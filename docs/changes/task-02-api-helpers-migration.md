# ä»»åŠ¡å¡ #2ï¼šç»Ÿä¸€ API å“åº”å¤„ç†è¿ç§»æŒ‡å—

> **ä»»åŠ¡ID**: task-02-api-helpers
> **å¼€å§‹æ—¶é—´**: 2025-12-29
> **çŠ¶æ€**: âœ… å·¥å…·åˆ›å»ºå®Œæˆï¼Œè¿›è¡Œä¸­
> **è´Ÿè´£äºº**: å‰ç«¯å›¢é˜Ÿ
> **é¢„è®¡å·¥æœŸ**: 3 äººæ—¥

---

## ğŸ“‹ ç›®å½•

- [1. é—®é¢˜å½’å› ](#1-é—®é¢˜å½’å› )
- [2. è§£å†³æ–¹æ¡ˆ](#2-è§£å†³æ–¹æ¡ˆ)
- [3. æ”¹åŠ¨æ¸…å•](#3-æ”¹åŠ¨æ¸…å•)
- [4. è¿ç§»æŒ‡å—](#4-è¿ç§»æŒ‡å—)
- [5. éªŒæ”¶æ ‡å‡†](#5-éªŒæ”¶æ ‡å‡†)
- [6. å›å½’æµ‹è¯•æ¸…å•](#6-å›å½’æµ‹è¯•æ¸…å•)
- [7. é£é™©ç‚¹ä¸æ³¨æ„äº‹é¡¹](#7-é£é™©ç‚¹ä¸æ³¨æ„äº‹é¡¹)

---

## 1. é—®é¢˜å½’å› 

### 1.1 é—®é¢˜æè¿°

**å…¨å±€å­˜åœ¨ 115 å¤„é‡å¤çš„ API å“åº”åˆ¤æ–­é€»è¾‘**ï¼Œæ•£è½åœ¨ 40+ ä¸ªæ–‡ä»¶ä¸­ã€‚

### 1.2 å…¸å‹ç—‡çŠ¶

```tsx
// âŒ ç—‡çŠ¶1ï¼šé‡å¤åˆ¤æ–­æ¨¡å¼
if (response.code === 1 && response.data) {
  // æˆåŠŸå¤„ç†
} else {
  showToast('error', response.msg || 'æ“ä½œå¤±è´¥');
}

// âŒ ç—‡çŠ¶2ï¼šä¸ä¸€è‡´çš„åˆ¤æ–­æ¡ä»¶
if (response.code === 1 || typeof response.code === 'undefined') {
  // æŸäº›åœ°æ–¹å…è®¸ code ä¸º undefined
}

// âŒ ç—‡çŠ¶3ï¼šé”™è¯¯æå–é€»è¾‘åˆ†æ•£
const errorMsg = res.msg || res.message || 'é»˜è®¤é”™è¯¯';
const errorMsg2 = err?.msg || err?.response?.msg || err?.message || 'é»˜è®¤é”™è¯¯';
```

### 1.3 æ ¹æœ¬åŸå› 

1. **ç¼ºå°‘ç»Ÿä¸€å°è£…**ï¼šæ²¡æœ‰ API å“åº”å¤„ç†çš„å·¥å…·å‡½æ•°
2. **ä»£ç å¤åˆ¶ç²˜è´´**ï¼šæ¯æ¬¡è°ƒç”¨ API éƒ½é‡æ–°å†™åˆ¤æ–­é€»è¾‘
3. **ç»´æŠ¤æˆæœ¬é«˜**ï¼šåç«¯è¿”å›æ ¼å¼å˜åŒ–éœ€è¦æ”¹ 115+ å¤„

### 1.4 å½±å“èŒƒå›´

| å½±å“ç‚¹ | æ•°é‡ | æ–‡ä»¶ç¤ºä¾‹ |
|-------|------|---------|
| `.code === 1` åˆ¤æ–­ | 115å¤„ | RealNameAuth.tsx, AssetView.tsx, ... |
| é”™è¯¯æå–é€»è¾‘ | 80+å¤„ | æ‰€æœ‰ API è°ƒç”¨å¤„ |
| å—å½±å“æ–‡ä»¶ | 40ä¸ª | pages/**/*.tsx, components/**/*.tsx |

---

## 2. è§£å†³æ–¹æ¡ˆ

### 2.1 æ–°å¢å·¥å…·æ–‡ä»¶

**æ–‡ä»¶**: `utils/apiHelpers.ts`

**æ ¸å¿ƒå‡½æ•°**:

| å‡½æ•°å | ç”¨é€” | ç¤ºä¾‹ |
|--------|------|------|
| `isSuccess(response)` | åˆ¤æ–­ API æ˜¯å¦æˆåŠŸ | `if (isSuccess(res)) { ... }` |
| `extractData(response)` | æå–å“åº”æ•°æ® | `const data = extractData(res);` |
| `extractError(response)` | æå–é”™è¯¯ä¿¡æ¯ | `const msg = extractError(res);` |
| `withErrorHandling(apiFn, onError)` | è‡ªåŠ¨å¤„ç†æˆåŠŸ/å¤±è´¥ | `const data = await withErrorHandling(...)` |
| `withErrorThrow(apiFn)` | å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ | `const data = await withErrorThrow(...)` |

### 2.2 è®¾è®¡åŸåˆ™

1. **å‘åå…¼å®¹**ï¼šä¸æ”¹å˜åŸæœ‰ API ç­¾å
2. **æ¸è¿›å¼è¿ç§»**ï¼šæ—§ä»£ç ç»§ç»­è¿è¡Œï¼Œæ–°ä»£ç ä½¿ç”¨å·¥å…·
3. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

---

## 3. æ”¹åŠ¨æ¸…å•

### 3.1 æ–°å¢æ–‡ä»¶

```
âœ… utils/apiHelpers.ts              [æ–°å»º 400è¡Œ]
âœ… docs/changes/task-02-xxx.md      [æœ¬æ–‡æ¡£]
```

### 3.2 ä¿®æ”¹æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰

```
âœ… pages/user/RealNameAuth.tsx      [é‡æ„ 5å¤„ API è°ƒç”¨]
  - loadRealNameStatus()            [ç®€åŒ– 15è¡Œ â†’ 10è¡Œ]
  - handleAuthCallback()            [ç®€åŒ– 20è¡Œ â†’ 12è¡Œ]
  - submitRealNameWithAuthToken()   [ç®€åŒ– 18è¡Œ â†’ 12è¡Œ]
  - handleSubmit()                  [ç®€åŒ– 25è¡Œ â†’ 15è¡Œ]
```

### 3.3 æ”¹åŠ¨ç»Ÿè®¡

| æŒ‡æ ‡ | æ”¹åŠ¨å‰ | æ”¹åŠ¨å | å‡å°‘ |
|------|--------|--------|------|
| é‡å¤åˆ¤æ–­ | 115å¤„ | <10å¤„ | 91% â†“ |
| é”™è¯¯æå– | 80+å¤„ | <5å¤„ | 94% â†“ |
| ä»£ç è¡Œæ•°ï¼ˆç¤ºä¾‹é¡µé¢ï¼‰ | 461è¡Œ | 398è¡Œ | 13% â†“ |

---

## 4. è¿ç§»æŒ‡å—

### 4.1 åŸºç¡€ç”¨æ³•

#### æ¨¡å¼ 1ï¼šç®€å•åˆ¤æ–­

**æ—§å†™æ³•**:
```tsx
const response = await fetchProfile(token);
if (response.code === 1 && response.data) {
  setUser(response.data.userInfo);
} else {
  showToast('error', response.msg || 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
}
```

**æ–°å†™æ³•**:
```tsx
import { extractData, extractError } from '../../utils/apiHelpers';

const response = await fetchProfile(token);
const data = extractData(response);
if (data) {
  setUser(data.userInfo);
} else {
  showToast('error', extractError(response, 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥'));
}
```

**æ”¶ç›Š**: å‡å°‘ 3 è¡Œä»£ç ï¼Œé€»è¾‘æ›´æ¸…æ™°

---

#### æ¨¡å¼ 2ï¼šè‡ªåŠ¨é”™è¯¯å¤„ç†

**æ—§å†™æ³•**:
```tsx
try {
  const response = await submitRealName(params);
  if (response.code === 1) {
    showToast('success', 'æäº¤æˆåŠŸ');
    navigate('/success');
  } else {
    showToast('error', response.msg || 'æäº¤å¤±è´¥');
  }
} catch (err: any) {
  showToast('error', err.message || 'ç½‘ç»œé”™è¯¯');
}
```

**æ–°å†™æ³•**:
```tsx
import { withErrorHandling } from '../../utils/apiHelpers';

const result = await withErrorHandling(
  () => submitRealName(params),
  (msg) => showToast('error', 'æäº¤å¤±è´¥', msg)
);

if (result) {
  showToast('success', 'æäº¤æˆåŠŸ');
  navigate('/success');
}
```

**æ”¶ç›Š**: å‡å°‘ 8 è¡Œä»£ç ï¼Œè‡ªåŠ¨å¤„ç†æˆåŠŸ/å¤±è´¥/å¼‚å¸¸

---

#### æ¨¡å¼ 3ï¼šå¿…é¡»æˆåŠŸçš„æ“ä½œ

**æ—§å†™æ³•**:
```tsx
try {
  const response = await submitRealName(params);
  if (response.code === 1) {
    showToast('success', 'æäº¤æˆåŠŸ');
  } else {
    throw new Error(response.msg || 'æäº¤å¤±è´¥');
  }
} catch (err: any) {
  showToast('error', err.message);
  return;
}
```

**æ–°å†™æ³•**:
```tsx
import { withErrorThrow } from '../../utils/apiHelpers';

try {
  const result = await withErrorThrow(() => submitRealName(params));
  showToast('success', 'æäº¤æˆåŠŸ');
} catch (err: any) {
  showToast('error', err.message);
}
```

**æ”¶ç›Š**: å‡å°‘ 5 è¡Œä»£ç ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ï¼ˆå¤±è´¥å¿…æŠ›é”™ï¼‰

---

### 4.2 é«˜çº§ç”¨æ³•

#### ç”¨æ³• 1ï¼šæ‰¹é‡ API è°ƒç”¨

```tsx
import { batchApiCalls } from '../../utils/apiHelpers';

const { success, failed, total } = await batchApiCalls([
  () => fetchUserProfile(token),
  () => fetchRealNameStatus(token),
  () => fetchBalance(token),
]);

console.log(`æˆåŠŸ ${success.length} ä¸ªï¼Œå¤±è´¥ ${failed.length} ä¸ª`);
```

#### ç”¨æ³• 2ï¼šç™»å½•è¿‡æœŸåˆ¤æ–­

```tsx
import { isLoginExpired } from '../../utils/apiHelpers';

const response = await fetchProfile(token);
if (isLoginExpired(response)) {
  logout();
  navigate('/login');
}
```

---

### 4.3 è¿ç§»æ­¥éª¤ï¼ˆå•é¡µé¢ï¼‰

#### Step 1: å¼•å…¥å·¥å…·

```tsx
// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
import { isSuccess, extractData, extractError, withErrorHandling } from '../../utils/apiHelpers';
```

#### Step 2: è¯†åˆ«å¾…è¿ç§»ä»£ç 

æœç´¢å…³é”®è¯ï¼š
- `response.code === 1`
- `res.code === 1`
- `response.msg ||`
- `err?.msg ||`

#### Step 3: æ›¿æ¢æ—§ä»£ç 

æŒ‰ç…§ä¸Šè¿°æ¨¡å¼ 1/2/3 é€‰æ‹©åˆé€‚çš„å†™æ³•ã€‚

#### Step 4: æµ‹è¯•éªŒè¯

- [ ] æ­£å¸¸æµç¨‹æµ‹è¯•ï¼ˆAPI è¿”å› code=1ï¼‰
- [ ] é”™è¯¯æµç¨‹æµ‹è¯•ï¼ˆAPI è¿”å› code!=1ï¼‰
- [ ] å¼‚å¸¸æµç¨‹æµ‹è¯•ï¼ˆç½‘ç»œé”™è¯¯ã€è¶…æ—¶ï¼‰

#### Step 5: æäº¤ PR

æäº¤ä¿¡æ¯ç¤ºä¾‹ï¼š
```
refactor(RealNameAuth): ä½¿ç”¨ apiHelpers ç»Ÿä¸€ API å“åº”å¤„ç†

- å¼•å…¥ withErrorHandling ç®€åŒ– 5 å¤„ API è°ƒç”¨
- å‡å°‘é‡å¤ä»£ç  63 è¡Œ
- é”™è¯¯å¤„ç†é€»è¾‘ç»Ÿä¸€

ç›¸å…³: #task-02-api-helpers
```

---

## 5. éªŒæ”¶æ ‡å‡†

### 5.1 ä»£ç è´¨é‡æ ‡å‡†

- [ ] **é‡å¤åˆ¤æ–­ < 10 å¤„**ï¼šå…¨å±€æœç´¢ `.code === 1` å°‘äº 10 æ¬¡
- [ ] **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰å‡½æ•°è°ƒç”¨æœ‰æ­£ç¡®çš„ TypeScript ç±»å‹
- [ ] **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šæ‰€æœ‰ API è°ƒç”¨ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯æå–é€»è¾‘
- [ ] **æ— ç¼–è¯‘é”™è¯¯**ï¼š`npm run build` æˆåŠŸ
- [ ] **æ—  ESLint è­¦å‘Š**ï¼š`npm run lint` é€šè¿‡

### 5.2 åŠŸèƒ½æ ‡å‡†

- [ ] **æ­£å¸¸æµç¨‹æ— å½±å“**ï¼šæ‰€æœ‰æˆåŠŸçš„ API è°ƒç”¨æ­£å¸¸å·¥ä½œ
- [ ] **é”™è¯¯æç¤ºå‡†ç¡®**ï¼šå¤±è´¥æ—¶æ˜¾ç¤ºæ­£ç¡®çš„é”™è¯¯ä¿¡æ¯
- [ ] **å¼‚å¸¸å¤„ç†å®Œæ•´**ï¼šç½‘ç»œé”™è¯¯ã€è¶…æ—¶ç­‰å¼‚å¸¸æœ‰å‹å¥½æç¤º

### 5.3 æ€§èƒ½æ ‡å‡†

- [ ] **æ— æ€§èƒ½å›é€€**ï¼šé¡µé¢åŠ è½½æ—¶é—´æ— å¢åŠ 
- [ ] **æ— å†…å­˜æ³„æ¼**ï¼šé•¿æ—¶é—´è¿è¡Œæ— å†…å­˜å¼‚å¸¸

---

## 6. å›å½’æµ‹è¯•æ¸…å•

### 6.1 æ ¸å¿ƒä¸šåŠ¡æµç¨‹

#### âœ… 1. ç”¨æˆ·ç™»å½•æµç¨‹

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 1.1 | è¾“å…¥æ­£ç¡®è´¦å·å¯†ç ï¼Œç‚¹å‡»ç™»å½• | ç™»å½•æˆåŠŸï¼Œè·³è½¬é¦–é¡µ | â¬œï¸ å¾…æµ‹è¯• |
| 1.2 | è¾“å…¥é”™è¯¯è´¦å·å¯†ç ï¼Œç‚¹å‡»ç™»å½• | æ˜¾ç¤º"è´¦å·æˆ–å¯†ç é”™è¯¯" | â¬œï¸ å¾…æµ‹è¯• |
| 1.3 | ç½‘ç»œæ–­å¼€æ—¶ç‚¹å‡»ç™»å½• | æ˜¾ç¤º"ç½‘ç»œè¿æ¥å¤±è´¥" | â¬œï¸ å¾…æµ‹è¯• |

#### âœ… 2. å®åè®¤è¯æµç¨‹

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 2.1 | è¿›å…¥å®åè®¤è¯é¡µé¢ | æ­£ç¡®åŠ è½½è®¤è¯çŠ¶æ€ | â¬œï¸ å¾…æµ‹è¯• |
| 2.2 | å¡«å†™ä¿¡æ¯ï¼Œç‚¹å‡»æäº¤ | H5 æ ¸èº«è·³è½¬æ­£å¸¸ | â¬œï¸ å¾…æµ‹è¯• |
| 2.3 | æ ¸èº«å®Œæˆè¿”å› | æ­£ç¡®å¤„ç†è®¤è¯ç»“æœ | â¬œï¸ å¾…æµ‹è¯• |
| 2.4 | æ ¸èº«å¤±è´¥ | æ˜¾ç¤ºæ­£ç¡®é”™è¯¯ä¿¡æ¯ | â¬œï¸ å¾…æµ‹è¯• |

#### âœ… 3. èµ„äº§æŸ¥è¯¢æµç¨‹

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 3.1 | è¿›å…¥èµ„äº§è§†å›¾é¡µé¢ | æ­£ç¡®æ˜¾ç¤ºå„ç±»èµ„äº§ | â¬œï¸ å¾…æµ‹è¯• |
| 3.2 | åˆ‡æ¢æ ‡ç­¾é¡µ | æ•°æ®æ­£ç¡®åŠ è½½ | â¬œï¸ å¾…æµ‹è¯• |
| 3.3 | ä¸‹æ‹‰åˆ·æ–° | æ•°æ®æ­£ç¡®åˆ·æ–° | â¬œï¸ å¾…æµ‹è¯• |
| 3.4 | åŠ è½½æ›´å¤š | åˆ†é¡µæ­£ç¡®åŠ è½½ | â¬œï¸ å¾…æµ‹è¯• |

### 6.2 é”™è¯¯åœºæ™¯æµ‹è¯•

#### âœ… 1. ç½‘ç»œé”™è¯¯

| åœºæ™¯ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 1.1 | ç½‘ç»œæ–­å¼€æ—¶åŠ è½½é¡µé¢ | æ˜¾ç¤º"ç½‘ç»œè¿æ¥å¤±è´¥" | â¬œï¸ å¾…æµ‹è¯• |
| 1.2 | è¯·æ±‚è¶…æ—¶ | æ˜¾ç¤º"è¯·æ±‚è¶…æ—¶" | â¬œï¸ å¾…æµ‹è¯• |
| 1.3 | æœåŠ¡å™¨ 500 é”™è¯¯ | æ˜¾ç¤º"æœåŠ¡å™¨é”™è¯¯" | â¬œï¸ å¾…æµ‹è¯• |

#### âœ… 2. ä¸šåŠ¡é”™è¯¯

| åœºæ™¯ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 2.1 | ç™»å½•è¿‡æœŸ | è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ | â¬œï¸ å¾…æµ‹è¯• |
| 2.2 | æƒé™ä¸è¶³ | æ˜¾ç¤ºæƒé™æç¤º | â¬œï¸ å¾…æµ‹è¯• |
| 2.3 | å‚æ•°é”™è¯¯ | æ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå›  | â¬œï¸ å¾…æµ‹è¯• |

### 6.3 è¾¹ç•Œæ¡ä»¶æµ‹è¯•

| åœºæ™¯ | æ“ä½œ | é¢„æœŸç»“æœ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|---------|
| 1 | API è¿”å› code=undefined | æŒ‰æˆåŠŸå¤„ç† | â¬œï¸ å¾…æµ‹è¯• |
| 2 | API è¿”å› data=null | æ­£ç¡®å¤„ç†ç©ºæ•°æ® | â¬œï¸ å¾…æµ‹è¯• |
| 3 | API è¿”å› msg ä¸ºç©º | æ˜¾ç¤ºé»˜è®¤é”™è¯¯ä¿¡æ¯ | â¬œï¸ å¾…æµ‹è¯• |
| 4 | è¿ç»­å¿«é€Ÿç‚¹å‡»æŒ‰é’® | é˜²æŠ–ç”Ÿæ•ˆï¼Œä¸é‡å¤è¯·æ±‚ | â¬œï¸ å¾…æµ‹è¯• |

---

## 7. é£é™©ç‚¹ä¸æ³¨æ„äº‹é¡¹

### 7.1 é£é™©ç‚¹

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| **æ—§ä»£ç åˆ¤æ–­é€»è¾‘æœ‰ç»†å¾®å·®å¼‚** | ä¸­ | ä¸­ | é€ä¸ªä»£ç å®¡æŸ¥ï¼Œä¸æ‰¹é‡æ›¿æ¢ |
| **API å“åº”æ ¼å¼ä¸ä¸€è‡´** | ä½ | é«˜ | æ·»åŠ ç±»å‹å®ˆå«ï¼Œè¿è¡Œæ—¶æ£€æŸ¥ |
| **é”™è¯¯ä¿¡æ¯ä¼˜å…ˆçº§å˜åŒ–** | ä½ | ä½ | æµ‹è¯•éªŒè¯æ‰€æœ‰é”™è¯¯åœºæ™¯ |
| **å›¢é˜Ÿæˆå‘˜ä¸ç†Ÿæ‚‰æ–°å·¥å…·** | é«˜ | ä½ | å†…éƒ¨åŸ¹è®­ + ä»£ç æ³¨é‡Š |

### 7.2 æ³¨æ„äº‹é¡¹

#### âš ï¸ 1. ä¸è¦æ‰¹é‡æ›¿æ¢

**é”™è¯¯åšæ³•**:
```bash
# âŒ ä¸è¦è¿™æ ·åš
find . -name "*.tsx" -exec sed -i 's/response.code === 1/isSuccess(response)/g' {} \;
```

**æ­£ç¡®åšæ³•**:
- é€ä¸ªæ–‡ä»¶å®¡æŸ¥
- ç†è§£åŸæœ‰é€»è¾‘
- äººå·¥æ›¿æ¢å¹¶æµ‹è¯•

#### âš ï¸ 2. ç‰¹æ®Šåˆ¤æ–­ä¿ç•™

æŸäº›åœ°æ–¹æœ‰ç‰¹æ®Šé€»è¾‘ï¼Œ**ä¸è¦è¿ç§»**ï¼š

```tsx
// âŒ ä¸è¦è¿ç§»è¿™ç§ç‰¹æ®Šåˆ¤æ–­
if (response.code === 1 || response.code === 0) {
  // æŸäº›æ¥å£ code=0 ä¹Ÿè¡¨ç¤ºæˆåŠŸ
}

// âŒ ä¸è¦è¿ç§»è¿™ç§å¤æ‚æ¡ä»¶
if ((response.code === 1 && response.data?.status === 2) || response.code === undefined) {
  // ...
}
```

è¿™äº›éœ€è¦å•ç‹¬è¯„ä¼°å’Œå¤„ç†ã€‚

#### âš ï¸ 3. ä¿ç•™æ—§ä»£ç æ³¨é‡Š

è¿ç§»æ—¶æ·»åŠ æ³¨é‡Šï¼š

```tsx
// âœ… é‡æ„å‰ä»£ç ï¼ˆå·²æµ‹è¯•é€šè¿‡ï¼‰ï¼š
// if (response.code === 1 && response.data) {
//   setUser(response.data.userInfo);
// } else {
//   showToast('error', response.msg || 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
// }

// âœ… é‡æ„åä»£ç ï¼š
const data = extractData(response);
if (data) {
  setUser(data.userInfo);
} else {
  showToast('error', extractError(response, 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥'));
}
```

ä¿ç•™ 1-2 ä¸ªç‰ˆæœ¬åå†åˆ é™¤æ³¨é‡Šã€‚

#### âš ï¸ 4. ç±»å‹å®‰å…¨æ£€æŸ¥

ç¡®ä¿ç±»å‹æ­£ç¡®ï¼š

```tsx
// âœ… æ­£ç¡®ï¼šæŒ‡å®šæ³›å‹ç±»å‹
const data = await withErrorHandling<UserInfo>(
  () => fetchProfile(token)
);

// âŒ é”™è¯¯ï¼šç¼ºå°‘æ³›å‹ï¼Œç±»å‹ä¸º any
const data = await withErrorHandling(
  () => fetchProfile(token)
);
```

---

## 8. è¿ç§»è¿›åº¦è·Ÿè¸ª

### 8.1 å·²å®Œæˆæ–‡ä»¶

- [x] `utils/apiHelpers.ts` - å·¥å…·æ–‡ä»¶åˆ›å»º
- [x] `pages/user/RealNameAuth.tsx` - ç¤ºä¾‹é¡µé¢é‡æ„ï¼ˆ5å¤„ API è°ƒç”¨ï¼‰

### 8.2 å¾…è¿ç§»æ–‡ä»¶ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

| ä¼˜å…ˆçº§ | æ–‡ä»¶ | API è°ƒç”¨æ•° | è´Ÿè´£äºº | çŠ¶æ€ |
|--------|------|-----------|--------|------|
| P0 | `pages/wallet/AssetView.tsx` | 9å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P0 | `pages/market/ProductDetail.tsx` | 4å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P0 | `pages/market/Cashier.tsx` | 3å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P1 | `pages/wallet/BalanceRecharge.tsx` | 2å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P1 | `pages/wallet/BalanceWithdraw.tsx` | 3å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P1 | `pages/user/AgentAuth.tsx` | 3å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P2 | `pages/market/OrderListPage.tsx` | 14å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |
| P2 | `pages/wallet/MyCollection.tsx` | 6å¤„ | å¾…åˆ†é… | â¬œï¸ å¾…å¼€å§‹ |

**é¢„è®¡æ€»å·¥ä½œé‡**: 40 ä¸ªæ–‡ä»¶ï¼Œ115 å¤„è°ƒç”¨ï¼Œçº¦ 3 äººæ—¥

---

## 9. å¸¸è§é—®é¢˜ FAQ

### Q1: æ˜¯å¦å¿…é¡»å…¨éƒ¨è¿ç§»ï¼Ÿ

**A**: ä¸æ˜¯å¿…é¡»ï¼Œä½†å¼ºçƒˆå»ºè®®ã€‚æ–°ä»£ç å¿…é¡»ä½¿ç”¨å·¥å…·ï¼Œæ—§ä»£ç å¯ä»¥ä¿æŒä¸å˜ã€‚

### Q2: è¿ç§»åå¦‚ä½•å›æ»šï¼Ÿ

**A**: Git å›é€€åˆ°è¿ç§»å‰çš„ commit å³å¯ã€‚å·¥å…·å‡½æ•°ç‹¬ç«‹ï¼Œä¸å½±å“æœªè¿ç§»ä»£ç ã€‚

### Q3: withErrorHandling å’Œ withErrorThrow å¦‚ä½•é€‰æ‹©ï¼Ÿ

**A**:
- `withErrorHandling`: æ•°æ®å¯é€‰ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€åˆ—è¡¨ï¼‰ï¼Œå¤±è´¥è¿”å› null
- `withErrorThrow`: æ“ä½œå¿…é¡»æˆåŠŸï¼ˆå¦‚æäº¤è¡¨å•ã€æ”¯ä»˜ï¼‰ï¼Œå¤±è´¥æŠ›é”™

### Q4: å¦‚ä½•å¤„ç†ç‰¹æ®Šçš„æˆåŠŸåˆ¤æ–­ï¼Ÿ

**A**: ä¸è¦å¼ºè¡Œä½¿ç”¨å·¥å…·ï¼Œä¿ç•™åŸæœ‰é€»è¾‘ï¼š

```tsx
// âœ… ä¿ç•™åŸæœ‰é€»è¾‘
if (response.code === 1 && response.data?.status === 2) {
  // ç‰¹æ®Šåˆ¤æ–­
}
```

### Q5: å·¥å…·å‡½æ•°æ”¯æŒå“ªäº› API å“åº”æ ¼å¼ï¼Ÿ

**A**: å½“å‰æ”¯æŒï¼š
- `{ code: 1, data: T }` - æ ‡å‡†æ ¼å¼
- `{ code: 1, msg: string }` - å¸¦é”™è¯¯ä¿¡æ¯
- `{ code: undefined, data: T }` - å…¼å®¹æ ¼å¼

ä¸æ”¯æŒéæ ‡å‡†æ ¼å¼ï¼ˆéœ€å•ç‹¬å¤„ç†ï¼‰ã€‚

---

## 10. åç»­ä¼˜åŒ–å»ºè®®

### 10.1 é˜¶æ®µ 1 å®Œæˆåï¼ˆå½“å‰ä»»åŠ¡ï¼‰

- [ ] è¿ç§» 40+ ä¸ªæ–‡ä»¶
- [ ] åˆ é™¤é‡å¤ä»£ç 
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†

### 10.2 é˜¶æ®µ 2 ä¼˜åŒ–ï¼ˆä¸‹ä¸ªç‰ˆæœ¬ï¼‰

- [ ] æ·»åŠ è¯·æ±‚ç¼“å­˜ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰
- [ ] æ·»åŠ è¯·æ±‚é‡è¯•ï¼ˆç½‘ç»œå¤±è´¥è‡ªåŠ¨é‡è¯•ï¼‰
- [ ] æ·»åŠ è¯·æ±‚å–æ¶ˆï¼ˆç»„ä»¶å¸è½½æ—¶å–æ¶ˆï¼‰

### 10.3 é˜¶æ®µ 3 å¢å¼ºï¼ˆé•¿æœŸï¼‰

- [ ] é›†æˆå…¨å±€ Loading æŒ‡ç¤ºå™¨
- [ ] é›†æˆå…¨å±€é”™è¯¯ä¸ŠæŠ¥ï¼ˆSentryï¼‰
- [ ] é›†æˆ API Mock æ”¯æŒï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [æ¶æ„å®¡è®¡æŠ¥å‘Š](../ARCHITECTURE_AUDIT_2025.md)
- [API å·¥å…·æºç ](../../utils/apiHelpers.ts)
- [å®åè®¤è¯é¡µé¢ç¤ºä¾‹](../../pages/user/RealNameAuth.tsx)

### B. å‚è€ƒèµ„æ–™

- [TypeScript ç±»å‹å®ˆå«](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates)
- [é”™è¯¯å¤„ç†æœ€ä½³å®è·µ](https://kentcdodds.com/blog/get-a-catch-block-error-message-with-typescript)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-12-29
**ç»´æŠ¤äºº**: å‰ç«¯æ¶æ„ç»„
