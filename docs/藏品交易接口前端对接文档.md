# 藏品交易接口前端对接文档

版本: v2.0  
更新日期: 2026-01-22  
基础路径: `/api`

---

## 目录

- [一、概览](#一概览)
- [二、路由迁移说明](#二路由迁移说明)
- [三、业务共识](#三业务共识)
- [四、CollectionTrade - 交易管理](#四collectiontrade---交易管理)
- [五、CollectionConsignment - 寄售管理](#五collectionconsignment---寄售管理)
- [六、CollectionItem - 商品浏览](#六collectionitem---商品浏览)
- [七、错误处理](#七错误处理)
- [八、前端对接建议](#八前端对接建议)

---

## 一、概览

### 1.1 请求格式

- **请求方式**: 支持 `GET` 和 `POST`
- **Content-Type**: `application/json` 或 `application/x-www-form-urlencoded`
- **字符编码**: UTF-8

### 1.2 响应格式

所有接口统一返回格式：

```json
{
    "code": 1,           // 1=成功, 0=失败
    "message": "",       // 提示信息
    "msg": "",           // 提示信息（兼容字段）
    "time": 1705284600,  // 服务器时间戳
    "data": {}           // 数据内容
}
```

### 1.3 认证说明

- **认证方式**: 在请求头中携带 `batoken`
- **无需登录的接口**:
  - CollectionTrade: `tradeList`, `queryByCode`
  - CollectionItem: `index`, `detail`, `bySession`
- **需要登录的接口**: 其他所有接口

### 1.4 分页参数

| 参数名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| page | int | 页码 | 1 |
| limit | int | 每页数量（最大50） | 10 |

### 1.5 通用分页响应字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list | array | 数据列表 |
| total | int | 总记录数 |
| per_page / limit | int | 每页数量 |
| current_page / page | int | 当前页码 |
| last_page | int | 最后一页 |
| has_more | bool | 是否有更多数据 |

---

## 二、路由迁移说明

### 2.1 路由拆分架构

原 `CollectionItem` 控制器已拆分为三个专职控制器：

| 新控制器 | 职责 | 基础路径 |
|----------|------|----------|
| CollectionTrade | 交易与用户藏品管理 | `/api/collectionTrade` |
| CollectionConsignment | 寄售管理 | `/api/collectionConsignment` |
| CollectionItem | 商品浏览（保留） | `/api/collectionItem` |

### 2.2 路由迁移对照表

#### 交易相关（迁移至 CollectionTrade）

| 旧路由 | 新路由 | 状态 |
|--------|--------|------|
| `/api/collectionItem/tradeList` | `/api/collectionTrade/tradeList` | ✅ 已迁移 |
| `/api/collectionItem/myCollection` | `/api/collectionTrade/myCollection` | ✅ 已迁移 |
| `/api/collectionItem/purchaseRecords` | `/api/collectionTrade/purchaseRecords` | ✅ 已迁移 |
| `/api/collectionItem/orderDetail` | `/api/collectionTrade/orderDetail` | ✅ 已迁移 |
| `/api/collectionItem/toMining` | `/api/collectionTrade/toMining` | ✅ 已迁移 |
| `/api/collectionItem/queryByCode` | `/api/collectionTrade/queryByCode` | ✅ 已迁移 |
| `/api/collectionItem/deliveryList` | `/api/collectionTrade/deliveryList` | ⚠️ 已废弃 |
| `/api/collectionItem/rightsDeliver` | `/api/collectionTrade/rightsDeliver` | ⚠️ 已废弃 |

#### 寄售相关（迁移至 CollectionConsignment）

| 旧路由 | 新路由 | 状态 |
|--------|--------|------|
| `/api/collectionItem/consign` | `/api/collectionConsignment/consign` | ✅ 已迁移 |
| `/api/collectionItem/batchConsign` | `/api/collectionConsignment/batchConsign` | ✅ 已迁移 |
| `/api/collectionItem/batchConsignableList` | `/api/collectionConsignment/batchConsignableList` | ✅ 已迁移 |
| `/api/collectionItem/consignmentCheck` | `/api/collectionConsignment/consignmentCheck` | ✅ 已迁移 |
| `/api/collectionItem/myConsignmentList` | `/api/collectionConsignment/myConsignmentList` | ✅ 已迁移 |
| `/api/collectionItem/consignmentDetail` | `/api/collectionConsignment/consignmentDetail` | ✅ 已迁移 |
| `/api/collectionItem/cancelConsignment` | `/api/collectionConsignment/cancelConsignment` | ✅ 已迁移 |

#### 预约相关（迁移至 CollectionReservation）

| 旧路由 | 新路由 | 状态 |
|--------|--------|------|
| `/api/collectionItem/bidBuy` | `/api/collectionReservation/bidBuy` | ✅ 已迁移 |
| `/api/collectionItem/reservations` | `/api/collectionReservation/reservations` | ✅ 已迁移 |
| `/api/collectionItem/reservationDetail` | `/api/collectionReservation/reservationDetail` | ✅ 已迁移 |

#### 商品浏览（保留在 CollectionItem）

| 路由 | 状态 |
|------|------|
| `/api/collectionItem/index` | ✅ 保留 |
| `/api/collectionItem/detail` | ✅ 保留 |
| `/api/collectionItem/bySession` | ✅ 保留 |

### 2.3 废弃接口处理

调用已废弃的旧路由将返回 `410 Gone` 状态码：

```json
{
    "code": 0,
    "msg": "此接口已废弃，请使用 /api/collectionConsignment/xxx",
    "data": null
}
```

---

## 三、业务共识

### 3.1 价格分区规则

价格分区按 100 元一档进行划分：

| zone_id | 分区名称 | 价格范围 |
|---------|----------|----------|
| 1 | 100元区 | 0.01 - 100.00 |
| 2 | 200元区 | 100.01 - 200.00 |
| 3 | 300元区 | 200.01 - 300.00 |
| ... | ... | ... |
| 10 | 1000元区 | 900.01 - 1000.00 |
| 11 | 1100元区 | 1000.01 - 1100.00 |

**计算规则**：`zone_id = ceil(price / 100)`

### 3.2 首次交易逻辑（旧资产解锁）

通过旧资产解锁获得的藏品，在 `user_collection` 表中会标记 `is_old_asset_package = 1`。

**首次交易特殊规则**：
- 寄售价格：使用用户购买价格（不增值）
- 利润分配：本金对半分（50%可提现余额 + 50%消费金）
- 后续交易：买家获得藏品后 `is_old_asset_package = 0`，按正常增值逻辑处理

### 3.3 藏品字段来源

| 字段 | 来源表 | 说明 |
|------|--------|------|
| asset_code | collection_item | 确权编号 |
| fingerprint/tx_hash | collection_item | MD5存证指纹 |
| rights_hash | user_collection / collection_item | 区块链确权哈希 |
| user_collection_id | user_collection | 用户藏品记录ID |
| consignment_status | user_collection | 寄售状态 |
| mining_status | user_collection | 矿机状态 |

### 3.4 寄售状态说明

| 状态值 | 说明 |
|--------|------|
| 0 | 已取消/未寄售 |
| 1 | 寄售中 |
| 2 | 已售出 |
| 3 | 流拍失败 |

### 3.5 矿机/分红状态说明

| 状态值 | 说明 |
|--------|------|
| 0 | 非矿机状态 |
| 1 | 矿机运行中（参与每日分红） |

**注意**：矿机状态的藏品无法寄售，需先退出矿机。

---

## 四、CollectionTrade - 交易管理

基础路径：`/api/collectionTrade`

### 4.1 寄售交易区列表

**接口地址**：`GET /api/collectionTrade/tradeList`

**是否需要登录**：否

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量（最大50） | 10 |
| session_id | int | 否 | 专场ID | - |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].id | int | 藏品ID |
| list[].session_id | int | 专场ID |
| list[].title | string | 藏品标题 |
| list[].image | string | 藏品图片URL |
| list[].price | float | 最低寄售价格 |
| list[].stock | int | 在售数量 |
| list[].sales | int | 销量 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "id": 1,
                "session_id": 2,
                "title": "创世节点算力权益证",
                "image": "https://example.com/image.jpg",
                "price": 1000.00,
                "stock": 5,
                "sales": 0
            }
        ],
        "total": 100,
        "page": 1,
        "limit": 10
    }
}
```

---

### 4.2 我的藏品列表

**接口地址**：`GET /api/collectionTrade/myCollection`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量 | 10 |
| status | string | 否 | 状态筛选 | holding |

**status 参数说明**：

| 值 | 说明 |
|----|------|
| all | 全部（持有中+寄售中+矿机中，不含已售出） |
| holding | 持有中（未寄售、非矿机状态） |
| consigned | 寄售中 |
| mining | 矿机中 |
| failed | 寄售失败 |
| sold | 已售出 |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].id | int | 用户藏品ID |
| list[].unique_id | string | 唯一标识ID |
| list[].title | string | 藏品标题 |
| list[].image | string | 藏品图片 |
| list[].asset_code | string | 确权编号 |
| list[].hash | string | 藏品哈希 |
| list[].price | float | 买入价格 |
| list[].buy_price | float | 买入价格（兼容字段） |
| list[].market_price | float | 当前市场价 |
| list[].transaction_count | int | 交易次数 |
| list[].fail_count | int | 流拍次数 |
| list[].consignment_status | int | 寄售状态 |
| list[].status_text | string | 状态文本 |
| list[].session_id | int | 场次ID |
| list[].session_title | string | 场次标题 |
| list[].zone_id | int | 价格区间ID |
| list[].price_zone | string | 价格分区名称 |
| list[].mining_status | int | 矿机状态 |
| list[].mining_start_time | string | 矿机启动时间 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "id": 123,
                "unique_id": "123",
                "title": "创世节点算力权益证",
                "image": "https://example.com/image.jpg",
                "asset_code": "37-DATA-0037-0001",
                "hash": "0x1a2b3c4d...",
                "price": 1000.00,
                "buy_price": 1000.00,
                "market_price": 1200.00,
                "transaction_count": 5,
                "fail_count": 0,
                "consignment_status": 0,
                "status_text": "持有中",
                "session_id": 1,
                "session_title": "树交生态链专场",
                "zone_id": 10,
                "price_zone": "1000元区",
                "mining_status": 0,
                "mining_start_time": ""
            }
        ],
        "total": 50,
        "per_page": 10,
        "current_page": 1,
        "last_page": 5
    }
}
```

---

### 4.3 购买记录列表

**接口地址**：`GET /api/collectionTrade/purchaseRecords`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量（最大50） | 10 |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].order_id | int | 订单ID |
| list[].order_no | string | 订单号 |
| list[].total_amount | float | 订单金额 |
| list[].status | string | 订单状态 |
| list[].pay_type | string | 支付方式 |
| list[].pay_type_text | string | 支付方式文本 |
| list[].pay_time | int | 支付时间戳 |
| list[].pay_time_text | string | 支付时间 |
| list[].item_id | int | 藏品ID |
| list[].item_title | string | 藏品标题 |
| list[].item_image | string | 藏品图片 |
| list[].price | float | 单价 |
| list[].quantity | int | 数量 |
| list[].subtotal | float | 小计 |
| list[].asset_code | string | 确权编号 |
| list[].fingerprint | string | MD5存证指纹 |
| list[].user_collection_id | int | 用户藏品ID |
| list[].status_text | string | 状态文本 |
| list[].consignment_status | string | 寄售状态文本 |
| list[].free_consign_attempts | int | 免费寄售次数 |
| consignment_coupon | int | 用户剩余寄售券数量 |

**status_text 可能的取值**：

| 值 | 说明 |
|----|------|
| 待寄售 | 未寄售 |
| 寄售中 | 已寄售 |
| 已售出 | 已售出 |
| 已权益交割 | 已进行权益交割 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "order_id": 1001,
                "order_no": "BB202601151030000001",
                "total_amount": 1000.00,
                "status": "paid",
                "pay_type": "money",
                "pay_type_text": "余额支付",
                "pay_time": 1705284600,
                "pay_time_text": "2026-01-15 10:30:00",
                "buy_time_text": "2026-01-15 10:30:00",
                "item_id": 3739,
                "item_title": "创世节点算力权益证",
                "item_image": "https://example.com/image.jpg",
                "price": 1000.00,
                "quantity": 1,
                "subtotal": 1000.00,
                "asset_code": "37-DATA-0037-0001",
                "fingerprint": "0x1a2b3c4d...",
                "user_collection_id": 123,
                "status_text": "待寄售",
                "consignment_status": "",
                "free_consign_attempts": 1,
                "order_status": "paid",
                "order_status_text": "已支付"
            }
        ],
        "total": 30,
        "per_page": 10,
        "current_page": 1,
        "last_page": 3,
        "has_more": true,
        "consignment_coupon": 2
    }
}
```

---

### 4.4 订单详情

**接口地址**：`GET /api/collectionTrade/orderDetail`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 否 | 订单ID（与 order_no 二选一） |
| order_no | string | 否 | 订单号（与 id 二选一） |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "id": 1001,
        "order_no": "BB202601151030000001",
        "user_id": 123,
        "total_amount": 1000.00,
        "pay_type": "money",
        "pay_type_text": "余额支付",
        "status": "paid",
        "status_text": "已支付",
        "pay_time": 1705284600,
        "pay_time_text": "2026-01-15 10:30:00",
        "complete_time": 0,
        "complete_time_text": "",
        "create_time": 1705284600,
        "create_time_text": "2026-01-15 10:30:00",
        "remark": "",
        "items": [
            {
                "id": 1,
                "item_id": 3739,
                "item_title": "创世节点算力权益证",
                "item_image": "https://example.com/image.jpg",
                "price": 1000.00,
                "quantity": 1,
                "subtotal": 1000.00
            }
        ]
    }
}
```

---

### 4.5 转入挖矿/矿机

**接口地址**：`POST /api/collectionTrade/toMining`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_collection_id | int | 是 | 用户藏品记录ID |

**响应示例**：

```json
{
    "code": 1,
    "msg": "转入矿机成功",
    "data": {
        "user_collection_id": 123,
        "mining_status": 1,
        "mining_start_time": 1705284600,
        "mining_start_time_text": "2026-01-15 10:30:00"
    }
}
```

**错误情况**：

- 藏品不存在或无权操作
- 该藏品已经是矿机状态，无需重复操作
- 该藏品已售出，无法转为矿机

---

### 4.6 根据编码查询藏品

**接口地址**：`GET /api/collectionTrade/queryByCode`

**是否需要登录**：否

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| code | string | 是 | 确权编号或MD5指纹 |

**code 支持的格式**：

- 确权编号：`37-DATA-0037-0001`
- MD5指纹：`0x1a2b3c4d...` 或 `1a2b3c4d...`（自动识别 0x 前缀）

**响应示例**：

```json
{
    "code": 1,
    "msg": "查询成功",
    "data": {
        "id": 3739,
        "title": "创世节点算力权益证",
        "image": "https://example.com/image.jpg",
        "asset_code": "37-DATA-0037-0001",
        "tx_hash": "0x1a2b3c4d...",
        "fingerprint": "0x1a2b3c4d...",
        "price": 1000.00,
        "issue_price": 1000.00,
        "holder": {
            "user_id": 123,
            "username": "",
            "nickname": "用户昵称",
            "mobile": "138****5678"
        }
    }
}
```

**说明**：`holder` 字段仅当藏品已交付给用户且未售出时返回，否则为 `null`。

---

### 4.7 废弃接口

#### 4.7.1 交付列表（已废弃）

**接口地址**：`GET /api/collectionTrade/deliveryList`

**说明**：此接口已废弃，调用将返回错误。

#### 4.7.2 权益交付（已废弃）

**接口地址**：`POST /api/collectionTrade/rightsDeliver`

**说明**：此接口已废弃，调用将返回错误。

---

## 五、CollectionConsignment - 寄售管理

基础路径：`/api/collectionConsignment`

### 5.1 寄售藏品

**接口地址**：`POST /api/collectionConsignment/consign`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_collection_id | int | 是 | 用户藏品记录ID |

**业务规则**：

1. **寄售券要求**：首次寄售需要消耗 1 张寄售券
2. **服务费**：首次寄售收取 3% 服务费（从确权金扣除）
3. **代理折扣**：代理用户享受服务费折扣
4. **免费重发**：流拍后可无限次免费重新上架（不扣券、不扣服务费）
5. **解锁时间**：需满足系统配置的持有时长（如购买后 24 小时）
6. **场次时间**：只能在交易场次开放时间内寄售

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| consignment_id | int | 寄售记录ID |
| user_collection_id | int | 用户藏品ID |
| item_id | int | 藏品ID |
| consignment_price | float | 寄售价格 |
| service_fee | float | 服务费 |
| is_free_resend | bool | 是否免费重发 |
| waive_type | string | 豁免类型：none/free_attempt/system_resend |
| coupon_used | bool | 是否使用了寄售券 |
| coupon_remaining | int | 剩余寄售券数量 |
| free_attempts_remaining | int | 剩余免费寄售次数 |
| item_title | string | 藏品标题 |
| price_zone | string | 价格分区 |
| session_id | int | 场次ID |
| zone_id | int | 区间ID |
| package_name | string | 资产包名称 |
| listed_at | string | 上架时间 |
| expire_at | string | 预计过期时间（7天后） |

**响应示例**：

```json
{
    "code": 1,
    "msg": "寄售申请成功，已上架到寄售区",
    "data": {
        "consignment_id": 456,
        "user_collection_id": 123,
        "item_id": 3739,
        "consignment_price": 1000.00,
        "service_fee": 30.00,
        "is_free_resend": false,
        "waive_type": "none",
        "coupon_used": true,
        "coupon_deducted": 1,
        "coupon_remaining": 1,
        "free_attempts_used": 0,
        "free_attempts_remaining": 0,
        "item_title": "创世节点算力权益证",
        "price_zone": "1000元区",
        "session_id": 1,
        "zone_id": 10,
        "package_name": "树交生态链",
        "listed_at": "2026-01-22 10:30:00",
        "expire_at": "2026-01-29 10:30:00"
    }
}
```

**常见错误**：

| 错误信息 | 说明 |
|---------|------|
| 藏品记录不存在 | user_collection_id 无效 |
| 该藏品已转入分红，无法寄售 | 藏品处于矿机状态 |
| 该藏品当前正在寄售中，无法再次寄售 | 重复寄售 |
| 该藏品已售出，无法寄售 | 藏品已售出 |
| 购买N小时后才允许寄售 | 未满足持有时长 |
| 确权金不足，无法支付寄售手续费 | 余额不足 |
| 没有可用的寄售券，请先获取寄售券 | 寄售券不足 |
| 交易场次未开启 | 不在交易时间内 |

---

### 5.2 批量寄售

**接口地址**：`POST /api/collectionConsignment/batchConsign`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| consignments | array | 是 | 寄售列表（最大1000个） |
| consignments[].user_collection_id | int | 是 | 用户藏品记录ID |
| consignments[].price | float | 否 | 寄售价格（可忽略，默认使用原价） |

**响应示例**：

```json
{
    "code": 1,
    "message": "批量寄售处理完成",
    "data": {
        "total_count": 10,
        "success_count": 8,
        "failure_count": 2,
        "failure_summary": {
            "确权金不足，无法支付寄售手续费": 2
        },
        "results": [
            {
                "index": 0,
                "user_collection_id": 123,
                "success": true,
                "message": "寄售成功",
                "data": {
                    "consignment_id": 456,
                    "price": 1000.00,
                    "service_fee": 30.00,
                    "waive_type": "none"
                }
            },
            {
                "index": 1,
                "user_collection_id": 124,
                "success": false,
                "message": "确权金不足，无法支付寄售手续费"
            }
        ]
    }
}
```

---

### 5.3 可批量寄售列表

**接口地址**：`GET /api/collectionConsignment/batchConsignableList`

**是否需要登录**：是

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| stats.total_collections | int | 用户总藏品数 |
| stats.available_collections | int | 可寄售藏品数 |
| stats.current_time | string | 当前时间 |
| stats.active_sessions | int | 活跃场次数 |
| stats.is_in_trading_time | bool | 是否在交易时间内 |
| items | array | 可寄售藏品ID列表 |
| items[].user_collection_id | int | 用户藏品记录ID |
| available_now_count | int | 当前可寄售数量 |
| returned_items_count | int | 返回的藏品数量 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "获取成功",
    "data": {
        "stats": {
            "total_collections": 100,
            "available_collections": 50,
            "current_time": "10:30",
            "active_sessions": 2,
            "is_in_trading_time": true
        },
        "items": [
            { "user_collection_id": 123 },
            { "user_collection_id": 124 },
            { "user_collection_id": 125 }
        ],
        "available_now_count": 50,
        "returned_items_count": 50,
        "note": "显示真实的可用藏品ID列表，可直接用于批量寄售API"
    }
}
```

---

### 5.4 寄售检查

**接口地址**：`GET /api/collectionConsignment/consignmentCheck`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_collection_id | int | 是 | 用户藏品记录ID |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| can_consign | bool | 是否可以寄售 |
| unlock_hours | int | 解锁小时数（0表示购买后即可寄售） |
| buy_time | int | 购买时间戳 |
| unlock_time | int | 解锁时间戳 |
| remaining_seconds | int | 剩余解锁秒数 |
| message | string | 提示信息 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "can_consign": false,
        "unlock_hours": 24,
        "buy_time": 1705284600,
        "unlock_time": 1705371000,
        "remaining_seconds": 3600,
        "message": "购买24小时后才允许寄售，剩余约 1 小时"
    }
}
```

---

### 5.5 我的寄售列表

**接口地址**：`GET /api/collectionConsignment/myConsignmentList`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量（最大50） | 10 |
| status | int | 否 | 寄售状态：0=全部, 1=寄售中, 2=已售出, 3=已取消 | 0 |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].consignment_id | int | 寄售记录ID |
| list[].user_collection_id | int | 用户藏品ID |
| list[].item_id | int | 藏品ID |
| list[].title | string | 藏品标题 |
| list[].image | string | 藏品图片 |
| list[].original_price | float | 原价 |
| list[].consignment_price | float | 寄售价格 |
| list[].service_fee | float | 服务费 |
| list[].total_cost | float | 用户实际成本（寄售价格+服务费） |
| list[].consignment_status | int | 寄售状态 |
| list[].consignment_status_text | string | 寄售状态文本 |
| list[].create_time_text | string | 创建时间 |
| list[].days_passed | int | 已过天数 |
| list[].can_force_delivery | bool | 是否可强制提货（7天后） |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "consignment_id": 456,
                "user_id": 123,
                "user_collection_id": 789,
                "item_id": 3739,
                "title": "创世节点算力权益证",
                "image": "https://example.com/image.jpg",
                "original_price": 1000.00,
                "consignment_price": 1000.00,
                "service_fee": 30.00,
                "total_cost": 1030.00,
                "consignment_status": 1,
                "consignment_status_text": "寄售中",
                "create_time_text": "2026-01-22 10:30:00",
                "update_time_text": "2026-01-22 10:30:00",
                "days_passed": 3,
                "can_force_delivery": false
            }
        ],
        "total": 10,
        "per_page": 10,
        "current_page": 1,
        "last_page": 1,
        "has_more": false
    }
}
```

---

### 5.6 寄售详情

**接口地址**：`GET /api/collectionConsignment/consignmentDetail`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| consignment_id | int | 是 | 寄售记录ID |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| consignment_id | int | 寄售记录ID |
| user_collection_id | int | 用户藏品ID |
| item_id | int | 藏品ID |
| title | string | 藏品标题 |
| image | string | 藏品图片 |
| description | string | 藏品描述 |
| artist | string | 艺术家/创作者 |
| original_price | float | 原价 |
| consignment_price | float | 寄售价格 |
| consignment_status | int | 寄售状态 |
| consignment_status_text | string | 寄售状态文本 |
| create_time_text | string | 创建时间 |
| days_passed | int | 已过天数 |
| remaining_days | int | 剩余天数（7天后可强制提货） |
| can_force_delivery | bool | 是否可强制提货 |
| buyer_id | int | 买家用户ID（已售出时有值） |
| buyer_nickname | string | 买家昵称（已售出时有值） |
| buyer_mobile | string | 买家手机号（已售出时有值，脱敏） |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "consignment_id": 456,
        "user_id": 123,
        "user_collection_id": 789,
        "item_id": 3739,
        "title": "创世节点算力权益证",
        "image": "https://example.com/image.jpg",
        "description": "藏品描述内容...",
        "artist": "创作者名称",
        "original_price": 1000.00,
        "consignment_price": 1000.00,
        "consignment_status": 2,
        "consignment_status_text": "已售出",
        "create_time_text": "2026-01-22 10:30:00",
        "update_time_text": "2026-01-23 15:00:00",
        "days_passed": 1,
        "remaining_days": 0,
        "can_force_delivery": false,
        "buyer_id": 456,
        "buyer_username": "",
        "buyer_nickname": "买家昵称",
        "buyer_mobile": "138****5678"
    }
}
```

---

### 5.7 取消寄售

**接口地址**：`POST /api/collectionConsignment/cancelConsignment`

**是否需要登录**：是

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| consignment_id | int | 是 | 寄售记录ID |

**业务规则**：

- 只能取消状态为"寄售中"的记录
- 取消后寄售券会退还给用户
- 流拍失败的记录无法取消（已结束）

**响应示例**：

```json
{
    "code": 1,
    "msg": "取消寄售成功，寄售券已退还",
    "data": null
}
```

---

## 六、CollectionItem - 商品浏览

基础路径：`/api/collectionItem`

### 6.1 藏品商品列表

**接口地址**：`GET /api/collectionItem/index`

**是否需要登录**：否

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量（最大50） | 10 |
| session_id | int | 否 | 专场ID | - |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].id | int | 商品ID |
| list[].session_id | int | 专场ID |
| list[].title | string | 商品标题 |
| list[].image | string | 商品图片URL |
| list[].price | float | 价格 |
| list[].price_zone | string | 价格分区 |
| list[].stock | int | 库存 |
| list[].sales | int | 销量 |
| list[].session_name | string | 场次名称 |
| list[].session_start_time | string | 场次开始时间 |
| list[].session_end_time | string | 场次结束时间 |
| list[].is_trading_time | bool | 是否在交易时间内 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "id": 3739,
                "session_id": 1,
                "title": "创世节点算力权益证",
                "image": "https://example.com/image.jpg",
                "price": 1000.00,
                "price_zone": "1000元区",
                "stock": 100,
                "sales": 50,
                "session_name": "树交生态链专场",
                "session_start_time": "09:00",
                "session_end_time": "21:00",
                "is_trading_time": true
            }
        ],
        "total": 100,
        "page": 1,
        "limit": 10
    }
}
```

---

### 6.2 藏品商品详情

**接口地址**：`GET /api/collectionItem/detail`

**是否需要登录**：否

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 商品ID |

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| object_type | string | 对象类型（固定为 "item"） |
| id | int | 商品ID |
| title | string | 商品标题 |
| image | string | 商品图片URL |
| images | array | 商品详情图片列表 |
| price | float | 价格 |
| description | string | 商品描述 |
| artist | string | 艺术家/创作者 |
| stock | int | 库存数量 |
| sales | int | 销量 |
| session_id | int | 专场ID |
| zone_id | int | 价格区间ID |
| price_zone | string | 价格分区名称 |
| package_id | int | 资产包ID |
| package_name | string | 资产包名称 |
| session_title | string | 场次标题 |
| session_start_time | string | 场次开始时间 |
| session_end_time | string | 场次结束时间 |
| is_trading_time | bool | 是否在交易时间内 |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "object_type": "item",
        "id": 3739,
        "title": "创世节点算力权益证",
        "image": "https://example.com/image.jpg",
        "images": [
            "https://example.com/image1.jpg",
            "https://example.com/image2.jpg"
        ],
        "price": 1000.00,
        "description": "商品详细描述...",
        "artist": "创作者名称",
        "stock": 100,
        "sales": 50,
        "session_id": 1,
        "zone_id": 10,
        "price_zone": "1000元区",
        "package_id": 1,
        "package_name": "树交生态链",
        "session_title": "树交生态链专场",
        "session_start_time": "09:00",
        "session_end_time": "21:00",
        "is_trading_time": true
    }
}
```

---

### 6.3 根据专场获取商品列表

**接口地址**：`GET /api/collectionItem/bySession`

**是否需要登录**：否

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| session_id | int | 是 | 专场ID | - |
| page | int | 否 | 页码 | 1 |
| limit | int | 否 | 每页数量（最大50） | 10 |

**说明**：此接口返回按"资产包+价格分区"聚合后的数据，用于预约购买时选择。

**响应字段**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list[].session_id | int | 专场ID |
| list[].package_name | string | 资产包名称 |
| list[].package_id | int | 资产包ID |
| list[].zone_id | int | 价格区间ID |
| list[].price_zone | string | 价格分区（不含"元区"后缀） |
| list[].official_stock | int | 官方库存 |
| list[].consignment_count | int | 寄售数量 |
| list[].total_available | int | 总可用数量 |
| list[].min_price | float | 最低价格 |
| list[].max_price | float | 最高价格 |
| list[].price_range | string | 价格范围文本 |
| list[].session_name | string | 场次名称 |
| list[].session_start_time | string | 场次开始时间 |
| list[].session_end_time | string | 场次结束时间 |
| list[].is_trading_time | bool | 是否在交易时间内 |
| list[].is_consignment | bool | 是否纯寄售（无官方库存） |

**响应示例**：

```json
{
    "code": 1,
    "msg": "",
    "data": {
        "list": [
            {
                "session_id": 1,
                "package_name": "树交生态链",
                "package_id": 1,
                "zone_id": 10,
                "price_zone": "1000",
                "official_stock": 50,
                "consignment_count": 20,
                "total_available": 70,
                "min_price": 950.00,
                "max_price": 1050.00,
                "price_range": "950.00 - 1050.00",
                "session_name": "树交生态链专场",
                "session_start_time": "09:00",
                "session_end_time": "21:00",
                "is_trading_time": true,
                "is_consignment": false
            }
        ],
        "total": 5,
        "page": 1,
        "limit": 10
    }
}
```

---

### 6.4 废弃接口

以下接口已从 CollectionItem 迁移，调用将返回 `410 Gone`：

| 接口 | 新路由 |
|------|--------|
| `/api/collectionItem/bidBuy` | `/api/collectionReservation/bidBuy` |
| `/api/collectionItem/reservations` | `/api/collectionReservation/reservations` |
| `/api/collectionItem/reservationDetail` | `/api/collectionReservation/reservationDetail` |

---

## 七、错误处理

### 7.1 统一错误响应格式

```json
{
    "code": 0,
    "msg": "错误信息",
    "message": "错误信息",
    "data": null
}
```

### 7.2 HTTP 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功（业务成功或失败由 code 字段决定） |
| 401 | 未登录或 Token 无效 |
| 410 | 接口已废弃 |
| 500 | 服务器内部错误 |

### 7.3 业务错误码

| code | 说明 |
|------|------|
| 1 | 成功 |
| 0 | 失败（msg 中包含具体错误信息） |

### 7.4 前端错误处理示例

```typescript
import axios from 'axios';

// 创建 axios 实例
const api = axios.create({
    baseURL: '/api',
    timeout: 10000
});

// 请求拦截器 - 添加 token
api.interceptors.request.use(config => {
    const token = localStorage.getItem('batoken');
    if (token) {
        config.headers['batoken'] = token;
    }
    return config;
});

// 响应拦截器 - 统一错误处理
api.interceptors.response.use(
    response => {
        const { code, msg, data } = response.data;
        if (code === 1) {
            return data;
        } else {
            // 业务错误
            return Promise.reject(new Error(msg || '请求失败'));
        }
    },
    error => {
        if (error.response) {
            switch (error.response.status) {
                case 401:
                    // 未登录，跳转登录页
                    window.location.href = '/login';
                    break;
                case 410:
                    // 接口已废弃
                    console.error('接口已废弃，请更新为新路由');
                    break;
                default:
                    console.error('请求失败', error);
            }
        }
        return Promise.reject(error);
    }
);

export default api;
```

---

## 八、前端对接建议

### 8.1 寄售流程

```
检查可寄售 → 预览寄售 → 确认寄售 → 完成
    ↓            ↓           ↓
consignmentCheck   显示费用   consign
                   显示价格
```

**前端实现步骤**：

1. 调用 `consignmentCheck` 检查是否满足寄售条件
2. 满足条件则显示寄售确认弹窗，预览服务费和寄售价格
3. 用户确认后调用 `consign` 接口
4. 成功后刷新我的藏品列表

### 8.2 批量寄售流程

```
获取可寄售列表 → 用户选择 → 批量寄售 → 显示结果
      ↓             ↓           ↓           ↓
batchConsignableList  勾选    batchConsign  分析results
```

**前端实现步骤**：

1. 调用 `batchConsignableList` 获取可寄售藏品列表
2. 用户勾选要寄售的藏品
3. 调用 `batchConsign` 批量寄售
4. 根据返回的 `results` 显示成功/失败详情

### 8.3 我的藏品状态流转

```
持有中 (holding)
    ↓
    ├── 寄售 → 寄售中 (consigned) → 已售出 (sold) / 寄售失败 (failed)
    ↓
    └── 转矿机 → 矿机中 (mining)
```

### 8.4 关键字段说明

| 字段 | 说明 | 使用场景 |
|------|------|----------|
| user_collection_id | 用户藏品记录ID | 寄售、转矿机、查询状态 |
| consignment_id | 寄售记录ID | 取消寄售、查看寄售详情 |
| item_id | 藏品商品ID | 查看商品详情 |
| asset_code | 确权编号 | 防伪验证、溯源查询 |
| fingerprint | MD5存证指纹 | 防伪验证 |

### 8.5 时间相关说明

- 所有时间戳字段为**秒级**（非毫秒）
- 时间文本字段格式为 `Y-m-d H:i:s`
- 场次时间（`session_start_time`、`session_end_time`）为 `H:i` 格式

### 8.6 图片 URL 说明

- 所有图片字段已自动处理为完整 URL
- 前端无需拼接域名

---

## 附录

### A. TypeScript 类型定义

```typescript
// 通用响应
interface ApiResponse<T> {
    code: number;
    msg: string;
    message: string;
    time: number;
    data: T;
}

// 分页响应
interface PaginatedData<T> {
    list: T[];
    total: number;
    per_page: number;
    current_page: number;
    last_page: number;
    has_more?: boolean;
}

// 用户藏品
interface UserCollection {
    id: number;
    unique_id: string;
    title: string;
    image: string;
    asset_code: string;
    hash: string;
    price: number;
    buy_price: number;
    market_price: number;
    transaction_count: number;
    fail_count: number;
    consignment_status: 0 | 1 | 2;
    status_text: string;
    session_id: number;
    session_title: string;
    zone_id: number;
    price_zone: string;
    mining_status: 0 | 1;
    mining_start_time: string;
}

// 寄售记录
interface ConsignmentRecord {
    consignment_id: number;
    user_collection_id: number;
    item_id: number;
    title: string;
    image: string;
    original_price: number;
    consignment_price: number;
    service_fee: number;
    total_cost: number;
    consignment_status: 0 | 1 | 2 | 3;
    consignment_status_text: string;
    create_time_text: string;
    days_passed: number;
    can_force_delivery: boolean;
}

// 寄售响应
interface ConsignResponse {
    consignment_id: number;
    user_collection_id: number;
    item_id: number;
    consignment_price: number;
    service_fee: number;
    is_free_resend: boolean;
    waive_type: 'none' | 'free_attempt' | 'system_resend';
    coupon_used: boolean;
    coupon_remaining: number;
    free_attempts_remaining: number;
    item_title: string;
    price_zone: string;
    session_id: number;
    zone_id: number;
    package_name: string;
    listed_at: string;
    expire_at: string;
}
```

### B. 更新日志

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2026-01-22 | v2.0 | 新增 CollectionConsignment、CollectionItem 接口文档；更新路由迁移说明；添加业务共识章节 |
| 2026-01-22 | v1.0 | 初始版本，CollectionTrade 接口文档 |

---

*文档结束*
