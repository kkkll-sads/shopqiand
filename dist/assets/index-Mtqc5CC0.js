import{j as e,H as Va,S as yt,a as ot,T as Wa,U as jt,B as Ka,X as Ce,r as n,A as Rt,I as Ja,L as dt,C as qe,b as qa,c as Ze,d as Nt,e as Za,f as pe,g as ze,P as vt,F as Te,h as Lt,i as Be,k as zs,M as At,l as nt,m as Ee,n as aa,o as Mt,p as wt,E as ft,q as bt,s as js,t as Qa,u as Ns,v as vs,w as St,x as Xa,G as ra,y as er,z as na,W as Le,R as at,D as ia,J as Ge,K as ws,N as tr,O as Xt,Q as la,V as rt,Z as ct,Y as sr,_ as us,$ as ar,a0 as rr,a1 as nr,a2 as ir,a3 as _t,a4 as gs,a5 as lr,a6 as oa,a7 as ca,a8 as _s,a9 as zt,aa as hs,ab as es,ac as Rs,ad as ts,ae as or,af as da,ag as cr,ah as dr,ai as xr,aj as It,ak as mr,al as ur,am as gr,an as hr,ao as As,ap as ks,aq as fr,ar as br,as as pr,at as Ot,au as yr,av as jr,aw as Nr,ax as vr,ay as wr,az as _r,aA as kr,aB as Sr,aC as Cr,aD as Er,aE as Ir}from"./react-vendor-D-a-n2rB.js";import{b as Tr}from"./area-data-BVDNhPol.js";import{b as xa}from"./vendor-YRKd36Sg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function a(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(l){if(l.ep)return;l.ep=!0;const o=a(l);fetch(l.href,o)}})();const Fr=({activeTab:t,onTabChange:s})=>{const a=[{id:"home",label:"首页",icon:Va},{id:"market",label:"商城",icon:yt},{id:"rights",label:"数字确权",icon:ot},{id:"live",label:"直播",icon:Wa},{id:"profile",label:"我的",icon:jt}];return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-100 pb-safe pt-2 px-4 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-50",children:e.jsx("div",{className:"flex justify-between items-center pb-2",children:a.map(r=>{const l=r.icon,o=t===r.id;return e.jsxs("button",{onClick:()=>s(r.id),className:`flex flex-col items-center justify-center w-14 transition-colors duration-200 ${o?"text-orange-600":"text-gray-400"}`,children:[e.jsx(l,{size:24,strokeWidth:o?2.5:2}),e.jsx("span",{className:"text-[10px] mt-1 font-medium",children:r.label})]},r.id)})})})},je={AUTH_KEY:"cat_is_logged_in",AUTH_TOKEN_KEY:"cat_auth_token",USER_INFO_KEY:"cat_user_info",REAL_NAME_STATUS_KEY:"cat_real_name_status",REAL_NAME_KEY:"cat_real_name",READ_MESSAGE_IDS_KEY:"cat_read_message_ids",NEWS_ACTIVE_TAB_KEY:"cat_news_active_tab",READ_NEWS_IDS_KEY:"cat_read_news_ids",LOGIN_REMEMBERED_PHONE:"login_remembered_phone",LOGIN_REMEMBERED_PASSWORD:"login_remembered_password",LOGIN_REMEMBER_ME:"login_remember_me"},ne=je.AUTH_TOKEN_KEY,Ae=je.USER_INFO_KEY,Pr={DEV:!1},zr="/api",ma=()=>typeof window<"u"?window.location.origin:"",Ye=Pr??{},ua=()=>{const t=Ye==null?void 0:Ye.VITE_API_BASE_URL;return t||zr},Rr=()=>{const t=[Ye==null?void 0:Ye.VITE_API_BASE_URL,Ye==null?void 0:Ye.VITE_API_TARGET];for(const s of t)if(s&&s.startsWith("http"))try{return new URL(s).origin}catch(a){console.warn("[api] 无法解析 API origin:",s,a)}if(!(Ye!=null&&Ye.DEV)){const s=ua();if(s.startsWith("http"))try{return new URL(s).origin}catch{}}return ma()},Ar=ua();Rr();const ke=t=>{if(!t)return"";if(t.startsWith("http")){try{const s=new URL(t),a=ma(),r=typeof window<"u"&&s.host===window.location.host,l=a&&(()=>{try{return s.host===new URL(a).host}catch{return!1}})(),o=/^18\.\d+\.\d+\.\d+/.test(s.hostname);if(r||l||o){const c=s.pathname+s.search;return c.startsWith("/")?c:"/"+c}}catch{}return t}if(t.startsWith("//"))try{return`${typeof window<"u"?window.location.protocol:"https:"}${t}`}catch{return`https:${t}`}return t.startsWith("/"),t},q={auth:{checkIn:"/User/checkIn"},account:{profile:"/Account/profile",retrievePassword:"/Account/retrievePassword",cancelAccount:"/Account/cancelAccount",balance:"/Account/balance",transferBalanceToServiceFee:"/Account/transferBalanceToServiceFee",serviceFeeLog:"/Account/serviceFeeLog",rechargeServiceFee:"/Account/rechargeServiceFee",allLog:"/Account/allLog",integral:"/Account/integral",exchangeScoreToGreenPower:"/Account/exchangeScoreToGreenPower",checkOldAssetsUnlockStatus:"/Account/checkOldAssetsUnlockStatus",unlockOldAssets:"/Account/unlockOldAssets"},address:{list:"/shopAddress/index",add:"/shopAddress/add",edit:"/shopAddress/edit",delete:"/shopAddress/delete",getDefault:"/shopAddress/getDefault"},user:{realNameStatus:"/User/realNameStatus",submitRealName:"/User/submitRealName",updateAvatar:"/User/updateAvatar",updateNickname:"/User/updateNickname",updatePassword:"/User/updatePassword",updatePayPassword:"/User/updatePayPassword",resetPayPasswordBySms:"/User/resetPayPasswordBySms",paymentAccountList:"/User/getPaymentAccountList",addPaymentAccount:"/User/addPaymentAccount",deletePaymentAccount:"/User/deletePaymentAccount",editPaymentAccount:"/User/editPaymentAccount",setDefaultPaymentAccount:"/User/setDefaultPaymentAccount",agentReviewStatus:"/User/agentReviewStatus",submitAgentReview:"/User/submitAgentReview",getH5AuthToken:"/User/getH5AuthToken",consignmentCoupons:"/user/consignmentCoupons"},yidun:{livePersonCheck:"/YidunOcr/livePersonCheck",h5Recheck:"/YidunOcr/h5Recheck"},upload:{image:"/ajax/upload"},sms:{send:"/Sms/send"},announcement:{list:"/Announcement/index"},banner:{list:"/Banner/getBannerList"},recharge:{companyAccountList:"/Recharge/getCompanyAccountList",submitOrder:"/Recharge/submitOrder",submitWithdraw:"/Recharge/submitWithdraw",submitStaticIncomeWithdraw:"/Recharge/submitStaticIncomeWithdraw",getMyOrderList:"/Recharge/getMyOrderList",getMyWithdrawList:"/Recharge/getMyWithdrawList",detail:"/Recharge/detail"},common:{page:"/Common/page"},help:{categories:"/Help/categories",questions:"/Help/questions"},shopProduct:{list:"/shopProduct/index",detail:"/shopProduct/detail",categories:"/shopProduct/categories",sales:"/shopProduct/sales",latest:"/shopProduct/latest",share:"/shopProduct/share"},shopOrder:{create:"/shopOrder/create",buy:"/shopOrder/buy",pendingPay:"/shopOrder/pendingPay",pendingShip:"/shopOrder/pendingShip",pendingConfirm:"/shopOrder/pendingConfirm",completed:"/shopOrder/completed",confirm:"/shopOrder/confirm",pay:"/shopOrder/pay",detail:"/shopOrder/detail",delete:"/shopOrder/delete"},collectionSession:{index:"/collectionSession/index",detail:"/collectionSession/detail"},collectionItem:{index:"/collectionItem/index",bySession:"/collectionItem/bySession",detail:"/collectionItem/detail",originalDetail:"/collectionItem/originalDetail",buy:"/collectionItem/buy",matchingPool:"/collectionItem/matchingPool",cancelBid:"/collectionItem/cancelBid",bidBuy:"/collectionItem/bidBuy",purchaseRecords:"/collectionItem/purchaseRecords",consignmentList:"/collectionItem/consignmentList",tradeList:"/collectionItem/tradeList",myConsignmentList:"/collectionItem/myConsignmentList",queryByCode:"/collectionItem/queryByCode",consignmentDetail:"/collectionItem/consignmentDetail",cancelConsignment:"/collectionItem/cancelConsignment",deliver:"/collectionItem/deliver",consign:"/collectionItem/consign",consignmentCheck:"/collectionItem/consignmentCheck",deliveryList:"/collectionItem/deliveryList",rightsDeliver:"/collectionItem/rightsDeliver",reservations:"/collectionItem/reservations"},artist:{index:"/artist/index",detail:"/artist/detail",workDetail:"/artist/workDetail",allWorks:"/artist/allWorks"},signIn:{rules:"/SignIn/rules",info:"/SignIn/info",do:"/SignIn/do",records:"/SignIn/records",progress:"/SignIn/progress"},team:{promotionCard:"/Team/promotionCard",members:"/Team/members"}};class Dr extends Error{constructor(s="请先登录"){super(s),this.code=303,this.needLogin=!0,this.name="NeedLoginError"}}const Xe=t=>{try{return localStorage.getItem(t)}catch{return null}},Ve=(t,s)=>{try{localStorage.setItem(t,s)}catch(a){console.error(`写入存储失败 [${t}]`,a)}},gt=t=>{try{localStorage.removeItem(t)}catch(s){console.error(`删除存储失败 [${t}]`,s)}},ss=(t,s=null)=>{try{const a=Xe(t);return a?JSON.parse(a):s}catch(a){return console.warn(`解析存储内容失败 [${t}]`,a),s}},Jt=(t,s)=>{try{Ve(t,JSON.stringify(s))}catch(a){console.error(`写入 JSON 存储失败 [${t}]`,a)}},ga=()=>{[je.AUTH_KEY,je.AUTH_TOKEN_KEY,je.USER_INFO_KEY,je.REAL_NAME_STATUS_KEY,je.REAL_NAME_KEY].forEach(gt)};let qt=null;const Lr=t=>{qt=t},Mr=()=>{qt=null},Br=t=>{if(qt)try{return qt(t),!0}catch(s){console.error("NeedLogin 处理回调执行失败:",s)}return console.warn("捕获到 NeedLoginError，但尚未注册处理函数"),!1},$r=async t=>{const s=t.headers.get("content-type");let a;if(s&&s.includes("application/json"))a=await t.json();else{const r=await t.text();console.warn("API 返回非 JSON 响应:",r);try{a=JSON.parse(r)}catch{throw new Error(`服务器返回了非 JSON 格式的响应: ${r.substring(0,100)}`)}}if(!t.ok)throw new Error(`HTTP error! status: ${t.status}, message: ${(a==null?void 0:a.msg)||(a==null?void 0:a.message)||JSON.stringify(a)}`);return a};async function Je(t,{method:s="GET",headers:a={},body:r=null,token:l}={}){const o=`${Ar}${t}`,c={Accept:"application/json",...a};l&&(c["ba-user-token"]=l,c["ba-token"]||(c["ba-token"]=l),c.batoken||(c.batoken=l)),!(typeof FormData<"u"&&r instanceof FormData)&&r&&!c["Content-Type"]&&(c["Content-Type"]="application/json");try{const x=await fetch(o,{method:s,headers:c,body:r,mode:"cors",credentials:"omit"}),m=await $r(x);if(m.code===303)throw console.warn("用户登录已失效（code 303），抛出 NeedLoginError 交由上层统一处理"),new Dr(m.msg||"请先登录");return m}catch(x){if((x==null?void 0:x.name)==="NeedLoginError")throw Br(x.message)||ga(),x;if(console.error(`API 调用失败 [${s}] ${o}:`,x),x.name==="TypeError"&&x.message==="Failed to fetch"){const m=new Error(`网络请求失败，可能是跨域问题或服务器不可达。请检查：
1. API 服务器是否正常运行
2. 是否配置了 CORS 允许跨域
3. 网络连接是否正常`);throw m.isCorsError=!0,m}throw x}}const pt={},Or="app:debug-log-enabled",Ur=typeof import.meta<"u"&&(pt==null?void 0:pt.VITE_ENABLE_DEBUG_LOG)==="true",Gr=typeof import.meta<"u"?(pt==null?void 0:pt.VITE_ENABLE_BIZ_LOG)!=="false":!0,Hr=()=>{if(typeof window>"u"||!window.localStorage)return null;const t=window.localStorage.getItem(Or);return t===null?null:t==="true"},Yr=()=>{const t=Hr();return t!==null?t:!!Ur},as=(t,s)=>s?`[${t}][${s}]`:`[${t}]`,fe=(t,...s)=>{Yr()&&console.debug(as("DEBUG",t),...s)},tt=(t,s)=>{Gr&&console.info(as("BIZ",t),s)},Ke=(t,...s)=>{console.warn(as("WARN",t),...s)},Fe=(t,...s)=>{console.error(as("ERROR",t),...s)};async function Vr(t){try{const s=new FormData;s.append("tab","register"),s.append("mobile",t.mobile),s.append("password",t.password),s.append("pay_password",t.pay_password),s.append("invite_code",t.invite_code),s.append("captcha",t.captcha);const a=await Je(q.auth.checkIn,{method:"POST",body:s});return fe("api.auth.register.raw",a),tt("auth.register",{code:a.code}),a}catch(s){if(Fe("api.auth.register","注册接口调用失败",s),s.name==="TypeError"&&s.message==="Failed to fetch"){const a=new Error(`网络请求失败，可能是跨域问题或服务器不可达。请检查：
1. API 服务器是否正常运行
2. 是否配置了 CORS 允许跨域
3. 网络连接是否正常`);throw a.isCorsError=!0,a}throw s}}async function Wr(t){try{const s=new FormData;s.append("tab","login"),s.append("username",t.mobile),s.append("password",t.password);const a=await Je(q.auth.checkIn,{method:"POST",body:s});return fe("api.auth.login.raw",a),tt("auth.login.request",{code:a.code}),a}catch(s){if(Fe("api.auth.login","登录接口调用失败",s),s.name==="TypeError"&&s.message==="Failed to fetch"){const a=new Error(`网络请求失败，可能是跨域问题或服务器不可达。请检查：
1. API 服务器是否正常运行
2. 是否配置了 CORS 允许跨域
3. 网络连接是否正常`);throw a.isCorsError=!0,a}throw s}}async function Kr(t){try{const s=new FormData;s.append("type",t.type||"mobile"),s.append("account",t.account),s.append("captcha",t.captcha),s.append("password",t.password),s.append("newpassword",t.password);const a=await Je(q.account.retrievePassword,{method:"POST",body:s});return fe("api.auth.retrievePassword.raw",a),a}catch(s){throw Fe("api.auth.retrievePassword","找回密码失败",s),s}}const ce=()=>Xe(ne)||"",Jr=t=>{var s;return(t==null?void 0:t.isCorsError)||t instanceof Error&&((s=t.message)==null?void 0:s.includes("Failed to fetch"))};async function Z(t,s={}){const{token:a,retry:r=0,retryDelayMs:l=500,onNeedLogin:o,onNetworkError:c,...d}=s,x=a??ce();let m=0;for(;;)try{return await Je(t,{...d,token:x})}catch(b){const g=(b==null?void 0:b.name)==="NeedLoginError",f=Jr(b);if(g&&o)try{o()}catch{}if(f&&m<r){m+=1,l>0&&await new Promise(h=>setTimeout(h,l));continue}if(f&&c)try{c(b)}catch{}throw b}}async function $e(t){try{const s=await Z(q.account.profile,{method:"GET",token:t});return fe("api.user.profile.raw",s),s}catch(s){if(Fe("api.user.profile","获取个人中心信息失败",s),s.name==="TypeError"&&s.message==="Failed to fetch"){const a=new Error(`网络请求失败，可能是跨域问题或服务器不可达。请检查：
1. API 服务器是否正常运行
2. 是否配置了 CORS 允许跨域
3. 网络连接是否正常`);throw a.isCorsError=!0,a}throw s}}async function qr(t){const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试修改头像");const a={avatar:t.avatar||"",avatar_url:t.avatar_url||""};try{const r=await Z(q.user.updateAvatar,{method:"POST",body:JSON.stringify(a),token:s});return fe("api.user.updateAvatar.raw",r),r}catch(r){throw Fe("api.user.updateAvatar","修改头像失败",r),r}}async function Zr(t){var r;const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试修改昵称");if(!((r=t.nickname)!=null&&r.trim()))throw new Error("请输入合法的昵称");const a=new FormData;a.append("nickname",t.nickname.trim());try{const l=await Z(q.user.updateNickname,{method:"POST",body:a,token:s});return fe("api.user.updateNickname.raw",l),l}catch(l){throw Fe("api.user.updateNickname","修改昵称失败",l),l}}async function Qr(t){var o,c;const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试修改密码");const a=(o=t.old_password)==null?void 0:o.trim(),r=(c=t.new_password)==null?void 0:c.trim();if(!a)throw new Error("请输入旧密码");if(!r)throw new Error("请输入新密码");if(r.length<6)throw new Error("新密码长度至少 6 位");if(r===a)throw new Error("新密码不能与旧密码相同");const l=new FormData;l.append("old_password",a),l.append("new_password",r);try{const d=await Z(q.user.updatePassword,{method:"POST",body:l,token:s});return fe("api.user.updatePassword.raw",d),d}catch(d){throw Fe("api.user.updatePassword","修改登录密码失败",d),d}}async function Xr(t){var o,c;const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试修改支付密码");const a=(o=t.old_pay_password)==null?void 0:o.trim(),r=(c=t.new_pay_password)==null?void 0:c.trim();if(!a)throw new Error("请输入旧支付密码");if(!r)throw new Error("请输入新支付密码");if(r.length<6)throw new Error("新支付密码长度至少 6 位");if(r===a)throw new Error("新支付密码不能与旧支付密码相同");const l=new FormData;l.append("old_pay_password",a),l.append("new_pay_password",r);try{const d=await Z(q.user.updatePayPassword,{method:"POST",body:l,token:s});return fe("api.user.updatePayPassword.raw",d),d}catch(d){throw Fe("api.user.updatePayPassword","修改支付密码失败",d),d}}async function en(t){const s=new FormData;s.append("mobile",t.mobile),s.append("captcha",t.captcha),s.append("new_pay_password",t.new_pay_password);try{const a=await Z(q.user.resetPayPasswordBySms,{method:"POST",body:s});return fe("api.user.resetPayPasswordBySms.raw",a),a}catch(a){throw Fe("api.user.resetPayPasswordBySms","短信重置支付密码失败",a),a}}async function tn(t){var o,c;const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试注销账户");const a=(o=t.password)==null?void 0:o.trim(),r=((c=t.reason)==null?void 0:c.trim())??"";if(!a)throw new Error("请输入登录密码以确认注销");const l=new FormData;l.append("password",a),l.append("reason",r);try{const d=await Z(q.account.cancelAccount,{method:"POST",body:l,token:s});return fe("api.user.cancelAccount.raw",d),d}catch(d){throw Fe("api.user.cancelAccount","提交账户注销申请失败",d),d}}async function Zt(t){return Z(q.user.realNameStatus,{method:"GET",token:t})}async function sn(t){const s=t.token??ce(),a=new FormData;return t.auth_token?a.append("auth_token",t.auth_token):(t.real_name&&a.append("real_name",t.real_name),t.id_card&&a.append("id_card",t.id_card),t.id_card_front&&a.append("id_card_front",t.id_card_front),t.id_card_back&&a.append("id_card_back",t.id_card_back)),Z(q.user.submitRealName,{method:"POST",body:a,token:s})}async function an(t){const s=t.token??ce(),a=new FormData;return a.append("real_name",t.real_name),a.append("id_card",t.id_card),a.append("redirect_url",t.redirect_url),Z(q.user.getH5AuthToken,{method:"POST",body:a,token:s})}async function rn(t){const s=t.token??ce(),a=new URLSearchParams;return a.append("authToken",t.authToken),Z(q.yidun.h5Recheck,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString(),token:s})}async function ha(t){return Z(q.team.promotionCard,{method:"GET",token:t})}async function nn(t={}){const s=t.token??ce(),a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.page&&a.set("page",String(t.page));const r=t.limit||t.page_size;r&&a.set("limit",String(r)),t.level&&a.set("level",String(t.level));const l=`${q.team.members}?${a.toString()}`;return Z(l,{method:"GET",token:s})}async function Ds(t){return Z(q.user.agentReviewStatus,{method:"GET",token:t})}async function ln(t){const s=t.token??ce(),a=new FormData;return t.name&&a.append("name",t.name),t.phone&&a.append("phone",t.phone),t.company_name&&a.append("company_name",t.company_name),t.legal_person&&a.append("legal_person",t.legal_person),t.legal_id_number&&a.append("legal_id_number",t.legal_id_number),a.append("subject_type",String(t.subject_type)),t.license_image&&a.append("license_image",t.license_image),t.reason&&a.append("reason",t.reason),Z(q.user.submitAgentReview,{method:"POST",body:a,token:s})}async function fa(t){return Z(q.address.list,{method:"GET",token:t})}async function Ls(t){const s=t.token??ce(),a=new FormData;t.id&&a.append("id",String(t.id)),a.append("name",t.name),a.append("phone",t.phone),a.append("province",t.province),a.append("city",t.city),a.append("district",t.district||""),a.append("address",t.address),a.append("is_default",t.is_default?"1":"0");const r=t.id?q.address.edit:q.address.add;return Z(r,{method:"POST",body:a,token:s})}async function on(t){const s=t.token??ce(),a=new FormData;return a.append("id",String(t.id)),Z(q.address.delete,{method:"POST",body:a,token:s})}async function cn(t){return Z(q.address.getDefault,{method:"GET",token:t})}async function dn(){try{const t=await Z(q.signIn.rules,{method:"GET"});return fe("api.signIn.rules.raw",t),t}catch(t){throw Fe("api.signIn.rules","获取签到规则失败",t),t}}async function Ms(t){if(!t)throw new Error("未找到用户登录信息，请先登录后再查看签到信息");try{const s=await Z(q.signIn.info,{method:"GET",token:t});return fe("api.signIn.info.raw",s),s}catch(s){throw Fe("api.signIn.info","获取签到信息失败",s),s}}async function xn(t){if(!t)throw new Error("未找到用户登录信息，请先登录后再签到");try{const s=await Z(q.signIn.do,{method:"POST",body:JSON.stringify({}),token:t});return fe("api.signIn.do.raw",s),s}catch(s){throw Fe("api.signIn.do","执行签到失败",s),s}}async function ns(t){if(!t)throw new Error("未找到用户登录信息，请先登录后再查看提现进度");try{const s=await Z(q.signIn.progress,{method:"GET",token:t});return fe("api.signIn.progress.raw",s),s}catch(s){throw Fe("api.signIn.progress","获取签到提现进度失败",s),s}}async function mn(t){const s=t.token??ce();if(!t.score||Number(t.score)<=0)throw new Error("请输入有效的消费金数量");const a=new URLSearchParams;a.set("score",String(t.score));const r=`${q.account.exchangeScoreToGreenPower}?${a.toString()}`;return Z(r,{method:"POST",token:s})}async function un(t){var a;const s=t??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再检查解锁状态");try{const r=await Z(q.account.checkOldAssetsUnlockStatus,{method:"GET",token:s});return fe("api.assets.unlock.check.raw",r),tt("assets.unlock.check",{code:r.code,unlockStatus:(a=r.data)==null?void 0:a.unlock_status}),r}catch(r){throw Fe("api.assets.unlock.check","检查旧资产解锁状态失败",r),r}}async function gn(t){var a;const s=t??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再尝试解锁旧资产");try{const r=await Z(q.account.unlockOldAssets,{method:"POST",body:JSON.stringify({}),token:s});return fe("api.assets.unlock.execute.raw",r),tt("assets.unlock.execute",{code:r.code,unlockStatus:(a=r.data)==null?void 0:a.unlock_status}),r}catch(r){throw Fe("api.assets.unlock.execute","解锁旧资产失败",r),r}}async function rs(t){return Z(q.user.paymentAccountList,{method:"GET",token:t})}async function hn(t){const s=new FormData;return s.append("type",t.type),s.append("account_type",t.account_type),s.append("bank_name",t.bank_name),s.append("account_name",t.account_name),s.append("account_number",t.account_number),t.bank_branch&&s.append("bank_branch",t.bank_branch),t.screenshot&&s.append("screenshot",t.screenshot),Z(q.user.addPaymentAccount,{method:"POST",body:s,token:t.token})}async function fn(t){const s=new FormData;return s.append("id",t.id),s.append("bank_name",t.bank_name),s.append("account_name",t.account_name),s.append("account_number",t.account_number),t.bank_branch&&s.append("bank_branch",t.bank_branch),t.screenshot&&s.append("screenshot",t.screenshot),Z(q.user.editPaymentAccount,{method:"POST",body:s,token:t.token})}async function bn(t){const s=new FormData;return s.append("id",t.id),Z(q.user.deletePaymentAccount,{method:"POST",body:s,token:t.token})}async function pn(t){const s=new FormData;return s.append("id",t.id),Z(q.user.setDefaultPaymentAccount,{method:"POST",body:s,token:t.token})}async function Bs(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit));const a=`${q.account.balance}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function yn(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.type&&s.set("type",t.type);const a=`${q.account.allLog}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function jn(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit));const a=`${q.account.serviceFeeLog}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function Nn(t){if(!t.amount||Number(t.amount)<=0)throw new Error("请输入有效的充值金额");const s=new URLSearchParams;s.append("amount",String(t.amount)),t.remark&&s.append("remark",t.remark);const a=`${q.account.rechargeServiceFee}?${s.toString()}`,r={amount:Number(t.amount)};return t.source&&(r.source=t.source),Z(a,{method:"POST",body:JSON.stringify(r),token:t.token})}async function vn(t={}){const s=new URLSearchParams;t.usage&&s.set("usage",t.usage);const a=`${q.recharge.companyAccountList}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function $s(t){const s=new FormData;s.append("company_account_id",String(t.company_account_id)),s.append("amount",String(t.amount)),t.payment_method?s.append("payment_method",t.payment_method):s.append("payment_method","offline");const a=t.voucher||t.payment_screenshot;return a&&s.append("payment_screenshot",a),t.remark&&s.append("remark",t.remark),t.payment_type&&s.append("payment_type",t.payment_type),Z(q.recharge.submitOrder,{method:"POST",body:s,token:t.token})}async function ba(t){const s=new FormData;return s.append("payment_account_id",String(t.payment_account_id||t.payment_id)),s.append("amount",String(t.amount)),t.pay_password&&s.append("pay_password",t.pay_password),t.remark&&s.append("remark",t.remark),Z(q.recharge.submitWithdraw,{method:"POST",body:s,token:t.token})}async function wn(t){const s=new FormData;return s.append("user_account_id",String(t.payment_id||t.payment_account_id)),s.append("money",String(t.amount)),t.pay_password&&s.append("pay_password",t.pay_password),Z(q.recharge.submitStaticIncomeWithdraw,{method:"POST",body:s,token:t.token})}async function pa(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.status!==void 0&&s.set("status",String(t.status));const a=`${q.recharge.getMyOrderList}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}const _n=pa;async function Ss(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.status!==void 0&&s.set("status",String(t.status));const a=`${q.recharge.getMyWithdrawList}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function kn(t,s){const a=new URLSearchParams;a.set("id",String(t));const r=`${q.recharge.detail}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function Sn(t={}){const s=new URLSearchParams;t.page!==void 0&&s.set("page",String(t.page)),t.limit!==void 0&&s.set("limit",String(t.limit));const a=`${q.shopProduct.list}?${s.toString()}`;return Z(a,{method:"GET"})}async function Cs(t){const s=`${q.shopProduct.detail}?id=${t}`;return Z(s,{method:"GET"})}async function Cn(){return Z(q.shopProduct.categories,{method:"GET"})}async function En(t={}){const s=new URLSearchParams;t.page!==void 0&&s.set("page",String(t.page)),t.limit!==void 0&&s.set("limit",String(t.limit));const a=`${q.shopProduct.sales}?${s.toString()}`;return Z(a,{method:"GET"})}async function In(t={}){const s=new URLSearchParams;t.page!==void 0&&s.set("page",String(t.page)),t.limit!==void 0&&s.set("limit",String(t.limit));const a=`${q.shopProduct.latest}?${s.toString()}`;return Z(a,{method:"GET"})}async function Tn(t){const s=`${q.shopProduct.share}?id=${t}`;return Z(s,{method:"GET"})}async function Yt(t={}){const s=t.token??ce(),a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.shopOrder.pendingPay}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function Vt(t={}){const s=t.token??ce(),a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.shopOrder.pendingShip}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function Wt(t={}){const s=t.token??ce(),a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.shopOrder.pendingConfirm}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function is(t={}){const s=t.token??ce(),a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.shopOrder.completed}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function ya(t){const s=t.token??ce(),a=new FormData;return a.append("id",String(t.id)),Z(q.shopOrder.confirm,{method:"POST",body:a,token:s})}async function Fn(t){const s=t.token??ce(),a=new FormData;return a.append("order_id",String(t.id)),Z(q.shopOrder.pay,{method:"POST",body:a,token:s})}async function Pn(t){const s=t.token??ce(),a=new FormData;return a.append("order_id",String(t.id)),Z(q.shopOrder.delete,{method:"POST",body:a,token:s})}async function ja(t){const s=t.token??ce(),a=`${q.shopOrder.detail}?id=${t.id}`;return Z(a,{method:"GET",token:s})}async function Na(t){var c;const s=t.token??ce();if(!s)throw new Error("未找到用户登录信息，请先登录后再购买商品");if(!t.items||t.items.length===0)throw new Error("请选择要购买的商品");if(!t.pay_type)throw new Error("请选择支付方式");const a=t.items.map(d=>{const x=Number(d.product_id),m=Number(d.quantity);if(!Number.isFinite(x)||x<=0)throw new Error("无效的商品ID");if(!Number.isFinite(m)||m<=0)throw new Error("商品数量必须大于0");return{product_id:x,quantity:m}});let r=!1;if(t.items&&t.items.length>0)try{const d=t.items[0].product_id,x=await Cs(d);x.code===1&&x.data&&(r=x.data.is_physical==="1")}catch(d){Ke("order.buy","获取商品详情失败，无法判断是否为实物商品",d),r=!0}let l=t.address_id;if(l==null)try{const d=await cn(s);d.code===1&&((c=d.data)!=null&&c.id)&&(l=typeof d.data.id=="string"?parseInt(d.data.id,10):d.data.id)}catch(d){if(r)throw new Error("实物商品必须填写收货地址，请先添加收货地址");Ke("order.buy","获取默认收货地址失败，将使用 null",d),l=null}if(r&&l==null)throw new Error("实物商品必须填写收货地址，请先添加收货地址");const o={items:a,pay_type:t.pay_type,address_id:l??null,remark:t.remark||""};try{const d=await Z(q.shopOrder.buy,{method:"POST",body:JSON.stringify(o),token:s});return fe("api.shop.buy.raw",d),tt("order.buy",{code:d.code,addressId:l??null,payType:t.pay_type,itemCount:a.length,isPhysicalProduct:r}),d}catch(d){throw Fe("api.shop.buy","购买商品失败",d),d}}async function zn(){return Z(q.collectionSession.index,{method:"GET"})}async function va(t){return Z(`${q.collectionItem.detail}?id=${t}`,{method:"GET"})}async function Rn(t){const s=new URLSearchParams;s.set("id",String(t)),s.set("type","my");const a=`${q.collectionItem.detail}?${s.toString()}`;return Z(a,{method:"GET"})}async function An(t,s={}){const a=new URLSearchParams;a.set("session_id",String(t)),s.page&&a.set("page",String(s.page)),s.limit&&a.set("limit",String(s.limit));const r=`${q.collectionItem.bySession}?${a.toString()}`;return Z(r,{method:"GET"})}async function Os(t){const s=`${q.collectionItem.originalDetail}?id=${t}`;return Z(s,{method:"GET"})}async function wa(t={}){const s=t.token??ce(),a=new URLSearchParams;t.status!==void 0&&t.status!==-1&&a.set("status",String(t.status)),t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.collectionItem.reservations}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function Dn(t){fe("collection.bidBuy","开始调用",t);const s=t.token??ce();t.session_id!==void 0&&Number(t.session_id),t.zone_id!==void 0&&Number(t.zone_id);const a=t.extra_hashrate??0,r=Number.isFinite(a)?a:0;if(r<0||r>50)throw new Error("额外算力需在 0-50 之间");const l=new FormData;l.append("session_id",t.session_id!==void 0?String(t.session_id):""),l.append("zone_id",t.zone_id!==void 0?String(t.zone_id):""),l.append("extra_hashrate",String(r));const o=await Z(q.collectionItem.bidBuy,{method:"POST",token:s,body:l});return tt("collection.bidBuy",{sessionId:t.session_id,zoneId:t.zone_id,code:o.code}),fe("collection.bidBuy","响应结果",o),o}async function Ln(t){const s=new URLSearchParams;s.set("code",t.code);const a=`${q.collectionItem.queryByCode}?${s.toString()}`;return Z(a,{method:"GET"})}async function fs(t={}){const s=t.token||localStorage.getItem(ne)||"",a=new URLSearchParams;t.page&&a.set("page",String(t.page)),t.limit&&a.set("limit",String(t.limit));const r=`${q.collectionItem.purchaseRecords}?${a.toString()}`;return Z(r,{method:"GET",token:s})}async function Mn(){return Z(q.artist.index,{method:"GET"})}async function Bn(t){const s=`${q.artist.detail}?id=${t}`;return Z(s,{method:"GET"})}async function $n(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit));const a=`${q.artist.allWorks}?${s.toString()}`;return Z(a,{method:"GET"})}const Es=Mn;async function bs(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.status!==void 0&&s.set("status",String(t.status));const a=`${q.user.consignmentCoupons}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function _a(t){const s=new FormData;return s.append("user_collection_id",String(t.user_collection_id||t.id)),s.append("price",String(t.price)),Z(q.collectionItem.consign,{method:"POST",body:s,token:t.token})}async function On(t){const s={consignment_id:Number(t.consignment_id)};return Z(q.collectionItem.cancelConsignment,{method:"POST",body:JSON.stringify(s),token:t.token})}async function Kt(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.status!==void 0&&t.status!==0&&s.set("status",String(t.status));const a=`${q.collectionItem.myConsignmentList}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function Un(t){const s=`${q.collectionItem.consignmentDetail}?id=${t.consignment_id}`;return Z(s,{method:"GET",token:t.token})}async function ps(t){const s=new URLSearchParams;s.set("user_collection_id",String(t.user_collection_id));const a=`${q.collectionItem.consignmentCheck}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function ls(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),t.status&&s.set("status",t.status);const a=`${q.collectionItem.deliveryList}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function Gn(t={}){const s=new URLSearchParams;t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit));const a=`${q.collectionItem.purchaseRecords}?${s.toString()}`;return Z(a,{method:"GET",token:t.token})}async function ka(t){t.token||localStorage.getItem(ne);const s={user_collection_id:Number(t.user_collection_id)};return Z(q.collectionItem.rightsDeliver,{method:"POST",body:JSON.stringify(s),token:t.token})}async function Us(){return Je(`${q.common.page}?type=about_us`,{method:"GET"})}async function Hn(){return Je(`${q.common.page}?type=privacy_policy`,{method:"GET"})}async function Yn(){return Je(`${q.common.page}?type=user_agreement`,{method:"GET"})}async function Vn(){return Je(q.help.categories,{method:"GET"})}async function Wn(t){const s=new URLSearchParams;s.set("category_id",String(t.category_id)),t.category_code&&s.set("category_code",t.category_code);const a=`${q.help.questions}?${s.toString()}`;return Je(a,{method:"GET"})}async function Dt(t={}){const{page:s,limit:a,type:r="normal",title:l,is_popup:o}=t,c=new URLSearchParams;s!==void 0&&c.set("page",String(s)),a!==void 0&&c.set("limit",String(a)),r&&c.set("type",r),l&&c.set("title",l),o!==void 0&&c.set("is_popup",String(o));const d=`${q.announcement.list}?${c.toString()}`;return Je(d,{method:"GET"})}async function Kn(t={}){const s=new URLSearchParams;t.page!==void 0&&s.set("page",String(t.page)),t.limit!==void 0&&s.set("limit",String(t.limit));const a=`${q.banner.list}?${s.toString()}`;return Je(a,{method:"GET"})}async function Is(t,s){const a=new FormData;a.append("file",t);const r=await Z(q.upload.image,{method:"POST",body:a,token:s}),l=r.data||{},o=l.file||l;if(o.id&&o.url)return{...r,data:{id:o.id,url:o.url,name:o.name,size:o.size,mimetype:o.mimetype,width:o.width,height:o.height,sha1:o.sha1,storage:o.storage,full_url:o.url,path:o.path,filepath:o.filepath,fullurl:o.fullurl,fullUrl:o.fullUrl}};{const c=o.url||o.path||o.filepath||"",d=o.full_url||o.fullurl||o.fullUrl||c;return{...r,data:{id:0,url:c,name:t.name,size:t.size,mimetype:t.type,width:void 0,height:void 0,sha1:"",storage:"local",full_url:d,path:o.path,filepath:o.filepath,fullurl:o.fullurl,fullUrl:o.fullUrl}}}}async function Sa(t,s){const a=new FormData;a.append("mobile",t.mobile),a.append("event",t.event),t.password&&a.append("password",t.password);const r=await Z(q.sms.send,{method:"POST",body:a,token:s});if(Number(r.code)!==1){const l=new Error(r.msg||"发送验证码失败");throw l.msg=r.msg,l.code=r.code,l}return r}async function Jn(t,s){const a=s??ce();if(!a)throw new Error("未找到用户登录信息，请先登录后再提交确权申报");const r=Number(t.amount);if(!Number.isFinite(r)||r<=0)throw new Error("请填写有效的确权金额");if(!t.images||t.images.length===0)throw new Error("请至少上传一张凭证图片");return Z("/rightsDeclaration/submit",{method:"POST",token:a,body:JSON.stringify({voucher_type:t.voucher_type,amount:r,images:t.images,remark:t.remark||""})})}async function Ca(t={},s){const a=s??ce(),r=new URLSearchParams;return t.page&&r.append("page",t.page.toString()),t.limit&&r.append("limit",t.limit.toString()),t.status&&r.append("status",t.status),Z(`/rightsDeclaration/list?${r.toString()}`,{method:"GET",token:a})}async function qn(t,s){const a=s??ce();return Z(`/rightsDeclaration/detail?id=${t}`,{method:"GET",token:a})}async function Zn(t={},s){const a=s??ce(),r=new URLSearchParams;return t.page&&r.append("page",t.page.toString()),t.limit&&r.append("limit",t.limit.toString()),t.status&&r.append("status",t.status),Z(`/rightsDeclaration/reviewStatus?${r.toString()}`,{method:"GET",token:a})}const Qn=({visible:t,announcement:s,onClose:a,onDontShowToday:r})=>!t||!s?null:e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-300",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-orange-500 to-orange-400 px-4 py-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ka,{size:20,className:"animate-bounce"}),e.jsx("span",{className:"font-semibold",children:"平台公告"})]}),e.jsx("button",{type:"button",className:"absolute top-3 right-3 p-1 rounded-full bg-white/20 hover:bg-white/30 active:bg-white/40 transition-colors",onClick:a,children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"px-4 pt-4 pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 leading-tight",children:s.title}),s.createtime&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:(()=>{const l=typeof s.createtime=="number"?s.createtime:parseInt(s.createtime,10);if(isNaN(l))return"";const o=new Date(l*1e3),c=o.getFullYear(),d=String(o.getMonth()+1).padStart(2,"0"),x=String(o.getDate()).padStart(2,"0"),m=String(o.getHours()).padStart(2,"0"),b=String(o.getMinutes()).padStart(2,"0");return`${c}-${d}-${x} ${m}:${b}`})()})]}),e.jsx("div",{className:"px-4 py-3 max-h-[50vh] overflow-y-auto",children:e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:s.content}})}),e.jsxs("div",{className:"px-4 py-4 border-t border-gray-100 bg-gray-50 flex flex-col gap-2",children:[e.jsx("button",{type:"button",className:"w-full py-2.5 bg-gradient-to-r from-orange-500 to-orange-400 text-white text-sm font-medium rounded-lg active:opacity-80 transition-opacity shadow-sm",onClick:a,children:"我知道了"}),r&&e.jsx("button",{type:"button",className:"w-full py-2 text-xs text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>{r(),a()},children:"今日不再提示"})]})]})}),ee=t=>t?t.code===1||typeof t.code>"u":!1,re=t=>!t||!(t.code===0||t.code===1||typeof t.code>"u")?null:t.data??null,oe=(t,s="操作失败，请稍后重试")=>t&&(t.msg||t.message)||s,Xn=(t,s="操作失败，请稍后重试")=>{var a;return t?t.msg?t.msg:(a=t.response)!=null&&a.msg?t.response.msg:t.message?t.message:s:s},Ut=async(t,s)=>{try{const a=await t();if(ee(a))return re(a);{const r=oe(a);return s==null||s(r),null}}catch(a){const r=Xn(a);return s==null||s(r),null}},{AUTH_KEY:Gt,AUTH_TOKEN_KEY:mt,USER_INFO_KEY:Ct,REAL_NAME_STATUS_KEY:ut,REAL_NAME_KEY:Et}=je;function Ea(){const[t,s]=n.useState(()=>Xe(Gt)==="true"),[a,r]=n.useState(()=>ss(Ct)),[l,o]=n.useState(()=>Xe(mt)),[c,d]=n.useState(()=>{const u=Xe(ut);return u?parseInt(u,10):null}),[x,m]=n.useState(()=>Xe(Et)),b=c===2,g=n.useCallback(async u=>{if(s(!0),Ve(Gt,"true"),u!=null&&u.token){o(u.token),Ve(mt,u.token);try{const _=await Zt(u.token);if(ee(_)&&_.data){const N=_.data.real_name_status,i=_.data.real_name;d(N),Ve(ut,String(N)),i&&(m(i),Ve(Et,i))}}catch(_){console.error("获取实名认证状态失败:",_)}}u!=null&&u.userInfo&&(r(u.userInfo),Jt(Ct,u.userInfo))},[]),f=n.useCallback(()=>{s(!1),r(null),o(null),d(null),m(null),gt(Gt),gt(mt),gt(Ct),gt(ut),gt(Et)},[]),h=n.useCallback(u=>{r(u),Jt(Ct,u)},[]),j=n.useCallback(u=>{o(u),Ve(mt,u)},[]),w=n.useCallback((u,_)=>{d(u),Ve(ut,String(u)),_&&(m(_),Ve(Et,_))},[]),v=n.useCallback(async()=>{const u=l||Xe(mt);if(!u){Ke("auth.realName.refresh","无法刷新实名认证状态：未找到token");return}try{const _=await Zt(u);if(ee(_)&&_.data){const N=_.data.real_name_status,i=_.data.real_name;fe("auth.realName.refresh","刷新实名认证状态成功",{status:N,name:i}),d(N),Ve(ut,String(N)),i&&(m(i),Ve(Et,i))}}catch(_){Fe("auth.realName.refresh","刷新实名认证状态失败",_)}},[l]);return n.useEffect(()=>{const u=_=>{if(_.key===Gt){const N=_.newValue==="true";s(N),N||(r(null),o(null))}if(_.key===Ct)try{const N=_.newValue?JSON.parse(_.newValue):null;r(N)}catch{r(null)}if(_.key===mt&&o(_.newValue),_.key===ut)try{const N=_.newValue?parseInt(_.newValue,10):null;d(N)}catch{d(null)}};return window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u)}},[]),{isLoggedIn:t,user:a,token:l,realNameStatus:c,realName:x,isRealNameVerified:b,login:g,logout:f,updateUser:h,updateToken:j,updateRealNameStatus:w,refreshRealNameStatus:v}}function ei(t){switch(t.name){case"settings":return"service-center:settings";case"reset-login-password":return t.from?"service-center:reset-login-password":"reset-login-password";case"reset-pay-password":return t.from?"service-center:reset-pay-password":"reset-pay-password";case"notification-settings":return"service-center:notification-settings";case"account-deletion":return"service-center:account-deletion";case"edit-profile":return"service-center:edit-profile";case"message-center":return"service-center:message";case"about-us":return t.from==="home"?"home:about-us":"about-us";case"user-agreement":return t.from==="profile"?"profile:user-agreement":"user-agreement";case"news":return t.activeTab?`news:${t.activeTab}`:"news";case"news-detail":return`news-detail:${t.id}`;case"artist-detail":return`artist-detail:${t.id}`;case"artist-works-showcase":return`artist-works-showcase:${t.artistId}`;case"cashier":return`cashier:${t.orderId}`;case"order-detail":return`order-detail:${t.orderId}`;case"order-list":return`order-list:${t.kind}:${t.status}`;case"asset-view":return typeof t.tab=="number"?`asset-view:${t.tab}`:"asset-view";case"asset-history":return t.title?`asset-history:${t.type}:${t.title}`:`asset-history:${t.type}`;case"hashrate-exchange":return t.source?`wallet:hashrate_exchange:${t.source}`:"wallet:hashrate_exchange";case"balance-recharge":{const s=["asset","balance-recharge"];return t.source&&s.push(t.source),t.amount&&s.push(t.amount),s.join(":")}case"balance-withdraw":{const s=["asset","balance-withdraw"];return t.source&&s.push(t.source),s.join(":")}case"service-recharge":{const s=["asset","service-recharge"];return t.source&&s.push(t.source),s.join(":")}case"claim-detail":return`claim-detail:${t.id}`;case"my-collection-detail":return`my-collection-detail:${t.id}`;case"my-collection-consignment":return`my-collection-action:consignment:${t.id}`;case"friend-detail":return`friend-detail:${t.id}`;default:return t.name}}function Ia(t){const s=t.split(":");switch(s[0]){case"news-center":return{name:"news"};case"news":return{name:"news",activeTab:s[1]||void 0};case"news-detail":return{name:"news-detail",id:s[1]||""};case"artist-detail":return{name:"artist-detail",id:s[1]||""};case"artist-works-showcase":return{name:"artist-works-showcase",artistId:s[1]||""};case"cashier":return{name:"cashier",orderId:s[1]||""};case"order-detail":return{name:"order-detail",orderId:s[1]||""};case"order-list":return{name:"order-list",kind:s[1]||"product",status:Number(s[2])||0};case"asset-view":return{name:"asset-view",tab:s[1]?Number(s[1]):void 0};case"asset-history":return{name:"asset-history",type:s[1]||"",title:s[2]||void 0};case"wallet":return s[1]==="hashrate_exchange"?{name:"hashrate-exchange",source:s[2]||void 0}:{name:"asset-view"};case"asset":return s[1]==="balance-recharge"?{name:"balance-recharge",source:s[2],amount:s[3]}:s[1]==="balance-withdraw"?{name:"balance-withdraw",source:s[2]}:s[1]==="service-recharge"?{name:"service-recharge",source:s[2]}:s[1]==="extension-withdraw"?{name:"extension-withdraw"}:{name:"asset-view"};case"hashrate-exchange":return{name:"hashrate-exchange",source:s[1]||void 0};case"reset-login-password":return{name:"reset-login-password",from:s[1]||void 0};case"reset-pay-password":return{name:"reset-pay-password",from:s[1]||void 0};case"claim-detail":return{name:"claim-detail",id:s[1]||""};case"my-collection-detail":return{name:"my-collection-detail",id:s[1]||""};case"my-collection-action":return s[1]==="consignment"?{name:"my-collection-consignment",id:s[2]||""}:{name:"my-collection"};case"friend-detail":return{name:"friend-detail",id:s[1]||""};case"service-center":switch(s[1]){case"settings":return{name:"settings"};case"reset-login-password":return{name:"reset-login-password",from:"settings"};case"reset-pay-password":return{name:"reset-pay-password",from:"settings"};case"forgot-password":return{name:"forgot-password"};case"notification-settings":return{name:"notification-settings"};case"account-deletion":return{name:"account-deletion"};case"edit-profile":return{name:"edit-profile"};case"message":return{name:"message-center"};default:return{name:"settings"}}case"home":return s[1]==="about-us"?{name:"about-us",from:"home"}:{name:"login"};case"profile":return s[1]==="user-agreement"?{name:"user-agreement",from:"profile"}:{name:"my-friends"};case"artist-showcase":return{name:"artist-showcase"};case"masterpiece-showcase":return{name:"masterpiece-showcase"};case"trading-zone":return{name:"trading-zone"};case"reservation":return{name:"reservation"};case"reservation-record":return{name:"reservation-record"};case"card-management":return{name:"card-management"};case"help-center":return{name:"help-center"};case"online-service":return{name:"online-service"};case"sign-in":return{name:"sign-in"};case"cumulative-rights":return{name:"cumulative-rights"};case"consignment-voucher":return{name:"consignment-voucher"};case"my-collection":return{name:"my-collection"};case"claim-history":return{name:"claim-history"};case"asset-trace":return{name:"asset-trace"};case"search":return{name:"search"};case"switch-to-market":return{name:"switch-to-market"};case"invite-friends":return{name:"invite-friends"};default:return{name:"login"}}}function os(t){return t?typeof t=="string"?{...Ia(t),back:null}:"name"in t?{...t,back:t.back??null}:null:null}function ti(t=null){const[s,a]=n.useState(()=>os(t)),r=n.useRef([]),l=n.useCallback((x,m)=>{const b=os(x);m!=null&&m.clearHistory&&(r.current=[]),!(m!=null&&m.replace)&&s&&(r.current=[...r.current,s]);const g=b?{...b,back:(m==null?void 0:m.back)??b.back??null}:null;a(g)},[s]),o=n.useCallback(()=>{a(x=>{let m=null;if(x!=null&&x.back)m=os(x.back),console.log("[goBack] Using route.back:",x.back,"-> next:",(m==null?void 0:m.name)??"null");else{const b=[...r.current];m=b.pop()??null,r.current=b,console.log("[goBack] Popped from stack, remaining:",b.length,"-> next:",(m==null?void 0:m.name)??"null")}return m})},[]),c=n.useMemo(()=>r.current,[]),d=n.useCallback(()=>{r.current=[],a(null)},[]);return{current:s,history:c,navigate:l,goBack:o,reset:d}}const si=t=>{if(typeof t=="number")return{iconSize:t,textClass:"text-sm",gapClass:"gap-2"};const s={sm:{iconSize:16,textClass:"text-xs",gapClass:"gap-1"},md:{iconSize:24,textClass:"text-sm",gapClass:"gap-2"},lg:{iconSize:32,textClass:"text-base",gapClass:"gap-3"}};return s[t]||s.md},ge=({size:t="md",text:s,color:a,fullScreen:r=!1,className:l=""})=>{const{iconSize:o,textClass:c,gapClass:d}=si(t),x=r?"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50":`flex items-center justify-center ${d} ${l}`,m=a||"currentColor";return e.jsxs("div",{className:x,children:[e.jsx("svg",{width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:m,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`animate-spin ${!a&&"text-orange-500"}`,"aria-hidden":"true",children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),s&&e.jsx("span",{className:`${c} text-gray-600`,children:s})]})},_e=({title:t,onBack:s,children:a,rightAction:r,loading:l=!1,loadingText:o="加载中...",bgColor:c="bg-gray-50",padding:d=!0,footer:x,className:m=""})=>e.jsxs("div",{className:`min-h-screen ${c} pb-safe flex flex-col ${m}`,children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center sticky top-0 z-30 shadow-sm",children:[s&&e.jsx("button",{onClick:s,className:"absolute left-4 p-1 text-gray-600 active:bg-gray-100 rounded-full","aria-label":"返回上一页",children:e.jsx(Rt,{size:20})}),e.jsx("h1",{className:"text-lg font-bold text-gray-800 w-full text-center",children:t}),r&&e.jsx("div",{className:"absolute right-4",children:r})]}),e.jsx("div",{className:`flex-1 ${d?"p-4":""}`,children:l?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(ge,{text:o})}):a}),x&&e.jsx("div",{className:`sticky bottom-0 left-0 right-0 bg-white border-t border-gray-100 \r
                        px-4 py-3 pb-safe shadow-[0_-2px_10px_rgba(0,0,0,0.05)]`,children:x})]}),Oe=({icon:t,title:s,description:a,action:r,className:l=""})=>e.jsxs("div",{className:`flex flex-col items-center justify-center py-16 px-4 ${l}`,children:[e.jsx("div",{className:"mb-4",children:t||e.jsx(Ja,{size:64,className:"text-gray-300","aria-hidden":"true"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-2",children:s}),a&&e.jsx("p",{className:"text-sm text-gray-400 text-center max-w-xs mb-4",children:a}),r&&e.jsx("button",{onClick:r.onClick,className:`mt-2 px-6 py-2 bg-orange-500 text-white text-sm font-medium rounded-full \r
                     hover:bg-orange-600 active:scale-95 transition-all duration-200\r
                     shadow-md shadow-orange-200`,children:r.label})]}),ai=({open:t,title:s,content:a,onConfirm:r,onCancel:l,confirmText:o="确定",cancelText:c="取消",loading:d=!1,confirmType:x="primary",showCloseButton:m=!0,maskClosable:b=!0})=>{if(!t)return null;const g=()=>{b&&!d&&l()},f=j=>{j.stopPropagation()},h=x==="danger"?"bg-red-500 hover:bg-red-600 active:bg-red-700":"bg-orange-500 hover:bg-orange-600 active:bg-orange-700";return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:g,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`bg-white rounded-2xl w-full max-w-sm shadow-xl transform transition-all \r
                   animate-in fade-in zoom-in-95 duration-200`,onClick:f,children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[e.jsx("h3",{id:"modal-title",className:"text-lg font-semibold text-gray-800",children:s}),m&&e.jsx("button",{onClick:l,disabled:d,className:`p-1 text-gray-400 hover:text-gray-600 rounded-full \r
                         hover:bg-gray-100 transition-colors disabled:opacity-50`,"aria-label":"关闭弹窗",children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"px-5 py-6 text-gray-600 text-sm leading-relaxed",children:a}),e.jsxs("div",{className:"flex gap-3 px-5 pb-5",children:[e.jsx("button",{onClick:l,disabled:d,className:`flex-1 py-3 px-4 border border-gray-200 text-gray-600 \r
                       font-medium rounded-xl hover:bg-gray-50 active:bg-gray-100\r
                       transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,children:c}),e.jsxs("button",{onClick:r,disabled:d,className:`flex-1 py-3 px-4 text-white font-medium rounded-xl 
                       transition-colors disabled:opacity-70 disabled:cursor-not-allowed
                       flex items-center justify-center gap-2 ${h}`,children:[d&&e.jsx(dt,{size:18,className:"animate-spin"}),d?"处理中...":o]})]})]})})},st=({icon:t,title:s,subtitle:a,extra:r,arrow:l=!0,onClick:o,className:c="",disabled:d=!1})=>{const x=o&&!d;return e.jsxs("div",{className:`
        flex items-center py-3.5 px-4 bg-white
        ${x?"cursor-pointer active:bg-gray-50":""}
        ${d?"opacity-50 cursor-not-allowed":""}
        ${c}
      `,onClick:x?o:void 0,role:x?"button":void 0,tabIndex:x?0:void 0,children:[t&&e.jsx("div",{className:"mr-3 flex-shrink-0",children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-base text-gray-800 truncate",children:s}),a&&e.jsx("div",{className:"text-sm text-gray-500 mt-0.5 truncate",children:a})]}),e.jsxs("div",{className:"flex items-center ml-3 flex-shrink-0",children:[r&&e.jsx("div",{className:"mr-1",children:r}),l&&e.jsx(qe,{size:20,className:"text-gray-400","aria-hidden":"true"})]})]})},ri="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",et=({src:t,alt:s,className:a="",placeholder:r,onError:l,onLoad:o})=>{const[c,d]=n.useState(!1),[x,m]=n.useState(!1),[b,g]=n.useState(!1),f=n.useRef(null);n.useEffect(()=>{const v=f.current;if(!v)return;const u=new IntersectionObserver(_=>{_.forEach(N=>{N.isIntersecting&&(g(!0),u.unobserve(v))})},{rootMargin:"100px",threshold:.1});return u.observe(v),()=>{u.disconnect()}},[]);const h=()=>{d(!0),m(!1),o==null||o()},j=()=>{d(!0),m(!0),l==null||l()},w=b?t:r||ri;return e.jsxs("div",{className:`relative overflow-hidden bg-gray-100 ${a}`,children:[!c&&e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-gray-100 via-gray-200 to-gray-100 \r
                        animate-pulse`}),x?e.jsxs("div",{className:`absolute inset-0 flex flex-col items-center justify-center \r
                        bg-gray-100 text-gray-400`,children:[e.jsx(qa,{size:24,"aria-hidden":"true"}),e.jsx("span",{className:"text-xs mt-1",children:"加载失败"})]}):e.jsx("img",{ref:f,src:w,alt:s,className:`w-full h-full object-cover transition-opacity duration-300 
                     ${c?"opacity-100":"opacity-0"}`,onLoad:h,onError:j,loading:"lazy"})]})},ni=()=>{const t={};for(const s of Tr){const a=s.label,r=[],l={};if(s.children)for(const o of s.children){const c=o.label;r.push(c),o.children&&(l[c]=o.children.map(d=>d.label))}t[a]={cities:r,districts:Object.keys(l).length>0?l:void 0}}return t},ii=ni(),li=({visible:t,onClose:s,onConfirm:a,initialProvince:r="",initialCity:l="",initialDistrict:o=""})=>{const[c,d]=n.useState(!1),[x,m]=n.useState(!1),b=ii,[g,f]=n.useState(""),[h,j]=n.useState(""),[w,v]=n.useState(""),u=n.useMemo(()=>Object.keys(b),[b]),_=n.useMemo(()=>!g||!b[g]?[]:b[g].cities||[],[g,b]),N=n.useMemo(()=>{if(!g||!h||!b[g])return[];const p=b[g];return p.districts?p.districts[h]||[]:[]},[g,h,b]);n.useEffect(()=>{if(t)m(!0),requestAnimationFrame(()=>d(!0)),Object.keys(b).length>0&&i();else{d(!1);const p=setTimeout(()=>m(!1),300);return()=>clearTimeout(p)}},[t,b]);const i=()=>{var P,y,S,k,T,D,Y,L;const p=Object.keys(b);if(p.length!==0)if(r&&p.includes(r)){f(r);const B=((P=b[r])==null?void 0:P.cities)||[];if(l&&B.includes(l)){j(l);const K=((S=(y=b[r])==null?void 0:y.districts)==null?void 0:S[l])||[];o&&K.includes(o)?v(o):K.length>0?v(K[0]):v("")}else if(B.length>0){j(B[0]);const K=((T=(k=b[r])==null?void 0:k.districts)==null?void 0:T[B[0]])||[];v(K.length>0?K[0]:"")}}else{const B=p[0];f(B);const K=((D=b[B])==null?void 0:D.cities)||[];if(K.length>0){j(K[0]);const C=((L=(Y=b[B])==null?void 0:Y.districts)==null?void 0:L[K[0]])||[];v(C.length>0?C[0]:"")}}},F=p=>{var y,S,k;if(p===g)return;f(p);const P=((y=b[p])==null?void 0:y.cities)||[];if(P.length>0){const T=P[0];j(T);const D=((k=(S=b[p])==null?void 0:S.districts)==null?void 0:k[T])||[];v(D.length>0?D[0]:"")}else j(""),v("")},I=p=>{var y,S;if(p===h)return;j(p);const P=((S=(y=b[g])==null?void 0:y.districts)==null?void 0:S[p])||[];v(P.length>0?P[0]:"")},z=()=>{g&&h&&a(g,h,w||void 0)};return x?e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,onClick:s}),e.jsxs("div",{className:`relative bg-white rounded-t-2xl w-full max-h-[70vh] flex flex-col transition-transform duration-300 ease-out ${c?"translate-y-0":"translate-y-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100",children:[e.jsx("button",{onClick:s,className:"text-gray-400 p-1 active:bg-gray-50 rounded-full",children:e.jsx(Ce,{size:20})}),e.jsx("span",{className:"text-base font-bold text-gray-800",children:"选择所在地区"}),e.jsx("button",{onClick:z,className:"text-orange-600 font-medium text-sm p-1 active:opacity-70",children:"确定"})]}),e.jsxs("div",{className:"px-4 py-2 bg-gray-50 flex items-center gap-2 text-sm flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full ${g?"bg-orange-100 text-orange-700":"text-gray-400"}`,children:g||"请选择省份"}),e.jsx("span",{className:"text-gray-300",children:"/"}),e.jsx("span",{className:`px-3 py-1 rounded-full ${h?"bg-orange-100 text-orange-700":"text-gray-400"}`,children:h||"请选择城市"}),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"/"}),e.jsx("span",{className:`px-3 py-1 rounded-full ${w?"bg-orange-100 text-orange-700":"text-gray-400"}`,children:w||"请选择区县"})]})]}),e.jsxs("div",{className:`flex h-64 overflow-hidden ${N.length>0?"divide-x":""}`,children:[e.jsx("div",{className:`${N.length>0?"flex-1":"w-1/2"} overflow-y-auto border-r border-gray-100 overscroll-contain bg-gray-50/50`,children:u.map(p=>e.jsx("div",{onClick:()=>F(p),className:`px-3 py-3 text-sm text-center cursor-pointer transition-colors ${p===g?"bg-white text-orange-600 font-bold border-l-4 border-orange-500":"text-gray-600 hover:bg-gray-100"}`,children:p},p))}),e.jsxs("div",{className:`${N.length>0?"flex-1":"w-1/2"} overflow-y-auto overscroll-contain bg-white`,children:[_.map(p=>e.jsxs("div",{onClick:()=>I(p),className:`px-3 py-3 text-sm text-center cursor-pointer transition-colors flex items-center justify-between ${p===h?"text-orange-600 font-bold bg-orange-50/20":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("span",{children:p}),p===h&&e.jsx(Ze,{size:16,className:"text-orange-500"})]},p)),_.length===0&&e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-xs",children:"暂无城市数据"})]}),N.length>0&&e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain bg-white/50",children:N.map(p=>e.jsxs("div",{onClick:()=>v(p),className:`px-3 py-3 text-sm text-center cursor-pointer transition-colors flex items-center justify-between ${p===w?"text-orange-600 font-bold bg-orange-50":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("span",{children:p}),p===w&&e.jsx(Ze,{size:16,className:"text-orange-500"})]},p))})]}),e.jsx("div",{className:"pb-safe bg-white"})]})]}):null},Gs=["ICBC","ABC","BOC","CCB","CMB","PSBC","COMM","CITIC","SPDB","CIB","CMBC","GDB","SPABANK"],oi=[...xa].sort((t,s)=>{const a=Gs.indexOf(t.code),r=Gs.indexOf(s.code);return a!==-1&&r!==-1?a-r:a!==-1?-1:r!==-1?1:0}),ci=()=>oi.map(t=>t.name),di=t=>{const s=xa.find(a=>a.name===t);return s==null?void 0:s.code},xi=new Set(["ABC","ASCB","BJBANK","BOC","BOHAIB","CCB","CEB","CIB","CITIC","CMB","CMBC","COMM","CQBANK","CZBANK","GDB","HBC","HXBANK","ICBC","JSB","NBBANK","NJCB","PSBC","SHBANK","SPABANK","SPDB"]),mi=t=>{const s=t==null?void 0:t.toUpperCase();return s&&xi.has(s)?`/images/banks/${s}.png`:"/images/banks/default.png"},ui=({visible:t,onClose:s,onConfirm:a,initialBank:r=""})=>{const[l,o]=n.useState(!1),[c,d]=n.useState(!1),[x,m]=n.useState(""),[b,g]=n.useState(""),[f,h]=n.useState(!1),j=n.useMemo(()=>ci(),[]),w=n.useMemo(()=>b.trim()?j.filter(_=>_.toLowerCase().includes(b.toLowerCase())):j,[j,b]);n.useEffect(()=>{if(t){if(d(!0),requestAnimationFrame(()=>o(!0)),g(""),h(!1),r){const _=j.includes(r);m(r),!_&&r.trim()}}else{o(!1);const _=setTimeout(()=>d(!1),300);return()=>clearTimeout(_)}},[t,r,j]);const v=()=>{f?b.trim()&&a(b.trim()):x&&a(x)},u=()=>{b.trim()&&a(b.trim())};return c?e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 transition-opacity duration-300 ${l?"opacity-100":"opacity-0"}`,onClick:s}),e.jsxs("div",{className:`relative bg-white rounded-t-2xl w-full max-h-[85vh] flex flex-col transition-transform duration-300 ease-out ${l?"translate-y-0":"translate-y-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 flex-shrink-0",children:[e.jsx("button",{onClick:s,className:"text-gray-400 p-1 active:bg-gray-50 rounded-full",children:e.jsx(Ce,{size:20})}),e.jsx("span",{className:"text-base font-bold text-gray-800",children:f?"手动输入银行":"选择银行"}),!f&&e.jsx("button",{onClick:v,className:"text-orange-600 font-medium text-sm p-1 active:opacity-70",children:"确定"}),f&&e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-50 bg-white flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(Nt,{size:16})}),e.jsx("input",{type:"text",placeholder:"搜索或输入银行名称",className:"w-full bg-gray-100 text-sm text-gray-900 rounded-xl pl-9 pr-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:bg-white transition-all",value:b,onChange:_=>{g(_.target.value),f&&!_.target.value&&h(!1)},onFocus:()=>{}}),b&&e.jsx("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 p-1",onClick:()=>g(""),children:e.jsx(Ce,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-[300px] overscroll-contain bg-white pb-safe",children:[b&&!w.some(_=>_===b)&&e.jsxs("div",{onClick:u,className:"px-5 py-4 text-sm flex items-center gap-3 cursor-pointer border-b border-gray-50 active:bg-gray-50 transition-colors text-orange-600 bg-orange-50/10",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Za,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:['使用 "',b,'"']}),e.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:"找不到银行？点击直接使用输入名称"})]})]}),w.map(_=>{const N=di(_),i=N?mi(N):"/images/banks/default.png";return e.jsxs("div",{onClick:()=>{m(_),h(!1)},className:`px-5 py-3.5 text-sm flex items-center justify-between cursor-pointer border-b border-gray-50 active:bg-gray-50 transition-colors ${_===x?"text-orange-600 font-medium bg-orange-50/20":"text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:i,alt:_,className:"w-6 h-6 object-contain rounded",onError:F=>{F.target.src="/images/banks/default.png"}}),e.jsx("span",{children:_})]}),_===x&&e.jsx(Ze,{size:18,className:"text-orange-500"})]},_)}),w.length===0&&!b&&e.jsx("div",{className:"py-12 text-center text-gray-400 text-xs",children:"暂无银行数据"}),w.length===0&&b&&e.jsx("div",{className:"py-8 text-center text-gray-400 text-xs",children:'没有找到匹配的银行，请使用上方"手动输入"'})]})]})]}):null},Hs=({open:t,isRealNameVerified:s=!1,onNavigateToAuth:a,onBackToHome:r,onNavigateToProfile:l})=>t?s&&l?(l(),null):e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-sm mx-4 shadow-2xl",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(pe,{className:"text-orange-500",size:32})})}),e.jsx("h2",{className:"text-xl font-bold text-center text-gray-800 mb-4",children:"需要实名认证"}),e.jsx("p",{className:"text-center text-gray-600 mb-8 leading-relaxed",children:"为了您的账户安全，需要完成实名认证后才能使用此功能"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:a,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3.5 rounded-full font-bold text-base shadow-lg shadow-orange-200 active:scale-95 transition-transform",children:"前往实名认证"}),e.jsx("button",{onClick:r,className:"w-full bg-gray-100 text-gray-700 py-3.5 rounded-full font-medium text-base active:scale-95 transition-transform",children:"返回首页"})]})]})}):null,gi=t=>{if(!t)return"";if(typeof t=="string"&&(t.includes("-")||t.includes("/")))return t;let s;if(typeof t=="string"){if(s=parseInt(t,10),isNaN(s))return t}else s=t;const a=s<1e10?s*1e3:s,r=new Date(a);if(isNaN(r.getTime()))return String(t);const l=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0"),d=String(r.getHours()).padStart(2,"0"),x=String(r.getMinutes()).padStart(2,"0");return`${l}-${o}-${c} ${d}:${x}`},Ta=({newsItem:t,onBack:s})=>{const a=l=>l?l.split(`

`).map((o,c)=>e.jsx("p",{className:"mb-4 leading-7 text-justify",children:o},c)):e.jsx(Oe,{title:"暂无内容"}),r=t.type==="announcement"?"公告详情":"资讯详情";return e.jsx(_e,{title:r,onBack:s,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3 leading-snug",children:t.title}),e.jsxs("div",{className:"flex items-center text-gray-400 text-xs mb-6 pb-4 border-b border-gray-50",children:[e.jsx(ze,{size:12,className:"mr-1.5"}),e.jsxs("span",{children:["发布时间：",gi(t.date)]})]}),e.jsx("div",{className:"text-gray-700 text-sm",children:a(t.content)})]})})},Fa=({artistId:t,onBack:s,onProductSelect:a})=>{const[r,l]=n.useState(null),[o,c]=n.useState([]),[d,x]=n.useState(!0),[m,b]=n.useState(null);return n.useEffect(()=>{let g=!0;return(async()=>{var h;try{x(!0),b(null);let j=t;if(!j)try{const _=(await Es({page:1,limit:1})).data,N=(h=_==null?void 0:_.list)==null?void 0:h[0];if(N)j=N.id;else{b("未找到任何艺术家数据");return}}catch(u){console.error("兜底获取艺术家列表失败:",u),b("未找到有效的艺术家ID");return}const w=await Bn(j);if(!g)return;if(w.code!==1||!w.data){b(w.msg||"艺术家数据加载失败");return}const v=w.data;l({id:String(v.id),name:v.name,image:ke(v.image),title:v.title,bio:v.bio}),c((v.works||[]).map(u=>({...u,image:ke(u.image)})))}catch(j){console.error("加载艺术家详情失败:",j),b((j==null?void 0:j.message)||"加载艺术家详情失败")}finally{g&&x(!1)}})(),()=>{g=!1}},[t]),e.jsxs(_e,{title:"艺术家详情",onBack:s,children:[d&&!r&&e.jsx(ge,{text:"加载中..."}),m&&!r&&e.jsx("div",{className:"text-center text-xs text-red-400 py-8",children:m}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 flex flex-col items-center text-center mb-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden mb-4 border-4 border-gray-50 shadow-inner",children:e.jsx(et,{src:r.image,alt:r.name,className:"w-full h-full"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:r.name}),r.title&&e.jsx("span",{className:"inline-block bg-orange-50 text-orange-600 text-xs px-3 py-1 rounded-full font-medium mb-4",children:r.title}),e.jsx("div",{className:"w-full h-px bg-gray-100 mb-4"}),e.jsxs("div",{className:"text-left w-full",children:[e.jsx("h3",{className:"font-bold text-sm text-gray-800 mb-2 border-l-4 border-orange-500 pl-2",children:"艺术家简介"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:r.bio||"暂无简介"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center mb-3 px-1",children:e.jsx("h3",{className:"font-bold text-gray-800 text-base border-l-4 border-orange-500 pl-2",children:"代表作品"})}),o.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map(g=>e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-sm border border-gray-100 active:scale-[0.99] transition-transform cursor-pointer",onClick:()=>{a&&g.price!==void 0&&a({id:String(g.id),title:g.title,artist:(r==null?void 0:r.name)||"",image:g.image,price:g.price,productType:"shop"})},children:[e.jsx(et,{src:g.image,alt:g.title,className:"w-full aspect-square"}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-sm text-gray-800 font-medium truncate",children:g.title}),g.price!==void 0&&e.jsxs("div",{className:"text-red-500 text-sm font-bold mt-1",children:[g.price.toFixed(2)," ",e.jsx("span",{className:"text-[10px] font-normal text-gray-400",children:"消费金"})]}),g.description&&!g.price&&e.jsx("div",{className:"text-[11px] text-gray-500 mt-1 line-clamp-2",children:g.description})]})]},g.id))}):e.jsx(Oe,{title:"暂无代表作品数据"})]})]})]})},xt=({title:t,onBack:s,children:a,rightAction:r,bgColor:l="bg-gray-50"})=>e.jsxs("div",{className:`h-screen flex flex-col ${l} pb-safe`,children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center shadow-sm shrink-0 z-30",children:[e.jsx("button",{onClick:s,className:"absolute left-4 p-1 text-gray-600 active:bg-gray-100 rounded-full",children:e.jsx(Rt,{size:20})}),e.jsx("h1",{className:"text-lg font-bold text-gray-800 w-full text-center",children:t}),r&&e.jsx("div",{className:"absolute right-4",children:r})]}),e.jsx("div",{className:"flex-1 overflow-y-auto relative flex flex-col scrollbar-hide",children:a})]}),Pa=n.createContext(void 0),he=()=>{const t=n.useContext(Pa);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t},hi=({children:t})=>{const[s,a]=n.useState([]),[r,l]=n.useState(null),[o,c]=n.useState(null),d=n.useCallback((j,w,v,u=3e3,_)=>{const N=Date.now().toString()+Math.random().toString().slice(2),i={id:N,type:j,title:w,description:v,duration:u,action:_};a(F=>[i,...F].slice(0,3)),u>0&&setTimeout(()=>{x(N)},u)},[]),x=n.useCallback(j=>{a(w=>w.filter(v=>v.id!==j))},[]),m=n.useCallback((j,w,v=4e3)=>{l({text:j,action:w,duration:v}),v>0&&setTimeout(()=>{l(null)},v)},[]),b=n.useCallback(()=>{l(null)},[]),g=n.useCallback(j=>{c(j)},[]),f=n.useCallback(()=>{c(null)},[]),h={showToast:d,showSnackBar:m,showDialog:g,hideDialog:f,toasts:s,snackBar:r,dialog:o,removeToast:x,closeSnackBar:b};return e.jsx(Pa.Provider,{value:h,children:t})},fi=({tabs:t,activeTab:s,onChange:a})=>e.jsx("div",{className:"bg-white border-b border-gray-100 sticky top-0 z-20",children:e.jsx("div",{className:"flex overflow-x-auto no-scrollbar",children:t.map((r,l)=>e.jsxs("button",{onClick:()=>a(l),className:`flex-1 min-w-[80px] py-3 text-sm font-medium relative whitespace-nowrap ${s===l?"text-orange-600":"text-gray-500"}`,children:[r,s===l&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 bg-orange-600 rounded-full"})]},l))})});var ys=(t=>(t[t.NOT_VERIFIED=0]="NOT_VERIFIED",t[t.PENDING=1]="PENDING",t[t.VERIFIED=2]="VERIFIED",t[t.REJECTED=3]="REJECTED",t))(ys||{}),be=(t=>(t[t.NOT_CONSIGNED=0]="NOT_CONSIGNED",t[t.PENDING=1]="PENDING",t[t.CONSIGNING=2]="CONSIGNING",t[t.REJECTED=3]="REJECTED",t[t.SOLD=4]="SOLD",t))(be||{}),We=(t=>(t[t.NOT_DELIVERED=0]="NOT_DELIVERED",t[t.DELIVERED=1]="DELIVERED",t))(We||{}),it=(t=>(t[t.PENDING=0]="PENDING",t[t.APPROVED=1]="APPROVED",t[t.REJECTED=2]="REJECTED",t))(it||{}),lt=(t=>(t[t.PENDING=0]="PENDING",t[t.APPROVED=1]="APPROVED",t[t.REJECTED=2]="REJECTED",t))(lt||{}),Tt=(t=>(t[t.UNPAID=0]="UNPAID",t[t.PAID=1]="PAID",t))(Tt||{}),Ue=(t=>(t[t.NOT_SHIPPED=0]="NOT_SHIPPED",t[t.SHIPPED=1]="SHIPPED",t[t.RECEIVED=2]="RECEIVED",t))(Ue||{}),Me=(t=>(t[t.PENDING=0]="PENDING",t[t.APPROVED=1]="APPROVED",t[t.REJECTED=2]="REJECTED",t[t.CANCELLED=3]="CANCELLED",t))(Me||{});const bi=({orders:t,loading:s,activeTab:a,formatOrderDate:r,formatOrderPrice:l,onCancelConsignment:o})=>!t.length&&!s?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(vt,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-xs",children:"暂无寄售订单"})]}):e.jsxs(e.Fragment,{children:[t.map(c=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:c.create_time_text||r(c.create_time)}),e.jsx("span",{className:"text-xs font-medium text-orange-600",children:c.consignment_status_text||"未知状态"})]}),e.jsxs("div",{className:"flex gap-3",children:[c.image&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(c.image),alt:c.title,className:"w-full h-full object-cover",onError:d=>{d.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-1",children:c.title}),e.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:["原价: ¥",l(c.original_price)]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 mb-2 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"寄售价格："}),e.jsxs("span",{children:["¥",l(c.consignment_price)]})]}),c.service_fee!==void 0&&Number(c.service_fee)>0&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"服务费："}),e.jsxs("span",{children:["¥",l(c.service_fee)]})]}),c.total_cost!==void 0&&Number(c.total_cost)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("div",{className:"flex justify-between text-gray-900 font-bold",children:[e.jsx("span",{children:"实际成本："}),e.jsxs("span",{children:["¥",l(c.total_cost)]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["寄售价 ¥",l(c.consignment_price)]}),e.jsx("div",{className:"flex gap-2",children:a===1&&c.consignment_status===be.PENDING&&e.jsx("button",{onClick:()=>o(c.consignment_id),className:"px-3 py-1 rounded-full border border-red-300 text-red-600 text-xs active:bg-red-50",children:"取消寄售"})})]})]})]})]},c.consignment_id)),s&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{className:"text-xs text-gray-400",children:"加载中..."})})]}),pi=({activeTab:t,purchaseRecords:s,consignmentOrders:a,loading:r,formatOrderDate:l,formatOrderPrice:o,onViewConsignmentDetail:c})=>{const d=x=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(vt,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-xs",children:x})]});return t===0?!s.length&&!r?d("暂无买入订单"):e.jsxs(e.Fragment,{children:[s.map(x=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:x.pay_time_text||l(x.pay_time)}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:x.status_text||x.order_status_text||"未知状态"})]}),e.jsxs("div",{className:"flex gap-3",children:[x.item_image&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(x.item_image),alt:x.item_title,className:"w-full h-full object-cover",onError:m=>{m.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-1",children:x.item_title}),e.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:["数量: ",x.quantity," | 单价: ¥",o(x.price)]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["¥ ",o(x.total_amount)]}),e.jsx("div",{className:"text-xs text-gray-500",children:x.pay_type_text||"余额支付"})]}),x.order_no&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["订单号: ",x.order_no]})]})]})]},x.order_id)),r&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{className:"text-xs text-gray-400",children:"加载中..."})})]}):!a.length&&!r?d("暂无卖出订单"):e.jsxs(e.Fragment,{children:[a.map(x=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:x.update_time_text||x.create_time_text||l(x.update_time||x.create_time)}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:x.consignment_status_text||"已售出"})]}),e.jsxs("div",{className:"flex gap-3",children:[x.image&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(x.image),alt:x.title,className:"w-full h-full object-cover",onError:m=>{m.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-1",children:x.title}),e.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:["原价: ¥",o(x.original_price)," | 寄售价: ¥",o(x.consignment_price)]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["¥ ",o(x.consignment_price)]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>c(x.consignment_id),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 active:bg-gray-50",children:"查看寄售详情"})})]})]})]})]},x.consignment_id)),r&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{className:"text-xs text-gray-400",children:"加载中..."})})]})},yi=({category:t,orders:s,loading:a,activeTab:r,formatOrderDate:l,formatOrderPrice:o,getOrderStatus:c,getOrderImage:d,getOrderName:x,getOrderQuantity:m,getOrderPrice:b,onDelete:g,onConfirmReceipt:f,onViewDetail:h})=>!s.length&&!a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(vt,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-xs",children:"暂无订单数据"})]}):e.jsxs(e.Fragment,{children:[s.map(j=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:l(j.create_time)}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:c(j)})]}),e.jsxs("div",{className:"flex gap-3",children:[d(j)&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:d(j),alt:x(j),className:"w-full h-full object-cover",onError:w=>{w.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-1",children:x(j)}),e.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:["数量: ",m(j)]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:(()=>{const w=b(j);return w.isScore?`${w.score} 消费金`:`¥ ${o(w.amount)}`})()}),e.jsxs("div",{className:"flex gap-2",children:[r===0&&t==="points"&&e.jsx("button",{onClick:()=>g(j.id),className:"px-3 py-1 rounded-full border border-red-300 text-red-600 text-xs active:bg-red-50",children:"删除订单"}),r===2&&t==="points"||r===1&&t==="delivery"?e.jsx("button",{onClick:()=>f(j.id),className:"px-3 py-1 rounded-full bg-blue-600 text-white text-xs active:bg-blue-700",children:"确认收货"}):null,e.jsx("button",{onClick:()=>h(Number(j.id)),className:"px-3 py-1 rounded-full border border-gray-200 text-xs text-gray-600 active:bg-gray-50",children:"查看详情"})]})]})]})]})]},j.id)),a&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{className:"text-xs text-gray-400",children:"加载中..."})})]}),Pe=(t,s="YYYY-MM-DD HH:mm:ss")=>{if(t==null||t==="")return"-";let a;if(typeof t=="number"){const m=t<1e10?t*1e3:t;a=new Date(m)}else if(typeof t=="string"&&/^\d+$/.test(t)){const m=parseInt(t,10),b=m<1e10?m*1e3:m;a=new Date(b)}else a=new Date(t);if(isNaN(a.getTime()))return"-";const r=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),c=String(a.getHours()).padStart(2,"0"),d=String(a.getMinutes()).padStart(2,"0"),x=String(a.getSeconds()).padStart(2,"0");switch(s){case"YYYY-MM-DD":return`${r}-${l}-${o}`;case"YYYY-MM-DD HH:mm":return`${r}-${l}-${o} ${c}:${d}`;case"MM-DD HH:mm":return`${l}-${o} ${c}:${d}`;case"YYYY-MM-DD HH:mm:ss":default:return`${r}-${l}-${o} ${c}:${d}:${x}`}},we=(t,s={})=>{const{decimals:a=2,prefix:r="",thousandSeparator:l=!0}=s;if(t==null||t==="")return r+"0.00";const o=typeof t=="string"?parseFloat(t):t;if(isNaN(o))return r+"0.00";let c=o.toFixed(a);if(l){const d=c.split(".");d[0]=d[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),c=d.join(".")}return r+c},ji=t=>!t||t.length<11?t||"-":t.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"),Ni=t=>!t||t.length<15?t||"-":t.replace(/(\d{6})\d+(\d{4})/,"$1********$2"),vi=({visible:t,detail:s,onClose:a,formatOrderPrice:r})=>{var l,o,c,d,x,m,b;return!t||!s?null:e.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto relative",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"寄售详情"}),e.jsx("button",{type:"button",className:"p-1 text-gray-400 hover:text-gray-600 active:bg-gray-100 rounded-full",onClick:a,children:e.jsx(Ce,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"藏品名称"})]}),e.jsx("span",{className:"text-xs font-medium text-gray-800",children:s.title})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"寄售状态"})]}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:s.consignment_status_text||"已售出"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"寄售价"})]}),e.jsxs("span",{className:"text-xs text-gray-800",children:["¥ ",r(s.consignment_price)]})]})]}),(s.buyer_id||s.buyer_username||s.buyer_nickname||s.buyer_mobile)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(jt,{size:16,className:"text-blue-600"}),"买家信息"]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-700",children:[s.buyer_id&&e.jsxs("div",{children:["买家ID：",s.buyer_id]}),s.buyer_username&&e.jsxs("div",{children:["用户名：",s.buyer_username]}),s.buyer_nickname&&e.jsxs("div",{children:["昵称：",s.buyer_nickname]}),s.buyer_mobile&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(zs,{size:14,className:"text-gray-400"}),e.jsx("span",{children:s.buyer_mobile})]})]})]}),s.description&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"说明"}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:s.description})]}),s.delivery_info&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100 space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"物流信息"}),((l=s.delivery_info)==null?void 0:l.address)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(At,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:s.delivery_info.address})]}),((o=s.delivery_info)==null?void 0:o.receiver)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(jt,{size:14,className:"text-gray-400"}),e.jsx("span",{children:s.delivery_info.receiver})]}),((c=s.delivery_info)==null?void 0:c.phone)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(zs,{size:14,className:"text-gray-400"}),e.jsx("span",{children:s.delivery_info.phone})]}),((d=s.delivery_info)==null?void 0:d.logistics_company)&&e.jsxs("div",{className:"text-xs text-gray-600",children:["物流公司：",s.delivery_info.logistics_company]}),((x=s.delivery_info)==null?void 0:x.tracking_no)&&e.jsxs("div",{className:"text-xs text-gray-600",children:["物流单号：",s.delivery_info.tracking_no]}),((m=s.delivery_info)==null?void 0:m.status_text)&&e.jsxs("div",{className:"text-xs text-gray-600",children:["状态：",s.delivery_info.status_text]}),((b=s.delivery_info)==null?void 0:b.update_time)&&e.jsxs("div",{className:"text-xs text-gray-600",children:["更新时间：",Pe(s.delivery_info.update_time)]})]})]})]})})},za=({category:t,initialTab:s,onBack:a,onNavigate:r})=>{const[l,o]=n.useState(s),[c,d]=n.useState([]),[x,m]=n.useState([]),[b,g]=n.useState([]),[f,h]=n.useState(!1),[j,w]=n.useState(1),[v,u]=n.useState(!0),[_,N]=n.useState(null),[i,F]=n.useState(!1),[I,z]=n.useState(null),[p,P]=n.useState(!1),S=(()=>{switch(t){case"product":return{title:"商品订单",tabs:["买入订单","卖出订单"]};case"transaction":return{title:"交易订单",tabs:["待寄售","寄售中","寄售失败"]};case"delivery":return{title:"提货订单",tabs:["待发货","待收货","已签收"]};case"points":return{title:"消费金订单",tabs:["待付款","待发货","待收货","已完成"]};default:return{title:"订单列表",tabs:[]}}})(),k=$=>{const U={name:"order-list",kind:t,status:l};r({name:"order-detail",orderId:String($),back:U})};n.useEffect(()=>{if(t==="points"){const $=async()=>{h(!0);try{const U=localStorage.getItem(ne)||"";let G;switch(l){case 0:G=await Yt({page:1,limit:10,token:U});break;case 1:G=await Vt({page:1,limit:10,token:U});break;case 2:G=await Wt({page:1,limit:10,token:U});break;case 3:G=await is({page:1,limit:10,token:U});break;default:G={code:1,data:{list:[],total:0,page:1,limit:10}}}const J=re(G);if(J){const se=J.list||[];d(se),u(se.length>=10),w(1)}}catch(U){console.error("加载订单失败:",U)}finally{h(!1)}};w(1),d([]),$()}},[t,l]),n.useEffect(()=>{if(t==="delivery"){const $=async()=>{h(!0);try{const U=localStorage.getItem(ne)||"";let G;switch(l){case 0:G="paid";break;case 1:G="shipped";break;case 2:G="completed";break;default:G=void 0}const J=await ls({page:1,limit:10,status:G,token:U}),se=re(J);if(se){const de=se.list||[];d(de),u(de.length>=10),w(1)}}catch(U){console.error("加载提货订单失败:",U)}finally{h(!1)}};w(1),d([]),$()}},[t,l]),n.useEffect(()=>{if(t==="transaction"){const $=async()=>{h(!0);try{const U=localStorage.getItem(ne)||"";let G;switch(l){case 0:G=0;break;case 1:G=1;break;case 2:G=3;break;default:G=0}const J=await Kt({page:1,limit:10,status:G,token:U}),se=re(J);if(se){const de=se.list||[];m(de),u(se.has_more||!1),w(1)}}catch(U){console.error("加载寄售订单失败:",U)}finally{h(!1)}};w(1),m([]),$()}},[t,l]),n.useEffect(()=>{if(t==="product"){const $=async()=>{h(!0);try{const U=localStorage.getItem(ne)||"";if(l===0){const G=await Gn({page:1,limit:10,token:U}),J=re(G);if(J){const se=J.list||[];g(se),u(J.has_more||!1),w(1)}}else if(l===1){const G=await Kt({page:1,limit:10,status:2,token:U}),J=re(G);if(J){const se=J.list||[];m(se),u(J.has_more||!1),w(1)}else m([]),u(!1),w(1)}}catch(U){console.error("加载购买记录失败:",U)}finally{h(!1)}};w(1),g([]),$()}},[t,l]);const{showToast:T,showDialog:D}=he(),Y=async $=>{try{const U=localStorage.getItem(ne)||"",G=await ya({id:$,token:U});if(ee(G)){w(1),d([]),h(!0);try{let J;if(t==="delivery"){let de;switch(l){case 0:de="paid";break;case 1:de="shipped";break;case 2:de="completed";break}J=await ls({page:1,limit:10,status:de,token:U})}else switch(l){case 0:J=await Yt({page:1,limit:10,token:U});break;case 1:J=await Vt({page:1,limit:10,token:U});break;case 2:J=await Wt({page:1,limit:10,token:U});break;case 3:J=await is({page:1,limit:10,token:U});break;default:J={code:1,data:{list:[],total:0,page:1,limit:10}}}const se=re(J);se&&d(se.list||[])}catch(J){console.error("重新加载订单失败:",J)}finally{h(!1)}}else T("error","操作失败",oe(G,"确认收货失败"))}catch(U){console.error("确认收货失败:",U),T("error","操作失败",U.message||"确认收货失败")}},L=($,U=!1)=>{if(!$)return"";let G;if(typeof $=="string"){const ae=$.trim().replace(/[^\d]/g,"");if(G=parseInt(ae,10),isNaN(G))return $.trim()}else G=$;if(!G||G===0)return"";const J=G<1e10?G*1e3:G,se=new Date(J);if(isNaN(se.getTime()))return"";const de=se.getFullYear(),Re=String(se.getMonth()+1).padStart(2,"0"),ie=String(se.getDate()).padStart(2,"0"),xe=`${de}-${Re}-${ie}`;if(U){const ae=String(se.getHours()).padStart(2,"0"),le=String(se.getMinutes()).padStart(2,"0"),me=String(se.getSeconds()).padStart(2,"0"),ye=`${ae}:${le}:${me}`;return`${xe} ${ye}`.trim()}return xe.trim()},B=$=>$==null?"0.00":(typeof $=="string"?parseFloat($):$).toFixed(2),K=$=>$.items&&$.items.length>0?$.items[0]:null,C=$=>{const U=K($);return U!=null&&U.product_thumbnail?ke(U.product_thumbnail):$.product_image||$.thumbnail||""},E=$=>{const U=K($);return U!=null&&U.product_name?U.product_name:$.product_name||"商品"},R=$=>{const U=K($);return U!=null&&U.quantity?U.quantity:$.quantity||1},O=$=>$.status_text||"未知状态",V=$=>{const U=K($);return $.pay_type==="score"?{amount:0,score:$.total_score?typeof $.total_score=="string"?parseFloat($.total_score):$.total_score:(U==null?void 0:U.subtotal_score)||(U==null?void 0:U.score_price)||0,isScore:!0}:{amount:$.total_amount?typeof $.total_amount=="string"?parseFloat($.total_amount):$.total_amount:(U==null?void 0:U.subtotal)||(U==null?void 0:U.price)||0,score:0,isScore:!1}},H=async $=>{D({title:"确认删除",description:"确定要删除此订单吗？删除后无法恢复。",confirmText:"确定删除",confirmColor:"#FF6B6B",cancelText:"取消",onConfirm:async()=>{try{const U=localStorage.getItem(ne)||"",G=await Pn({id:$,token:U});if(ee(G)){w(1),d([]),h(!0);try{let J;if(t==="delivery"){let de;switch(l){case 0:de="paid";break;case 1:de="shipped";break;case 2:de="completed";break}J=await ls({page:1,limit:10,status:de,token:U})}else switch(l){case 0:J=await Yt({page:1,limit:10,token:U});break;case 1:J=await Vt({page:1,limit:10,token:U});break;case 2:J=await Wt({page:1,limit:10,token:U});break;case 3:J=await is({page:1,limit:10,token:U});break;default:J={code:1,data:{list:[],total:0,page:1,limit:10}}}const se=re(J);se&&d(se.list||[]),T("success",oe(G,"删除成功"))}catch(J){console.error("重新加载订单失败:",J)}finally{h(!1)}}else T("error","删除失败",oe(G,"删除失败"))}catch(U){console.error("删除订单失败:",U),T("error","删除失败",U.message||"删除失败")}}})},W=async $=>{P(!0);try{const U=localStorage.getItem(ne)||"",G=await Un({consignment_id:$,token:U}),J=re(G);J?(z(J),F(!0)):T("error","获取失败",oe(G,"获取寄售详情失败"))}catch(U){console.error("获取寄售详情失败:",U),T("error","获取失败",U.message||"获取寄售详情失败")}finally{P(!1)}},A=async $=>{D({title:"确认取消",description:"确定要取消此寄售吗？",confirmText:"确定取消",cancelText:"取消",onConfirm:async()=>{try{const U=localStorage.getItem(ne)||"",G=await On({consignment_id:$,token:U});if(ee(G)){w(1),m([]),h(!0);try{let J;switch(l){case 0:J=0;break;case 1:J=1;break;case 2:J=3;break;default:J=0}const se=await Kt({page:1,limit:10,status:J,token:U}),de=re(se);de&&m(de.list||[]),T("success",oe(G,"取消成功"))}catch(J){console.error("重新加载寄售订单失败:",J)}finally{h(!1)}}else T("error","取消失败",oe(G,"取消寄售失败"))}catch(U){console.error("取消寄售失败:",U),T("error","取消失败",U.message||"取消寄售失败")}}})};return e.jsxs(xt,{title:S.title,onBack:a,children:[e.jsx(fi,{tabs:S.tabs,activeTab:l,onChange:o}),e.jsx("div",{className:"p-4 space-y-4",children:t==="transaction"?e.jsx(bi,{orders:x,loading:f,activeTab:l,formatOrderDate:$=>L($),formatOrderPrice:B,onCancelConsignment:A}):t==="product"?e.jsx(pi,{activeTab:l,purchaseRecords:b,consignmentOrders:x,loading:f,formatOrderDate:$=>L($),formatOrderPrice:B,onViewConsignmentDetail:W}):t==="points"||t==="delivery"?e.jsx(yi,{category:t,orders:c,loading:f,activeTab:l,formatOrderDate:$=>L($),formatOrderPrice:B,getOrderStatus:O,getOrderImage:C,getOrderName:E,getOrderQuantity:R,getOrderPrice:V,onDelete:H,onConfirmReceipt:Y,onViewDetail:k}):e.jsx("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"暂无数据"})})}),e.jsx(vi,{visible:i,detail:I,onClose:()=>F(!1),formatOrderPrice:B})]})};var ht=(t=>(t.VALIDATION="validation",t.NETWORK="network",t.BUSINESS="business",t.SYSTEM="system",t.AUTH="auth",t))(ht||{}),Ft=(t=>(t.INFO="info",t.WARNING="warning",t.ERROR="error",t.CRITICAL="critical",t))(Ft||{});class kt extends Error{constructor(s,a="system",r="error",l){super(s),this.name="AppError",this.type=a,this.severity=r,this.originalError=l==null?void 0:l.originalError,this.context=l==null?void 0:l.context,this.shouldReport=(l==null?void 0:l.shouldReport)??r==="critical",this.userMessage=(l==null?void 0:l.userMessage)||s,Object.setPrototypeOf(this,kt.prototype)}toUserMessage(){return this.userMessage}toLogObject(){var s;return{name:this.name,message:this.message,type:this.type,severity:this.severity,context:this.context,stack:this.stack,originalError:((s=this.originalError)==null?void 0:s.message)||this.originalError}}}function wi(t,s="操作失败，请稍后重试"){var a,r,l,o;return t?typeof t=="string"?t:t.msg&&typeof t.msg=="string"?t.msg:(a=t.response)!=null&&a.msg&&typeof t.response.msg=="string"?t.response.msg:t.message&&typeof t.message=="string"?t.message:(r=t.data)!=null&&r.message&&typeof t.data.message=="string"?t.data.message:(o=(l=t.response)==null?void 0:l.data)!=null&&o.message&&typeof t.response.data.message=="string"?t.response.data.message:s:s}function Ra(t){return t?t instanceof kt?t.type:t.isCorsError||t.name==="NetworkError"||t.code==="ETIMEDOUT"||t.code==="ECONNABORTED"?"network":t.status===401||t.status===403||t.code===401||t.code===403?"auth":t.status===400||t.code===400?"validation":typeof t.code=="number"&&t.code!==0&&t.code!==1?"business":"system":"system"}function _i(t){if(!t)return"error";if(t instanceof kt)return t.severity;const s=Ra(t);return s==="validation"?"warning":s==="auth"||s==="network"?"error":s==="business"?"warning":"error"}function Aa(t,s="操作失败，请稍后重试"){if(t instanceof kt)return t;const a=wi(t,s),r=Ra(t),l=_i(t);return new kt(a,r,l,{originalError:t,userMessage:a})}function ki(t,s){const a=Aa(t),r={...a.toLogObject(),context:{...a.context,...s},timestamp:new Date().toISOString()};a.severity==="critical"?console.error("[CRITICAL ERROR]",r):a.severity==="error"?console.error("[ERROR]",r):a.severity==="warning"?console.warn("[WARNING]",r):console.info("[INFO]",r),a.shouldReport}function Ie(t){const{showToast:s}=he(),[a,r]=n.useState(null),l=n.useRef(t);n.useEffect(()=>{l.current=t},[t]);const o=n.useCallback((x,m)=>{if(!x)return;const b={showToast:!0,persist:!1,logError:!0,...l.current,...m},g=Aa(x,b.customMessage||"操作失败，请稍后重试");if(b.logError&&ki(g,b.context),b.showToast){const f=Si(g.severity),h=b.toastTitle||Ci(g.type);s(f,h,g.userMessage)}b.persist&&r(g)},[s]),c=n.useCallback(()=>{r(null)},[]),d=n.useCallback((x,m)=>(async()=>{try{const b=await x();return(m==null?void 0:m.persist)!==!1&&c(),b}catch(b){return o(b,m),null}})(),[o,c]);return{error:a,errorMessage:(a==null?void 0:a.userMessage)||null,hasError:a!==null,errorType:(a==null?void 0:a.type)||null,errorSeverity:(a==null?void 0:a.severity)||null,handleError:o,clearError:c,withErrorHandling:d}}function Si(t){switch(t){case Ft.INFO:return"info";case Ft.WARNING:return"warning";case Ft.ERROR:case Ft.CRITICAL:return"error";default:return"error"}}function Ci(t){switch(t){case ht.VALIDATION:return"输入错误";case ht.NETWORK:return"网络错误";case ht.BUSINESS:return"操作失败";case ht.AUTH:return"认证失败";case ht.SYSTEM:default:return"系统错误"}}const Ei=({orderId:t,onBack:s,onNavigate:a})=>{var N;const{showToast:r,showDialog:l}=he(),{errorMessage:o,hasError:c,handleError:d}=Ie(),{handleError:x}=Ie({showToast:!0,persist:!1}),[m,b]=n.useState(null),[g,f]=n.useState(!0);n.useEffect(()=>{h()},[t]);const h=async()=>{try{f(!0);const i=localStorage.getItem(ne);if(!i)return;const F=await ja({id:t,token:i});ee(F)&&F.data?b(F.data):d(F,{persist:!0,showToast:!1,customMessage:"获取订单详情失败",context:{orderId:t}})}catch(i){d(i,{persist:!0,showToast:!1,customMessage:"网络请求失败",context:{orderId:t}})}finally{f(!1)}},j=i=>{const F=String(i).trim();a({name:"cashier",orderId:F,back:{name:"order-detail",orderId:F}})},w=async i=>{l({title:"确认收货",description:"请确认您已收到商品，确认后交易将完成。",confirmText:"确认收货",cancelText:"取消",onConfirm:async()=>{try{const F=localStorage.getItem(ne)||"",I=await ya({id:i,token:F});ee(I)?(r("success",I.msg||"收货成功"),h()):x(I,{toastTitle:"操作失败",customMessage:"确认收货失败",context:{orderId:i}})}catch(F){x(F,{toastTitle:"操作失败",customMessage:"网络请求失败",context:{orderId:i}})}}})},v=i=>{navigator.clipboard.writeText(i).then(()=>{r("success","复制成功")}).catch(()=>{r("error","复制失败")})};if(g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(ge,{})});if(c||!m)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 text-gray-500",children:o||"订单不存在"});const u=i=>i.status_text?i.status_text:{[Tt.UNPAID]:"待付款",[Ue.NOT_SHIPPED]:"待发货",[Ue.SHIPPED]:"待收货",[Ue.RECEIVED]:"已完成",4:"已关闭","-1":"已取消"}[i.status]||"未知状态",_=m.pay_type==="score";return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe relative flex flex-col",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10 border-b border-gray-100",children:[e.jsx("button",{onClick:s,className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors text-gray-800",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"订单详情"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 pb-24",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-600 p-1 rounded-md",children:e.jsx(Te,{size:14})}),e.jsx("span",{className:"text-sm text-gray-600",children:"订单号"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-mono text-gray-800",children:m.order_no||m.id}),e.jsx("button",{onClick:()=>v(m.order_no||String(m.id)),className:"text-gray-400 hover:text-gray-600",children:e.jsx(nt,{size:12})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-orange-100 text-orange-600 p-1 rounded-md",children:e.jsx(Lt,{size:14})}),e.jsx("span",{className:"text-sm text-gray-600",children:"订单状态"})]}),e.jsx("span",{className:"text-sm font-bold text-blue-600",children:u(m)})]})]}),e.jsxs("div",{className:`rounded - xl p - 6 text - white shadow - lg ${_?"bg-gradient-to-r from-orange-400 to-red-500":"bg-gradient-to-r from-blue-500 to-blue-600"} `,children:[e.jsx("div",{className:"text-xl font-bold mb-1",children:u(m)}),e.jsx("div",{className:"text-white/80 text-sm",children:m.status===Tt.UNPAID?"请尽快完成支付":m.status===Ue.NOT_SHIPPED?"商家正在备货中":m.status===Ue.SHIPPED?"商品运输中，请留意查收":m.status===Ue.RECEIVED?"订单已完成，感谢您的购买":""})]}),m.recipient_name&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50 flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 shrink-0 mt-1",children:e.jsx(At,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900",children:m.recipient_name}),e.jsx("span",{className:"text-gray-500 text-sm",children:m.recipient_phone})]}),e.jsx("div",{className:"text-sm text-gray-600 leading-snug",children:m.recipient_address})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-50",children:[e.jsx(vt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"商品明细"})]}),e.jsx("div",{className:"space-y-4",children:(N=m.items)==null?void 0:N.map((i,F)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden shrink-0 border border-gray-100",children:e.jsx(et,{src:ke(i.product_thumbnail||""),alt:i.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 line-clamp-2",children:i.product_name}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["数量: ",i.quantity]}),e.jsx("div",{className:"flex justify-between items-end mt-2",children:e.jsx("div",{className:"font-mono font-bold text-gray-900",children:_?e.jsxs("span",{className:"text-orange-600",children:[i.subtotal_score||i.score_price," 消费金"]}):e.jsxs("span",{children:["¥ ",we(i.subtotal||i.price)]})})})]})]},i.id||F))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-50 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"商品总额"}),e.jsx("span",{className:"font-medium",children:_?`${m.total_score||0} 消费金`:`¥${we(m.total_amount)} `})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"运费"}),e.jsx("span",{className:"font-medium",children:"¥0.00"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 mt-2 border-t border-gray-50",children:[e.jsx("span",{className:"font-bold text-gray-800",children:"实付款"}),e.jsx("span",{className:"text-xl font-bold font-mono text-orange-600",children:_?`${m.total_score||0} 消费金`:`¥${we(m.total_amount)} `})]})]})]}),m.shipping_no&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-3",children:"物流信息"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[m.shipping_company&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"物流公司"}),e.jsx("span",{className:"text-gray-900",children:m.shipping_company})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"物流单号"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-900 font-mono",children:m.shipping_no}),e.jsx("button",{onClick:()=>v(m.shipping_no),className:"text-blue-600 text-xs",children:"复制"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50 space-y-2",children:[m.create_time&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"创建时间"}),e.jsx("span",{children:Pe(m.create_time)})]}),m.pay_time&&m.pay_time>0&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"支付时间"}),e.jsx("span",{children:Pe(m.pay_time)})]}),m.ship_time&&m.ship_time>0&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"发货时间"}),e.jsx("span",{children:Pe(m.ship_time)})]}),m.complete_time&&m.complete_time>0&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"完成时间"}),e.jsx("span",{children:Pe(m.complete_time)})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 z-50 safe-area-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]",children:[console.log("Order status:",m.status,"Type:",typeof m.status,"String:",String(m.status)),(m.status===Tt.UNPAID||m.status==="pending"||String(m.status)==="0")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"待支付"}),e.jsx("div",{className:"text-xs mt-0.5",children:"请尽快完成支付"})]}),e.jsx("button",{onClick:()=>j(m.id),className:`px - 6 py - 2.5 rounded - full text - white font - bold shadow - lg active: scale - 95 transition - transform ${_?"bg-gradient-to-r from-orange-500 to-red-500 shadow-orange-200":"bg-blue-600 shadow-blue-200"} `,children:"立即付款"})]}),(m.status===Ue.NOT_SHIPPED||m.status==="paid"||String(m.status)==="1")&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-1",children:"等待商家发货"}),e.jsx("div",{className:"text-xs text-gray-500",children:"商家正在备货中，请耐心等待"})]}),(m.status===Ue.SHIPPED||m.status==="shipped"||String(m.status)==="2")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"待收货"}),e.jsx("div",{className:"text-xs mt-0.5",children:"商品运输中，请留意查收"})]}),e.jsx("button",{onClick:()=>w(m.id),className:"px-6 py-2.5 bg-blue-600 text-white font-bold rounded-full shadow-lg shadow-blue-200 active:scale-95 transition-transform",children:"确认收货"})]}),(m.status===Ue.RECEIVED||m.status==="completed"||String(m.status)==="3")&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-1",children:"订单已完成"}),e.jsx("div",{className:"text-xs text-gray-500",children:"感谢您的购买"})]}),(m.status===4||m.status===-1||m.status==="closed"||m.status==="cancelled"||["4","-1"].includes(String(m.status)))&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"订单已关闭"}),e.jsx("div",{className:"text-xs text-gray-400",children:"该订单已取消或关闭"})]}),![Tt.UNPAID,Ue.NOT_SHIPPED,Ue.SHIPPED,Ue.RECEIVED,4,-1,"0","1","2","3","4","-1","pending","paid","shipped","completed","closed","cancelled"].includes(m.status)&&e.jsxs("div",{className:"text-center text-gray-500 text-sm",children:["状态未知: ",m.status," (",m.status_text||"无状态文本",")"]})]})]})},Ii=({orderId:t,onBack:s,onNavigate:a})=>{const{showToast:r}=he(),[l,o]=n.useState(null),[c,d]=n.useState(!0),[x,m]=n.useState(!1),[b,g]=n.useState("money"),[f,h]=n.useState({score:0,money:"0.00"});n.useEffect(()=>{j()},[t]);const j=async()=>{try{d(!0);const N=localStorage.getItem(ne)||"",[i,F]=await Promise.all([ja({id:t,token:N}),$e(N)]),I=re(i);I?(o(I),I.pay_type&&g(I.pay_type)):r("error","获取订单失败",oe(i,"无法加载订单信息"));const z=re(F);z!=null&&z.userInfo&&h({score:z.userInfo.score,money:z.userInfo.money})}catch(N){console.error("Load cashier data failed",N),r("error","加载失败","网络错误")}finally{d(!1)}},w=async()=>{if(!x)try{m(!0);const N=localStorage.getItem(ne),i=await Fn({id:t,token:N||""});ee(i)?(r("success",oe(i,"支付成功")),a({name:"order-list",kind:b==="score"?"points":"product",status:1,back:{name:"cashier",orderId:String(t)}})):r("error","支付失败",oe(i,"操作失败"))}catch(N){console.error("Pay failed",N),r("error","支付失败",N.message||"系统错误")}finally{m(!1)}};if(c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(ge,{})});if(!l)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 text-gray-500",children:"订单不存在"});const v=b==="score",u=v?l.total_score:l.total_amount,_=v?"bg-orange-600 shadow-orange-200":"bg-blue-600 shadow-blue-200";return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10",children:[e.jsx("button",{onClick:s,className:"p-2 -ml-2 text-gray-800",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"收银台"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["订单号：",l.order_no]}),e.jsxs("div",{className:"text-4xl font-bold text-gray-900 font-mono",children:[u," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:v?"消费金":"元"})]})]}),e.jsx("div",{className:"space-y-4",children:v?e.jsxs("div",{className:"bg-white rounded-xl p-4 flex items-center justify-between shadow-sm border border-orange-100 ring-1 ring-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600",children:e.jsx(aa,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"消费金支付"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["当前余额: ",f.score," 消费金"]})]})]}),e.jsx("div",{className:"w-5 h-5 rounded-full border-[5px] border-orange-500 bg-white"})]}):e.jsxs("div",{className:"bg-white rounded-xl p-4 flex items-center justify-between shadow-sm border border-blue-100 ring-1 ring-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(Be,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"余额支付"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["当前余额: ¥",f.money]})]})]}),e.jsx("div",{className:"w-5 h-5 rounded-full border-[5px] border-blue-600 bg-white"})]})}),e.jsxs("div",{className:"mt-12",children:[e.jsx("button",{onClick:w,disabled:x,className:`w-full text-white font-bold py-3.5 rounded-full shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 ${_}`,children:x?e.jsx(ge,{size:20,color:"white"}):"确认支付"}),x&&e.jsx("p",{className:"text-center text-xs text-gray-400 mt-4",children:"正在支付，请稍候..."})]})]})]})},Ti=({id:t,onBack:s})=>{var f;const{showToast:a}=he(),[r,l]=n.useState(null),[o,c]=n.useState(!0);n.useEffect(()=>{d()},[t]);const d=async()=>{c(!0);try{const h=localStorage.getItem(ne);if(!h){a("error","登录过期","请重新登录");return}const j=await qn(parseInt(t),h);ee(j)&&j.data?l(j.data.detail):a("error","加载失败",oe(j,"获取详情失败"))}catch(h){console.error("加载详情失败:",h),a("error","加载失败","网络错误，请重试")}finally{c(!1)}},x=h=>{navigator.clipboard.writeText(h).then(()=>{a("success","复制成功")})},m=h=>{switch(h){case"pending":return{label:"待审核",subLabel:"系统正在审核您的凭证，请耐心等待",icon:e.jsx(ze,{size:40,className:"text-orange-500"}),bg:"bg-orange-50",text:"text-orange-600"};case"approved":return{label:"确权成功",subLabel:"资产已发放至您的账户",icon:e.jsx(wt,{size:40,className:"text-green-500"}),bg:"bg-green-50",text:"text-green-600"};case"rejected":return{label:"审核失败",subLabel:"请查看下方原因并重新提交",icon:e.jsx(pe,{size:40,className:"text-red-500"}),bg:"bg-red-50",text:"text-red-600"};case"cancelled":return{label:"已撤销",subLabel:"您已撤销此确权申请",icon:e.jsx(pe,{size:40,className:"text-gray-500"}),bg:"bg-gray-50",text:"text-gray-600"};default:return null}},b=h=>h.voucher_type_text||"未知类型";if(o)return e.jsx("div",{className:"min-h-screen bg-gray-50 pb-safe font-sans flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300"})});if(!r)return null;const g=m(r.status);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe font-sans",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-20 shadow-sm border-b border-gray-100",children:[e.jsx("button",{onClick:s,className:"p-1 -ml-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ee,{size:24,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"详情"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:`rounded-2xl p-6 flex flex-col items-center justify-center text-center space-y-3 ${g.bg}`,children:[e.jsx("div",{className:"mb-1",children:g.icon}),e.jsx("h2",{className:`text-xl font-bold ${g.text}`,children:g.label}),e.jsx("p",{className:`text-sm opacity-80 ${g.text}`,children:g.subLabel})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 items-center justify-center flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500 mb-1",children:"确权金额"}),e.jsxs("span",{className:"text-3xl font-mono font-bold text-gray-900",children:["¥",Number(r.amount).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),r.status==="rejected"&&r.review_remark&&e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{size:16,className:"text-red-500"}),e.jsx("span",{className:"font-bold text-red-600 text-sm",children:"驳回原因"})]}),e.jsx("p",{className:"text-sm text-red-600/90 leading-relaxed bg-white/50 p-2 rounded-lg",children:r.review_remark})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"凭证类型"}),e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-50 rounded-lg",children:[e.jsx(Te,{size:12,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium text-sm",children:b(r)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"提交时间"}),e.jsx("span",{className:"text-gray-900 font-medium font-mono text-sm",children:r.create_time_text})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"记录编号"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-900 font-medium font-mono text-sm",children:["#",r.id]}),e.jsx("button",{onClick:()=>x(r.id.toString()),className:"text-gray-400 hover:text-gray-600",children:e.jsx(nt,{size:12})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b border-gray-50",children:[e.jsx(Mt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"font-bold text-gray-900 text-sm",children:"凭证截图"}),e.jsxs("span",{className:"text-gray-400 text-xs ml-auto",children:["共 ",((f=r.images_array)==null?void 0:f.length)||0," 张"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.images_array&&r.images_array.map((h,j)=>e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200",children:e.jsx("img",{src:h,alt:`Evidence ${j}`,className:"w-full h-full object-cover"})},j))})]})]}),e.jsx("div",{className:"text-center py-6 text-xs text-gray-400",children:"如对结果有疑问，请联系在线客服"})]})},Fi=({onBack:t,onLogout:s,onNavigate:a})=>{const r=n.useMemo(()=>{try{const x=localStorage.getItem(Ae);return x?JSON.parse(x):null}catch(x){return console.warn("解析本地用户信息失败:",x),null}},[]),l=(r==null?void 0:r.nickname)||(r==null?void 0:r.username)||"用户",o=l.slice(0,1).toUpperCase(),c=ke(r==null?void 0:r.avatar),d=ji(r==null?void 0:r.mobile);return e.jsxs(_e,{title:"设置",onBack:t,bgColor:"bg-gray-100",padding:!1,children:[e.jsxs("div",{className:"bg-white mt-2 px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-yellow-200 flex items-center justify-center text-lg font-bold text-yellow-700 overflow-hidden",children:c?e.jsx("img",{src:c,alt:"用户头像",className:"w-full h-full object-cover"}):o}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l}),d&&d!=="-"&&e.jsxs("span",{className:"text-xs text-gray-400 mt-0.5",children:["手机号：",d]})]})]}),e.jsxs("button",{className:"flex items-center text-xs text-gray-500 active:opacity-70",onClick:()=>a({name:"edit-profile"}),children:["编辑",e.jsx(qe,{size:16,className:"ml-0.5"})]})]}),e.jsxs("div",{className:"mt-3 bg-white",children:[e.jsx(st,{title:"重置登录密码",onClick:()=>a({name:"reset-login-password",from:"settings"})}),e.jsx(st,{title:"重置支付密码",onClick:()=>a({name:"reset-pay-password",from:"settings"})}),e.jsx(st,{title:"新消息通知",onClick:()=>a({name:"notification-settings"})}),e.jsx(st,{title:"账户注销",onClick:()=>a({name:"account-deletion"})})]}),e.jsxs("div",{className:"mt-3 bg-white",children:[e.jsx(st,{title:"当前版本号",extra:e.jsx("span",{className:"text-gray-400 text-xs",children:"2.2.1"}),arrow:!1}),e.jsx(st,{title:"隐私政策",onClick:()=>a({name:"privacy-policy",from:"settings"})}),e.jsx(st,{title:"关于我们",onClick:()=>a({name:"about-us",from:"settings"})})]}),e.jsx("div",{className:"mt-8 px-4",children:e.jsx("button",{className:"w-full bg-orange-500 text-white text-sm font-semibold py-3 rounded-md active:opacity-80 shadow-sm",onClick:s,children:"退出登录"})})]})},Pi=t=>{switch(t){case"privacy_policy":return Hn;case"user_agreement":return Yn;case"about_us":return Us;default:return Us}},Ts=({type:t,defaultTitle:s,onBack:a})=>{const[r,l]=n.useState(null),[o,c]=n.useState(!0),[d,x]=n.useState(null);return n.useEffect(()=>{let m=!1;return(async()=>{c(!0),x(null);try{const f=await Pi(t)();if(m)return;ee(f)&&f.data?l(f.data):x(oe(f,"加载失败，请稍后重试"))}catch(g){if(m)return;console.error(`加载${s}失败:`,g),x("网络异常，请检查网络后重试")}finally{m||c(!1)}})(),()=>{m=!0}},[t,s]),e.jsx(xt,{title:(r==null?void 0:r.title)||s,onBack:a,children:e.jsxs("div",{className:"p-4 m-4 bg-white rounded-xl shadow-sm border border-gray-100",children:[o&&e.jsx("div",{className:"py-10",children:e.jsx(ge,{text:"正在加载..."})}),!o&&d&&e.jsx("div",{className:"py-10 text-center text-red-500 text-sm",children:d}),!o&&!d&&(r==null?void 0:r.content)&&e.jsx("div",{className:"prose prose-sm max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:r.content}}),e.jsxs("div",{className:"mt-8 pt-4 border-t border-gray-100 text-center text-xs text-gray-400",children:[e.jsx("p",{children:"Copyright © 2025 数权中心. All rights reserved."}),e.jsx("p",{className:"mt-1",children:"版本 v1.0.2"})]})]})})};function zi(t){if(!t)return!1;const s=t.msg||t.message||"";return s.toLowerCase().includes("frequently")||s.includes("请求频繁")||s.includes("请稍后")||s.toLowerCase().includes("try again")}function Ri(t,s="操作失败，请重试"){var a;if(!t)return s;if(typeof t=="string")return t;if(t instanceof Error){const r=t;return r.msg&&typeof r.msg=="string"?r.msg:t.message||s}if(typeof t=="object"){const r=t;if(r.msg&&typeof r.msg=="string")return r.msg;if(r.message&&typeof r.message=="string")return r.message;if((a=r.data)!=null&&a.msg&&typeof r.data.msg=="string")return r.data.msg}return s}function Ai(t){const s=t.match(/try again in (\d+) seconds?/i);return s?`请求过于频繁，请${s[1]}秒后重试`:t.toLowerCase().includes("frequently")?"请求过于频繁，请稍后重试":t}function Di(t,s="操作失败，请重试"){const a=Ri(t,s);return zi({msg:a})?Ai(a):a}const Li=t=>{switch(t){case"reset_login":return{oldLabel:"旧登录密码",oldPlaceholder:"请输入当前使用的登录密码",newLabel:"新登录密码",newPlaceholder:"请设置新的登录密码",confirmLabel:"确认新密码",confirmPlaceholder:"请再次输入新密码",submitText:"提交修改",minLength:6,showPhone:!1,showCode:!1};case"reset_pay":return{oldLabel:"旧支付密码",oldPlaceholder:"请输入当前支付密码（6位数字）",newLabel:"新支付密码",newPlaceholder:"请设置新支付密码（6位数字）",confirmLabel:"确认新密码",confirmPlaceholder:"请再次输入新支付密码",submitText:"确认修改",minLength:6,showPhone:!1,showCode:!1};case"reset_pay_sms":return{oldLabel:"",oldPlaceholder:"",newLabel:"新支付密码",newPlaceholder:"请设置新支付密码（6位数字）",confirmLabel:"确认新密码",confirmPlaceholder:"请再次输入新支付密码",submitText:"确认重置",minLength:6,showPhone:!0,showCode:!0};case"forgot":return{oldLabel:"",oldPlaceholder:"",newLabel:"新登录密码",newPlaceholder:"请设置新的登录密码，6-32 位",confirmLabel:"",confirmPlaceholder:"",submitText:"重置密码",minLength:6,showPhone:!0,showCode:!0};default:return{oldLabel:"旧密码",oldPlaceholder:"请输入旧密码",newLabel:"新密码",newPlaceholder:"请输入新密码",confirmLabel:"确认新密码",confirmPlaceholder:"请再次输入新密码",submitText:"确认",minLength:6,showPhone:!1,showCode:!1}}},Fs=({type:t,title:s,onBack:a,onSuccess:r,onNavigateForgotPassword:l})=>{const[o,c]=n.useState(t),{showToast:d}=he(),x=Li(o),m=ss(je.USER_INFO_KEY,null),b=(m==null?void 0:m.mobile)||"",[g,f]=n.useState(b),[h,j]=n.useState(""),[w,v]=n.useState(""),[u,_]=n.useState(""),[N,i]=n.useState(""),[F,I]=n.useState(!1),[z,p]=n.useState(""),[P,y]=n.useState(0),[S,k]=n.useState(!1),[T,D]=n.useState(!1),[Y,L]=n.useState(!1),B=F||!!b,K=async()=>{if(!/^1[3-9]\d{9}$/.test(g.trim())){d("warning","手机号错误","请输入正确的手机号");return}try{await Sa({mobile:g.trim(),event:o==="reset_pay_sms"?"reset_pay_password":"retrieve_password"}),d("success","验证码已发送"),y(60);const R=setInterval(()=>{y(O=>O<=1?(clearInterval(R),0):O-1)},1e3)}catch(R){const O=Di(R,"发送验证码失败");d("error","发送失败",O)}},C=async E=>{var H;E.preventDefault();const R=u.trim();if(o==="forgot"){const W=g.trim(),A=h.trim();if(!W||!A||!R){p("请完整填写手机号、验证码和新密码");return}const $=/^1[3-9]\d{9}$/;let U="mobile";if($.test(W))U="mobile";else{p("请输入正确的手机号");return}if(!/^[A-Za-z0-9]{6,32}$/.test(R)){p("新密码需为6-32位字母或数字，且不含特殊字符");return}p(""),I(!0);try{await Kr({type:U,account:W,captcha:A,password:R}),d("success","重置成功","请使用新密码重新登录"),r==null||r(),a()}catch(J){const se=J.msg||J.message||"重置密码失败，请检查验证码是否正确";p(se),d("error","重置失败",se)}finally{I(!1)}return}const O=w.trim(),V=N.trim();if(o==="reset_pay"){const W=/^\d{6}$/;if(!W.test(O)||!W.test(R)||!W.test(V)){p("支付密码需为6位数字");return}}else if(o==="reset_pay_sms"){if(!/^1[3-9]\d{9}$/.test(g.trim())){p("请输入正确的手机号");return}if(!h.trim()){p("请输入短信验证码");return}const A=/^\d{6}$/;if(!A.test(R)||!A.test(V)){p("支付密码需为6位数字");return}}else{if(!O||!R||!V){p("请完整填写所有字段");return}if(R.length<x.minLength){p(`新密码长度至少需要 ${x.minLength} 位`);return}if(R!==V){p("两次输入的新密码不一致");return}}if(R!==V){p("两次输入的新密码不一致");return}p(""),I(!0);try{if(o==="reset_login"){const W=await Qr({old_password:O,new_password:R});if(ee(W))ga(),d("success","重置成功","登录密码重置成功，请使用新密码重新登录"),r==null||r(),a();else{const A=oe(W,"修改密码失败");p(A),d("error","修改失败",A)}}else if(o==="reset_pay"){const W=await Xr({old_pay_password:O,new_pay_password:R});if(ee(W))d("success","修改成功","支付密码修改成功"),r==null||r(),a();else{const A=oe(W,"修改支付密码失败");p(A),d("error","修改失败",A)}}else if(o==="reset_pay_sms"){const W=await en({mobile:g.trim(),captcha:h.trim(),new_pay_password:R});if(ee(W))d("success","重置成功","支付密码重置成功"),r==null||r(),a();else{const A=oe(W,"重置支付密码失败");p(A),d("error","重置失败",A)}}}catch(W){const A=(W==null?void 0:W.msg)||(W==null?void 0:W.message)||((H=W==null?void 0:W.data)==null?void 0:H.msg)||"操作失败，请稍后重试";p(A),d("error","操作失败",A)}finally{I(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe",children:[e.jsx("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-gray-100",children:e.jsxs("div",{className:"relative flex items-center justify-center w-full",children:[e.jsx("button",{className:"absolute left-0 p-2 -ml-2 rounded-full active:bg-gray-100 transition-colors",onClick:a,"aria-label":"返回",children:e.jsx(Ee,{size:22,className:"text-gray-900"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:s}),(o==="reset_login"||o==="reset_pay")&&l&&e.jsx("button",{type:"button",className:"absolute right-0 text-sm text-orange-600 font-medium active:opacity-70",onClick:()=>{o==="reset_pay"?(c("reset_pay_sms"),p(""),j(""),f(""),v(""),_(""),i("")):l()},children:o==="reset_pay"?"短信重置":"忘记密码？"})]})}),e.jsxs("main",{className:"pt-2",children:[o==="reset_pay"&&e.jsx("div",{className:"mx-4 mb-4 rounded-xl bg-orange-50 p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-orange-500 mt-0.5",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 8V13",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.9945 16H12.0035",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("p",{className:"text-sm text-orange-700 leading-relaxed",children:"支持通过短信验证码重置交易密码；若忘记旧支付密码，请点击右上角“短信重置”。"})]})}),e.jsxs("form",{className:"bg-white px-4",onSubmit:C,children:[x.showPhone&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"账号（手机号）"}),e.jsx("input",{type:"tel",className:`w-full text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 font-medium ${B?"text-gray-500":""}`,placeholder:"请输入注册时使用的手机号",value:g,onChange:E=>f(E.target.value),disabled:B,readOnly:B})]}),x.showCode&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"验证码"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"text",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 font-medium",placeholder:"请输入短信验证码",value:h,onChange:E=>j(E.target.value),disabled:F}),e.jsx("button",{type:"button",className:`text-sm font-medium transition-opacity whitespace-nowrap ${P>0||F?"text-gray-400 cursor-not-allowed":"text-orange-600 active:opacity-70"}`,onClick:K,disabled:F||P>0,children:P>0?`${P}s后重试`:"获取验证码"})]})]}),x.oldLabel&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:x.oldLabel}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:S?"text":"password",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 font-medium",placeholder:x.oldPlaceholder,value:w,onChange:E=>v(E.target.value),disabled:F}),e.jsx("button",{type:"button",onClick:()=>k(!S),className:"p-2 text-gray-400 focus:outline-none",children:S?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:x.newLabel}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:T?"text":"password",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 font-medium",placeholder:x.newPlaceholder,value:u,onChange:E=>_(E.target.value),disabled:F}),e.jsx("button",{type:"button",onClick:()=>D(!T),className:"p-2 text-gray-400 focus:outline-none",children:T?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]})]}),x.confirmLabel&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:x.confirmLabel}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:Y?"text":"password",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 font-medium",placeholder:x.confirmPlaceholder,value:N,onChange:E=>i(E.target.value),disabled:F}),e.jsx("button",{type:"button",onClick:()=>L(!Y),className:"p-2 text-gray-400 focus:outline-none",children:Y?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]})]})]}),e.jsxs("div",{className:"px-4 mt-6",children:[z&&e.jsxs("div",{className:"mb-4 rounded-lg bg-red-50 p-3 flex items-start gap-2",children:[e.jsx("div",{className:"text-red-500 mt-0.5",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M12 16H12.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("p",{className:"text-sm text-red-600 font-medium",children:z})]}),e.jsx("button",{type:"submit",onClick:C,className:"w-full rounded-full bg-gradient-to-r from-orange-500 to-orange-600 py-3.5 text-base font-bold text-white shadow-lg shadow-orange-500/20 active:scale-[0.98] active:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transition-all duration-200",disabled:F,children:F?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(ge,{size:"sm",color:"white"}),e.jsx("span",{children:"处理中..."})]}):x.submitText})]})]})]})},Mi=({onBack:t,onNavigateForgotPassword:s})=>e.jsx(Fs,{type:"reset_login",title:"重置登录密码",onBack:t,onNavigateForgotPassword:s}),Bi=({onBack:t,onNavigateForgotPassword:s})=>{const[a,r]=n.useState("reset_pay"),l=()=>{if(a==="reset_pay_sms"){r("reset_pay");return}t()};return e.jsx(Fs,{type:a,title:a==="reset_pay"?"修改支付密码":"短信重置支付密码",onBack:l,onNavigateForgotPassword:()=>r("reset_pay_sms")})},Da=({onBack:t})=>e.jsx(Fs,{type:"forgot",title:"找回登录密码",onBack:t}),Ys="cat_notification_settings",Vs={banner:!0,sound:!0,vibration:!0},$i=({onBack:t})=>{const[s,a]=n.useState(()=>{try{const c=localStorage.getItem(Ys);if(c)return{...Vs,...JSON.parse(c)}}catch(c){console.warn("读取通知设置失败:",c)}return Vs});n.useEffect(()=>{try{localStorage.setItem(Ys,JSON.stringify(s))}catch(c){console.warn("保存通知设置失败:",c)}},[s]);const r=c=>{a(d=>({...d,[c]:!d[c]}))},l=c=>e.jsx("span",{"aria-hidden":"true",className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${c?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white shadow transition ${c?"translate-x-5":"translate-x-1"}`})}),o=[{key:"banner",label:"横幅消息通知"},{key:"sound",label:"系统声音"},{key:"vibration",label:"系统震动"}];return e.jsxs(_e,{title:"新消息通知",onBack:t,padding:!1,children:[e.jsx("div",{className:"mt-3 bg-white divide-y divide-gray-100",children:o.map(({key:c,label:d})=>e.jsxs("button",{className:"w-full px-4 py-4 flex items-center justify-between text-sm text-gray-900 active:bg-gray-50",onClick:()=>r(c),"aria-pressed":s[c],children:[e.jsx("span",{children:d}),l(s[c])]},c))}),e.jsx("p",{className:"px-4 pt-4 text-xs text-gray-400 leading-relaxed",children:"开启后可第一时间掌握最新交易提醒、活动资讯。您可随时在此处调整通知方式。"})]})};function La(t=!1){const[s,a]=n.useState(t),[r,l]=n.useState(null),o=n.useCallback(x=>{x!==void 0&&l(x),a(!0)},[]),c=n.useCallback(()=>{a(!1),setTimeout(()=>{l(null)},300)},[]),d=n.useCallback(()=>{a(x=>!x)},[]);return{open:s,data:r,show:o,hide:c,toggle:d,setData:l}}const Oi=["账户不存在安全状态（没有被盗、被封等风险）；","平台内，您的资产账户已结清；","平台内，您的账户与与三方账号没有绑定关系；","您的所有订单均处于已完成状态。"],Ui=({onBack:t})=>{const{showToast:s}=he(),[a,r]=n.useState(""),[l,o]=n.useState(""),[c,d]=n.useState(""),[x,m]=n.useState(!1),[b,g]=n.useState(""),f=La(),h=()=>{const v=a.trim(),u=l.trim();return!v||!u?(g("请填写登录密码并完成二次确认"),!1):v!==u?(g("两次输入的密码不一致"),!1):(g(""),!0)},j=v=>{v.preventDefault(),h()&&f.show()},w=async()=>{var v;f.hide(),m(!0);try{const u=await tn({password:a.trim(),reason:c.trim()});localStorage.removeItem(ne),localStorage.removeItem(Ae),s("success","提交成功",(u==null?void 0:u.msg)||"您的注销申请已提交，我们将尽快处理。"),t()}catch(u){const _=(u==null?void 0:u.msg)||(u==null?void 0:u.message)||((v=u==null?void 0:u.data)==null?void 0:v.msg)||"提交注销申请失败，请稍后重试";g(_),s("error","注销失败",_)}finally{m(!1)}};return e.jsxs(_e,{title:"账户注销",onBack:t,padding:!1,children:[e.jsxs("form",{className:"flex flex-col flex-1",onSubmit:j,children:[e.jsxs("main",{className:"px-4 pt-4 flex flex-col gap-3 flex-1",children:[e.jsxs("section",{className:"bg-white mt-2 pb-2",children:[e.jsx("h2",{className:"px-4 py-4 text-base font-bold text-gray-900 border-b border-gray-100",children:"注销提示"}),e.jsx("p",{className:"px-4 py-3 text-sm leading-6 text-gray-600",children:"注销成功后，您将无法使用当前账号，相关数据也将被删除无法找回。"})]}),e.jsxs("section",{className:"bg-white mt-2 pb-2",children:[e.jsx("h2",{className:"px-4 py-4 text-base font-bold text-gray-900 border-b border-gray-100",children:"注销条件"}),e.jsxs("div",{className:"px-4 py-3 text-sm leading-6 text-gray-600",children:[e.jsx("p",{className:"mb-2",children:"您提交的注销申请生效前，平台将进行以下验证，以保证您的账户与财产安全："}),e.jsx("ol",{className:"list-decimal pl-4 space-y-1",children:Oi.map(v=>e.jsx("li",{children:v},v))})]})]}),e.jsxs("section",{className:"bg-white mt-2",children:[e.jsx("h2",{className:"px-4 py-4 text-base font-bold text-gray-900 border-b border-gray-100",children:"身份验证"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"请输入登录密码"}),e.jsx("input",{type:"password",className:"w-full text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300",placeholder:"请输入登录密码",value:a,onChange:v=>r(v.target.value),disabled:x})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"再次输入密码确认注销"}),e.jsx("input",{type:"password",className:"w-full text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300",placeholder:"请再次输入登录密码",value:l,onChange:v=>o(v.target.value),disabled:x})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"注销原因（选填）"}),e.jsx("textarea",{className:"w-full text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 resize-none min-h-[60px]",placeholder:"请输入注销原因，我们将用于优化体验",rows:3,value:c,onChange:v=>d(v.target.value),disabled:x})]}),b&&e.jsx("p",{className:"mt-4 text-sm text-red-500",role:"alert",children:b})]})]})]}),e.jsx("div",{className:"px-4 pt-6 pb-6",children:e.jsx("button",{type:"submit",className:"w-full rounded-lg bg-orange-500 py-3 text-sm font-semibold text-white shadow-sm active:opacity-80 disabled:opacity-50",disabled:x,children:x?"提交中...":"确认注销"})})]}),e.jsx(ai,{open:f.open,title:"确认注销账户",content:"确认提交账号注销申请？确认后账号将无法恢复。",confirmText:"确认注销",cancelText:"取消",type:"danger",onConfirm:w,onCancel:f.hide})]})},Gi=({onBack:t,onLogout:s})=>{const{showToast:a}=he(),r=n.useMemo(()=>{try{const i=localStorage.getItem(Ae);return i?JSON.parse(i):null}catch(i){return console.warn("解析本地用户信息失败:",i),null}},[]),[l,o]=n.useState(r),[c,d]=n.useState((r==null?void 0:r.nickname)||(r==null?void 0:r.username)||""),[x,m]=n.useState((r==null?void 0:r.avatar)||""),[b,g]=n.useState(!1),[f,h]=n.useState(!1),j=n.useRef(null),v=(c||(l==null?void 0:l.nickname)||(l==null?void 0:l.username)||"用户").slice(0,1).toUpperCase(),u=async()=>{if(!l){t();return}const i=c.trim()||l.nickname;h(!0);try{const F=await Zr({nickname:i,token:l.token||localStorage.getItem(ne)||""}),I={...l,nickname:i};o(I),localStorage.setItem(Ae,JSON.stringify(I)),a("success",(F==null?void 0:F.msg)||"保存成功"),t()}catch(F){console.error("昵称更新失败:",F),a("error","保存失败",(F==null?void 0:F.message)||"昵称保存失败，请稍后重试")}finally{h(!1)}},_=()=>{var i;if(!l){a("warning","请先登录","请先登录后再修改头像");return}(i=j.current)==null||i.click()},N=async i=>{var I,z,p,P,y,S,k;const F=(I=i.target.files)==null?void 0:I[0];if(!F||!l){i.target.value="";return}g(!0);try{const T=await Is(F),D=((z=T.data)==null?void 0:z.url)||((p=T.data)==null?void 0:p.path)||((P=T.data)==null?void 0:P.filepath)||"",Y=((y=T.data)==null?void 0:y.fullurl)||((S=T.data)==null?void 0:S.fullUrl)||((k=T.data)==null?void 0:k.url)||"";if(!D&&!Y)throw new Error("上传返回结果为空，请重试");const L=l.token||localStorage.getItem(ne)||"",B=await qr({avatar:D||Y,avatar_url:Y,token:L}),K={...l,avatar:Y||D};o(K),m(K.avatar||""),localStorage.setItem(Ae,JSON.stringify(K)),a("success",(B==null?void 0:B.msg)||"头像更新成功")}catch(T){console.error("修改头像失败:",T),a("error","修改失败",(T==null?void 0:T.message)||"头像修改失败，请稍后重试")}finally{g(!1),i.target.value=""}};return e.jsxs(_e,{title:"编辑资料",onBack:t,bgColor:"bg-gray-100",padding:!1,children:[e.jsxs("div",{className:"bg-white mt-2 px-4",children:[e.jsxs("button",{className:"w-full py-4 flex items-center justify-between border-b border-gray-100 active:opacity-70 disabled:opacity-50",onClick:_,disabled:b,children:[e.jsx("span",{className:"text-base text-gray-800",children:"头像"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 overflow-hidden flex items-center justify-center text-lg font-bold text-orange-600",children:x?e.jsx("img",{src:x,alt:"用户头像",className:"w-full h-full object-cover"}):v}),e.jsx(qe,{size:18,className:"text-gray-300"})]})]}),e.jsx("input",{ref:j,type:"file",accept:"image/*",className:"hidden",onChange:N}),e.jsxs("div",{className:"py-4 flex items-center border-b border-gray-100",children:[e.jsx("span",{className:"text-base text-gray-800 w-20",children:"昵称"}),e.jsx("input",{type:"text",value:c,onChange:i=>d(i.target.value),placeholder:"请输入昵称",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300"})]})]}),e.jsxs("div",{className:"mt-8 px-4 space-y-3",children:[e.jsx("button",{className:"w-full bg-orange-500 text-white text-sm font-semibold py-3 rounded-md active:opacity-80 shadow-sm disabled:opacity-50",onClick:u,disabled:f,children:f?"保存中...":"保存"}),e.jsx("button",{className:"w-full bg-white text-orange-500 border border-orange-400 text-sm font-semibold py-3 rounded-md active:bg-orange-50",onClick:s,children:"退出登录"})]})]})},Ws=()=>({type:"bank_card",bank_name:"",account_name:"",account_number:"",bank_branch:"",screenshot:null,is_default:!1}),Hi=({onBack:t})=>{const{showToast:s}=he(),{errorMessage:a,hasError:r,handleError:l,clearError:o}=Ie(),{errorMessage:c,hasError:d,handleError:x,clearError:m}=Ie(),[b,g]=n.useState(!1),[f,h]=n.useState([]),[j,w]=n.useState("list"),[v,u]=n.useState(null),[_,N]=n.useState(!1),[i,F]=n.useState(()=>Ws()),[I,z]=n.useState(!1),[p,P]=n.useState(null),[y,S]=n.useState(!1),k=n.useCallback(async()=>{const C=localStorage.getItem(ne)||"";if(!C){l("未检测到登录信息，请重新登录后重试",{persist:!0,showToast:!1}),h([]);return}g(!0);try{const R=await Promise.race([rs(C),new Promise((V,H)=>setTimeout(()=>H(new Error("加载超时，请稍后重试")),1e4))]),O=re(R);O?(h(O.list||[]),o()):l(R,{persist:!0,showToast:!1,customMessage:"获取卡号列表失败"})}catch(E){l(E,{persist:!0,showToast:!1,customMessage:"获取卡号列表失败"})}finally{g(!1)}},[l,o]);n.useEffect(()=>{k()},[k]);const T=C=>{const E=C.id??"",R=E==null?"":String(E),O=C.type_text||C.type||"卡号",V=C.account||"",H=C.bank_name||"",W=C.bank_branch||"",A=C.account_name||"",$=Number(C.is_default)===1;return e.jsxs("div",{className:"bg-white rounded-lg px-4 py-3 shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-orange-50 flex items-center justify-center text-orange-500",children:e.jsx(Be,{size:18,strokeWidth:1.7})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:O}),$&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-orange-50 text-orange-500 border border-orange-100",children:"默认"})]}),V&&e.jsx("span",{className:"text-xs text-gray-700 mt-0.5 break-all",children:V}),(H||W||A)&&e.jsx("span",{className:"text-[11px] text-gray-400 mt-0.5",children:[H,W,A].filter(Boolean).join(" · ")})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{type:"button",className:"p-1.5 rounded-full text-gray-400 hover:text-orange-500 hover:bg-orange-50 active:opacity-80",onClick:()=>{if(!R){s("error","操作失败","该账户缺少 ID，无法编辑");return}u(R),N($),F({type:C.type||"bank_card",bank_name:H,account_name:A,account_number:V,bank_branch:W,screenshot:null,is_default:$}),m(),P(null),w("edit")},children:e.jsx(Qa,{size:18})}),e.jsx("button",{type:"button",className:"p-1.5 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-50 active:opacity-80",onClick:async()=>{if(!R){s("error","操作失败","该账户缺少 ID，无法删除");return}if(window.confirm("确定要删除该账户吗？"))try{const U=await bn({id:R});ee(U)?(s("success","删除成功",(U==null?void 0:U.msg)||"账户已删除"),await k()):l(U,{toastTitle:"删除失败",customMessage:"删除账户失败，请稍后重试",context:{accountId:R}})}catch(U){l(U,{toastTitle:"删除失败",customMessage:"删除账户失败，请稍后重试",context:{accountId:R}})}},children:e.jsx(Ns,{size:18})})]})]},R||`${O}-${V}`)},D=(C,E)=>{F(R=>({...R,[C]:E}))},Y=()=>{F(Ws()),m()},L=async C=>{C.preventDefault(),m(),P(null);const{type:E,bank_name:R,account_name:O,account_number:V,bank_branch:H,screenshot:W,is_default:A}=i;if(!E)return x("请选择账户类型",{persist:!0,showToast:!1});if(!O.trim())return x("请输入账户名称",{persist:!0,showToast:!1});if(!V.trim())return x("请输入账号/卡号",{persist:!0,showToast:!1});if(E==="bank_card"&&!R.trim())return x("请选择或输入银行名称",{persist:!0,showToast:!1});if(E==="usdt"&&!H.trim())return x("请输入 USDT 网络类型",{persist:!0,showToast:!1});z(!0);try{if(j==="edit"){if(!v){x("缺少要编辑的账户 ID",{persist:!0,showToast:!1}),z(!1);return}const $=await fn({id:v,bank_name:R.trim(),account_name:O.trim(),account_number:V.trim(),bank_branch:H.trim(),screenshot:W??void 0});ee($)?(A&&!_&&await pn({id:v}),P("账户信息已更新"),Y(),w("list"),u(null),N(!1),await k()):x($,{persist:!0,showToast:!1,customMessage:"保存失败，请检查填写信息"})}else{const $=await hn({type:E,account_type:"personal",bank_name:R.trim(),account_name:O.trim(),account_number:V.trim(),bank_branch:H.trim(),screenshot:W??void 0});ee($)?(P(($==null?void 0:$.msg)||"新增账户成功"),Y(),w("list"),await k()):x($,{persist:!0,showToast:!1,customMessage:"新增账户失败，请检查填写信息"})}}catch($){x($,{persist:!0,showToast:!1,customMessage:"提交失败，请稍后重试"})}finally{z(!1)}},B=()=>i.type==="usdt"?"USDT 网络类型（如 TRC20、ERC20）":"开户行 / 支行（选填）",K=()=>e.jsxs("form",{className:"bg-white mt-2 px-4",onSubmit:L,children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-2",children:["账户类型 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:[{value:"bank_card",label:"银行卡"},{value:"alipay",label:"支付宝"}].map(C=>{const E=i.type===C.value;return e.jsx("button",{type:"button",className:`py-2 px-4 rounded-lg text-sm font-medium transition-all ${E?"bg-orange-50 text-orange-600 border-orange-200 border":"bg-gray-50 text-gray-600 border border-transparent"}`,onClick:()=>D("type",C.value),children:C.label},C.value)})})]}),i.type==="bank_card"&&e.jsxs("div",{className:"py-4 border-b border-gray-100 flex flex-col gap-1 cursor-pointer",onClick:()=>S(!0),children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["银行名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-base font-medium ${i.bank_name?"text-gray-900":"text-gray-300"}`,children:i.bank_name||"点击选择银行"}),e.jsx(qe,{size:18,className:"text-gray-400"})]})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["账户名称 / 持卡人 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium",type:"text",placeholder:"请输入账户名或持卡人姓名",value:i.account_name,onChange:C=>D("account_name",C.target.value)})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["账号 / 卡号 / 收款账号 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium",type:"text",placeholder:"请输入账号/卡号",value:i.account_number,onChange:C=>D("account_number",C.target.value)})]}),(i.type==="bank_card"||i.type==="usdt")&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("span",{className:"block text-sm text-gray-500 mb-1",children:B()}),e.jsx("input",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium",type:"text",placeholder:i.type==="usdt"?"TRC20 / ERC20 等":"如：招商银行上海徐家汇支行",value:i.bank_branch,onChange:C=>D("bank_branch",C.target.value)})]}),i.type==="wechat"&&e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("span",{className:"block text-sm text-gray-500 mb-1",children:"收款二维码（选填）"}),e.jsx("input",{type:"file",accept:"image/*",onChange:C=>{var E;return D("screenshot",((E=C.target.files)==null?void 0:E[0])||null)},className:"text-xs text-gray-500 mt-1"}),i.screenshot&&e.jsx("span",{className:"block text-[11px] text-gray-400 mt-1",children:i.screenshot.name})]}),j==="edit"&&e.jsxs("label",{className:"flex items-center justify-between py-4",children:[e.jsx("span",{className:"text-base text-gray-800",children:"设为默认账户"}),e.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:i.is_default,onChange:C=>D("is_default",C.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),d&&e.jsx("div",{className:"bg-red-50 text-red-600 text-xs px-3 py-2 rounded-md mt-2 mb-2",children:c}),e.jsx("button",{type:"submit",disabled:I,className:"w-full bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white text-base font-bold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform disabled:opacity-60 disabled:cursor-not-allowed mt-8 mb-8",children:I?"提交中...":"提交保存"})]});return e.jsxs(xt,{title:j==="add"?"新增账户":j==="edit"?"编辑账户":"银行卡",onBack:()=>{j==="add"||j==="edit"?(Y(),w("list"),u(null),N(!1)):t()},children:[p&&j==="list"&&e.jsx("div",{className:"bg-green-50 text-green-600 text-xs px-3 py-2 m-4 rounded-lg",children:p}),e.jsx(ui,{visible:y,onClose:()=>S(!1),onConfirm:C=>{D("bank_name",C),S(!1)},initialBank:i.bank_name}),(j==="add"||j==="edit")&&K(),j==="list"&&e.jsxs("div",{className:"p-4 space-y-3 pb-24",children:[b&&e.jsx(ge,{text:"加载中..."}),!b&&r&&e.jsx("div",{className:"bg-red-50 text-red-600 text-xs px-3 py-2 rounded-md",children:a}),!b&&!r&&f.length===0&&e.jsxs("div",{className:"mt-12 flex flex-col items-center text-gray-400 text-sm",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx(Be,{size:26,className:"text-gray-300"})}),e.jsx("div",{children:"没有任何账户"})]}),!b&&!r&&f.length>0&&f.map(T)]}),j==="list"&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 pb-safe max-w-md mx-auto",children:e.jsxs("button",{type:"button",className:"w-full bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform shadow-lg shadow-orange-200",onClick:()=>{w("add"),P(null)},children:[e.jsx(js,{size:20}),"新增账户"]})})]})},Yi=t=>{if(!t)return 0;const s=t.match(/(\d+)/);return s?Number(s[1]):0},Ks={morning:{code:"Pool-A",name:"数字鲁商资产池",subName:"山东产业带数字化营销权益",roi:"+5.5%",quota:"100万",icon:er,themeColor:"text-blue-600",gradient:"from-blue-600 to-cyan-500",softBg:"bg-blue-50",dataBg:"bg-[#F0F7FF]",buttonClass:"bg-gradient-to-r from-blue-600 to-cyan-600 shadow-blue-200"},afternoon:{code:"Pool-B",name:"助农供应链资产池",subName:"优质果蔬集群应收账款确权",roi:"+8.2%",quota:"500万",icon:aa,themeColor:"text-orange-600",gradient:"from-orange-500 to-red-500",softBg:"bg-orange-50",dataBg:"bg-[#FFF7F0]",buttonClass:"bg-gradient-to-r from-orange-500 to-red-500 shadow-orange-200"},evening:{code:"Pool-C",name:"林业碳汇权益池",subName:"林业碳汇数据资产映射",roi:"+12.0%",quota:"200万",icon:ra,themeColor:"text-emerald-600",gradient:"from-emerald-600 to-teal-600",softBg:"bg-emerald-50",dataBg:"bg-[#F0FDF4]",buttonClass:"bg-gradient-to-r from-emerald-600 to-teal-500 shadow-emerald-200"},default:{code:"D-Asset",name:"新手体验试炼场",subName:"虚拟资产确权体验专区",roi:"+3.0%",quota:"不限",icon:Xa,themeColor:"text-purple-600",gradient:"from-purple-600 to-pink-500",softBg:"bg-purple-50",dataBg:"bg-[#FAF5FF]",buttonClass:"bg-gradient-to-r from-purple-600 to-pink-500 shadow-purple-200"}},Vi=t=>{const s=parseInt(t.split(":")[0]);return s>=9&&s<12?"morning":s>=13&&s<16?"afternoon":s>=18&&s<21?"evening":"default"},Js=t=>{const s=t?Vi(t.startTime):"default",a=Ks[s]||Ks.default;return{...a,name:(t==null?void 0:t.title)||a.name,subName:t?`${t.startTime} - ${t.endTime}`:a.subName}},qs=({onBack:t,onProductSelect:s,onNavigate:a,initialSessionId:r,initialSessionTitle:l,initialSessionStartTime:o,initialSessionEndTime:c})=>{const{errorMessage:d,hasError:x,handleError:m,clearError:b}=Ie(),{errorMessage:g,hasError:f,handleError:h,clearError:j}=Ie(),[w,v]=n.useState(new Date),[u,_]=n.useState(null),[N,i]=n.useState([]),[F,I]=n.useState(!0),[z,p]=n.useState("preview"),[P,y]=n.useState([]),[S,k]=n.useState(!1),[T,D]=n.useState("all"),Y=n.useRef(null),L=n.useCallback(async R=>{var O,V;if(Y.current===R.id){console.log("Session already loading, skipping:",R.id);return}try{Y.current=R.id,k(!0),j();const H=await An(R.id,{page:1,limit:10});if(console.log("API Response:",H),console.log("Items list:",(O=H.data)==null?void 0:O.list),ee(H)&&((V=H.data)!=null&&V.list)){const W=H.data.list.map(A=>{const $=A.consignment_count>0||A.consignment_list&&A.consignment_list.length>0,U=A.official_stock>0||A.stock>0;let G="collection";$&&U?G="mixed":$&&(G="consignment");const J=Yi(A.price_zone),se=J>0?J:Number(A.min_price||A.price||0),de=A.total_available??(A.official_stock||0)+(A.consignment_count||0);return console.log("Processing item:",A.id||A.package_name,{official_stock:A.official_stock,consignment_count:A.consignment_count,total_available:de,price_range:A.price_range,source:G}),{...A,price:se,stock:de,official_stock:A.official_stock||A.stock||0,consignment_count:A.consignment_count||0,total_available:de,package_name:A.package_name||A.title,displayKey:`pkg-${A.zone_id||A.id}-${A.package_name||A.id}`,source:G,hasStockInfo:de>0}});console.log("Processed items:",W.map(A=>({id:A.id,package_name:A.package_name,source:A.source,official_stock:A.official_stock,consignment_count:A.consignment_count}))),W.length>0?y(W):h("暂无上链资产",{persist:!0,showToast:!1})}else h("暂无上链资产",{persist:!0,showToast:!1});_(R)}catch(H){h(H,{persist:!0,showToast:!1,customMessage:"数据同步延迟，请重试",context:{sessionId:R.id}}),_(R)}finally{Y.current=null,k(!1)}},[]);n.useEffect(()=>{console.log("TradingZone mounted/updated with sessionId:",r),(async()=>{var O;try{I(!0),b();const V=await zn();if(ee(V)&&((O=V.data)!=null&&O.list)){const H=V.data.list.map(W=>({id:String(W.id),title:W.title,image:W.image,startTime:W.start_time,endTime:W.end_time,isActive:!!(W!=null&&W.is_active)}));if(i(H),r){const W=H.find(A=>A.id===r);W?L(W):l&&L({id:r,title:l,image:"",startTime:o||"",endTime:c||""})}}else m(V,{persist:!0,showToast:!1,customMessage:"获取数据资产池失败"})}catch(V){m(V,{persist:!0,showToast:!1,customMessage:"网络连接异常"})}finally{I(!1)}})()},[r,l,o,c,L]),n.useEffect(()=>{const R=setInterval(()=>v(new Date),1e3);return()=>clearInterval(R)},[]);const B=()=>{u?r?t():(_(null),y([]),j()):t()},K=R=>{a?a({name:"trading-zone-items",sessionId:R.id,sessionTitle:R.title,sessionStartTime:R.startTime,sessionEndTime:R.endTime}):L(R)},C=R=>{const[O,V]=R.startTime.split(":").map(Number),[H,W]=R.endTime.split(":").map(Number),A=new Date(w);A.setHours(O,V,0,0);const $=new Date(w);return $.setHours(H,W,0,0),w>=$?{status:"ended",target:null}:R.isActive||w>=A&&w<$?{status:"active",target:$}:w<A?{status:"waiting",target:A}:{status:"ended",target:null}},E=R=>{if(R<0)return"00:00:00";const O=Math.floor(R/1e3),V=Math.floor(O/3600),H=Math.floor(O%3600/60),W=O%60;return`${V.toString().padStart(2,"0")}:${H.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`};if(u){const R=Js(u),{status:O,target:V}=C(u);return e.jsxs("div",{className:"min-h-screen bg-[#F8F9FA] text-gray-900 font-sans pb-safe",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-72 bg-gradient-to-b from-[#FFE4C4] via-[#FFF0E0] to-[#F8F9FA] z-0"}),e.jsxs("div",{className:"relative z-10 p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{type:"button",onClick:B,className:"p-2 bg-white/60 backdrop-blur rounded-full shadow-sm hover:bg-white transition-all text-gray-700",children:e.jsx(Rt,{size:20})}),e.jsx("div",{className:"text-xs font-bold text-gray-500/50 font-serif tracking-widest uppercase"})]}),e.jsxs("div",{className:"bg-white rounded-[32px] p-6 shadow-xl shadow-gray-200/60 mb-8 border border-white/60 relative overflow-hidden ring-1 ring-gray-50",children:[e.jsx("div",{className:`absolute -right-8 -top-8 w-40 h-40 rounded-full opacity-10 ${R.softBg}`}),e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-[10px] font-bold px-3 py-1 rounded-full ${R.softBg} ${R.themeColor} mb-3 inline-block shadow-sm`,children:R.code}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight mb-1 tracking-tight",children:R.name}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:R.subName})]}),e.jsx("div",{className:`p-4 rounded-2xl ${R.softBg} ${R.themeColor} shadow-inner`,children:e.jsx(R.icon,{size:28})})]}),e.jsxs("div",{className:`relative z-10 flex items-stretch rounded-2xl ${R.dataBg} p-4 mb-5 border border-black/[0.02]`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 font-bold mb-1",children:"预期收益率"}),e.jsx("div",{className:`text-2xl font-black ${R.themeColor} tracking-tight leading-none pt-1`,children:R.roi})]}),e.jsx("div",{className:"w-px bg-black/[0.06] mx-4 self-center h-8"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 font-bold mb-1",children:"本期额度"}),e.jsx("div",{className:"text-lg font-extrabold text-gray-700 leading-none pt-1",children:R.quota})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-5 px-2",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-5 rounded-full bg-orange-500"}),e.jsx("span",{children:"资产申购列表"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs("button",{type:"button",onClick:()=>a({name:"reservation-record"}),className:"flex items-center gap-1.5 bg-orange-50 text-orange-600 px-3 py-1.5 rounded-full text-xs font-bold border border-orange-100 active:scale-95 transition-transform",children:[e.jsx(vs,{size:14}),e.jsx("span",{children:"申购记录"})]}),O==="active"&&V&&e.jsxs("div",{className:"text-xs font-mono text-white bg-red-500 px-3 py-1.5 rounded-full shadow-md shadow-red-200 flex items-center gap-1.5 animate-pulse",children:[e.jsx(ze,{size:12}),e.jsx("span",{className:"font-bold tracking-wide",children:E(V.getTime()-w.getTime())})]})]})]}),e.jsx("div",{className:"flex gap-2 mb-5 px-2 overflow-x-auto pb-1 scrollbar-none",children:["all",...Array.from(new Set(P.map(W=>W.price_zone).filter(W=>W)))].map(W=>e.jsx("button",{type:"button",onClick:()=>D(W),className:`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${T===W?"bg-orange-500 text-white shadow-md shadow-orange-200":"bg-white text-gray-500 border border-gray-100 hover:bg-gray-50"}`,children:W==="all"?"全部":W},W))}),S?e.jsx("div",{className:"py-20 flex justify-center",children:e.jsx(ge,{})}):f?e.jsx("div",{className:"py-12 text-center text-gray-400 text-sm",children:g}):P.length===0?e.jsx("div",{className:"py-12 text-center text-gray-400 text-sm",children:"暂无资产"}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:P.filter(H=>T==="all"?!0:H.price_zone===T).map(H=>e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-[0_4px_20px_rgb(0,0,0,0.03)] border border-gray-100 hover:border-gray-200 hover:shadow-lg transition-all active:scale-[0.98] group",onClick:()=>{console.log("Clicking item:",{id:H.id,source:H.source,consignment_id:H.consignment_id,is_consignment:H.is_consignment});const W={id:String(H.id),title:H.title,price:H.price,image:H.image,artist:R.name,category:"Data Asset",productType:"collection",sessionId:(u==null?void 0:u.id)||H.session_id,zoneId:H.zone_id||H.price_zone_id,...H.source==="consignment"&&H.consignment_id?{consignmentId:H.consignment_id}:{}};console.log("Product data to pass:",W),s&&s(W)},children:[e.jsxs("div",{className:"aspect-square bg-gray-50 relative overflow-hidden",children:[e.jsx(et,{src:H.image,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/40 backdrop-blur-md text-white text-[10px] px-2 py-1 rounded-full font-bold shadow-sm border border-white/20",children:["ID.",H.id]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-gray-900 text-sm font-bold line-clamp-1 mb-1",children:H.title}),e.jsx("div",{className:"text-[10px] text-gray-400 font-mono mb-2",children:H.price_zone&&e.jsx("span",{className:"inline-block px-1.5 py-0.5 bg-orange-50 text-orange-600 rounded",children:H.price_zone})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-red-500 font-extrabold text-base flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-xs",children:"¥"}),e.jsx("span",{children:H.price.toLocaleString()})]}),e.jsx("button",{type:"button",className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-md shadow-orange-200 active:scale-95 transition-transform",children:"申购"})]})]})]},H.displayKey))})]})]})}return e.jsxs("div",{className:"min-h-screen bg-[#F8F9FA] text-gray-900 font-sans pb-safe",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-[#FFE4C4] via-[#FFF0E0] to-[#F8F9FA] z-0"}),e.jsxs("div",{className:"relative z-10 px-5 pt-4 pb-2 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:B,className:"p-2 -ml-2 text-gray-700 active:bg-black/5 rounded-full transition-colors",children:e.jsx(Rt,{size:24})}),e.jsx("h1",{className:"font-bold text-xl text-gray-900 tracking-tight",children:"资产交易"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white/90 backdrop-blur px-3 py-1.5 rounded-full shadow-sm border border-white/60",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse ring-4 ring-green-100"}),e.jsx("span",{className:"text-xs font-bold text-gray-700 font-sans tracking-wide",children:"LIVE"})]})]}),e.jsxs("div",{className:"relative z-10 p-5 space-y-6",children:[" ",F?e.jsx("div",{className:"mt-20",children:e.jsx(ge,{})}):x?e.jsx("div",{className:"mt-20 text-center text-red-500 text-sm",children:d}):N.map(R=>{const O=Js(R),{status:V,target:H}=C(R);return e.jsxs("div",{className:"bg-white rounded-[28px] p-6 shadow-[0_12px_24px_rgb(0,0,0,0.06)] border border-white relative overflow-hidden transition-all duration-300 active:scale-[0.99]",children:[e.jsx("div",{className:"absolute -right-6 -bottom-6 opacity-[0.03] pointer-events-none",children:e.jsx(O.icon,{size:180})}),e.jsxs("div",{className:"relative z-10 flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:`inline-flex items-center px-2.5 py-1 rounded-lg text-[10px] font-bold ${O.softBg} ${O.themeColor} mb-2.5 border border-transparent`,children:O.code}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 leading-none mb-2",children:O.name}),e.jsx("p",{className:"text-xs text-gray-400 font-medium",children:O.subName})]}),V==="active"?e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 mb-2 shadow-lg shadow-red-200 animate-[pulse_2s_infinite]",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),e.jsx("span",{className:"animate-bounce",children:"🔥"})," 正在抢购"]}),H&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-red-500 font-bold mb-0.5",children:"距结束仅剩"}),e.jsx("span",{className:"font-mono text-2xl font-black text-red-600 tracking-tighter tabular-nums drop-shadow-sm",children:E(H.getTime()-w.getTime())})]})]}):e.jsx("span",{className:`text-[10px] font-bold px-3 py-1.5 rounded-full border ${V==="waiting"?"bg-orange-50 border-orange-100 text-orange-500":"bg-gray-50 border-gray-100 text-gray-400"}`,children:V==="waiting"?"即将开始":"已结束"})]}),e.jsxs("div",{className:`relative z-10 flex items-stretch rounded-2xl ${O.dataBg} p-4 mb-5 border border-black/[0.02]`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 font-bold mb-1",children:"预期收益率"}),e.jsx("div",{className:`text-2xl font-black ${O.themeColor} tracking-tight leading-none pt-1`,children:O.roi})]}),e.jsx("div",{className:"w-px bg-black/[0.06] mx-4 self-center h-8"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 font-bold mb-1",children:"本期额度"}),e.jsx("div",{className:"text-lg font-extrabold text-gray-700 leading-none pt-1",children:O.quota})]})]}),e.jsx("div",{className:"relative z-10",children:e.jsxs("button",{type:"button",onClick:()=>V==="active"&&K(R),disabled:V!=="active",className:`w-full h-12 rounded-xl text-sm font-bold flex items-center justify-center gap-2 shadow-lg transition-all active:scale-[0.98]
                           ${V==="active"?`${O.buttonClass} text-white`:"bg-gray-100 text-gray-400 border border-gray-200 shadow-none cursor-not-allowed"}`,children:[V==="active"?"立即抢购 · ACCESS":V==="waiting"?"即将开始 · COMING SOON":"本场结束 · CLOSED",V==="active"&&e.jsx(St,{size:16})]})})]},R.id)})]})]})},Wi=({onBack:t})=>e.jsx(Ts,{type:"about_us",defaultTitle:"中心介绍",onBack:t}),Ma=({onBack:t})=>e.jsx(Ts,{type:"privacy_policy",defaultTitle:"隐私政策",onBack:t}),Ki=({onBack:t,onArtistSelect:s})=>{const[a,r]=n.useState([]),[l,o]=n.useState(!0);return n.useEffect(()=>{let c=!0;return(async()=>{var x;try{o(!0);const m=await Es();if(!c)return;const g=(((x=m.data)==null?void 0:x.list)??[]).map(f=>({id:String(f.id),name:f.name,image:ke(f.avatar),title:f.title,bio:f.description}));r(g)}catch(m){console.error("加载艺术家列表失败:",m),r([])}finally{c&&o(!1)}})(),()=>{c=!1}},[]),e.jsxs(_e,{title:"艺术家风采",onBack:t,children:[l&&e.jsx(ge,{text:"加载中..."}),!l&&a.length===0&&e.jsx(Oe,{title:"暂无艺术家数据"}),!l&&a.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(c=>e.jsxs("div",{className:"flex flex-col bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 active:scale-95 transition-all duration-200 cursor-pointer group",onClick:()=>s==null?void 0:s(c.id),children:[e.jsx(et,{src:c.image,alt:c.name,className:"w-full aspect-[4/5]"}),e.jsxs("div",{className:"p-3 flex flex-col items-center text-center flex-1 justify-center",children:[c.title?e.jsx("span",{className:"inline-block px-2 py-0.5 bg-orange-50 text-orange-600 text-[10px] font-medium rounded-full mb-1.5 max-w-full truncate",children:c.title}):e.jsx("div",{className:"h-5 mb-1.5"}),e.jsx("span",{className:"text-base font-bold text-gray-900 truncate w-full",children:c.name})]})]},c.id))})]})};function Ji(t){const s=[...t];for(let a=s.length-1;a>0;a--){const r=Math.floor(Math.random()*(a+1));[s[a],s[r]]=[s[r],s[a]]}return s}const qi=({onBack:t,onNavigateToArtist:s})=>{const[a,r]=n.useState([]),[l,o]=n.useState(!0),[c,d]=n.useState(null),[x,m]=n.useState(1),[b,g]=n.useState(0),f=20,h=async w=>{try{o(!0),d(null);const u=(await $n({page:w,limit:10})).data,_=(u==null?void 0:u.list)??[];g((u==null?void 0:u.total)??0);const N=Ji(_).slice(0,f).map(i=>({...i,image:ke(i.image)}));r(N),m(w)}catch(v){console.error("加载艺术佳作列表失败:",v),d((v==null?void 0:v.message)||"加载佳作列表失败")}finally{o(!1)}};n.useEffect(()=>{let w=!0;return(async()=>{w&&await h(1)})(),()=>{w=!1}},[]);const j=async()=>{const w=b&&f?Math.max(1,Math.ceil(b/f)):x+1;let v=x+1;v>w&&(v=1),await h(v)};return e.jsxs(_e,{title:"佳作鉴赏",onBack:t,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"精选艺术家佳作 · 随机展示"}),e.jsx("button",{type:"button",onClick:j,className:"text-xs text-blue-600 px-2 py-1 rounded-full border border-blue-100 bg-blue-50 active:bg-blue-100",children:"换一批"})]}),l&&!a.length&&e.jsx(ge,{text:"加载中..."}),c&&!a.length&&e.jsx("div",{className:"text-center text-xs text-red-400 py-8",children:c}),!l&&!c&&!a.length&&e.jsx(Oe,{title:"暂无作品数据"}),a.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.map(w=>e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 active:scale-[0.99] transition-transform cursor-pointer flex flex-col",onClick:()=>s(w.artist_id),children:[e.jsx(et,{src:w.image,alt:w.title,className:"w-full aspect-[4/5]"}),e.jsxs("div",{className:"p-3 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-xs text-blue-600 font-medium truncate mb-1",children:w.artist_title?`${w.artist_name}｜${w.artist_title}`:w.artist_name}),e.jsx("div",{className:"text-sm text-gray-900 font-semibold truncate mb-1",children:w.title}),w.description&&e.jsx("div",{className:"text-[11px] text-gray-500 leading-snug line-clamp-2",children:w.description})]})]},w.id))})]})};async function Zi(t={}){const s=t.token??ce(),a=t.limit||10;if(!s)throw new Error("未找到用户登录信息，请先登录后再查看消费金日志");const r=new URLSearchParams;r.append("limit",String(a));const l=`${q.account.integral}?${r.toString()}`;try{const o=await Z(l,{method:"GET",token:s});return console.log("获取消费金日志接口原始响应:",o),o}catch(o){throw console.error("获取消费金日志失败:",o),o}}const Qi=({visible:t,title:s,content:a,loading:r=!1,onClose:l})=>t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-[85%] max-w-md mx-4 overflow-hidden",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 bg-gradient-to-r from-orange-50 to-white",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:s}),e.jsx("button",{type:"button",className:"p-1 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors",onClick:l,children:e.jsx(Ce,{size:20,className:"text-gray-500"})})]}),e.jsx("div",{className:"px-4 py-4 max-h-[60vh] overflow-y-auto",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(dt,{size:32,className:"text-orange-500 animate-spin mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"加载中..."})]}):a?e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:a}}):e.jsx("div",{className:"text-center py-8 text-sm text-gray-400",children:"暂无说明内容"})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsx("button",{type:"button",className:"w-full py-2.5 bg-gradient-to-r from-orange-500 to-orange-400 text-white text-sm font-medium rounded-lg active:opacity-80 transition-opacity",onClick:l,children:"我知道了"})})]})}):null,Xi={supply_chain_fund:"供应链专项金",total_assets:"总资产",withdrawable_income:"可调度收益",green_power:"绿色算力",consumer_points:"消费金",rights_fund:"确权金",pending_activation:"待激活"},el=({userInfo:t,onNavigate:s})=>{const[a,r]=n.useState({visible:!1,title:"",content:"",loading:!1}),l=async d=>{var m;const x=Xi[d];r({visible:!0,title:x,content:"",loading:!0});try{const b=await Dt({title:x,limit:1}),g=re(b);if(((m=g==null?void 0:g.list)==null?void 0:m.length)>0){const f=g.list[0];r(h=>({...h,content:f.content,loading:!1}))}else r(f=>({...f,content:"",loading:!1}))}catch(b){console.error("获取余额说明失败:",b),r(g=>({...g,content:"",loading:!1}))}},o=()=>{r(d=>({...d,visible:!1}))},c=({type:d})=>e.jsx("span",{role:"button",tabIndex:0,className:"inline-flex items-center justify-center ml-0.5 p-0.5 rounded-full hover:bg-white/20 active:bg-white/30 transition-colors cursor-pointer",onClick:x=>{x.stopPropagation(),l(d)},onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),x.stopPropagation(),l(d))},children:e.jsx(na,{size:12,className:"text-white/70"})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative rounded-3xl shadow-xl mb-3 overflow-hidden text-white font-sans",children:[e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-[#FF884D] to-[#FF5500] z-0",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-orange-300 opacity-20 rounded-full blur-2xl translate-y-1/2 -translate-x-1/4"})]}),e.jsxs("div",{className:"relative z-10 p-3",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-90 text-sm font-medium mb-1",children:["总资产 (CNY)",e.jsx(c,{type:"total_assets"})]}),e.jsx("div",{className:"text-3xl font-[DINAlternate-Bold,Roboto,sans-serif] font-bold tracking-tight drop-shadow-sm",children:we(t==null?void 0:t.money)})]}),e.jsx("div",{className:"w-full h-px bg-white/20 mb-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-4 gap-x-2 relative mb-2",children:[e.jsxs("div",{className:"text-center border-r border-white/10",children:[e.jsxs("div",{className:"text-xs text-white/80 mb-1 flex items-center justify-center",children:["供应链专项金",e.jsx(c,{type:"supply_chain_fund"})]}),e.jsx("div",{className:"text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif]",children:we(t==null?void 0:t.balance_available)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-white/80 mb-1 flex items-center justify-center",children:["可调度收益",e.jsx(c,{type:"withdrawable_income"})]}),e.jsx("div",{className:"text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif]",children:we(t==null?void 0:t.withdrawable_money)})]}),e.jsxs("div",{className:"text-center border-r border-white/10 border-t border-white/10 pt-3",children:[e.jsxs("div",{className:"text-xs text-white/80 mb-1 flex items-center justify-center",children:["消费金",e.jsx(c,{type:"consumer_points"})]}),e.jsx("div",{className:"text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif]",children:(t==null?void 0:t.score)??0})]}),e.jsxs("button",{type:"button",className:"text-center border-t border-white/10 pt-3",onClick:()=>s({name:"hashrate-exchange",source:"asset-view",back:{name:"asset-view"}}),children:[e.jsxs("div",{className:"text-xs text-white/80 mb-1 flex items-center justify-center gap-1",children:["绿色算力 ",e.jsx(St,{size:10,className:"opacity-70"}),e.jsx("span",{onClick:d=>d.stopPropagation(),children:e.jsx(c,{type:"green_power"})})]}),e.jsxs("div",{className:"text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif] text-[#E0F2F1] drop-shadow-[0_0_8px_rgba(0,255,0,0.3)]",children:[(t==null?void 0:t.green_power)||0," ",e.jsx("span",{className:"text-xs font-normal opacity-70",children:"GHs"})]})]})]}),e.jsxs("div",{className:"mt-2 pt-2 flex justify-between text-xs text-white/95 border-t border-white/20 px-1 font-medium tracking-wide",children:[e.jsxs("span",{className:"flex items-center",children:["确权金: ¥",we(t==null?void 0:t.service_fee_balance),e.jsx(c,{type:"rights_fund"})]}),e.jsxs("span",{className:"flex items-center",children:["待激活: ¥",we((t==null?void 0:t.pending_activation_gold)||0),e.jsx(c,{type:"pending_activation"})]})]})]})]}),e.jsx(Qi,{visible:a.visible,title:a.title,content:a.content,loading:a.loading,onClose:o})]})},tl=({onNavigate:t})=>{const s=[{label:"申购专项金",icon:Le,route:{name:"balance-recharge",source:"asset-view"},color:"text-orange-600"},{label:"收益提现",icon:at,route:{name:"balance-withdraw",source:"asset-view"},color:"text-orange-600"},{label:"算力补充",icon:ia,route:{name:"hashrate-exchange",source:"asset-view"},color:"text-green-600"},{label:"确权金划转",icon:Be,route:{name:"service-recharge",source:"asset-view"},color:"text-purple-600"}];return e.jsx("div",{className:"grid grid-cols-4 gap-3 mb-6",children:s.map((a,r)=>e.jsxs("button",{type:"button",onClick:()=>t(a.route),className:"flex flex-col items-center group active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-full aspect-[4/3] bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center mb-1.5 relative overflow-hidden group-hover:shadow-md transition-shadow",children:e.jsx("div",{className:`mb-1 ${a.color}`,children:e.jsx(a.icon,{size:22})})}),e.jsx("span",{className:"text-[11px] font-medium text-gray-600 leading-tight text-center",children:a.label})]},r))})},sl=({tabs:t,activeTab:s,onChange:a})=>e.jsx("div",{className:"overflow-x-auto scrollbar-hide mb-4",children:e.jsx("div",{className:"flex gap-2 p-1 bg-gray-50 rounded-xl inline-flex min-w-full",children:t.map((r,l)=>e.jsx("button",{onClick:()=>a(l),className:`
              flex-shrink-0 px-4 py-2.5 text-xs font-medium rounded-lg 
              transition-all duration-300 whitespace-nowrap
              ${l===s?"bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-md shadow-orange-200 scale-105 border border-orange-400":"bg-white text-gray-600 hover:text-orange-500 hover:bg-orange-50 border border-transparent"}
            `,children:r},l))})});function Ba(t){const[s,a]=n.useState(t.initial),[r,l]=n.useState(t.context||{}),o=n.useRef([]),c=n.useCallback(m=>{const b=t.transitions[s];if(!b)return!1;const g=b[m];return g?typeof g=="object"&&g.guard?g.guard():!0:!1},[s,t.transitions]),d=n.useCallback((m,b)=>{const g=t.transitions[s];if(!g)return t.debug&&Ke("stateMachine.send",`No transitions defined for state: ${s}`),!1;const f=g[m];if(!f)return t.debug&&Ke("stateMachine.send",`Invalid transition: ${s} + ${m}`),!1;let h,j,w;return typeof f=="string"?h=f:(h=f.target,j=f.guard,w=f.effect),j&&!j()?(t.debug&&Ke("stateMachine.send",`Transition blocked by guard: ${s} + ${m}`),!1):(o.current.push({from:s,event:m,to:h,timestamp:Date.now()}),o.current.length>50&&(o.current=o.current.slice(-50)),t.debug&&fe("stateMachine.send",`Transition: ${s} --[${m}]--> ${h}`,{payload:b}),a(h),b&&l(v=>({...v,...b})),w&&w(),!0)},[s,t.transitions,t.debug]),x=n.useCallback(()=>[...o.current],[]);return{state:s,context:r,can:c,send:d,setState:a,setContext:l,getHistory:x}}const al={closed:{OPEN_DELIVERY:"open_delivery",OPEN_CONSIGNMENT:"open_consignment"},open_delivery:{SWITCH_TO_CONSIGNMENT:"open_consignment",SUBMIT:"submitting",CLOSE:"closed"},open_consignment:{SWITCH_TO_DELIVERY:"open_delivery",SUBMIT:"submitting",CLOSE:"closed"},submitting:{SUBMIT_SUCCESS:"closed",SUBMIT_ERROR:"open_delivery",CLOSE:"closed"}};function rl(t,s){const{showToast:a,showDialog:r}=he(),{state:l,context:o,send:c,setContext:d}=Ba({initial:"closed",transitions:al,context:{selectedItem:null,actionType:null,error:null,consignmentCheckData:null,deliveryCheckResult:null,countdown:null,consignmentTicketCount:t}});n.useEffect(()=>{d(i=>({...i,consignmentTicketCount:t}))},[t]);const x=n.useCallback(i=>{if(!i)return{passed:!0,hoursLeft:0};const I=(Math.floor(Date.now()/1e3)-i)/3600,z=48-I;return{passed:I>=48,hoursLeft:Math.max(0,Math.ceil(z))}},[]),m=n.useCallback(i=>({isConsigning:i.consignment_status===be.CONSIGNING||i.consignment_status===be.PENDING,hasConsignedBefore:typeof i.consignment_status=="number"&&i.consignment_status!==be.NOT_CONSIGNED,hasConsignedSuccessfully:i.consignment_status===be.SOLD,isDelivered:i.delivery_status===We.DELIVERED}),[]),b=n.useCallback(i=>i.user_collection_id||i.id,[]),g=n.useCallback(i=>{c("OPEN_DELIVERY",{selectedItem:i,actionType:"delivery"})},[c]),f=n.useCallback(i=>{c("OPEN_CONSIGNMENT",{selectedItem:i,actionType:"consignment"})},[c]),h=n.useCallback(()=>{c("SWITCH_TO_DELIVERY",{actionType:"delivery"})},[c]),j=n.useCallback(()=>{c("SWITCH_TO_CONSIGNMENT",{actionType:"consignment"})},[c]),w=n.useCallback(()=>{c("CLOSE",{selectedItem:null,actionType:null,error:null,consignmentCheckData:null,deliveryCheckResult:null,countdown:null})},[c]),v=o.selectedItem?(()=>{const i=m(o.selectedItem),F=x(o.selectedItem.pay_time||o.selectedItem.buy_time||0);return{...i,...F}})():null,u=o.consignmentCheckData?(()=>{const i=o.consignmentCheckData;let F=!1,I=null,z=null;if(typeof i.can_consign=="boolean"?F=i.can_consign:typeof i.unlocked=="boolean"?F=i.unlocked:typeof i.remaining_seconds=="number"&&(F=Number(i.remaining_seconds)<=0,I=Number(i.remaining_seconds)),typeof i.remaining_text=="string"){z=i.remaining_text;const p=i.remaining_text.match(/(\d{1,}):(\d{2}):(\d{2})/);if(p){const P=Number(p[1])||0,y=Number(p[2])||0,S=Number(p[3])||0;I=P*3600+y*60+S}}else typeof i.remaining_seconds=="number"&&(I=Number(i.remaining_seconds));return{unlocked:F,remainingSeconds:I,remainingText:z,canConsign:F&&t>0}})():null;n.useEffect(()=>{if(l!=="open_consignment"||!o.selectedItem){d(z=>({...z,consignmentCheckData:null}));return}const i=b(o.selectedItem);if(i==null)return;let F=!0;const I=localStorage.getItem(ne)||void 0;return ps({user_collection_id:i,token:I}).then(z=>{F&&d(p=>({...p,consignmentCheckData:(z==null?void 0:z.data)??null}))}).catch(()=>{F&&d(z=>({...z,consignmentCheckData:null}))}),()=>{F=!1}},[l,o.selectedItem,b,d]),n.useEffect(()=>{if(l!=="open_consignment"||!u){d(p=>({...p,countdown:null}));return}let i=u.remainingSeconds;if(i===null||i<=0){d(p=>({...p,countdown:null}));return}const F=p=>{const P=Math.floor(p/3600),y=Math.floor(p%3600/60),S=p%60;return{hours:P,minutes:y,seconds:S}};d(p=>({...p,countdown:F(i)}));let I=!0;const z=setInterval(()=>{I&&(i=Math.max(0,i-1),d(p=>({...p,countdown:F(i)})),i<=0&&clearInterval(z))},1e3);return()=>{I=!1,clearInterval(z)}},[l,u,d]);const _=n.useCallback(async()=>{if(!o.selectedItem||l==="submitting")return;const i=localStorage.getItem(ne);if(!i){a("warning","请登录","请先登录后再进行操作");return}const F=b(o.selectedItem);if(F==null){a("error","错误","无法获取藏品ID，无法继续操作");return}if(o.actionType==="delivery"){const I=m(o.selectedItem);if(I.isConsigning){a("warning","提示","该藏品正在寄售中，无法提货");return}if(I.hasConsignedSuccessfully){a("warning","提示","该藏品已经寄售成功（已售出），无法提货");return}if(I.isDelivered){a("warning","提示","该藏品已经提货，无法再次提货");return}const z=x(o.selectedItem.pay_time||o.selectedItem.buy_time||0);if(!z.passed){a("warning","时间未到",`提货需要满足购买后48小时，还需等待 ${z.hoursLeft} 小时`);return}const p=async()=>{var P,y;c("SUBMIT");try{const S=await ka({user_collection_id:F,token:i});if(ee(S)||S.code===0||((P=S.data)==null?void 0:P.code)===0)a("success","操作成功",S.msg||((y=S.data)==null?void 0:y.message)||S.message||"权益分割已提交"),c("SUBMIT_SUCCESS"),s==null||s();else{const k=oe(S,"权益分割失败");a("error","操作失败",k),c("SUBMIT_ERROR",{error:k})}}catch(S){const k=(S==null?void 0:S.msg)||(S==null?void 0:S.message)||"权益分割失败";a("error","提交失败",k),c("SUBMIT_ERROR",{error:k})}};I.hasConsignedBefore?r({title:"强制权益分割确认",description:"该藏品曾经寄售过，确定要强制执行权益分割吗？",confirmText:"确定分割",cancelText:"取消",onConfirm:p}):p()}else if(o.actionType==="consignment"){const I=m(o.selectedItem);if(I.isConsigning){a("warning","提示","该藏品正在寄售中，无法再次寄售");return}if(I.hasConsignedSuccessfully){a("warning","提示","该藏品已经寄售成功（已售出），无法再次寄售");return}if(u&&!u.unlocked){const p=u.remainingSeconds?Math.ceil(u.remainingSeconds/3600):0;a("warning","时间未到",`寄售需要满足购买后48小时，还需等待 ${p} 小时`);return}if(t===0){a("warning","缺少道具","您没有寄售券，无法进行寄售");return}const z=parseFloat(o.selectedItem.price||"0");if(Number.isNaN(z)||z<=0){a("error","错误","藏品价格无效，无法进行寄售");return}c("SUBMIT");try{const p=await _a({user_collection_id:F,price:z,token:i});if(ee(p))a("success","提交成功",p.msg||"寄售申请已提交"),c("SUBMIT_SUCCESS"),s==null||s();else{const P=oe(p,"寄售申请失败");a("error","操作失败",P),c("SUBMIT_ERROR",{error:P})}}catch(p){const P=(p==null?void 0:p.msg)||(p==null?void 0:p.message)||"寄售申请失败";a("error","提交失败",P),c("SUBMIT_ERROR",{error:P})}}},[o.selectedItem,o.actionType,l,t,u,c,a,r,x,m,b,s]),N=l!=="submitting"&&o.selectedItem!==null&&(o.actionType==="delivery"&&(v==null?void 0:v.can48Hours)&&!v.isConsigning&&!v.isDelivered&&!v.hasConsignedSuccessfully||o.actionType==="consignment"&&(u==null?void 0:u.canConsign)===!0);return{state:l,context:o,isOpen:l!=="closed",isSubmitting:l==="submitting",canSubmit:N,openDelivery:g,openConsignment:f,switchToDelivery:h,switchToConsignment:j,handleSubmit:_,close:w,deliveryCheckResult:v,consignmentCheckResult:u}}function nl(t,s=0){const[a,r]=n.useState(s),[l,o]=n.useState(()=>new Map(t.map(g=>[g.id,{data:[],page:1,hasMore:!1,loading:!1,error:null,initialized:!1}]))),c=l.get(a)||{data:[],page:1,hasMore:!1,loading:!1,error:null,initialized:!1},d=n.useCallback((g,f)=>{o(h=>{const j=new Map(h),w={data:[],page:1,hasMore:!1,loading:!1,error:null,initialized:!1},v=j.get(g);let u;return v?u=v:u=w,j.set(g,{...u,...f}),j})},[]),x=n.useCallback(async(g,f=1)=>{const h=localStorage.getItem(ne);if(!h){d(g,{error:"请先登录",loading:!1});return}const j=t.find(w=>w.id===g);if(!j){d(g,{error:"标签页配置不存在",loading:!1});return}d(g,{loading:!0,error:null});try{const w=await j.fetchData({page:f,limit:10,token:h}),{list:v,hasMore:u,extra:_}=j.parseData(w),N=l.get(g),i=f===1?v:[...(N==null?void 0:N.data)||[],...v];d(g,{data:i,page:f,hasMore:u,loading:!1,error:null,initialized:!0}),_&&j.handleExtra&&j.handleExtra(_)}catch(w){d(g,{loading:!1,error:(w==null?void 0:w.message)||"加载失败"})}},[t,l,d]);n.useEffect(()=>{const g=l.get(a);!(g!=null&&g.initialized)&&!(g!=null&&g.loading)&&x(a,1)},[a,l,x]);const m=n.useCallback(()=>{const g=l.get(a);g&&!g.loading&&g.hasMore&&x(a,g.page+1)},[a,l,x]),b=n.useCallback(()=>{x(a,1)},[a,x]);return{activeTab:a,setActiveTab:r,currentTabState:c,isLoading:c.loading,hasError:!!c.error,error:c.error,data:c.data,hasMore:c.hasMore,loadMore:m,refresh:b,tabs:t}}const il=({onBack:t,onNavigate:s,onProductSelect:a,initialTab:r=0})=>{const{showToast:l,showDialog:o}=he(),[c,d]=n.useState(()=>{try{const y=localStorage.getItem(Ae);return y?JSON.parse(y):null}catch(y){return console.warn("解析本地用户信息失败:",y),null}}),[x,m]=n.useState(0),g=nl([{id:0,name:"专项金明细",fetchData:({page:y,limit:S,token:k})=>Bs({page:y,limit:S,token:k}),parseData:y=>{var k;const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:(((k=S==null?void 0:S.list)==null?void 0:k.length)||0)>=10}}},{id:1,name:"收益明细",fetchData:({page:y,limit:S,token:k})=>Bs({page:y,limit:S,token:k}),parseData:y=>{var k;const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:(((k=S==null?void 0:S.list)==null?void 0:k.length)||0)>=10}}},{id:2,name:"津贴明细",fetchData:({page:y,limit:S,token:k})=>Ss({page:y,limit:S,token:k}),parseData:y=>{const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:(S==null?void 0:S.has_more)||!1}}},{id:3,name:"确权金明细",fetchData:({page:y,limit:S,token:k})=>jn({page:y,limit:S,token:k}),parseData:y=>{var k;const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:(((k=S==null?void 0:S.list)==null?void 0:k.length)||0)>=10&&(S.current_page||1)*10<(S.total||0)}}},{id:4,name:"消费金明细",fetchData:({page:y,limit:S,token:k})=>Zi({limit:S,token:k}),parseData:y=>{const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:!1}}},{id:5,name:"我的藏品",fetchData:({page:y,limit:S,token:k})=>fs({page:y,token:k}),parseData:y=>{var k;const S=re(y);return{list:(S==null?void 0:S.list)||[],hasMore:(((k=S==null?void 0:S.list)==null?void 0:k.length)||0)>=10&&(S==null?void 0:S.has_more)!==!1,extra:{consignment_coupon:S==null?void 0:S.consignment_coupon}}},handleExtra:y=>{typeof y.consignment_coupon=="number"&&m(y.consignment_coupon)}}],r),f=rl(x,()=>{g.refresh()}),h=y=>{const S=y.consignment_status;return typeof S=="number"&&S!==be.NOT_CONSIGNED},j=y=>y.consignment_status===be.SOLD,w=y=>y.consignment_status===be.CONSIGNING||y.consignment_status===be.PENDING,v=y=>y.delivery_status===We.DELIVERED,u=y=>{w(y)||j(y)||h(y)||y.delivery_status===We.NOT_DELIVERED?f.openDelivery(y):y.consignment_status===be.NOT_CONSIGNED?f.openConsignment(y):f.openDelivery(y)},_=["专项金明细","收益明细","津贴明细","确权金明细","消费金明细","我的藏品"];n.useEffect(()=>{(async()=>{const S=localStorage.getItem(ne);if(S)try{const k=localStorage.getItem(Ae);if(k)try{const B=JSON.parse(k);d(B)}catch(B){console.warn("解析本地用户信息失败:",B)}const T=await $e(S),D=re(T);D!=null&&D.userInfo&&(d(D.userInfo),localStorage.setItem(Ae,JSON.stringify(D.userInfo)));const Y=await fs({page:1,limit:1,token:S}),L=re(Y);if(L){const B=L.consignment_coupon??0;m(B)}}catch(k){console.error("加载用户信息失败:",k)}})()},[]);const N=y=>y?new Date(typeof y=="string"?parseInt(y)*1e3:y*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",i=y=>e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:y.remark}),e.jsx("div",{className:"text-xs text-gray-500",children:N(y.create_time)})]}),e.jsxs("div",{className:`text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif] ${y.amount>=0?"text-[#FF6B00]":"text-gray-900"}`,children:[y.amount>=0?"+":"",y.amount.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["余额: ",y.before_balance.toFixed(2)," → ",y.after_balance.toFixed(2)]})]},y.id),F=y=>e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:"提现申请"}),e.jsx("div",{className:"text-xs text-gray-500",children:y.account_type_text})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900 font-[DINAlternate-Bold,Roboto,sans-serif]",children:["-",y.amount]}),e.jsx("div",{className:`text-xs mt-1 ${y.status===1?"text-green-600":y.status===2?"text-red-600":"text-yellow-600"}`,children:y.status_text})]})]}),e.jsx("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsxs("div",{children:["账户: ",y.account_name]}),e.jsxs("div",{className:"mt-1",children:["账号: ",y.account_number]}),e.jsxs("div",{className:"mt-1",children:["创建时间: ",y.create_time_text]}),y.audit_time_text&&e.jsxs("div",{className:"mt-1",children:["审核时间: ",y.audit_time_text]}),y.audit_reason&&e.jsxs("div",{className:"mt-1 text-red-500",children:["审核原因: ",y.audit_reason]})]})})]},y.id),I=y=>e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:y.remark}),e.jsx("div",{className:"text-xs text-gray-500",children:N(y.create_time)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-[#FF6B00] font-[DINAlternate-Bold,Roboto,sans-serif]",children:["+",y.amount.toFixed(2)]})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 pt-2 border-t border-gray-100",children:["服务费余额: ",y.before_service_fee.toFixed(2)," → ",y.after_service_fee.toFixed(2)]})]},y.id),z=y=>{const S=Math.abs(y.amount),k=Math.abs(y.before_value),T=Math.abs(y.after_value);return e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:y.remark||"消费金变动"}),e.jsx("div",{className:"text-xs text-gray-500",children:N(y.create_time)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-lg font-bold font-[DINAlternate-Bold,Roboto,sans-serif] ${y.amount>=0?"text-[#FF6B00]":"text-gray-900"}`,children:[y.amount>=0?"+":"",S.toFixed(0)]})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 pt-2 border-t border-gray-100",children:["消费金余额: ",k.toFixed(0)," → ",T.toFixed(0)]})]},y.id)},p=y=>{const S=y.item_title||y.title||"未命名藏品",k=y.item_image||y.image||"";return e.jsx("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm cursor-pointer active:bg-gray-50 transition-colors",onClick:()=>u(y),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(k)||void 0,alt:S,className:"w-full h-full object-cover",onError:T=>{T.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 flex-1",children:S}),e.jsx(St,{size:16,className:"text-gray-400 ml-2 flex-shrink-0"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["购买时间: ",y.pay_time_text||y.buy_time_text]}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 mb-2",children:["¥ ",y.price]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:y.status_text?e.jsx("div",{className:`text-xs px-2 py-1 rounded-full border ${y.status_text.includes("寄售")||y.status_text.includes("出售")?"bg-blue-50 text-blue-600 border-blue-200":y.status_text.includes("确权")||y.status_text.includes("成功")||y.status_text.includes("已售出")?"bg-green-50 text-green-600 border-green-200":y.status_text.includes("失败")||y.status_text.includes("取消")?"bg-red-50 text-red-600 border-red-200":y.status_text.includes("提货")||y.status_text.includes("待")?"bg-orange-50 text-orange-600 border-orange-200":"bg-gray-50 text-gray-600 border-gray-200"}`,children:y.status_text}):y.consignment_status===be.SOLD?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-green-50 text-green-600 border border-green-200",children:"已售出"}):y.consignment_status===be.CONSIGNING?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:"寄售中"}):y.delivery_status===We.DELIVERED?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-green-50 text-green-600 border border-green-200",children:"✓ 已提货"}):h(y)?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:"待提货"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:"○ 未提货"}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${y.consignment_status===be.NOT_CONSIGNED?"bg-gray-50 text-gray-600 border border-gray-200":y.consignment_status===be.PENDING?"bg-yellow-50 text-yellow-600 border border-yellow-200":y.consignment_status===be.REJECTED?"bg-red-50 text-red-600 border border-red-200":"bg-green-50 text-green-600 border border-green-200"}`,children:y.consignment_status_text||"未寄售"})]})})]})]})},y.id)},P=()=>g.isLoading&&g.data.length===0?e.jsx(ge,{text:"加载中..."}):g.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-red-200 rounded-lg flex items-center justify-center",children:e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:g.error})]}):g.data.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-gray-200 rounded-lg flex items-center justify-center",children:g.activeTab===5?e.jsx(yt,{size:32,className:"opacity-50"}):e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:g.activeTab===5?"暂无藏品":"暂无数据"})]}):e.jsxs("div",{children:[g.activeTab===0&&g.data.map(i),g.activeTab===1&&g.data.map(i),g.activeTab===2&&g.data.map(F),g.activeTab===3&&g.data.map(I),g.activeTab===4&&g.data.map(z),g.activeTab===5&&g.data.map(p),g.hasMore&&e.jsx("button",{onClick:g.loadMore,disabled:g.isLoading,className:"w-full py-2 text-sm text-orange-600 disabled:opacity-50",children:g.isLoading?"加载中...":"加载更多"})]});return e.jsxs(_e,{title:"数字资产总权益",onBack:t,rightAction:e.jsx("button",{onClick:()=>s({name:"asset-history",type:"all",back:{name:"asset-view"}}),className:"text-sm text-orange-600",children:"历史记录"}),padding:!1,children:[e.jsxs("div",{className:"p-3 pb-20",children:[e.jsx(el,{userInfo:c,onNavigate:s}),e.jsx(tl,{onNavigate:s}),e.jsx(sl,{tabs:_,activeTab:g.activeTab,onChange:g.setActiveTab}),P()]}),f.isOpen&&f.context.selectedItem&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4",onClick:f.close,children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full relative",onClick:y=>y.stopPropagation(),children:[e.jsx("button",{type:"button",className:"absolute top-4 right-4 p-1 text-gray-400 hover:text-gray-600",onClick:f.close,children:e.jsx(Ce,{size:20})}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(f.context.selectedItem.image)||void 0,alt:f.context.selectedItem.title,className:"w-full h-full object-cover",onError:y=>{y.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:f.context.selectedItem.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["购买时间: ",f.context.selectedItem.pay_time_text||f.context.selectedItem.buy_time_text]}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 mt-1",children:["¥ ",f.context.selectedItem.price]})]})]}),(()=>{const y=f.context.selectedItem;return w(y)||j(y)||v(y)||h(y)?null:e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg mb-4",children:[e.jsx("button",{onClick:f.switchToDelivery,className:`flex-1 py-2 text-xs rounded-md transition-colors ${f.context.actionType==="delivery"?"bg-white text-orange-600 font-medium shadow-sm":"text-gray-600"}`,children:"权益分割"}),e.jsx("button",{onClick:f.switchToConsignment,className:`flex-1 py-2 text-xs rounded-md transition-colors ${f.context.actionType==="consignment"?"bg-white text-orange-600 font-medium shadow-sm":"text-gray-600"}`,children:"寄售"})]})})(),e.jsx("div",{className:"space-y-3 mb-4",children:f.context.actionType==="delivery"?e.jsx(e.Fragment,{children:f.deliveryCheckResult&&(()=>{const y=f.deliveryCheckResult;return e.jsxs(e.Fragment,{children:[y.isConsigning&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品正在寄售中，无法提货"})]}),!y.isConsigning&&y.hasConsignedSuccessfully&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品已经寄售成功（已售出），无法提货"})]}),!y.isConsigning&&!y.hasConsignedSuccessfully&&y.isDelivered&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品已经提货，无法再次提货"})]}),!y.isConsigning&&!y.hasConsignedSuccessfully&&!y.isDelivered&&(y.can48Hours?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"已满足48小时提货条件"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsxs("span",{children:["还需等待 ",y.hoursLeft," 小时才能提货"]})]})),!y.isConsigning&&!y.hasConsignedSuccessfully&&!y.isDelivered&&y.hasConsignedBefore&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品曾经寄售过，将执行强制提货"})]})]})})()}):e.jsx(e.Fragment,{children:f.consignmentCheckResult&&f.deliveryCheckResult&&(()=>{const y=f.consignmentCheckResult,S=f.deliveryCheckResult;return e.jsxs(e.Fragment,{children:[S.isConsigning&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品正在寄售中，无法再次寄售"})]}),!S.isConsigning&&S.hasConsignedSuccessfully&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600 bg-red-50 px-3 py-2 rounded-lg",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"该藏品已经寄售成功（已售出），无法再次寄售"})]}),!S.isConsigning&&!S.hasConsignedSuccessfully&&(y.unlocked?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"已满足48小时寄售条件"})]}):e.jsxs("div",{className:"bg-orange-50 px-3 py-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600 mb-1",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"距离可寄售时间还有："})]}),y.remainingText?e.jsx("div",{className:"text-sm font-bold text-orange-700 text-center",children:y.remainingText}):f.context.countdown?e.jsxs("div",{className:"text-sm font-bold text-orange-700 text-center",children:[String(f.context.countdown.hours).padStart(2,"0"),":",String(f.context.countdown.minutes).padStart(2,"0"),":",String(f.context.countdown.seconds).padStart(2,"0")]}):y.remainingSeconds!==null?e.jsxs("div",{className:"text-sm font-bold text-orange-700 text-center",children:[Math.floor(y.remainingSeconds/3600),"h ",Math.floor(y.remainingSeconds%3600/60),"m ",y.remainingSeconds%60,"s"]}):e.jsx("div",{className:"text-xs text-orange-600 text-center",children:"计算中..."})]})),!S.isConsigning&&!S.hasConsignedSuccessfully&&e.jsxs("div",{className:"bg-orange-50 px-3 py-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[e.jsx(yt,{size:16}),e.jsx("span",{children:"我的寄售券："})]}),e.jsxs("div",{className:"text-sm font-bold text-orange-700",children:[x," 张"]})]}),x===0&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"您没有寄售券，无法进行寄售"})]})]})})()})}),f.context.error&&e.jsx("div",{className:"text-xs text-red-600 mb-2",children:f.context.error}),e.jsx("button",{onClick:f.handleSubmit,disabled:f.isSubmitting||!f.canSubmit,className:`w-full py-3 rounded-lg text-sm font-medium transition-colors ${!f.isSubmitting&&f.canSubmit?"bg-orange-600 text-white active:bg-orange-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:f.isSubmitting?"提交中...":f.context.actionType==="delivery"?"权益分割":"确认寄售"})]})})]})},ll=({onBack:t})=>{const[s,a]=n.useState(0),[r,l]=n.useState(!1),[o,c]=n.useState(null),[d,x]=n.useState([]),[m,b]=n.useState(1),[g,f]=n.useState(!1),h=["全部","供应链专项金","可调度收益","确权金","消费金"];n.useEffect(()=>{b(1),x([]),f(!1)},[s]),n.useEffect(()=>{j()},[s,m]);const j=async()=>{var z,p,P;const I=localStorage.getItem(ne);if(!I){c("请先登录");return}l(!0),c(null);try{const S={0:"all",1:"balance_available",2:"withdrawable_money",3:"service_fee_balance",4:"score"}[s]||"all";console.log(`[AssetHistory] 当前tab: ${s}, 请求type: ${S}`);const k=await yn({page:m,limit:10,type:S,token:I});console.log("[AssetHistory] API响应:",k);const T=re(k);T?(console.log(`[AssetHistory] 返回${((z=T.list)==null?void 0:z.length)||0}条记录`),(p=T.list)==null||p.slice(0,3).forEach((D,Y)=>{console.log(`[AssetHistory] 记录${Y+1} - type: "${D.type}", amount: ${D.amount}, remark: ${D.remark||D.memo}`)}),x(m===1?T.list||[]:D=>[...D,...T.list||[]]),f((((P=T.list)==null?void 0:P.length)||0)>=10&&(T.current_page||1)*10<(T.total||0))):c(k.msg||"获取明细失败")}catch(y){console.error("[AssetHistory] 加载失败:",y),c((y==null?void 0:y.message)||"加载数据失败")}finally{l(!1)}},w=I=>{a(I)},v=I=>I?new Date(typeof I=="string"?parseInt(I)*1e3:I*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",u=(I,z)=>{if(z==="green_power")return"绿色算力";const p={balance_available:"供应链专项金",withdrawable_money:"可调度收益",service_fee_balance:"确权金",score:"消费金"};return I==="green_power"?"绿色算力":p[I]||I},_=I=>{switch(I){case"balance_available":return e.jsx(Le,{size:20,className:"text-orange-600"});case"withdrawable_money":return e.jsx(tr,{size:20,className:"text-blue-600"});case"service_fee_balance":return e.jsx(Be,{size:20,className:"text-purple-600"});case"score":return e.jsx(ws,{size:20,className:"text-yellow-600"});default:return e.jsx(Le,{size:20,className:"text-gray-600"})}},N=I=>{switch(I){case"balance_available":return"bg-orange-100";case"withdrawable_money":return"bg-blue-100";case"service_fee_balance":return"bg-purple-100";case"score":return"bg-yellow-100";default:return"bg-gray-100"}},i=I=>{const z=I.field_type==="green_power"||I.type==="green_power"||I.remark&&I.remark.includes("绿色算力"),p=I.type==="score",P=p?Math.abs(I.amount):I.amount,y=p?Math.abs(I.before_value):I.before_value,S=p?Math.abs(I.after_value):I.after_value;return e.jsxs("div",{className:"bg-white rounded-xl p-4 mb-3 border border-gray-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${N(I.type)} flex items-center justify-center flex-shrink-0`,children:_(I.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 mb-1 truncate",children:I.remark||u(I.type,I.field_type)}),e.jsx("div",{className:"text-xs text-gray-400",children:v(I.create_time||I.createtime)})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:`text-base font-bold mb-1 font-[DINAlternate-Bold,Roboto,sans-serif] ${I.amount>=0?"text-[#FF6B00]":"text-gray-900"}`,children:[I.amount>=0?"+":"",P.toFixed(p?0:2),z?"算力":p?"":"元"]}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["余额: ",S.toFixed(p?0:2)]})]})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-50 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-400 bg-gray-50 px-2 py-0.5 rounded",children:u(I.type,I.field_type)}),e.jsxs("div",{className:"text-xs text-gray-400",children:[u(I.type,I.field_type),"余额: ",y.toFixed(p?0:2)," → ",S.toFixed(p?0:2)]})]})]},`log-${I.id}`)},F=()=>r&&m===1?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx(dt,{size:32,className:"animate-spin mb-4"}),e.jsx("span",{className:"text-xs",children:"加载中..."})]}):o?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-red-200 rounded-lg flex items-center justify-center",children:e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:o})]}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:"暂无数据"})]}):e.jsxs("div",{children:[d.map(i),g&&e.jsx("button",{onClick:()=>b(I=>I+1),disabled:r,className:"w-full py-2 text-sm text-orange-600 disabled:opacity-50",children:r?"加载中...":"加载更多"})]});return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center sticky top-0 z-10",children:[e.jsx("button",{onClick:t,className:"absolute left-4 p-1",children:e.jsx(Rt,{size:20})}),e.jsx("h1",{className:"text-lg font-bold text-gray-800 w-full text-center",children:"历史记录"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex overflow-x-auto whitespace-nowrap bg-white p-1 rounded-full mb-4 no-scrollbar",children:h.map((I,z)=>e.jsx("button",{onClick:()=>w(z),className:`flex-none px-4 py-2 text-xs rounded-full transition-colors whitespace-nowrap ${z===s?"bg-orange-100 text-orange-600 font-bold":"text-gray-500"}`,children:I},z))}),F()]})]})},ol=({onBack:t,onNavigate:s})=>{const[a,r]=n.useState([]),[l,o]=n.useState(!1),[c,d]=n.useState(1),[x,m]=n.useState(!0),[b,g]=n.useState(void 0),{handleError:f}=Ie({showToast:!0,persist:!1}),h=n.useRef(!1);n.useEffect(()=>{r([]),d(1),m(!0),h.current=!1,j(1,!0,b)},[b]);const j=async(i,F=!1,I)=>{if(!h.current){h.current=!0,o(!0);try{const z=await pa({page:i,limit:20,status:I});if(ee(z)){const p=z.data.data||[],P=z.data.last_page||1,y=i<P;r(S=>F?p:[...S,...p]),m(y),d(i)}else f(z,{toastTitle:"加载失败",customMessage:"获取订单列表失败"})}catch(z){f(z,{toastTitle:"加载失败",customMessage:"网络错误"})}finally{o(!1),h.current=!1}}},w=()=>{!l&&x&&j(c+1,!1,b)},v=i=>{switch(i){case 1:return"text-green-600 bg-green-50 border-green-100";case 2:return"text-red-600 bg-red-50 border-red-100";default:return"text-orange-600 bg-orange-50 border-orange-100"}},u=i=>{switch(i){case 1:return e.jsx(Ge,{size:14});case 2:return e.jsx(Xt,{size:14});default:return e.jsx(ze,{size:14})}},_=i=>i?new Date(i*1e3).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",N=[{label:"全部",value:void 0},{label:"待审核",value:0},{label:"已通过",value:1},{label:"已拒绝",value:2}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white sticky top-0 z-10 shadow-sm border-b border-gray-100",children:[e.jsxs("div",{className:"px-4 py-4 pt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-50 rounded-full text-gray-700 transition-colors",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"充值记录"})]}),e.jsx("div",{className:"flex px-4 border-b border-gray-100 overflow-x-auto hide-scrollbar",children:N.map(i=>e.jsxs("button",{onClick:()=>g(i.value),className:`flex-1 py-3 text-sm font-medium relative whitespace-nowrap transition-colors ${b===i.value?"text-orange-600":"text-gray-500 hover:text-gray-700"}`,children:[i.label,b===i.value&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 bg-orange-500 rounded-full"})]},String(i.value)))})]}),e.jsxs("div",{className:"flex-1 p-4 pb-safe space-y-3",children:[a.map(i=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 cursor-pointer active:bg-gray-50 transition-colors",onClick:()=>s({name:"recharge-order-detail",orderId:String(i.id),back:{name:"recharge-order-list"}}),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["订单号: ",i.order_no]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-lg",children:["¥",i.amount||i.money]}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-[10px]",children:i.payment_type_text||i.payment_type})]})]}),e.jsxs("div",{className:`px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 border ${v(i.status)}`,children:[u(i.status),i.status_text]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 border-t border-gray-50 pt-3 mt-1",children:[e.jsx("span",{children:_(i.createtime||i.create_time||0)}),i.audit_remark&&e.jsxs("span",{className:"flex items-center gap-1 text-red-400 max-w-[60%] truncate",children:[e.jsx(pe,{size:12}),i.audit_remark]})]}),i.payment_screenshot&&e.jsx("div",{className:"mt-3 pt-2 border-t border-dashed border-gray-100",children:e.jsxs("a",{href:i.payment_screenshot,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-orange-500 flex items-center gap-1",children:[e.jsx(Te,{size:12})," 查看凭证"]})})]},i.id)),!l&&a.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(Te,{size:48,className:"mb-4 text-gray-200"}),e.jsxs("p",{className:"text-sm",children:["暂无",b!==void 0?"相关":"","充值记录"]})]}),l&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ge,{})}),!l&&x&&a.length>0&&e.jsx("button",{onClick:w,className:"w-full py-3 text-sm text-gray-500 text-center hover:text-gray-700",children:"点击加载更多"}),!l&&!x&&a.length>0&&e.jsx("div",{className:"text-center py-4 text-xs text-gray-300",children:"- 没有更多了 -"})]})]})},$a=({orderId:t,onBack:s})=>{const{showToast:a}=he(),[r,l]=n.useState(null),[o,c]=n.useState(!0);n.useEffect(()=>{t&&(async()=>{try{const f=await kn(t);ee(f)?l(re(f)):a("error","获取详情失败",f.msg||"请稍后重试")}catch(f){console.error("Fetch recharge detail failed:",f),a("error","加载失败","网络错误，请稍后重试")}finally{c(!1)}})()},[t,a]);const d=g=>{navigator.clipboard.writeText(g).then(()=>{a("success","复制成功")}).catch(()=>{a("error","复制失败")})},x=g=>{const f={0:{text:"待审核",color:"text-orange-600",bgColor:"bg-gradient-to-r from-orange-400 to-orange-500",icon:ze},1:{text:"已通过",color:"text-green-600",bgColor:"bg-gradient-to-r from-green-400 to-green-500",icon:Ge},2:{text:"已拒绝",color:"text-red-600",bgColor:"bg-gradient-to-r from-red-400 to-red-500",icon:Xt}};return f[g]||f[0]};if(o)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(ge,{})});if(!r)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 text-gray-500",children:"订单不存在"});const m=x(r.status),b=m.icon;return e.jsx(xt,{title:"充值订单详情",onBack:s,children:e.jsxs("div",{className:"p-4 space-y-4 pb-safe",children:[e.jsxs("div",{className:`${m.bgColor} rounded-xl p-6 text-white shadow-lg relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full translate-y-1/2 -translate-x-1/4 blur-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(b,{size:28,className:"opacity-90"}),e.jsx("div",{className:"text-2xl font-bold",children:m.text})]}),e.jsxs("div",{className:"text-white/90 text-sm",children:[r.status===0&&"您的充值申请正在审核中，请耐心等待",r.status===1&&"您的充值已到账，感谢您的使用",r.status===2&&r.audit_remark?`拒绝原因：${r.audit_remark}`:"您的充值申请未通过审核"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"充值金额"}),e.jsxs("div",{className:"text-4xl font-bold text-orange-600 font-mono",children:["¥",r.amount]})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-gray-50",children:[e.jsx(Te,{size:16,className:"text-orange-600"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"订单信息"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-600 p-1 rounded-md",children:e.jsx(at,{size:14})}),e.jsx("span",{className:"text-sm text-gray-600",children:"订单号"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-mono text-gray-800",children:r.order_no}),e.jsx("button",{onClick:()=>d(r.order_no),className:"text-orange-600 hover:text-orange-700 active:scale-95 transition-transform",children:e.jsx(nt,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-green-100 text-green-600 p-1 rounded-md",children:e.jsx(Be,{size:14})}),e.jsx("span",{className:"text-sm text-gray-600",children:"支付方式"})]}),e.jsx("span",{className:"text-sm text-gray-800",children:r.payment_type==="online"?"在线支付":r.payment_type_text})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-orange-100 text-orange-600 p-1 rounded-md",children:e.jsx(Lt,{size:14})}),e.jsx("span",{className:"text-sm text-gray-600",children:"订单状态"})]}),e.jsx("span",{className:`text-sm font-bold ${m.color}`,children:r.status_text})]})]}),r.payment_screenshot&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-gray-50",children:[e.jsx(Mt,{size:16,className:"text-orange-600"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"支付凭证"})]}),e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200",children:e.jsx("img",{src:r.payment_screenshot,alt:"支付凭证",className:"w-full h-auto"})})]}),r.status!==0&&r.audit_time>0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-gray-50",children:[e.jsx(Ge,{size:16,className:"text-orange-600"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"审核信息"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"审核时间"}),e.jsx("span",{className:"text-gray-800",children:r.audit_time_text||Pe(r.audit_time)})]}),r.audit_remark&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"审核备注"}),e.jsx("span",{className:"text-gray-800",children:r.audit_remark})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-50 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"创建时间"}),e.jsx("span",{children:r.create_time_text||Pe(r.create_time)})]}),r.update_time>r.create_time&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"更新时间"}),e.jsx("span",{children:Pe(r.update_time)})]})]})]})})},cl=({onBack:t,onNavigate:s,initialAmount:a})=>{const[r,l]=n.useState(a||""),[o,c]=n.useState(null),{showToast:d}=he(),{handleError:x}=Ie({showToast:!0,persist:!1}),[m,b]=n.useState("input"),[g,f]=n.useState(""),[h,j]=n.useState(null),[w,v]=n.useState([]),[u,_]=n.useState(!1),[N,i]=n.useState([]);n.useEffect(()=>{F()},[]);const F=async()=>{_(!0);try{const O=await vn({usage:"recharge"});if(ee(O)){const V=O.data.list||[];v(V);const H=new Map;V.forEach(W=>{H.has(W.type)||H.set(W.type,{id:W.type,name:W.type_text||W.type,icon:W.icon})}),i(Array.from(H.values()))}else x(O,{toastTitle:"加载失败",customMessage:"获取收款账户失败",context:{usage:"recharge"}})}catch(O){x(O,{toastTitle:"加载失败",customMessage:"获取收款账户失败",context:{usage:"recharge"}})}finally{_(!1)}},[I,z]=n.useState(null),[p,P]=n.useState(null),[y,S]=n.useState(!1),k=(O,V)=>{if(!V)return!0;try{const H=V.match(/(\d+)\s*-\s*(\d+)/);if(H){const W=Number(H[1]),A=Number(H[2]);if(!isNaN(W)&&!isNaN(A))return O>=W&&O<=A}}catch(H){console.warn("Failed to parse range:",V,H)}return!0},T=async(O,V)=>{try{const H=await $s({company_account_id:O.id,amount:V,payment_type:o||void 0,payment_method:"online"});if(ee(H)){const{pay_url:W}=H.data||{};W?(d("success","订单创建成功","正在前往支付..."),setTimeout(()=>{window.location.href=W},1e3)):b("matched")}else x(H,{toastTitle:"创建订单失败",customMessage:H.msg||"充值通道维护中",context:{amount:V,accountId:O.id}}),b("input")}catch(H){x(H,{toastTitle:"创建订单失败",customMessage:"网络错误，请重试",context:{amount:V,accountId:O.id}}),b("input")}},D=()=>{const O=Number(r);if(!r||isNaN(O)||O<100){d("warning","输入有误","最低申购金额为 100 元");return}if(!o){d("warning","请选择","请选择支付方式");return}b("matching"),setTimeout(async()=>{const V=w.filter(H=>{const W=H.type===o,A=k(Number(r),H.remark);return W&&A});if(V.length>0){const H=Math.floor(Math.random()*V.length),W=V[H];j(W),await T(W,Number(r))}else d("error","匹配失败","当前金额暂无匹配通道，请调整金额重试"),b("input")},2500)},Y=O=>{var W;const V=(W=O.target.files)==null?void 0:W[0];if(!V)return;if(!["image/jpeg","image/png","image/gif"].includes(V.type)){d("error","格式错误","只支持 JPG、PNG、GIF 格式");return}if(V.size>5*1024*1024){d("error","文件过大","图片大小不能超过 5MB");return}z(V);const H=new FileReader;H.onloadend=()=>{P(H.result)},H.readAsDataURL(V)},L=async()=>{var O,V;if(!I){d("warning","请上传截图","请先上传付款截图");return}if(!h){d("error","系统错误","未找到匹配账户");return}S(!0);try{const H=await $s({company_account_id:h.id,amount:Number(r),payment_screenshot:I,payment_type:o||void 0});ee(H)?(d("success","提交成功",`订单号: ${((O=H.data)==null?void 0:O.order_no)||((V=H.data)==null?void 0:V.order_id)||"已生成"}`),l(""),c(null),z(null),P(null),j(null),b("input"),t()):x(H,{toastTitle:"提交失败",customMessage:"充值订单提交失败，请重试",context:{amount:r,companyAccountId:h==null?void 0:h.id}})}catch(H){x(H,{toastTitle:"提交失败",customMessage:"网络错误，请重试",context:{amount:r,companyAccountId:h==null?void 0:h.id}})}finally{S(!1)}},B=()=>{b("input"),j(null),z(null),P(null)},K=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-b from-orange-100 to-gray-50 px-4 py-5 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-700",children:e.jsx(Ee,{size:20})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"专项金申购通道"})]}),e.jsxs("button",{onClick:()=>b("history"),className:"text-xs font-bold text-orange-600 bg-white/50 px-3 py-1.5 rounded-full border border-orange-100 flex items-center gap-1 hover:bg-white transition-colors",children:[e.jsx(la,{size:14}),"充值记录"]})]}),e.jsxs("div",{className:"bg-white rounded-[24px] p-6 shadow-xl shadow-orange-100/50 mb-4 border border-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Le,{className:"text-orange-500",size:20}),e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"申购金额"})]}),e.jsxs("div",{className:"flex items-end gap-2 border-b-2 border-orange-50 pb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:"¥"}),e.jsx("input",{type:"number",value:r,onChange:O=>l(O.target.value),placeholder:"0.00",className:"flex-1 w-full min-w-0 text-4xl font-bold bg-transparent border-none focus:ring-0 outline-none p-0 placeholder-gray-200"}),r&&e.jsx("button",{onClick:()=>l(""),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(Ce,{size:18})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-4",children:[100,500,1e3,2e3,5e3,1e4].map(O=>e.jsx("button",{onClick:()=>l(String(O)),className:`py-2 rounded-lg text-sm font-bold transition-all ${r===String(O)?"bg-orange-50 text-orange-600 border border-orange-200 shadow-sm":"bg-gray-50 text-gray-500 hover:bg-gray-100 border border-transparent"}`,children:O},O))}),e.jsxs("p",{className:"text-xs text-slate-400 mt-3 flex items-center gap-1",children:[e.jsx(rt,{size:12}),"资金由第三方银行全流程监管"]})]})]}),e.jsxs("div",{className:"px-4 flex-1",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"选择支付通道"]}),u?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ge,{size:"md",className:"text-orange-500"})}):N.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:N.map(O=>e.jsxs("button",{onClick:()=>c(O.id),className:`relative p-4 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center gap-3 ${o===O.id?"bg-orange-50 text-orange-600 border-orange-200 shadow-lg scale-[1.02]":"bg-white border-gray-100 text-gray-600 hover:border-orange-100 hover:shadow-md"}`,children:[e.jsxs("div",{className:"w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-sm relative overflow-hidden",children:[O.icon&&e.jsx("img",{src:O.icon,alt:O.name,className:"w-full h-full object-cover p-2",onError:V=>{var H;V.currentTarget.style.display="none",(H=V.currentTarget.nextElementSibling)==null||H.classList.remove("opacity-0")}}),e.jsx(Be,{size:24,className:`text-orange-500 absolute transition-opacity ${O.icon?"opacity-0":""}`})]}),e.jsx("span",{className:"font-bold text-sm",children:O.name}),o===O.id&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Ge,{size:16,fill:"currentColor"})})]},O.id))}):e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm bg-gray-50 rounded-xl",children:"暂无可用支付通道"})]}),e.jsxs("div",{className:"px-4 py-5 safe-area-bottom bg-white/80 backdrop-blur border-t border-gray-100",children:[e.jsxs("button",{onClick:D,className:"w-full py-4 rounded-xl bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white font-bold text-lg shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform flex items-center justify-center gap-2",children:[e.jsx(ct,{size:20,fill:"currentColor"}),"立即接入匹配 · Match"]}),e.jsx("div",{className:"text-center mt-3 text-[10px] text-gray-400",children:"安全加密通道 | 资金存管保障 | 24H 实时到账"})]})]}),C=()=>e.jsxs("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-br from-gray-900 to-black p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-orange-900/20 via-black to-black"}),e.jsxs("div",{className:"relative z-10 text-center flex flex-col items-center w-full max-w-sm",children:[e.jsxs("div",{className:"relative w-64 h-64 mb-12",children:[e.jsx("div",{className:"absolute inset-0 bg-orange-500/10 rounded-full animate-ping [animation-duration:2s]"}),e.jsx("div",{className:"absolute inset-0 border border-orange-500/20 rounded-full"}),e.jsx("div",{className:"absolute inset-[15%] border border-orange-500/30 rounded-full"}),e.jsx("div",{className:"absolute inset-[30%] border border-orange-500/40 rounded-full"}),e.jsx("div",{className:"absolute inset-[45%] bg-orange-500/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-[50%] h-[2px] bg-gradient-to-r from-transparent via-orange-400 to-orange-500 origin-left animate-[spin_1.5s_linear_infinite] shadow-[0_0_15px_rgba(251,146,60,0.8)]"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(sr,{size:64,className:"text-orange-500 animate-pulse drop-shadow-[0_0_10px_rgba(251,146,60,0.8)]"})}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-1 h-1 bg-orange-400 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/3 right-1/4 w-1.5 h-1.5 bg-orange-300 rounded-full animate-pulse [animation-delay:0.5s]"})]}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3 tracking-wide",children:"正在接入区域结算..."}),e.jsx("p",{className:"text-sm text-gray-400 border border-gray-800 bg-gray-900/50 px-4 py-2 rounded-full backdrop-blur-sm",children:"智能匹配最优资金通道 (权重优先)"})]})]}),E=()=>h&&e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-[#FF6B35] px-4 py-5 pt-8 text-white relative overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:B,className:"w-8 h-8 flex items-center justify-center bg-white/20 rounded-full text-white hover:bg-white/30 transition-colors backdrop-blur-sm",children:e.jsx(Ee,{size:20})}),e.jsx("h1",{className:"text-xl font-bold",children:"通道接入成功"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center text-[#FF6B35] shadow-lg mb-3 animate-in zoom-in duration-300",children:e.jsx(Ge,{size:32})}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:"已分配专属专员"}),e.jsx("p",{className:"text-sm text-white/90 bg-white/10 px-3 py-1 rounded-full backdrop-blur-sm",children:"请在 15 分钟内完成转账"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 -mt-4 rounded-t-3xl relative z-20 px-4 pt-6 pb-safe",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Service Specialist"}),e.jsxs("span",{className:"px-2.5 py-1 bg-orange-100 text-orange-700 text-[10px] font-bold rounded-md flex items-center gap-1",children:[e.jsx(rt,{size:10}),"已缴保证金"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-xl shadow-orange-100/20 border border-gray-100 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-5 pb-5 border-b border-gray-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#FF6B35] to-[#FF9F2E] text-white flex items-center justify-center text-lg font-bold shadow-md shadow-orange-200",children:h.account_name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-lg",children:h.account_name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["金牌承兑服务商 (UID: ",h.id,")"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl border border-gray-100/50",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"收款账号"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900 font-mono tracking-wide",children:h.account_number}),e.jsx("button",{className:"text-[10px] bg-white border border-gray-200 px-2 py-1 rounded text-gray-600 active:bg-gray-50",onClick:()=>{navigator.clipboard.writeText(h.account_number),d("success","复制成功","账号已复制到剪贴板")},children:"复制"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl border border-gray-100/50",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"开户银行"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:h.bank_name||"支付平台"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl border border-gray-100/50",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"收款姓名"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 block truncate",children:h.account_name})]})]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl flex items-start gap-3 mb-6 border border-red-100",children:[e.jsx(us,{size:18,className:"text-red-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-red-600 leading-relaxed",children:["您正在委托授权服务商办理专项金划拨业务，请务必使用本人账户转账，",e.jsx("span",{className:"font-bold underline Decoration-red-500 decoration-2 underline-offset-2",children:"备注您的UID"}),"，否则将无法自动到账。"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"text-sm font-bold text-gray-900 mb-3 block flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"上传付款截图"]}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/gif",onChange:Y,className:"hidden",id:"payment-screenshot"}),p?e.jsxs("div",{className:"relative group rounded-2xl overflow-hidden shadow-lg shadow-gray-200",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/5 -z-10"}),e.jsx("img",{src:p,alt:"付款截图",className:"w-full h-auto max-h-[400px] object-contain bg-gray-900"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-3 bg-gradient-to-b from-black/50 to-transparent flex justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>{z(null),P(null)},className:"w-8 h-8 bg-red-500/80 text-white rounded-full flex items-center justify-center hover:bg-red-600 backdrop-blur-sm transition-colors",children:e.jsx(Ce,{size:16})})}),e.jsxs("label",{htmlFor:"payment-screenshot",className:"absolute bottom-4 right-4 px-4 py-2 bg-white/90 backdrop-blur text-xs font-bold text-gray-800 rounded-full cursor-pointer hover:bg-white transition-all shadow-lg border border-gray-100 flex items-center gap-2",children:[e.jsx(Mt,{size:14}),"重新上传"]})]}):e.jsxs("label",{htmlFor:"payment-screenshot",className:"flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-2xl cursor-pointer hover:border-orange-500 hover:bg-orange-50/30 transition-all group bg-white",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-50 flex items-center justify-center mb-3 group-hover:bg-orange-100 transition-colors",children:e.jsx(ar,{size:24,className:"text-gray-400 group-hover:text-orange-500 transition-colors"})}),e.jsx("span",{className:"text-sm font-medium text-gray-600 group-hover:text-orange-600",children:"点击上传付款截图"}),e.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"支持 JPG/PNG/GIF，最大5MB"})]})]}),e.jsx("button",{onClick:L,disabled:!I||y,className:`w-full py-4 rounded-xl font-bold text-base transition-all shadow-lg flex items-center justify-center gap-2 mb-4 ${I&&!y?"bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white shadow-orange-200 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-5 h-5 border-white/20 border-t-white"}),"提交处理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:18,fill:"currentColor"}),"提交充值订单"]})}),e.jsx("button",{onClick:B,className:"w-full py-3 rounded-xl bg-white text-gray-500 font-medium text-sm border border-gray-200 hover:bg-gray-50 transition-colors",children:"取消并返回"})]})]}),R=O=>{O.name==="recharge-order-detail"&&O.orderId?(f(O.orderId),b("detail")):s&&s(O)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-900",children:[m==="input"&&K(),m==="matching"&&C(),m==="matched"&&E(),m==="history"&&e.jsx(ol,{onBack:()=>b("input"),onNavigate:R}),m==="detail"&&e.jsx($a,{orderId:g,onBack:()=>b("history")})]})},dl=({onBack:t,onNavigate:s})=>{var C;const{showToast:a}=he(),{handleError:r}=Ie({showToast:!0,persist:!1}),{errorMessage:l,hasError:o,handleError:c,clearError:d}=Ie(),[x,m]=n.useState([]),[b,g]=n.useState(!1),[f,h]=n.useState(null),[j,w]=n.useState(!1),[v,u]=n.useState(!1),[_,N]=n.useState(""),[i,F]=n.useState(""),[I,z]=n.useState(""),[p,P]=n.useState(!1),[y,S]=n.useState("0.00"),[k,T]=n.useState(!1),D=.01;_&&(parseFloat(_)*D).toFixed(2),n.useEffect(()=>{Y(),L()},[]);const Y=async()=>{var R;const E=ce();if(E){g(!0);try{const O=await rs(E);if(ee(O)&&((R=O.data)!=null&&R.list)){m(O.data.list||[]);const V=O.data.list.find(H=>Number(H.is_default)===1);V&&h(V)}else r(O,{toastTitle:"加载失败",customMessage:"获取提现账户失败",context:{page:"BalanceWithdraw"}})}catch(O){r(O,{toastTitle:"加载失败",customMessage:"获取提现账户失败",context:{page:"BalanceWithdraw"}})}finally{g(!1)}}},L=async()=>{var R;const E=ce();if(E){T(!0);try{const O=await $e(E);if(ee(O)&&((R=O.data)!=null&&R.userInfo)){const V=O.data.userInfo;S(parseFloat(V.withdrawable_money||"0").toFixed(2))}else r(O,{toastTitle:"加载失败",customMessage:"获取余额失败",context:{page:"BalanceWithdraw"}})}catch(O){r(O,{toastTitle:"加载失败",customMessage:"获取余额失败",context:{page:"BalanceWithdraw"}})}finally{T(!1)}}},B=()=>{if(!_||parseFloat(_)<=0)return c("请输入有效的提现金额",{persist:!0,showToast:!1});if(parseFloat(_)>parseFloat(y))return c("提现金额不能超过可提现余额",{persist:!0,showToast:!1});if(!f)return c("请选择提现账户",{persist:!0,showToast:!1});d(),u(!0)},K=async()=>{if(!i)return c("请输入支付密码",{persist:!0,showToast:!1});if(!/^\d{6}$/.test(i))return c("支付密码必须为6位数字",{persist:!0,showToast:!1});P(!0),d();try{const E=await ba({amount:parseFloat(_),payment_account_id:f.id,pay_password:i,remark:I});ee(E)?(a("success","提交成功",E.msg||"提现申请提交成功"),N(""),F(""),h(null),u(!1),L()):c(E,{persist:!0,showToast:!1,customMessage:"提现申请提交失败",context:{amount:_,accountId:f==null?void 0:f.id}})}catch(E){c(E,{persist:!0,showToast:!1,customMessage:"提现申请提交失败",context:{amount:_,accountId:f==null?void 0:f.id}})}finally{P(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-900 pb-safe",children:[e.jsxs("div",{className:"bg-gradient-to-b from-orange-100 to-gray-50 p-5 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-700",children:e.jsx(Ee,{size:20})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"收益提现"})]}),e.jsxs("button",{onClick:()=>s==null?void 0:s({name:"withdraw-order-list"}),className:"text-xs font-bold text-orange-600 bg-white/50 px-3 py-1.5 rounded-full border border-orange-100 flex items-center gap-1 hover:bg-white transition-colors",children:[e.jsx(la,{size:14}),"提现记录"]})]}),e.jsxs("div",{className:"bg-white rounded-[24px] p-6 shadow-xl shadow-orange-100/50 mb-6 border border-orange-50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-50 rounded-bl-[100px] -z-0 opacity-50"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-400 tracking-wide flex items-center gap-2",children:[e.jsx(Le,{size:14}),"提现金额"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["可提现: ",k?"...":y]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 border-b-2 border-orange-50 pb-2 focus-within:border-orange-500 transition-colors",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:"¥"}),e.jsx("input",{type:"number",value:_,onChange:E=>{const R=E.target.value;parseFloat(R)>parseFloat(y)?N(y):N(R),setSubmitError(null)},placeholder:"0.00",className:"flex-1 text-4xl font-black text-gray-900 bg-transparent outline-none placeholder:text-gray-200 font-[DINAlternate-Bold]"}),e.jsx("button",{onClick:()=>N(y),className:"text-xs font-bold text-orange-600 px-2 py-1 bg-orange-50 rounded-md",children:"全部"})]}),e.jsxs("div",{className:"mt-4 flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"预计到账"}),e.jsxs("span",{className:"text-gray-900 font-bold",children:["¥ ",_?(parseFloat(_)*(1-D)).toFixed(2):"0.00"]})]})]})]})]}),e.jsxs("div",{className:"px-5 flex-1 space-y-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"收款账户"]}),e.jsxs("div",{onClick:()=>w(!0),className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex items-center justify-between active:scale-[0.99] transition-transform cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${f?"bg-orange-50 text-orange-600":"bg-gray-100 text-gray-400"}`,children:e.jsx(Be,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:f?f.account_name||"已选账户":"选择收款账户"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:f?`${f.type_text} (${((C=f.account)==null?void 0:C.slice(-4))||"****"})`:"点击选择绑定的银行卡/支付宝"})]})]}),e.jsx(qe,{size:18,className:"text-gray-300"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 w-16",children:"备注"}),e.jsx("input",{type:"text",value:I,onChange:E=>z(E.target.value),placeholder:"请输入提现备注 (选填)",className:"flex-1 text-sm text-gray-900 outline-none placeholder:text-gray-400"})]}),o&&e.jsxs("div",{className:"bg-red-50 p-3 rounded-xl flex items-start gap-2",children:[e.jsx(pe,{size:16,className:"text-red-500 shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:l})]})]}),e.jsxs("div",{className:"p-5 safe-area-bottom bg-white/80 backdrop-blur border-t border-gray-100",children:[e.jsx("button",{onClick:B,className:"w-full py-4 rounded-xl bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white font-bold text-lg shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",disabled:p,children:p?"处理中...":"确认提现资金"}),e.jsx("div",{className:"text-center mt-3 text-[10px] text-gray-400",children:"资金提现 T+1 到账 | 每日限额 ¥50,000"})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end justify-center animate-in fade-in",onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-[32px] p-6 pb-safe animate-in slide-in-from-bottom duration-300",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"选择收款账户"}),e.jsx("button",{onClick:()=>w(!1),className:"p-2 bg-gray-100 rounded-full text-gray-500",children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:[x.map(E=>e.jsxs("div",{onClick:()=>{h(E),w(!1)},className:`p-4 rounded-xl border flex items-center gap-4 transition-all ${(f==null?void 0:f.id)===E.id?"border-orange-500 bg-orange-50/50 shadow-sm":"border-gray-100 bg-white"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-bold text-xs",children:E.type==="alipay"?"支":E.type==="wechat"?"微":"银"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[E.account_name,E.is_default===1&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded",children:"默认"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[E.type_text," • ",E.account]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${(f==null?void 0:f.id)===E.id?"border-orange-500 bg-orange-500":"border-gray-300"}`,children:(f==null?void 0:f.id)===E.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]},E.id)),e.jsx("button",{onClick:()=>{w(!1),s==null||s("card-management")},className:"w-full py-3 rounded-xl border border-dashed border-gray-300 text-gray-500 text-sm font-medium hover:bg-gray-50 flex items-center justify-center gap-2",children:"+ 添加新账户"})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in",onClick:()=>u(!1),children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[24px] p-6 shadow-2xl animate-in zoom-in-95 duration-200",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"安全验证"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"请输入支付密码以确认操作"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"本次提现金额"}),e.jsxs("div",{className:"text-2xl font-black text-gray-900 font-[DINAlternate-Bold]",children:["¥ ",_]})]}),e.jsx("input",{type:"password",autoFocus:!0,value:i,onChange:E=>{F(E.target.value),setSubmitError(null)},className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-center text-lg tracking-[8px] font-bold outline-none focus:border-orange-500 focus:bg-white transition-all mb-4",placeholder:"••••••",maxLength:6}),o&&e.jsx("div",{className:"text-xs text-center text-red-500 mb-4",children:l}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold text-sm",children:"取消"}),e.jsx("button",{onClick:K,className:"flex-1 py-3 rounded-xl bg-gray-900 text-white font-bold text-sm shadow-lg shadow-gray-200",children:"确认提交"})]})]})})]})},xl=({onBack:t})=>{const[s,a]=n.useState(null),[r,l]=n.useState("money"),[o,c]=n.useState(""),[d,x]=n.useState(!1),[m,b]=n.useState(null),[g,f]=n.useState(null),[h,j]=n.useState(!1);n.useEffect(()=>{w()},[]);const w=async()=>{var N;const _=localStorage.getItem(ne);if(_)try{const i=await $e(_);ee(i)&&((N=i.data)!=null&&N.userInfo)&&(a(i.data.userInfo),localStorage.setItem(Ae,JSON.stringify(i.data.userInfo)))}catch(i){console.error(i)}},v=async()=>{const _=localStorage.getItem(ne);if(_){x(!0);try{const N=await Nn({amount:Number(o),source:r==="withdraw"?"withdrawable_money":"balance_available",token:_});ee(N)?(f("划转成功"),c(""),j(!1),w(),setTimeout(()=>{f(null),t()},1e3)):(b(oe(N,"划转失败")),j(!1))}catch(N){b((N==null?void 0:N.message)||"划转失败"),j(!1)}finally{x(!1)}}},u=Number(r==="money"?(s==null?void 0:s.money)||0:(s==null?void 0:s.withdrawable_money)||0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-900 pb-safe",children:[e.jsxs("div",{className:"bg-gradient-to-b from-orange-100 to-gray-50 p-5 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-700",children:e.jsx(Ee,{size:20})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"确权金划转"}),e.jsxs("div",{className:"ml-auto text-xs text-orange-600 font-medium bg-white/50 px-3 py-1 rounded-full backdrop-blur-sm border border-orange-100/50 flex items-center gap-1",children:[e.jsx(ot,{size:12,fill:"currentColor",className:"text-orange-500"}),"安全存管中"]})]}),e.jsxs("div",{className:"bg-white rounded-[24px] p-6 shadow-xl shadow-orange-100/50 mb-6 border border-orange-50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-50 rounded-bl-[100px] -z-0 opacity-50"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-400 tracking-wide flex items-center gap-2",children:[e.jsx(Be,{size:14}),"划转金额"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["服务费余额: ",e.jsx("span",{className:"text-gray-900 font-bold",children:we(s==null?void 0:s.service_fee_balance)})]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 border-b-2 border-orange-50 pb-2 focus-within:border-orange-500 transition-colors",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:"¥"}),e.jsx("input",{type:"number",value:o,onChange:_=>{c(_.target.value),b(null)},placeholder:"0.00",className:"flex-1 text-4xl font-black text-gray-900 bg-transparent outline-none placeholder:text-gray-200 font-[DINAlternate-Bold]"})]}),m&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:m})]})]})]}),e.jsxs("div",{className:"px-5 flex-1 space-y-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"划转来源"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{onClick:()=>l("money"),className:`p-4 rounded-xl border flex items-center justify-between cursor-pointer transition-all ${r==="money"?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-gray-100 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${r==="money"?"bg-orange-100 text-orange-600":"bg-gray-100 text-gray-400"}`,children:e.jsx(Le,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"专项金支付"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["可用: ¥ ",we(s==null?void 0:s.money)]})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r==="money"?"border-orange-500 bg-orange-500":"border-gray-300"}`,children:r==="money"&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]}),e.jsxs("div",{onClick:()=>l("withdraw"),className:`p-4 rounded-xl border flex items-center justify-between cursor-pointer transition-all ${r==="withdraw"?"bg-orange-50 border-orange-500 shadow-sm":"bg-white border-gray-100 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${r==="withdraw"?"bg-orange-100 text-orange-600":"bg-gray-100 text-gray-400"}`,children:e.jsx(Be,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"提现余额支付"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["可用: ¥ ",we(s==null?void 0:s.withdrawable_money)]})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r==="withdraw"?"border-orange-500 bg-orange-500":"border-gray-300"}`,children:r==="withdraw"&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-xl flex items-start gap-2",children:[e.jsx(pe,{size:16,className:"text-orange-500 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-orange-600 leading-tight",children:"服务费仅用于订单寄售时使用，无法提现和转出，请按需充值。"})]})]}),e.jsx("div",{className:"p-5 safe-area-bottom bg-white/80 backdrop-blur border-t border-gray-100",children:e.jsx("button",{onClick:()=>{const _=Number(o);if(!o||_<=0){b("请输入有效金额");return}if(_>u){b("余额不足");return}j(!0)},className:"w-full py-4 rounded-xl bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white font-bold text-lg shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform flex items-center justify-center gap-2",disabled:d,children:d?"处理中...":"确认划转"})}),h&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in",onClick:()=>j(!1),children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[24px] p-6 shadow-2xl animate-in zoom-in-95 duration-200",onClick:_=>_.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2 text-center",children:"确认划转"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"划转金额"}),e.jsxs("div",{className:"text-2xl font-black text-gray-900 font-[DINAlternate-Bold]",children:["¥ ",o]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold text-sm",children:"取消"}),e.jsx("button",{onClick:v,className:"flex-1 py-3 rounded-xl bg-orange-600 text-white font-bold text-sm shadow-lg shadow-orange-200",disabled:d,children:d?e.jsx(dt,{className:"animate-spin mx-auto",size:20}):"确定"})]})]})})]})},ml=({onBack:t,onNavigate:s})=>{var Y;const{showToast:a}=he(),{handleError:r}=Ie({showToast:!0,persist:!1}),{hasError:l,handleError:o,clearError:c}=Ie(),[d,x]=n.useState(()=>{try{const L=localStorage.getItem(Ae);return L?JSON.parse(L):null}catch(L){return console.warn("解析本地用户信息失败:",L),null}}),[m,b]=n.useState([]),[g,f]=n.useState(null),[h,j]=n.useState(!1),[w,v]=n.useState(!1),[u,_]=n.useState(""),[N,i]=n.useState(""),[F,I]=n.useState(""),[z,p]=n.useState(!1),[P,y]=n.useState(!1),S=(d==null?void 0:d.static_income)||"0";n.useEffect(()=>{(async()=>{var K;const B=ce();if(B)try{const C=await $e(B);ee(C)&&((K=C.data)!=null&&K.userInfo)&&(x(C.data.userInfo),localStorage.setItem("cat_user_info",JSON.stringify(C.data.userInfo)))}catch(C){console.error("获取用户信息失败:",C)}})()},[]),n.useEffect(()=>{(async()=>{var K;const B=ce();if(B){p(!0);try{const C=await rs(B);if(ee(C)&&((K=C.data)!=null&&K.list)){if(b(C.data.list||[]),C.data.list.length>0){const E=C.data.list.find(R=>Number(R.is_default)===1);f(E||C.data.list[0])}}else r(C,{toastTitle:"加载失败",customMessage:"获取收款账户信息失败"})}catch(C){r(C,{toastTitle:"加载失败",customMessage:"获取收款账户信息失败"})}finally{p(!1)}}})()},[]);const k=()=>{const L=parseFloat(S);L>0&&(_(L.toFixed(2)),c())},T=()=>{const L=Number(u);if(!u||L<=0)return o("请输入有效的提现金额",{persist:!0,showToast:!1});const B=Number(S);if(L>B)return o("提现金额不能超过可提现拓展服务费",{persist:!0,showToast:!1});if(!g||!g.id)return o("请选择收款账户",{persist:!0,showToast:!1});c(),v(!0)},D=async()=>{var B;if(!N)return o("请输入支付密码",{persist:!0,showToast:!1});if(!/^\d{6}$/.test(N))return o("支付密码必须为6位数字",{persist:!0,showToast:!1});y(!0),c();const L=localStorage.getItem(ne);if(!L){o("未找到用户登录信息，请先登录",{persist:!0,showToast:!1}),y(!1);return}try{const K=await wn({amount:Number(u),payment_account_id:Number(g.id),pay_password:N,remark:F||void 0,token:L});if(ee(K)){a("success","提交成功",K.msg||"提现申请已提交，请等待审核"),_(""),i(""),I(""),v(!1);const C=await $e(L);ee(C)&&((B=C.data)!=null&&B.userInfo)&&(x(C.data.userInfo),localStorage.setItem(Ae,JSON.stringify(C.data.userInfo)))}else o(K,{persist:!0,showToast:!1,customMessage:"提交提现申请失败",context:{amount:u,accountId:g==null?void 0:g.id}})}catch(K){o(K,{persist:!0,showToast:!1,customMessage:"提交提现申请失败，请稍后重试",context:{amount:u,accountId:g==null?void 0:g.id}})}finally{y(!1)}};return e.jsxs(_e,{title:"拓展提现",onBack:t,children:[e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm flex justify-between items-center cursor-pointer active:bg-gray-50",onClick:()=>j(!0),children:[e.jsx("span",{className:"text-base text-gray-800",children:g?`${g.account_name||g.type_text||"账户"} - ${((Y=g.account)==null?void 0:Y.slice(-4))||""}`:"选择收款账户"}),e.jsx(qe,{size:20,className:"text-gray-400"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2 mb-4",children:e.jsx("span",{className:"text-base text-gray-800 font-medium",children:"提现金额"})}),e.jsxs("div",{className:"flex items-center border-b border-gray-100 pb-4",children:[e.jsx("span",{className:"text-3xl text-gray-800 mr-2",children:"¥"}),e.jsx("input",{type:"number",placeholder:"",className:"flex-1 bg-transparent outline-none text-3xl text-gray-900",value:u,onChange:L=>{const B=L.target.value;if(B===""){_(""),setSubmitError(null);return}if(!isNaN(parseFloat(B))&&parseFloat(B)>=0){const K=parseFloat(B),C=parseFloat(S);K>C?_(S):_(B),setSubmitError(null)}}}),e.jsx("button",{onClick:k,className:"ml-2 text-sm text-orange-600 font-medium whitespace-nowrap",children:"全部提现"})]}),e.jsxs("div",{className:"mt-3 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"可提现拓展服务费 "}),e.jsxs("span",{className:"text-gray-800",children:["¥ ",we(S)]})]})]}),l&&e.jsx("div",{className:"text-xs text-red-500 bg-red-50 px-3 py-2 rounded",children:submitErrorMessage}),e.jsx("div",{className:"px-1",children:e.jsx("p",{className:"text-xs text-gray-400 leading-relaxed",children:"拓展收益按平台规则结算后方可申请提现，具体结算周期以公告为准。为保障资金安全，平台可能会对部分高频或大额提现订单进行人工核实。"})}),e.jsx("button",{onClick:T,disabled:P,className:"w-full bg-orange-600 text-white rounded-full py-3.5 text-base font-medium active:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:P?"提交中...":"提现"})]}),h&&e.jsx("div",{className:"fixed inset-0 z-20 bg-black/70 flex items-end justify-center",onClick:()=>j(!1),children:e.jsxs("div",{className:"bg-white rounded-t-2xl w-full max-h-[70vh] overflow-y-auto",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"选择收款账户"}),e.jsx("button",{onClick:()=>j(!1),children:e.jsx(Ce,{size:20,className:"text-gray-400"})})]}),z&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"加载中..."}),!z&&m.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"暂无绑定的收款账户"}),s&&e.jsx("button",{className:"text-sm text-orange-600 bg-orange-50 px-4 py-2 rounded-lg",onClick:()=>{j(!1),s("card-management")},children:"去添加收款账户"})]}),!z&&m.length>0&&e.jsxs("div",{className:"p-4 space-y-3",children:[m.map(L=>{const B=(g==null?void 0:g.id)===L.id;return e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-colors ${B?"border-orange-500 bg-orange-50":"border-gray-100 bg-gray-50"}`,onClick:()=>{f(L),j(!1)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:L.account_name||L.type_text}),e.jsx("span",{className:"text-xs text-orange-600",children:L.type_text})]}),e.jsx("div",{className:"text-xs text-gray-600",children:L.account})]},L.id)}),s&&e.jsx("button",{className:"w-full text-center text-sm text-orange-600 py-2",onClick:()=>{j(!1),s("card-management")},children:"管理账户"})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 z-20 bg-black/70 flex items-center justify-center p-4",onClick:()=>{v(!1),i("")},children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("span",{className:"font-bold text-lg text-gray-900",children:"输入支付密码"}),e.jsx("button",{onClick:()=>{v(!1),i("")},children:e.jsx(Ce,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"提现金额"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["¥ ",u]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"备注 (可选)"}),e.jsx("input",{type:"text",placeholder:"请输入备注信息",value:F,onChange:L=>I(L.target.value),className:"w-full border rounded-lg px-3 py-2 bg-gray-50 text-base outline-none focus:border-orange-500"})]}),e.jsx("input",{type:"password",placeholder:"请输入支付密码",className:"w-full border border-gray-200 rounded-lg px-4 py-3 text-base outline-none focus:border-orange-500 mb-4",value:N,onChange:L=>{i(L.target.value),setSubmitError(null)},autoFocus:!0}),l&&e.jsx("div",{className:"text-xs text-red-500 bg-red-50 px-3 py-2 rounded mb-4",children:submitErrorMessage}),e.jsx("button",{className:`w-full rounded-lg py-3 text-base font-medium ${P?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-orange-500 text-white active:bg-orange-600"}`,onClick:D,disabled:P,children:P?"提交中...":"确认提现"})]})})]})},ul=({onBack:t,onNavigate:s})=>{const{showToast:a}=he(),[r,l]=n.useState(null),[o,c]=n.useState(""),[d,x]=n.useState(!1),[m,b]=n.useState(!1),g=5,f=2;n.useEffect(()=>{h()},[]);const h=async()=>{const v=localStorage.getItem(ne);if(v)try{const u=await $e(v),_=re(u);_!=null&&_.userInfo&&(l(_.userInfo),localStorage.setItem(Ae,JSON.stringify(_.userInfo)))}catch(u){console.error(u)}},j=()=>{const v=Number(o);return isNaN(v)||v<0?0:v*f},w=async()=>{if(!o||Number(o)<=0){a("warning","输入有误","请输入兑换数量");return}const v=j();if(r&&r.score<v){a("warning","余额不足",`消费金不足，当前余额: ${r.score}`);return}try{b(!0);const u=await mn({score:v}),_=re(u);_?(a("success","兑换成功",`消耗 ${_.score_consumed} 消费金，获得 ${_.green_power_gained} 绿色算力`),r&&l({...r,score:_.after_score,green_power:_.after_green_power}),c("")):a("error","兑换失败",oe(u,"未知错误"))}catch(u){a("error","兑换异常",u.message||"网络请求失败")}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col font-sans text-gray-900 pb-safe",children:[e.jsxs("div",{className:"bg-gradient-to-b from-orange-100 to-gray-50 p-5 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-700",children:e.jsx(Ee,{size:20})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"算力补充"}),e.jsxs("div",{className:"ml-auto text-xs text-green-600 font-medium bg-white/50 px-3 py-1 rounded-full backdrop-blur-sm border border-green-100/50 flex items-center gap-1",children:[e.jsx(rt,{size:12,fill:"currentColor"}),"绿色金融补贴"]})]}),e.jsxs("div",{className:"bg-white rounded-[24px] p-6 shadow-xl shadow-green-100/30 mb-6 border border-green-50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-green-50 rounded-bl-[100px] -z-0 opacity-50"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-400 tracking-wide flex items-center gap-2",children:[e.jsx(rr,{size:14}),"补充额度 (GH/s)"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["当前持有: ",e.jsx("span",{className:"text-green-600 font-bold",children:(r==null?void 0:r.green_power)||0})," GHs"]})]}),e.jsxs("div",{className:"border-b-2 border-green-50 pb-3 focus-within:border-green-500 transition-colors",children:[e.jsx("div",{className:"flex items-baseline gap-2 mb-3",children:e.jsx("input",{type:"number",value:o,onChange:v=>c(v.target.value),placeholder:"0",className:"flex-1 text-4xl font-black text-gray-900 bg-transparent outline-none placeholder:text-gray-200 font-[DINAlternate-Bold]"})}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("div",{className:"text-base font-bold text-green-700 bg-green-100 px-4 py-2 rounded-lg whitespace-nowrap border border-green-200 shadow-sm",children:["1 GHs = ",f," 消费金"]})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-4",children:[10,50,100,500].map(v=>e.jsxs("button",{onClick:()=>c(String(v)),className:"py-1.5 rounded-lg bg-gray-50 hover:bg-green-50 text-xs font-bold text-gray-500 hover:text-green-600 border border-transparent hover:border-green-200 transition-all",children:["+",v]},v))})]})]})]}),e.jsxs("div",{className:"px-5 flex-1 space-y-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-green-500 rounded-full"}),"兑换详情"]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"标准算力成本"}),e.jsxs("span",{className:"text-sm font-medium text-gray-400 line-through",children:[g," 消费金 / GHs"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"当前补贴价"}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[f," 消费金 / GHs"]})]}),e.jsx("div",{className:"w-full h-px bg-gray-50"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-900 font-bold",children:"预计消耗"}),e.jsxs("span",{className:"text-lg font-bold text-orange-500 font-[DINAlternate-Bold]",children:[j()," ",e.jsx("span",{className:"text-xs text-gray-400 font-normal",children:"消费金"})]})]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-xl flex items-start gap-2",children:[e.jsx(nr,{size:16,className:"text-orange-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-orange-600 leading-tight",children:["您的当前消费金余额为 ",e.jsx("span",{className:"font-bold",children:(r==null?void 0:r.score)||0}),"。算力补充后即时生效，可提升您的每日产出效率。"]})]})]}),e.jsx("div",{className:"p-5 safe-area-bottom bg-white/80 backdrop-blur border-t border-gray-100",children:e.jsx("button",{onClick:w,disabled:m||(r?r.score<j():!0),className:`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-transform active:scale-[0.98]
                        ${m||r&&r.score<j()?"bg-gray-200 text-gray-400 shadow-none cursor-not-allowed":"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-green-200"}`,children:m?e.jsx(ge,{size:"sm",color:"white"}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:20,fill:"currentColor"})," 确认兑换"]})})})]})},gl=({onBack:t})=>{const[s,a]=n.useState(!0),[r,l]=n.useState(null),[o,c]=n.useState([]),[d,x]=n.useState(0);return n.useEffect(()=>{(async()=>{const b=localStorage.getItem(ne);if(!b){l("请先登录"),a(!1);return}a(!0),l(null);try{const g=await bs({page:1,limit:50,status:1,token:b});ee(g)&&g.data?(c(g.data.list||[]),x(g.data.total||0)):l(oe(g,"获取寄售券信息失败"))}catch(g){console.error("Failed to load consignment coupons:",g),l((g==null?void 0:g.message)||"获取寄售券信息失败")}finally{a(!1)}})()},[]),e.jsxs(_e,{title:"寄售券",onBack:t,children:[s&&e.jsx(ge,{text:"加载中..."}),!s&&r&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-red-200 rounded-lg flex items-center justify-center",children:e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:r})]}),!s&&!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl p-6 text-white shadow-lg mb-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(at,{size:24}),e.jsx("div",{className:"text-sm opacity-90",children:"我的寄售券"})]}),e.jsx("div",{className:"text-4xl font-bold mb-2",children:d}),e.jsx("div",{className:"text-sm opacity-80",children:"当前可用张数"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-6",children:[e.jsx("div",{className:"text-sm font-bold text-gray-800 mb-3 border-l-4 border-orange-300 pl-2",children:"使用说明"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsxs("div",{children:["寄售券绑定到",e.jsx("span",{className:"font-medium text-orange-600",children:"场次+价格区间"}),"，需匹配对应场次才能使用"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"可用于同一区间或相邻区间寄售（允许跨一个区间）"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsxs("div",{children:["寄售券有效期为",e.jsx("span",{className:"font-medium text-orange-600",children:"30天"}),"，过期自动失效"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"交易用户每次购买藏品都会获得一张寄售券"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"普通用户首次升级为交易用户时赠送一张寄售券"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"寄售时系统自动匹配可用寄售券，优先使用快过期的"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm font-bold text-gray-800 mb-4 border-l-4 border-orange-300 pl-2",children:"可用券列表"}),o.length===0?e.jsx(Oe,{icon:e.jsx(yt,{size:48,className:"text-gray-300"}),title:"暂无可用寄售券"}):e.jsx("div",{className:"space-y-3",children:o.map(m=>e.jsxs("div",{className:"flex flex-col p-3 bg-orange-50 border border-orange-100 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600",children:e.jsx(ir,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-800",children:m.price_zone||`价格区间 ${m.zone_id}`}),e.jsxs("div",{className:"text-xs text-orange-600 bg-orange-100 px-1.5 py-0.5 rounded inline-block mt-0.5",children:["场次ID: ",m.session_id]})]})]}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 bg-green-100 text-green-700 rounded-full",children:"未使用"})]}),e.jsxs("div",{className:"border-t border-orange-100 my-2 pt-2 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ze,{size:12}),e.jsxs("span",{children:["获取时间: ",Pe(m.create_time)]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-500",children:[e.jsx(Lt,{size:12}),e.jsxs("span",{children:["过期时间: ",Pe(m.expire_time)]})]})]})]},m.id))})]})]})]})},hl=({onBack:t})=>{var x;const[s,a]=n.useState(!0),[r,l]=n.useState(null),[o,c]=n.useState(null);n.useEffect(()=>{(async()=>{var g;const b=localStorage.getItem(ne);if(!b){l("请先登录"),a(!1);return}a(!0),l(null);try{const f=await $e(b);ee(f)&&((g=f.data)!=null&&g.userInfo)?c(f.data.userInfo):l(oe(f,"获取权益信息失败"))}catch(f){l((f==null?void 0:f.message)||"获取权益信息失败")}finally{a(!1)}})()},[]);const d=[{icon:_t,label:"总资产",value:we((o==null?void 0:o.money)||0),color:"text-blue-600",bgColor:"bg-blue-50",description:"所有账户资产总和"},{icon:gs,label:"专项金(可用)",value:we((o==null?void 0:o.balance_available)||0),color:"text-indigo-600",bgColor:"bg-indigo-50",description:"充值余额，优先购买扣除"},{icon:ws,label:"可提现余额",value:we((o==null?void 0:o.withdrawable_money)||0),color:"text-orange-600",bgColor:"bg-orange-50",description:"收益/分红/奖励，可申请提现"},{icon:ot,label:"消费金",value:((x=o==null?void 0:o.score)==null?void 0:x.toString())||"0",color:"text-purple-600",bgColor:"bg-purple-50",description:"利润/分红转化，用于商城消费"},{icon:gs,label:"确权金",value:we((o==null?void 0:o.service_fee_balance)||0),color:"text-green-600",bgColor:"bg-green-50",description:"寄售手续费账户"},{icon:_t,label:"待激活金",value:we((o==null?void 0:o.pending_activation_gold)||0),color:"text-yellow-600",bgColor:"bg-yellow-50",description:"旧资产解锁，独立核算"}];return e.jsxs(_e,{title:"权益总览",onBack:t,children:[s&&e.jsx(ge,{text:"加载中..."}),!s&&r&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-400",children:[e.jsx("div",{className:"w-16 h-16 mb-4 border-2 border-red-200 rounded-lg flex items-center justify-center",children:e.jsx(Te,{size:32,className:"opacity-50"})}),e.jsx("span",{className:"text-xs",children:r})]}),!s&&!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-6 text-white shadow-lg mb-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ot,{size:24}),e.jsx("div",{className:"text-sm opacity-90",children:"我的权益"})]}),e.jsx("div",{className:"text-2xl font-bold mb-4",children:"资产全景"}),e.jsx("div",{className:"text-sm opacity-80",children:"当前所有资金账户概览"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:d.map((m,b)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${m.bgColor} flex items-center justify-center mb-2`,children:e.jsx(m.icon,{size:20,className:m.color})}),e.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:m.label}),e.jsx("div",{className:`text-lg font-bold ${m.color} mb-1 font-[DINAlternate-Bold,Roboto,sans-serif]`,children:m.value}),m.description&&e.jsx("div",{className:"text-[10px] text-gray-400 leading-tight",children:m.description})]},b))}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm font-bold text-gray-800 mb-3 border-l-4 border-blue-300 pl-2",children:"资金说明"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"总资产：显示值为所有账户（专项金+可提现+消费金+确权金）之和，仅供展示。"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"专项金：主要用于购买藏品，优先扣除。"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"可提现：所有的成交回款、分红收益、现金奖励均进入此账户，可直接提现。"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 mt-1.5 flex-shrink-0"}),e.jsx("div",{children:"确权金：用于支付寄售手续费，可由其他账户划转，不可逆。"})]})]})]})]})]})},fl=({onBack:t,onNavigate:s})=>{const{showToast:a}=he(),{handleError:r}=Ie({showToast:!0,persist:!1}),[l,o]=n.useState([]),[c,d]=n.useState(!0);n.useEffect(()=>{x()},[]);const x=async()=>{d(!0);try{const g=localStorage.getItem(ne);if(!g){a("error","登录过期","请重新登录");return}const f=await Ca({},g);ee(f)&&f.data?o(f.data.list):r(f,{toastTitle:"加载失败",customMessage:"获取历史记录失败",context:{page:"ClaimHistory"}})}catch(g){r(g,{toastTitle:"加载失败",customMessage:"网络错误，请重试",context:{page:"ClaimHistory"}})}finally{d(!1)}},m=g=>{switch(g){case"pending":return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded bg-orange-50 text-orange-500 border border-orange-100 flex items-center gap-1",children:[e.jsx(ze,{size:12})," 待审核"]});case"approved":return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded bg-green-50 text-green-500 border border-green-100 flex items-center gap-1",children:[e.jsx(wt,{size:12})," 确权成功"]});case"rejected":return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded bg-red-50 text-red-500 border border-red-100 flex items-center gap-1",children:[e.jsx(pe,{size:12})," 审核失败"]});case"cancelled":return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded bg-gray-50 text-gray-500 border border-gray-100 flex items-center gap-1",children:[e.jsx(pe,{size:12})," 已撤销"]});default:return null}},b=g=>g.voucher_type_text||"未知类型";return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe font-sans",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-20 shadow-sm border-b border-gray-100",children:[e.jsx("button",{onClick:t,className:"p-1 -ml-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ee,{size:24,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"确权记录"}),e.jsx("div",{className:"w-8"})," "]}),e.jsx("div",{className:"p-4 space-y-3",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300 mb-4"}),e.jsx("p",{className:"text-sm",children:"加载中..."})]}):l.length>0?l.map(g=>e.jsxs("div",{onClick:()=>s({name:"claim-detail",id:String(g.id),back:{name:"claim-history"}}),className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow cursor-pointer active:scale-[0.99] transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400",children:e.jsx(Te,{size:16})}),e.jsx("span",{className:"font-bold text-gray-900 text-sm",children:b(g)})]}),m(g.status)]}),e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(ze,{size:12}),e.jsx("span",{children:g.create_time_text})]}),g.review_remark&&g.status==="rejected"&&e.jsxs("div",{className:"text-xs text-red-500 bg-red-50 px-2 py-1 rounded inline-block",children:["驳回原因: ",g.review_remark]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-0.5",children:"确权金额"}),e.jsxs("span",{className:"font-mono font-bold text-gray-900 text-lg",children:["¥",Number(g.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]},g.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Nt,{size:24})}),e.jsx("p",{className:"text-sm",children:"暂无确权记录"})]})})]})},bl=({onBack:t,onNavigate:s})=>{const[a,r]=n.useState([]),[l,o]=n.useState(!1),[c,d]=n.useState(1),[x,m]=n.useState(!0),[b,g]=n.useState(void 0),{handleError:f}=Ie({showToast:!0,persist:!1}),h=n.useRef(!1),j=[{value:void 0,label:"全部"},{value:0,label:"待审核"},{value:1,label:"已通过"},{value:2,label:"已拒绝"},{value:3,label:"已打款"}];n.useEffect(()=>{r([]),d(1),m(!0),h.current=!1,w(1,!0,b)},[b]);const w=async(i,F=!1,I)=>{if(!h.current){h.current=!0,o(!0);try{const z=await Ss({page:i,limit:20,status:I});if(ee(z)){const p=z.data.data||[],P=z.data.last_page||1,y=i<P;r(S=>F?p:[...S,...p]),m(y),d(i)}else f(z,{toastTitle:"加载失败",customMessage:"获取提现列表失败"})}catch(z){f(z,{toastTitle:"加载失败",customMessage:"网络请求失败"})}finally{o(!1),h.current=!1}}},v=()=>{!l&&x&&w(c+1,!1,b)},u=i=>({0:"text-orange-600 bg-orange-50 border-orange-200",1:"text-green-600 bg-green-50 border-green-200",2:"text-red-600 bg-red-50 border-red-200",3:"text-blue-600 bg-blue-50 border-blue-200",4:"text-gray-600 bg-gray-50 border-gray-200"})[i]||"text-gray-600 bg-gray-50 border-gray-200",_=i=>({0:e.jsx(ze,{size:14}),1:e.jsx(Ge,{size:14}),2:e.jsx(Xt,{size:14}),3:e.jsx(Ge,{size:14}),4:e.jsx(lr,{size:14})})[i]||e.jsx(us,{size:14}),N=i=>i?new Date(i*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white sticky top-0 z-10 shadow-sm border-b border-gray-100",children:[e.jsxs("div",{className:"px-4 py-4 pt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-50 rounded-full text-gray-700 transition-colors",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"提现记录"})]}),e.jsx("div",{className:"flex px-4 border-b border-gray-100 overflow-x-auto hide-scrollbar",children:j.map(i=>e.jsxs("button",{onClick:()=>g(i.value),className:`flex-1 py-3 text-sm font-medium relative whitespace-nowrap transition-colors ${b===i.value?"text-orange-600":"text-gray-500 hover:text-gray-700"}`,children:[i.label,b===i.value&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 bg-orange-500 rounded-full"})]},String(i.value)))})]}),e.jsxs("div",{className:"flex-1 p-4 pb-safe space-y-3",children:[a.map(i=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 cursor-pointer active:bg-gray-50 transition-colors",onClick:()=>s({name:"withdraw-order-detail",orderId:String(i.id),back:{name:"withdraw-order-list"}}),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:[i.account_type_text," • ",i.account_name]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-lg",children:["¥",i.amount]}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-[10px]",children:["到账 ¥",i.actual_amount]})]})]}),e.jsxs("div",{className:`px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 border ${u(i.status)}`,children:[_(i.status),i.status_text]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 border-t border-gray-50 pt-3 mt-1",children:[e.jsx("span",{children:i.create_time_text||N(i.create_time)}),i.audit_reason&&e.jsxs("span",{className:"flex items-center gap-1 text-red-400 max-w-[60%] truncate",children:[e.jsx(us,{size:12}),i.audit_reason]})]})]},i.id)),l&&e.jsx("div",{className:"py-8",children:e.jsx(ge,{text:"加载中..."})}),!l&&a.length===0&&e.jsxs("div",{className:"py-20 text-center text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center",children:e.jsx(Te,{size:32,className:"text-gray-300"})}),e.jsx("div",{children:"暂无提现记录"})]}),!l&&x&&a.length>0&&e.jsx("button",{onClick:v,className:"w-full py-3 text-sm text-gray-500 hover:text-gray-700",children:"加载更多"}),!l&&!x&&a.length>0&&e.jsx("div",{className:"py-4 text-center text-xs text-gray-400",children:"--- 已加载全部 ---"})]})]})},pl=({onBack:t,onNavigate:s})=>{var J,se,de,Re;const{showToast:a}=he(),[r,l]=n.useState(0),[o,c]=n.useState(!1),[d,x]=n.useState(!1),[m,b]=n.useState(!1),[g,f]=n.useState(0),[h,j]=n.useState(0),[w,v]=n.useState([]),[u,_]=n.useState(null),[N,i]=n.useState(null),[F,I]=n.useState(!0),[z,p]=n.useState(!1),[P,y]=n.useState([]),[S,k]=n.useState(null),[T,D]=n.useState(!1),[Y,L]=n.useState(""),[B,K]=n.useState(!1),[C,E]=n.useState(null),[R,O]=n.useState(new Date);n.useEffect(()=>{(async()=>{var ae,le;I(!0);const xe=ce();try{const me=await dn();if((ee(me)||me.code===0)&&re(me)&&_(re(me)),xe){const[ye,M,X]=await Promise.all([Ms(xe),ns(xe),ha(xe).catch(()=>({code:-1,data:null}))]),te=re(ye);if((ee(ye)||ye.code===0)&&te){const ue=te;l(ue.total_reward||0),c(ue.today_signed||!1);const De=((le=(ae=ue.calendar)==null?void 0:ae.signed_dates)==null?void 0:le.map(He=>{try{const ve=new Date(He);return isNaN(ve.getTime())?He:ve.toDateString()}catch{return He}}))||[];v(De)}const Q=re(M);Q?(console.log("进度数据:",Q),i(Q),Q.withdrawable_money!==void 0?l(Q.withdrawable_money):Q.total_money!==void 0&&l(Q.total_money)):console.warn("进度接口返回异常:",M);const Ne=re(X);Ne&&j(Ne.team_count||0)}}catch(me){console.error("加载签到数据失败:",me),a("error","加载失败","加载数据失败，请重试")}finally{I(!1)}})()},[]);const V=async()=>{var xe,ae;if(o){b(!0);return}const ie=localStorage.getItem(ne);if(!ie){a("warning","请先登录");return}try{const le=await xn(ie),me=re(le);if(me){const ye=me.daily_reward||0;f(ye),x(!0),l(me.total_reward||0),c(!0);const M=((ae=(xe=me.calendar)==null?void 0:xe.signed_dates)==null?void 0:ae.map(te=>{try{const Q=new Date(te);return isNaN(Q.getTime())?te:Q.toDateString()}catch{return te}}))||[];v(M);const X=localStorage.getItem(ne);if(X)try{const te=await ns(X),Q=re(te);Q&&(i(Q),Q.withdrawable_money!==void 0?l(Q.withdrawable_money):Q.total_money!==void 0&&l(Q.total_money))}catch(te){console.error("刷新进度信息失败:",te)}}else a("error","签到失败",oe(le,"请重试"))}catch(le){console.error("签到失败:",le),a("error","签到失败",(le==null?void 0:le.msg)||(le==null?void 0:le.message)||"请重试")}},H=()=>{s&&s("my-friends")},W=async()=>{const ie=localStorage.getItem(ne);if(!ie){E("未检测到登录信息，请重新登录");return}D(!0),E(null);try{const xe=await rs(ie),ae=re(xe);if(ae&&ae.list){if(y(ae.list||[]),ae.list.length>0){const le=ae.list.find(me=>Number(me.is_default)===1);k(le||ae.list[0])}}else E(oe(xe,"获取收款账户信息失败"))}catch(xe){E((xe==null?void 0:xe.msg)||"获取收款账户信息失败")}finally{D(!1)}},A=()=>{var ae;const ie=(N==null?void 0:N.withdraw_min_amount)||((ae=u==null?void 0:u.activity)==null?void 0:ae.withdraw_min_amount)||10;if(!((N==null?void 0:N.can_withdraw)??r>=ie)){a("warning","余额不足",`余额不足 ${ie.toFixed(2)} 元，暂不可提现`);return}p(!0),W()},$=async()=>{if(!S){E("请选择收款账户");return}if(!Y){E("请输入支付密码");return}if(!/^\d{6}$/.test(Y)){E("支付密码必须为6位数字");return}K(!0),E(null);try{const ie=await ba({amount:r,payment_account_id:S.id,pay_password:Y,remark:"签到活动提现"});if(ee(ie)||ie.code===0){a("success","提交成功","提现申请已提交，请等待审核"),p(!1),L("");const xe=localStorage.getItem(ne);if(xe)try{const[ae,le]=await Promise.all([Ms(xe),ns(xe)]),me=re(ae);(ee(ae)||ae.code===0)&&me&&l(me.total_reward||0);const ye=re(le);(ee(le)||le.code===0)&&ye&&(i(ye),ye.withdrawable_money!==void 0?l(ye.withdrawable_money):ye.total_money!==void 0&&l(ye.total_money))}catch(ae){console.error("刷新数据失败:",ae)}}else E(oe(ie,"提交失败，请重试"))}catch(ie){E((ie==null?void 0:ie.msg)||(ie==null?void 0:ie.message)||"提交失败，请重试")}finally{K(!1)}},U=ie=>{const xe=ie.getFullYear(),ae=ie.getMonth(),le=new Date(xe,ae+1,0).getDate(),me=new Date(xe,ae,1).getDay();return{days:le,firstDay:me}},G=()=>{const{days:ie,firstDay:xe}=U(R),ae=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],le=R.getFullYear(),me=R.getMonth(),ye=[];for(let M=0;M<xe;M++)ye.push(e.jsx("div",{className:"h-10"},`empty-${M}`));for(let M=1;M<=ie;M++){const te=new Date(le,me,M).toDateString(),Q=w.some(ue=>{try{const De=ue.includes("-")?new Date(ue):new Date(ue);return De.getFullYear()===le&&De.getMonth()===me&&De.getDate()===M}catch{return!1}}),Ne=te===new Date().toDateString();ye.push(e.jsxs("div",{className:"h-10 flex items-center justify-center relative",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
            ${Q?"bg-red-500 text-white shadow-md":Ne?"border border-red-500 text-red-500":"text-gray-700"}
          `,children:M}),Q&&e.jsx("div",{className:"absolute -bottom-1 text-[10px] text-red-500 font-bold",children:"✓"})]},M))}return e.jsxs("div",{className:"bg-white rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>O(new Date(le,me-1,1)),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ee,{size:20,className:"text-gray-500"})}),e.jsxs("div",{className:"font-bold text-lg text-gray-800",children:[le,"年 ",ae[me]]}),e.jsx("button",{onClick:()=>O(new Date(le,me+1,1)),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(qe,{size:20,className:"text-gray-500"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-xs text-gray-400 font-medium",children:[e.jsx("div",{children:"日"}),e.jsx("div",{children:"一"}),e.jsx("div",{children:"二"}),e.jsx("div",{children:"三"}),e.jsx("div",{children:"四"}),e.jsx("div",{children:"五"}),e.jsx("div",{children:"六"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:ye}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{children:"已签到"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border border-red-500"}),e.jsx("span",{children:"今天"})]})]})]})};return F?e.jsx("div",{className:"min-h-screen bg-red-50 pb-safe flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-500",children:"加载中..."})})}):e.jsxs("div",{className:"min-h-screen bg-red-50 pb-safe",children:[e.jsxs("div",{className:"relative bg-gradient-to-b from-red-600 to-red-500 text-white pb-24",children:[e.jsxs("div",{className:"flex items-center px-4 py-3",children:[e.jsx("button",{onClick:t,className:"p-1 -ml-2",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold flex-1 text-center pr-6",children:"每日签到"})]}),e.jsxs("div",{className:"px-6 pt-4 text-center",children:[e.jsx("div",{className:"text-xs opacity-80 mb-1",children:"树拍·星火燎原"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:((J=u==null?void 0:u.activity)==null?void 0:J.name)||"共识建设与通道测试活动"}),e.jsxs("div",{className:"mt-2 text-xs opacity-75",children:["活动时间：",(se=u==null?void 0:u.activity)!=null&&se.start_time?new Date(u.activity.start_time).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"2025.11.29"," - ",(de=u==null?void 0:u.activity)!=null&&de.end_time?new Date(u.activity.end_time).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"2025.12.04"]})]})]}),e.jsxs("div",{className:"px-4 -mt-20 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg text-center relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-bl-lg",children:["已邀请 ",h," 人"]}),e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"当前累计奖励 (元)"}),e.jsx("div",{className:"text-4xl font-bold text-red-600 mb-6",children:r.toFixed(2)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:V,className:`flex items-center justify-center gap-2 py-3 rounded-lg font-bold text-sm transition-all ${o?"bg-red-50 text-red-600 border border-red-200":"bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-md active:scale-95"}`,children:[o?e.jsx(oa,{size:18}):e.jsx(ca,{size:18}),o?"签到记录":"每日签到"]}),e.jsxs("button",{onClick:H,className:"flex items-center justify-center gap-2 bg-red-50 text-red-600 py-3 rounded-lg font-bold text-sm border border-red-100 active:bg-red-100 transition-all",children:[e.jsx(_s,{size:18}),"邀请好友"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-800",children:[e.jsx(Le,{className:"text-orange-500",size:20}),e.jsx("span",{children:"提现申请"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"T+1 到账"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-5 mb-4 relative overflow-hidden border border-red-100",children:[e.jsx("div",{className:"absolute -right-3 -top-3 opacity-5 transform rotate-12",children:e.jsx(Le,{size:80,className:"text-red-500"})}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-sm mb-2 relative z-10",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"当前余额"})]}),e.jsxs("div",{className:"relative z-10 flex items-baseline",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900 mr-1",children:((N==null?void 0:N.withdrawable_money)??(N==null?void 0:N.total_money)??r).toFixed(2)}),e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"元"})]})]}),(()=>{const ie=(N==null?void 0:N.withdrawable_money)??(N==null?void 0:N.total_money)??r,xe=10,ae=ie>=xe;return e.jsx("button",{onClick:ae?A:void 0,disabled:!ae,className:`w-full py-3 rounded-lg font-bold text-sm transition-all shadow-sm ${ae?"bg-gradient-to-r from-orange-500 to-red-500 text-white active:scale-[0.98] active:opacity-90":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:ae?"申请提现":`余额不足10元，还差 ${(xe-ie).toFixed(2)} 元`})})()]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-800 mb-4",children:[e.jsx(zt,{className:"text-blue-500",size:20}),e.jsx("span",{children:"活动规则"})]}),e.jsxs("div",{className:"space-y-3",children:[(Re=u==null?void 0:u.rules)==null?void 0:Re.map((ie,xe)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"w-24 shrink-0 flex justify-center",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-md w-full text-center font-medium block ${ie.key==="daily_reward"?"bg-orange-100 text-orange-600":ie.key==="register_reward"?"bg-green-100 text-green-600":ie.key==="invite_reward"?"bg-purple-100 text-purple-600":"bg-blue-100 text-blue-600"}`,children:ie.title})}),e.jsx("p",{className:"text-sm text-gray-600 flex-1 leading-relaxed",children:ie.key==="invite_reward"?e.jsxs(e.Fragment,{children:["邀请好友注册可获得 ",e.jsx("span",{className:"text-red-500 font-bold",children:"1.5 - 2.0 元随机金额奖励"})]}):ie.description})]},xe)),!(u!=null&&u.rules)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"w-24 shrink-0 flex justify-center",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-md w-full text-center font-medium block bg-orange-100 text-orange-600",children:"每日签到奖励"})}),e.jsxs("p",{className:"text-sm text-gray-600 flex-1 leading-relaxed",children:["每日首次签到可获得 ",e.jsx("span",{className:"text-red-500 font-bold",children:"0.20 - 0.50"})," 元随机金额奖励"]})]}),e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"w-24 shrink-0 flex justify-center",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-md w-full text-center font-medium block bg-green-100 text-green-600",children:"注册奖励"})}),e.jsxs("p",{className:"text-sm text-gray-600 flex-1 leading-relaxed",children:["新用户注册/激活可获得 ",e.jsx("span",{className:"text-red-500 font-bold",children:"2.88"})," 元奖励"]})]}),e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"w-24 shrink-0 flex justify-center",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-md w-full text-center font-medium block bg-purple-100 text-purple-600",children:"邀请好友奖励"})}),e.jsxs("p",{className:"text-sm text-gray-600 flex-1 leading-relaxed",children:["邀请好友注册可获得 ",e.jsx("span",{className:"text-red-500 font-bold",children:"1.5 元 - 2.0 元 / 人"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"w-24 shrink-0 flex justify-center",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-md w-full text-center font-medium block bg-blue-100 text-blue-600",children:"提现规则"})}),e.jsxs("p",{className:"text-sm text-gray-600 flex-1 leading-relaxed",children:["账户余额满 ",e.jsx("span",{className:"font-bold",children:"10.00"})," 元可申请提现，每人每天限提 1 次，24 小时内审核到账。"]})]})]})]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-red-500 w-72 rounded-2xl p-6 text-center relative shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:()=>x(!1),className:"absolute top-2 right-2 text-white/60 hover:text-white",children:e.jsx(Ce,{size:24})}),e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner",children:e.jsx(ws,{size:32,className:"text-red-500"})}),e.jsx("h3",{className:"text-yellow-100 text-lg font-bold mb-1",children:"恭喜获得"}),e.jsxs("div",{className:"text-4xl font-bold text-white mb-2",children:[g.toFixed(2)," ",e.jsx("span",{className:"text-lg",children:"元"})]}),e.jsx("p",{className:"text-white/80 text-sm mb-6",children:"已存入您的活动账户"}),e.jsx("button",{onClick:()=>x(!1),className:"w-full bg-yellow-400 text-red-600 font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform",children:"开心收下"})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-in fade-in duration-200 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl p-4 relative shadow-2xl scale-100 animate-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:()=>b(!1),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 z-10",children:e.jsx(Ce,{size:24})}),e.jsx("h3",{className:"text-center font-bold text-lg mb-2",children:"签到记录"}),G()]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 animate-in fade-in duration-200 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl p-6 relative shadow-2xl scale-100 animate-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>p(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10",children:e.jsx(Ce,{size:24})}),e.jsx("h3",{className:"text-center font-bold text-lg mb-6",children:"确认提现"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"提现金额 (全部)"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["¥ ",r.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"收款账户"}),T?e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"加载账户中..."}):P.length===0?e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"暂无收款账户"}),s&&e.jsx("button",{onClick:()=>{p(!1),s("cardManagement")},className:"text-orange-600 text-sm font-medium",children:"去添加账户"})]}):e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:P.map(ie=>e.jsxs("div",{onClick:()=>k(ie),className:`p-3 rounded-lg border cursor-pointer transition-all ${(S==null?void 0:S.id)===ie.id?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:ie.account_name}),e.jsx("span",{className:"text-xs text-gray-500",children:ie.type_text})]}),e.jsx("div",{className:"text-xs text-gray-400",children:ie.account})]},ie.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"支付密码"}),e.jsx("input",{type:"password",value:Y,onChange:ie=>L(ie.target.value),placeholder:"请输入支付密码",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm outline-none focus:border-orange-500 transition-colors"})]}),C&&e.jsx("div",{className:"text-xs text-red-500 bg-red-50 px-3 py-2 rounded",children:C}),e.jsx("button",{onClick:$,disabled:B||!S||!Y,className:`w-full py-3 rounded-xl font-bold text-white transition-all ${B||!S||!Y?"bg-gray-300 cursor-not-allowed":"bg-orange-600 active:bg-orange-700 shadow-lg active:scale-95"}`,children:B?"提交中...":"确认提现"})]})]})})]})},yl=({onBack:t,onNavigate:s})=>{const[a,r]=n.useState(!0),[l,o]=n.useState(null),[c,d]=n.useState([]),[x,m]=n.useState("all"),b="message_center_cache",g="message_center_cache_timestamp",f=300*1e3,h=()=>{try{const p=localStorage.getItem(je.READ_MESSAGE_IDS_KEY);return p?JSON.parse(p):[]}catch{return[]}},j=p=>{try{localStorage.setItem(je.READ_MESSAGE_IDS_KEY,JSON.stringify(p))}catch{}},w={AlertCircle:pe,Info:zt,Wallet:Le,Receipt:at,Package:vt,CheckCircle:Ge,Truck:Rs},v=()=>{try{const p=sessionStorage.getItem(b),P=sessionStorage.getItem(g);if(p&&P&&Date.now()-parseInt(P)<f)return JSON.parse(p).map(k=>({...k,icon:w[k.iconName]||zt}))}catch{}return null},u=p=>{try{const P=p.map(y=>{const S=Object.keys(w).find(k=>w[k]===y.icon)||"Info";return{...y,iconName:S,icon:void 0}});sessionStorage.setItem(b,JSON.stringify(P)),sessionStorage.setItem(g,String(Date.now()))}catch{}};n.useEffect(()=>{(async()=>{const P=v();if(P){console.log("[MessageCenter] 使用缓存数据");const S=h();let k=[];try{const D=localStorage.getItem(je.READ_NEWS_IDS_KEY);k=D?JSON.parse(D):[]}catch{}const T=P.map(D=>{let Y=D.isRead;return S.includes(D.id)&&(Y=!0),(D.type==="notice"||D.type==="activity")&&D.sourceId&&k.includes(String(D.sourceId))&&(Y=!0),{...D,isRead:Y}});d(T),r(!1);return}const y=localStorage.getItem(ne);if(!y){o("请先登录"),r(!1);return}r(!0),o(null);try{const S=h(),k=[];try{const[T,D]=await Promise.all([Dt({page:1,limit:10,type:"normal"}),Dt({page:1,limit:10,type:"important"})]),Y=localStorage.getItem(je.READ_NEWS_IDS_KEY),L=Y?JSON.parse(Y):[],B=re(T),K=(B==null?void 0:B.data)||(B==null?void 0:B.list)||[];K.length>0&&K.forEach(R=>{const O=`announcement-${R.id}`,V=R.createtime?new Date(R.createtime).getTime():Date.now(),H=L.includes(String(R.id));k.push({id:O,type:"notice",title:"平台公告",content:R.title||"",time:R.createtime||"",timestamp:V,isRead:H,icon:pe,color:"text-red-600",bgColor:"bg-red-50",sourceId:R.id})});const C=re(D),E=(C==null?void 0:C.data)||(C==null?void 0:C.list)||[];E.length>0&&E.forEach(R=>{const O=`dynamic-${R.id}`,V=R.createtime?new Date(R.createtime).getTime():Date.now(),H=L.includes(String(R.id));k.push({id:O,type:"activity",title:"平台动态",content:R.title||"",time:R.createtime||"",timestamp:V,isRead:H,icon:zt,color:"text-orange-600",bgColor:"bg-orange-50",sourceId:R.id})})}catch(T){console.error("加载公告失败:",T)}try{const T=await _n({page:1,limit:5,token:y}),D=re(T),Y=(D==null?void 0:D.data)||(D==null?void 0:D.list)||[];Y.length>0&&Y.forEach(L=>{const B=`recharge-${L.id}`,K=L.create_time?L.create_time*1e3:Date.now();if(L.status===it.PENDING||L.status===it.APPROVED||L.status===it.REJECTED){let C="";L.status===it.PENDING?C=`您的充值订单 ${L.order_no} 待审核，金额：¥${L.amount}`:L.status===it.APPROVED?C=`您的充值订单 ${L.order_no} 审核通过，金额：¥${L.amount}`:L.status===it.REJECTED&&(C=`您的充值订单 ${L.order_no} 审核未通过`),k.push({id:B,type:"recharge",title:"充值通知",content:C,time:L.create_time_text||"",timestamp:K,isRead:S.includes(B),icon:Le,color:"text-blue-600",bgColor:"bg-blue-50",sourceId:L.id})}})}catch(T){console.error("加载充值订单失败:",T)}try{const T=await Ss({page:1,limit:5,token:y}),D=re(T),Y=(D==null?void 0:D.data)||(D==null?void 0:D.list)||[];Y.length>0&&Y.forEach(L=>{const B=`withdraw-${L.id}`,K=L.create_time?L.create_time*1e3:Date.now();if(L.status===lt.PENDING||L.status===lt.APPROVED||L.status===lt.REJECTED){let C="";L.status===lt.PENDING?C=`您的提现申请待审核，金额：¥${L.amount}`:L.status===lt.APPROVED?C=`您的提现申请已通过，金额：¥${L.amount}，已到账：¥${L.actual_amount}`:L.status===lt.REJECTED&&(C=`您的提现申请未通过${L.audit_reason?`：${L.audit_reason}`:""}`),k.push({id:B,type:"withdraw",title:"提现通知",content:C,time:L.create_time_text||"",timestamp:K,isRead:S.includes(B),icon:at,color:"text-green-600",bgColor:"bg-green-50",sourceId:L.id})}})}catch(T){console.error("加载提现记录失败:",T)}try{const[T,D,Y]=await Promise.all([Yt({page:1,limit:3,token:y}),Vt({page:1,limit:3,token:y}),Wt({page:1,limit:3,token:y})]),L=re(T);L!=null&&L.list&&L.list.forEach(C=>{const E=`shop-order-pay-${C.id}`,R=C.create_time?typeof C.create_time=="string"?parseInt(C.create_time)*1e3:C.create_time*1e3:Date.now();k.push({id:E,type:"shop_order",title:"订单提醒",content:`您有订单 ${C.order_no||C.id} 待付款，请及时支付`,time:C.create_time_text||"",timestamp:R,isRead:S.includes(E),icon:vt,color:"text-yellow-600",bgColor:"bg-yellow-50",sourceId:C.id})});const B=re(D);B!=null&&B.list&&B.list.forEach(C=>{const E=`shop-order-ship-${C.id}`,R=C.pay_time?typeof C.pay_time=="string"?parseInt(C.pay_time)*1e3:C.pay_time*1e3:Date.now();k.push({id:E,type:"shop_order",title:"订单通知",content:`您的订单 ${C.order_no||C.id} 已付款，等待商家发货`,time:C.pay_time_text||C.create_time_text||"",timestamp:R,isRead:S.includes(E),icon:Ge,color:"text-blue-600",bgColor:"bg-blue-50",sourceId:C.id})});const K=re(Y);K!=null&&K.list&&K.list.forEach(C=>{const E=`shop-order-confirm-${C.id}`,R=C.ship_time?typeof C.ship_time=="string"?parseInt(C.ship_time)*1e3:C.ship_time*1e3:Date.now();k.push({id:E,type:"shop_order",title:"订单通知",content:`您的订单 ${C.order_no||C.id} 已发货${C.shipping_no?`，物流单号：${C.shipping_no}`:""}，请及时确认收货`,time:C.ship_time_text||C.create_time_text||"",timestamp:R,isRead:S.includes(E),icon:Rs,color:"text-green-600",bgColor:"bg-green-50",sourceId:C.id})})}catch(T){console.error("加载商城订单失败:",T)}k.sort((T,D)=>D.timestamp-T.timestamp),d(k),u(k)}catch(S){o((S==null?void 0:S.msg)||(S==null?void 0:S.message)||"获取消息失败")}finally{r(!1)}})()},[]);const _=p=>{try{let P;if(typeof p=="number"?P=new Date(p*1e3):p.includes("T")||p.includes("-")?P=new Date(p):P=new Date(p),isNaN(P.getTime()))return p.toString();const S=new Date().getTime()-P.getTime(),k=Math.floor(S/6e4),T=Math.floor(S/36e5),D=Math.floor(S/864e5);return k<1?"刚刚":k<60?`${k}分钟前`:T<24?`${T}小时前`:D<7?`${D}天前`:P.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return typeof p=="string"?p:String(p)}},N=c.filter(p=>!p.isRead).length,i=x==="unread"?c.filter(p=>!p.isRead):c,F=(p,P)=>{d(y=>{const S=y.map(D=>D.id===p?{...D,isRead:!0}:D),k=y.find(D=>D.id===p);if(k&&(k.type==="notice"||k.type==="activity")&&k.sourceId)try{const D=localStorage.getItem(je.READ_NEWS_IDS_KEY),Y=D?JSON.parse(D):[],L=String(k.sourceId);if(!Y.includes(L)){const B=[...Y,L];localStorage.setItem(je.READ_NEWS_IDS_KEY,JSON.stringify(B))}}catch(D){console.error("保存新闻已读状态失败",D)}const T=h();return T.includes(p)||j([...T,p]),u(S),S})},I=()=>{d(p=>{const P=p.map(S=>({...S,isRead:!0})),y=P.map(S=>S.id);j(y);try{const S=localStorage.getItem(je.READ_NEWS_IDS_KEY),T=[...S?JSON.parse(S):[]];P.forEach(D=>{if((D.type==="notice"||D.type==="activity")&&D.sourceId){const Y=String(D.sourceId);T.includes(Y)||T.push(Y)}}),localStorage.setItem(je.READ_NEWS_IDS_KEY,JSON.stringify(T))}catch(S){console.error("批量保存新闻已读状态失败",S)}return u(P),P})},z=p=>{switch(F(p.id),p.type){case"notice":case"activity":p.sourceId&&s({name:"news-detail",id:String(p.sourceId),from:{name:"message-center"},back:{name:"message-center"}});break;case"recharge":p.sourceId&&s({name:"recharge-order-detail",orderId:String(p.sourceId),back:{name:"message-center"}});break;case"withdraw":s({name:"balance-withdraw",source:"asset-view",back:{name:"message-center"}});break;case"shop_order":s({name:"order-list",kind:"points",status:0,back:{name:"message-center"}});break}};return e.jsx(xt,{title:"消息中心",onBack:t,rightAction:N>0?e.jsx("button",{onClick:I,className:"text-sm text-gray-600 active:opacity-70 font-medium",children:"全部已读"}):null,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#FF884D] to-[#FF5500] rounded-2xl p-6 text-white shadow-lg mb-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-orange-300 opacity-20 rounded-full translate-y-1/2 -translate-x-1/4 blur-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(hs,{size:24,className:"opacity-90"}),e.jsx("div",{className:"text-sm opacity-90 font-medium",children:"我的消息"})]}),e.jsx("div",{className:"text-4xl font-bold mb-2 font-[DINAlternate-Bold,Roboto,sans-serif]",children:N}),e.jsx("div",{className:"text-sm opacity-80",children:N>0?"条未读消息":"暂无未读消息"})]})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-xl p-1 mb-4",children:[e.jsx("button",{onClick:()=>m("all"),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${x==="all"?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-600"}`,children:"全部消息"}),e.jsxs("button",{onClick:()=>m("unread"),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all relative ${x==="unread"?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-600"}`,children:["未读消息",N>0&&e.jsx("span",{className:"absolute top-1.5 right-4 w-2 h-2 bg-red-500 rounded-full"})]})]}),a?e.jsx(ge,{text:"加载消息中..."}):l?e.jsx(Oe,{icon:e.jsx(Te,{size:48,className:"text-gray-300"}),title:"加载失败",description:l}):i.length===0?e.jsx(Oe,{icon:e.jsx(hs,{size:48,className:"text-gray-300"}),title:x==="unread"?"暂无未读消息":"暂无消息",description:x==="unread"?"您已阅读所有消息":"暂时没有新的消息"}):e.jsx("div",{className:"space-y-3",children:i.map(p=>e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm cursor-pointer active:bg-gray-50 transition-colors relative overflow-hidden ${p.isRead?"":"bg-orange-50/30"}`,onClick:()=>z(p),children:[!p.isRead&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-red-500"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${p.bgColor} flex items-center justify-center flex-shrink-0`,children:es.createElement(p.icon,{size:20,className:p.color})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:`text-sm font-medium ${p.isRead?"text-gray-700":"text-gray-900 font-bold"}`,children:p.title}),!p.isRead&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0 mt-1.5"})]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2 line-clamp-2 leading-relaxed",children:p.content}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-400",children:_(p.time)}),p.isRead&&e.jsx("div",{className:"text-xs text-gray-400",children:"已读"})]})]})]})]},p.id))})]})})},jl=({newsList:t,onNavigate:s,onMarkAllRead:a,onBack:r})=>{const[l,o]=n.useState(()=>{try{const x=localStorage.getItem(je.NEWS_ACTIVE_TAB_KEY);return x==="dynamics"||x==="announcement"?x:"announcement"}catch{return"announcement"}});n.useEffect(()=>{try{localStorage.setItem(je.NEWS_ACTIVE_TAB_KEY,l)}catch{}},[l]);const c=n.useMemo(()=>t.filter(x=>l==="announcement"?x.type==="announcement":x.type==="dynamic"),[l,t]),d=n.useMemo(()=>t.some(x=>x.isUnread),[t]);return e.jsxs("div",{className:"pb-24 min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center justify-center p-3 border-b border-gray-100 relative",children:[r&&e.jsx("button",{onClick:r,className:"absolute left-3 p-1 text-gray-800 active:opacity-70",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"font-bold text-lg",children:"资讯"}),e.jsx("button",{onClick:d?a:void 0,disabled:!d,className:`absolute right-4 flex items-center gap-1 text-xs font-medium rounded-full px-3 py-1 transition-colors border ${d?"text-orange-600 border-orange-100 hover:bg-orange-50 active:bg-orange-100":"text-gray-300 border-gray-100 cursor-not-allowed"}`,title:d?"一键清除未读":"暂无未读公告",children:e.jsx(Ns,{size:16})})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>o("announcement"),className:`flex-1 py-3 text-sm font-medium relative transition-colors ${l==="announcement"?"text-orange-600":"text-gray-500"}`,children:["平台公告",l==="announcement"&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 bg-orange-600 rounded-full"})]}),e.jsxs("button",{onClick:()=>o("dynamics"),className:`flex-1 py-3 text-sm font-medium relative transition-colors ${l==="dynamics"?"text-orange-600":"text-gray-500"}`,children:["平台动态",l==="dynamics"&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 bg-orange-600 rounded-full"})]})]})]}),e.jsx("div",{className:"p-4 space-y-4",children:c.length>0?c.map(x=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm relative cursor-pointer active:bg-gray-50 transition-colors",onClick:()=>{const m=x.type==="announcement"?"announcement":"dynamics";l!==m&&o(m),s(x.id)},children:[x.isUnread&&e.jsx("div",{className:"absolute top-4 right-4 w-2 h-2 bg-red-500 rounded-full ring-4 ring-white"}),e.jsx("div",{className:"text-xs text-gray-400 mb-3",children:Pe(x.date,"YYYY-MM-DD HH:mm")}),e.jsx("h3",{className:"text-sm text-gray-800 font-medium leading-relaxed mb-4 pr-4",children:x.title}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"查看详情"}),e.jsx(St,{size:14,className:"text-gray-400"})]})]},x.id)):e.jsx(Oe,{title:`暂无${l==="announcement"?"公告":"动态"}`})})]})},Nl=({onBack:t})=>{const{showToast:s}=he(),[a,r]=n.useState(""),[l,o]=n.useState(!0),[c,d]=n.useState(null),x=g=>g?`${typeof window<"u"?window.location.origin:""}/register?invite_code=${encodeURIComponent(g)}`:"";n.useEffect(()=>{(async()=>{try{o(!0),d(null);const f=localStorage.getItem(ne)||"";if(!f){d("请先登录");return}const h=await ha(f);(ee(h)||h.code===0)&&h.data?r(h.data.invite_code):d(oe(h,"获取推广卡信息失败"))}catch(f){console.error("加载推广卡信息失败:",f),d(f.message||"获取推广卡信息失败，请稍后重试")}finally{o(!1)}})()},[]);const m=x(a),b=async(g,f)=>{try{await navigator.clipboard.writeText(g),s("success",`${f==="code"?"邀请码":"链接"}已复制!`)}catch(h){console.error("Failed to copy:",h);const j=document.createElement("textarea");j.value=g,document.body.appendChild(j),j.select();try{document.execCommand("copy"),s("success",`${f==="code"?"邀请码":"链接"}已复制!`)}catch(w){console.error("Fallback copy failed",w),s("error","复制失败，请手动复制")}document.body.removeChild(j)}};return l?e.jsx(_e,{title:"邀请好友",onBack:t,children:e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx(ge,{text:"加载中..."})})}):c?e.jsx(_e,{title:"邀请好友",onBack:t,children:e.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-red-500 text-center px-4",children:c}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-6 py-2 bg-orange-500 text-white rounded-lg",children:"重试"})]})}):e.jsx(_e,{title:"邀请好友",onBack:t,children:e.jsxs("div",{className:"relative min-h-[70vh] flex flex-col items-center",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-[#FFD6A5]/30 to-transparent pointer-events-none"}),e.jsxs("div",{className:"relative bg-white p-8 rounded-3xl shadow-xl flex flex-col items-center w-full max-w-xs mb-8 z-10 border border-orange-100",children:[e.jsx("div",{className:"w-56 h-56 bg-orange-50 rounded-2xl flex items-center justify-center mb-6 overflow-hidden p-2",children:m&&e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(m)}`,alt:"邀请二维码",className:"w-full h-full object-cover rounded-xl mix-blend-multiply"})}),e.jsx("p",{className:"text-gray-500 text-sm text-center font-medium",children:"扫码注册，加入我们"})]}),e.jsxs("div",{className:"w-full max-w-xs mb-10 z-10",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3 font-medium ml-2",children:"我的邀请码"}),e.jsxs("div",{onClick:()=>b(a,"code"),className:"bg-white border border-orange-200 rounded-2xl p-5 flex items-center justify-between active:bg-orange-50 transition-all cursor-pointer shadow-sm hover:shadow-md",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-800 tracking-widest font-mono",children:a}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center",children:e.jsx(nt,{size:22})})]})]}),e.jsxs("button",{onClick:()=>{m?b(m,"link"):s("warning","邀请码加载中，请稍后再试")},disabled:!m,className:"w-full max-w-xs bg-gradient-to-r from-orange-500 to-orange-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-orange-200 flex items-center justify-center gap-3 active:scale-95 transition-transform z-10 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ts,{size:22}),e.jsx("span",{children:"分享链接"})]})]})})},Zs=({onBack:t,onItemSelect:s,initialConsignItemId:a})=>{const[r,l]=n.useState(!1),[o,c]=n.useState(null),[d,x]=n.useState([]),[m,b]=n.useState(1),[g,f]=n.useState(!1),[h,j]=n.useState(0),[w,v]=n.useState(null),[u,_]=n.useState(!1),[N,i]=n.useState(null),[F,I]=n.useState("delivery"),[z,p]=n.useState(null),[P,y]=n.useState(null),[S,k]=n.useState(!1),[T,D]=n.useState("hold"),Y=[{id:"hold",label:"待售"},{id:"consign",label:"挂单"},{id:"sold",label:"已卖出"},{id:"dividend",label:"已转分红"}];n.useEffect(()=>{(async()=>{var te;const X=localStorage.getItem(ne);if(X)try{const Q=localStorage.getItem(Ae);if(Q)try{const ue=JSON.parse(Q);v(ue)}catch(ue){console.warn("解析本地用户信息失败:",ue)}const Ne=await $e(X);ee(Ne)&&((te=Ne.data)!=null&&te.userInfo)&&(v(Ne.data.userInfo),localStorage.setItem(Ae,JSON.stringify(Ne.data.userInfo)))}catch(Q){console.error("加载用户信息失败:",Q)}})()},[]),n.useEffect(()=>{B()},[m,T]),n.useEffect(()=>{if(!a||!d||d.length===0)return;const M=d.find(X=>{const te=Re(X);return String(te)===String(a)||String(X.id)===String(a)||String(X.item_id)===String(a)});M&&(i(M),I("consignment"),y(null),_(!0))},[a,d]);const L=M=>{D(M),b(1),x([])},B=async()=>{const M=localStorage.getItem(ne);if(!M){c("请先登录"),l(!1);return}l(!0),c(null);try{if(T==="hold"||T==="dividend"){const X=await fs({page:m,token:M});if(ee(X)&&X.data){const te=X.data.list||[],Q=te.filter(Ne=>{const ue=Number(Ne.delivery_status)||0;return T==="hold"?ue===We.NOT_DELIVERED:ue===We.DELIVERED});x(m===1?Q:Ne=>[...Ne,...Q]),f(te.length>=10&&X.data.has_more!==!1),typeof X.data.consignment_coupon=="number"&&j(X.data.consignment_coupon)}else c(oe(X,"获取我的藏品失败"))}else{const te=await Kt({page:m,token:M,status:{consign:1,sold:2}[T]});if(ee(te)&&te.data){const Q=te.data.list||[],Ne=Q.map(ue=>({id:ue.id,item_id:ue.item_id||0,user_collection_id:ue.user_collection_id||0,item_title:ue.item_title,item_image:ue.image||ue.item_image||"",price:String(ue.consignment_price),status_text:ue.status_text,consignment_status:T==="consign"?be.CONSIGNING:be.SOLD,delivery_status:We.NOT_DELIVERED}));x(m===1?Ne:ue=>[...ue,...Ne]),f(Q.length>=10&&te.data.has_more!==!1)}else c(oe(te,"获取寄售列表失败"))}}catch(X){c((X==null?void 0:X.message)||"加载数据失败")}finally{l(!1)}},K=M=>{const te=(Math.floor(Date.now()/1e3)-M)/3600,Q=48-te;return{passed:te>=48,hoursLeft:Math.max(0,Math.ceil(Q))}},C=M=>{const te=Math.floor(Date.now()/1e3)-M,Q=48*3600-te;if(Q<=0)return null;const Ne=Math.floor(Q/3600),ue=Math.floor(Q%3600/60),De=Q%60;return{hours:Ne,minutes:ue,seconds:De}};n.useEffect(()=>{if(!u||!N||F!=="consignment"){p(null);return}if(K(N.pay_time||N.buy_time||0).passed){p(null);return}const X=C(N.pay_time||N.buy_time||0);p(X);const te=setInterval(()=>{const Q=C(N.pay_time||N.buy_time||0);Q?p(Q):(p(null),clearInterval(te))},1e3);return()=>clearInterval(te)},[u,N,F]),n.useEffect(()=>{u&&N&&(se(N)||J(N)||G(N))&&F==="consignment"&&I("delivery")},[u,N]),n.useEffect(()=>{if(!u||!N){y(null);return}y(null)},[F,u,N]);const[E,R]=n.useState(null),[O,V]=n.useState(0),[H,W]=n.useState(!1),A=M=>{const X=Math.floor(M/3600),te=Math.floor(M%3600/60),Q=M%60;return`${String(X).padStart(2,"0")}:${String(te).padStart(2,"0")}:${String(Q).padStart(2,"0")}`},[$,U]=n.useState(null);n.useEffect(()=>{if(!u||!N){R(null),V(0);return}const M=Re(N);if(M==null){R(null);return}let X=!0;const te=localStorage.getItem(ne)||void 0;return W(!0),Promise.all([ps({user_collection_id:M,token:te}),bs({page:1,limit:100,status:1,token:te})]).then(([Q,Ne])=>{var ve,Se,Qe;if(!X)return;R((Q==null?void 0:Q.data)??null);const ue=((ve=Ne.data)==null?void 0:ve.list)||[],De=N.session_id||((Se=N.original_record)==null?void 0:Se.session_id),He=N.zone_id||((Qe=N.original_record)==null?void 0:Qe.zone_id);if(De&&He){const Bt=ue.filter($t=>String($t.session_id)===String(De)&&String($t.zone_id)===String(He));V(Bt.length)}else V(ue.length>0?ue.length:0)}).catch(Q=>{console.error("Fetch data failed",Q),X&&(R(null),V(0))}).finally(()=>{X&&W(!1)}),()=>{X=!1}},[u,N]),n.useEffect(()=>{if(!E){U(null);return}let M=0;if(typeof E.remaining_seconds<"u"&&E.remaining_seconds!==null)M=Number(E.remaining_seconds)||0;else if(typeof E.remaining_text=="string"){const Q=E.remaining_text.match(/(\d{1,}):(\d{2}):(\d{2})/);if(Q){const Ne=Number(Q[1])||0,ue=Number(Q[2])||0,De=Number(Q[3])||0;M=Ne*3600+ue*60+De}else M=0}else{U(null);return}U(M>0?M:0);let X=!0;const te=setInterval(()=>{X&&(M=Math.max(0,M-1),U(M),M<=0&&clearInterval(te))},1e3);return()=>{X=!1,clearInterval(te)}},[E]);const G=M=>{const X=M.consignment_status;return typeof X=="number"&&X!==be.NOT_CONSIGNED},J=M=>M.consignment_status===be.SOLD,se=M=>M.consignment_status===be.CONSIGNING,de=M=>M.delivery_status===We.DELIVERED,Re=M=>{var X,te,Q;return M.user_collection_id??((X=M.original_record)==null?void 0:X.user_collection_id)??((te=M.original_record)==null?void 0:te.order_id)??((Q=M.original_record)==null?void 0:Q.id)??M.id??M.item_id},ie=M=>{if(s){s(M);return}i(M),se(M)||J(M)||G(M)||M.delivery_status===We.NOT_DELIVERED?I("delivery"):M.consignment_status===be.NOT_CONSIGNED?I("consignment"):I("delivery"),y(null),_(!0)},xe=()=>{if(!N||se(N)||J(N))return!1;const M=Re(N);if(M==null)return!1;if(F==="delivery"){if(de(N))return!1;if(E){if(typeof E.can_consign=="boolean")return!!E.can_consign;if(typeof E.unlocked=="boolean")return!!E.unlocked;if(typeof E.remaining_seconds=="number")return Number(E.remaining_seconds)<=0;if(typeof $=="number")return $<=0}return!0}else{const X=K(N.pay_time||N.buy_time||0),te=O>0;if(E){let Q=!1;return typeof E.can_consign=="boolean"?Q=E.can_consign:typeof E.unlocked=="boolean"?Q=E.unlocked:typeof E.remaining_seconds=="number"?Q=Number(E.remaining_seconds)<=0:typeof $=="number"?Q=$<=0:Q=X.passed,H?!1:Q&&te}return H?!1:X.passed&&te}},{showToast:ae,showDialog:le}=he(),me=async M=>{var Ne,ue,De;if(!N||S)return;const X=localStorage.getItem(ne);if(!X){ae("warning","请登录","请先登录后再进行操作");return}const te=()=>{b(1),B()},Q=Re(N);if(Q==null){ae("error","错误","无法获取藏品ID，无法继续操作");return}if(M==="delivery"){if(se(N)){ae("warning","提示","该藏品正在寄售中，无法提货");return}if(J(N)){ae("warning","提示","该藏品已经寄售成功（已售出），无法提货");return}if(de(N)){ae("warning","提示","该藏品已经提货，无法再次提货");return}const He=G(N),ve=()=>{k(!0),ka({user_collection_id:Q,token:X}).then(Se=>{ee(Se)?(ae("success","操作成功",oe(Se,"权益分割已提交")),_(!1),i(null),te()):ae("error","操作失败",oe(Se,"权益分割失败"))}).catch(Se=>{ae("error","提交失败",oe(Se,"权益分割失败"))}).finally(()=>k(!1))};He?le({title:"强制权益分割确认",description:"该藏品曾经寄售过，确定要强制执行权益分割吗？",confirmText:"确定分割",cancelText:"取消",onConfirm:ve}):ve()}else{if(se(N)){ae("warning","提示","该藏品正在寄售中，无法再次寄售");return}if(J(N)){ae("warning","提示","该藏品已经寄售成功（已售出），无法再次寄售");return}try{const ve=await ps({user_collection_id:Q,token:X}),Se=ve==null?void 0:ve.data;if(Se){if(typeof Se.unlocked=="boolean"){if(!Se.unlocked){const Qe=Se.remaining_seconds?Math.ceil(Number(Se.remaining_seconds)/3600):0;ae("warning","时间未到",`寄售需要满足购买后48小时，还需等待 ${Qe} 小时`);return}}else if(typeof Se.remaining_seconds=="number"&&Number(Se.remaining_seconds)>0){const Qe=Math.ceil(Number(Se.remaining_seconds)/3600);ae("warning","时间未到",`寄售需要满足购买后48小时，还需等待 ${Qe} 小时`);return}}}catch{}try{const Se=((Ne=(await bs({page:1,limit:100,status:1,token:X})).data)==null?void 0:Ne.list)||[];if(Se.length===0){ae("warning","缺少道具","您没有可用的寄售券，无法进行寄售");return}const Qe=N.session_id||((ue=N.original_record)==null?void 0:ue.session_id),Bt=N.zone_id||((De=N.original_record)==null?void 0:De.zone_id);if(!Qe||!Bt){if(!(Se.length>0)){ae("warning","缺少道具","您没有可用的寄售券");return}}else if(!Se.find(Ps=>String(Ps.session_id)===String(Qe)&&String(Ps.zone_id)===String(Bt))){ae("warning","寄售券不匹配","您没有该场次和分区的可用寄售券");return}}catch(ve){console.error("获取寄售券失败",ve),ae("warning","校验失败","无法验证寄售券信息，请稍后重试");return}const He=parseFloat(N.price||"0");if(Number.isNaN(He)||He<=0){y("藏品价格无效，无法进行寄售");return}k(!0),_a({user_collection_id:Q,price:He,token:X}).then(ve=>{ee(ve)?(ae("success","提交成功",oe(ve,"寄售申请已提交")),_(!1),i(null),L("consign")):ae("error","提交失败",oe(ve,"寄售申请失败"))}).catch(ve=>{y(oe(ve,"寄售申请失败"))}).finally(()=>k(!1))}},ye=M=>{const X=M.item_title||M.title||"未命名藏品",te=M.item_image||M.image||"";return e.jsx("div",{className:"bg-white rounded-lg p-4 mb-3 shadow-sm cursor-pointer active:bg-gray-50 transition-colors",onClick:()=>ie(M),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:ke(te)||void 0,alt:X,className:"w-full h-full object-cover",onError:Q=>{Q.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 flex-1",children:X}),e.jsx(St,{size:16,className:"text-gray-400 ml-2 flex-shrink-0"})]}),M.order_no&&e.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["订单号: ",M.order_no]}),M.asset_code&&e.jsxs("div",{className:"text-xs text-gray-400 mb-1 truncate",title:M.asset_code,children:["确权编号: ",M.asset_code]}),M.fingerprint&&e.jsxs("div",{className:"text-xs text-gray-400 mb-1 truncate",title:M.fingerprint,children:["存证指纹: ",M.fingerprint.length>20?`${M.fingerprint.substring(0,10)}...${M.fingerprint.substring(M.fingerprint.length-10)}`:M.fingerprint]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["购买时间: ",M.pay_time_text||M.buy_time_text]}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 mb-2",children:["¥ ",M.price]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:M.status_text?e.jsx("div",{className:`text-xs px-2 py-1 rounded-full border ${M.status_text.includes("寄售")||M.status_text.includes("出售")?"bg-blue-50 text-blue-600 border-blue-200":M.status_text.includes("确权")||M.status_text.includes("成功")||M.status_text.includes("已售出")?"bg-green-50 text-green-600 border-green-200":M.status_text.includes("失败")||M.status_text.includes("取消")?"bg-red-50 text-red-600 border-red-200":M.status_text.includes("提货")||M.status_text.includes("待")?"bg-orange-50 text-orange-600 border-orange-200":"bg-gray-50 text-gray-600 border-gray-200"}`,children:M.status_text}):M.consignment_status===be.SOLD?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-green-50 text-green-600 border border-green-200",children:"已售出"}):M.consignment_status===be.CONSIGNING?e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-600 border border-blue-200",children:"寄售中"}):M.delivery_status===We.DELIVERED?e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${M.delivery_status_text==="待发货"?"bg-blue-50 text-blue-600 border border-blue-200":M.delivery_status_text==="待收货"?"bg-yellow-50 text-yellow-600 border border-yellow-200":(M.delivery_status_text==="已签收","bg-green-50 text-green-600 border border-green-200")}`,children:M.delivery_status_text||"已提货"}):G(M)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:"待提货"}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${M.consignment_status===be.NOT_CONSIGNED?"bg-gray-50 text-gray-600 border border-gray-200":M.consignment_status===be.PENDING?"bg-yellow-50 text-yellow-600 border border-yellow-200":M.consignment_status===be.REJECTED?"bg-red-50 text-red-600 border border-red-200":"bg-green-50 text-green-600 border border-green-200"}`,children:M.consignment_status_text||"待寄售"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:"○ 未提货"}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${M.consignment_status===be.NOT_CONSIGNED?"bg-gray-50 text-gray-600 border border-gray-200":M.consignment_status===be.PENDING?"bg-yellow-50 text-yellow-600 border border-yellow-200":M.consignment_status===be.REJECTED?"bg-red-50 text-red-600 border border-red-200":"bg-green-50 text-green-600 border border-green-200"}`,children:M.consignment_status_text||"未寄售"})]})})]})]})})};return e.jsx(xt,{title:"我的藏品",onBack:t,children:e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-white px-4 pt-2 pb-0 border-b border-gray-100 flex justify-between items-center z-10 shrink-0",children:Y.map(M=>e.jsxs("button",{onClick:()=>L(M.id),className:`flex-1 py-3 text-sm font-medium relative transition-colors ${T===M.id?"text-orange-600":"text-gray-500 hover:text-gray-700"}`,children:[M.label,T===M.id&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-0.5 bg-orange-600 rounded-full"})]},M.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:r&&m===1?e.jsx(ge,{text:"加载中..."}):o?e.jsx(Oe,{icon:e.jsx(Te,{size:48,className:"text-gray-300"}),title:"加载失败",description:o}):d.length===0?e.jsx(Oe,{icon:e.jsx(yt,{size:48,className:"text-gray-300"}),title:"暂无藏品",description:"您还没有任何藏品"}):e.jsxs(e.Fragment,{children:[d.map(M=>e.jsx(es.Fragment,{children:ye(M)},M.id)),g&&e.jsx("button",{onClick:()=>b(M=>M+1),disabled:r,className:"w-full py-2 text-sm text-blue-600 disabled:opacity-50",children:r?"加载中...":"加载更多"})]})}),u&&N&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>_(!1),children:e.jsxs("div",{className:"bg-[#F9F9F9] rounded-xl overflow-hidden max-w-sm w-full relative shadow-2xl animate-in zoom-in-95 duration-200",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"bg-white px-5 py-4 flex justify-between items-center border-b border-gray-100",children:[e.jsx("div",{className:"text-base font-bold text-gray-900",children:"资产挂牌委托"}),e.jsx("button",{type:"button",className:"p-1 text-gray-400 hover:text-gray-600 active:scale-95 transition-transform",onClick:()=>_(!1),children:e.jsx(Ce,{size:20})})]}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-50 rounded-lg overflow-hidden flex-shrink-0 border border-gray-100",children:e.jsx("img",{src:ke(N.item_image||N.image||""),alt:N.item_title||N.title,className:"w-full h-full object-cover",onError:M=>{M.target.src="https://via.placeholder.com/150"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 mb-1 truncate leading-tight",children:N.item_title||N.title}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono truncate bg-gray-50 inline-block px-1.5 py-0.5 rounded",children:["确权编号：",N.asset_code||N.order_no||"Pending..."]})]})]}),(()=>{const M=parseFloat(N.price||"0"),X=M*.055,te=M*1.055;return e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-3 border-t border-dashed border-gray-100",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 mb-0.5",children:"当前估值"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900 font-[DINAlternate-Bold]",children:["¥",M.toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-col items-center border-l border-r border-gray-50",children:[e.jsx("span",{className:"text-[10px] text-gray-400 mb-0.5",children:"预期收益 (5.5%)"}),e.jsxs("span",{className:"text-sm font-bold text-red-500 font-[DINAlternate-Bold]",children:["+",X.toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-gray-400 mb-0.5",children:"预估回款"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900 font-[DINAlternate-Bold]",children:["¥",te.toFixed(2)]})]})]})})()]}),(()=>{const M=E||{};let X=!1,te=0;if(typeof M.unlocked=="boolean"&&!M.unlocked)X=!0,te=Number(M.remaining_seconds||0);else if(typeof M.remaining_seconds=="number"&&Number(M.remaining_seconds)>0)X=!0,te=Number(M.remaining_seconds);else{const Q=K(N.pay_time||N.buy_time||0);Q.passed||(X=!0,te=Q.hoursLeft*3600)}return X?e.jsxs("div",{className:"flex items-center justify-center gap-2 bg-orange-50 text-orange-600 py-2.5 rounded-lg border border-orange-100 px-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-medium",children:["🔒 锁定期剩余 ",A(te)]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 bg-green-50 text-green-700 py-2.5 rounded-lg border border-green-100",children:[e.jsx(Ge,{size:14,className:"text-green-600"}),e.jsx("span",{className:"text-xs font-medium",children:"T+1 解锁期已满，当前可流转"})]})})(),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("div",{className:"w-0.5 h-3 bg-gray-300 rounded-full"}),e.jsx("span",{className:"text-xs font-bold text-gray-500",children:"挂牌成本核算"}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 space-y-4",children:[(()=>{const X=parseFloat(N.price||"0")*.03,te=parseFloat((w==null?void 0:w.service_fee_balance)||"0"),Q=te>=X;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"确权技术服务费 (3%)"}),e.jsxs("div",{className:`text-xs mt-0.5 ${Q?"text-gray-400":"text-red-500"}`,children:["当前确权金: ¥",te.toFixed(2)," ",!Q&&"(不足)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900 font-[DINAlternate-Bold]",children:["¥",X.toFixed(2)]}),!Q&&e.jsx("button",{className:"text-[10px] text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded mt-1",onClick:()=>{ae("info","余额不足","请前往【我的-服务费】进行充值")},children:"去充值"})]})]})})(),e.jsx("div",{className:"w-full h-px bg-gray-50"}),(()=>{const M=O>0;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"资产流转券"}),e.jsxs("div",{className:`text-xs mt-0.5 ${M?"text-gray-400":"text-red-500"}`,children:["持有数量: ",O," 张"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-sm font-bold font-[DINAlternate-Bold] ${M?"text-gray-900":"text-red-500"}`,children:"1 张"})})]})})()]})]}),P&&e.jsx("div",{className:"text-xs text-red-600 text-center bg-red-50 py-2 rounded-lg",children:P}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{onClick:()=>{I("delivery"),me("delivery")},disabled:S||se(N)||J(N)||de(N),className:"flex-[3] flex flex-col items-center justify-center py-3 rounded-xl bg-white border border-gray-200 text-gray-600 active:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm",children:[e.jsx("span",{className:"text-sm font-bold",children:"权益交割"}),e.jsx("span",{className:"text-[10px] text-gray-400 font-normal scale-90",children:"转为每日分红"})]}),e.jsx("button",{onClick:()=>{I("consignment"),me("consignment")},disabled:S||!xe()||se(N),className:"flex-[7] flex flex-col items-center justify-center py-3 rounded-xl bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-200 active:scale-[0.98] disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed transition-all",children:S?e.jsx("span",{className:"text-sm font-bold",children:"提交中..."}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-bold",children:"确认挂牌上架"}),e.jsx("span",{className:"text-[10px] text-white/80 font-normal scale-90",children:"立即发布到撮合池"})]})})]})]})]})})]})})},Oa=({item:t,onBack:s,onNavigate:a})=>{const[r,l]=n.useState(null),[o,c]=n.useState(t),[d,x]=n.useState(!0),{showToast:m}=he();if(n.useEffect(()=>{(async()=>{const j=localStorage.getItem(ne);if(!j){x(!1);return}try{const w=t.user_collection_id||t.id,v=await Rn(w),u=re(v);u&&c(u);const _=await $e(j),N=re(_);let i=(N==null?void 0:N.userInfo)||null;const F=await Zt(j),I=re(F);I&&(i?i={...i,real_name:I.real_name||i.real_name,real_name_status:I.real_name_status}:i={real_name:I.real_name,real_name_status:I.real_name_status}),i&&l(i)}catch(w){console.error(w)}finally{x(!1)}})()},[t]),d)return e.jsx("div",{className:"min-h-screen bg-[#FDFBF7] flex items-center justify-center",children:e.jsx(ge,{})});const b=o.name||o.item_title||o.title||"未命名藏品",f=(parseFloat(o.price||"0")*1.055).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"min-h-screen bg-[#FDFBF7] text-gray-900 font-serif pb-24 relative overflow-hidden",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 6rem)"},children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]"}),e.jsxs("header",{className:"sticky top-0 z-40 bg-[#FDFBF7]/90 backdrop-blur-sm px-4 py-4 flex justify-between items-center border-b border-amber-900/5",children:[e.jsx("button",{onClick:s,className:"p-2 hover:bg-black/5 rounded-full transition-colors text-gray-800",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"数字资产持有凭证"}),e.jsx("button",{className:"p-2 hover:bg-black/5 rounded-full text-gray-800",children:e.jsx(ts,{size:20})})]}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"bg-white relative shadow-2xl shadow-gray-200/50 rounded-sm overflow-hidden border-[6px] border-double border-amber-900/10 p-6 md:p-8",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none",children:e.jsx(rt,{size:200})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-amber-50 text-amber-900 mb-3 border border-amber-100",children:e.jsx(_t,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 tracking-wide mb-1",children:"数字资产持有凭证"}),e.jsx("div",{className:"text-[10px] text-gray-400 uppercase tracking-[0.2em]",children:"Digital Asset Certificate"})]}),e.jsxs("div",{className:"space-y-6 relative z-10 font-sans",children:[e.jsxs("div",{className:"text-center py-6 mb-2 relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.08] pointer-events-none rounded-lg border border-amber-900/5 overflow-hidden",style:{backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 10px, #C5A572 10px, #C5A572 11px),
                                    repeating-linear-gradient(-45deg, transparent, transparent 10px, #C5A572 10px, #C5A572 11px)`}}),e.jsxs("div",{className:"text-sm text-gray-600 font-[courier,monospace] font-bold tracking-widest mb-3 relative z-10 drop-shadow-sm cursor-pointer hover:text-amber-600 transition-colors flex items-center justify-center gap-2",onClick:()=>{const h=o.asset_code||`37-DATA-****-${String(o.id||8821).padStart(4,"0")}`;navigator.clipboard.writeText(h).then(()=>{m("success","确权编号已复制")}).catch(()=>{m("error","复制失败")})},children:[e.jsxs("span",{children:["确权编号：",o.asset_code||`37-DATA-****-${String(o.id||8821).padStart(4,"0")}`]}),e.jsx(nt,{size:12,className:"text-gray-400"})]}),e.jsxs("h3",{className:"text-2xl font-extrabold text-gray-700 mb-3 font-serif tracking-tight leading-tight relative z-10 drop-shadow-sm px-2",children:["【",b,"】"]}),e.jsxs("div",{className:"text-base font-bold text-gray-600 tracking-wide relative z-10 mb-4",children:["持有人：",(()=>{const h=r==null?void 0:r.real_name;return h?h.length<=2?h.charAt(0)+"*":h.charAt(0)+"*".repeat(h.length-2)+h.charAt(h.length-1):"未认证"})()]}),e.jsx("div",{className:"absolute -right-4 -bottom-6 w-32 h-32 opacity-[0.85] -rotate-12 mix-blend-multiply z-20 pointer-events-none filter contrast-125 brightness-90",children:e.jsxs("svg",{viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsx("path",{id:"textCircleTop",d:"M 25,100 A 75,75 0 1,1 175,100",fill:"none"}),e.jsxs("filter",{id:"roughPaper",children:[e.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.08",numOctaves:"3",result:"noise"}),e.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"3"})]})]}),e.jsxs("g",{filter:"url(#roughPaper)",fill:"#B22222",stroke:"none",children:[" ",e.jsx("circle",{cx:"100",cy:"100",r:"96",fill:"none",stroke:"#B22222",strokeWidth:"3"}),e.jsx("circle",{cx:"100",cy:"100",r:"92",fill:"none",stroke:"#B22222",strokeWidth:"1"}),e.jsx("text",{fontSize:"14",fontWeight:"bold",fontFamily:"SimSun, serif",fill:"#B22222",children:e.jsx("textPath",{href:"#textCircleTop",startOffset:"50%",textAnchor:"middle",spacing:"auto",children:"树交所数字资产登记结算中心"})}),e.jsx("text",{x:"100",y:"100",fontSize:"40",textAnchor:"middle",dominantBaseline:"middle",fill:"#B22222",children:"★"}),e.jsx("text",{x:"100",y:"135",fontSize:"18",fontWeight:"bold",fontFamily:"SimHei, sans-serif",textAnchor:"middle",fill:"#B22222",children:"确权专用章"}),e.jsx("text",{x:"100",y:"155",fontSize:"10",fontFamily:"Arial, sans-serif",fontWeight:"bold",textAnchor:"middle",fill:"#B22222",letterSpacing:"1",children:"37010299821"})]})]})})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(rt,{size:16,className:"text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-0.5",children:"Asset Anchor / 资产锚定"}),e.jsxs("div",{className:"text-sm font-medium text-gray-600",children:["涉及农户/合作社：",o.farmer_info||"暂无数据",e.jsx("span",{className:"inline-block ml-1 text-[10px] text-amber-600 border border-amber-200 px-1 rounded bg-white",children:"隐私保护"})]}),e.jsxs("div",{className:"text-xs font-medium text-gray-600 mt-1",children:["核心企业：",o.core_enterprise||"暂无数据"]}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-1 leading-tight",children:"* 根据《数据安全法》及商业保密协议，底层隐私信息已做Hash脱敏处理，仅持有人可申请解密查看。"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2 tracking-wider",children:"Blockchain Fingerprint / 存证指纹"}),e.jsxs("div",{className:"bg-gray-900 text-green-500 font-mono text-[10px] p-3 rounded-t break-all leading-relaxed relative group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-gray-500 font-sans font-bold",children:[e.jsx(or,{size:12}),e.jsx("span",{className:"uppercase",children:"TREE-CHAIN CONSORTIUM"})]}),o.fingerprint||o.md5||o.tx_hash||"0x7d9a8b1c4e2f3a6b9c8d7e6f5a4b3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6"]}),e.jsxs("div",{className:"bg-gray-800 rounded-b p-2 flex gap-2 border-t border-gray-700",children:[e.jsxs("button",{onClick:()=>{const h=o.fingerprint||o.md5||o.tx_hash||"0x7d9a8b1c4e2f3a6b9c8d7e6f5a4b3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6";navigator.clipboard.writeText(h).then(()=>{m("success","已复制MD5指纹")}).catch(()=>{m("error","复制失败")})},className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-[10px] py-1.5 rounded flex items-center justify-center gap-1 transition-colors",children:[e.jsx(nt,{size:10}),"复制Hash"]}),e.jsxs("button",{onClick:()=>{const h=o.fingerprint||o.md5||o.tx_hash||"";if(!h){m("error","无法获取MD5指纹");return}a({name:"search",code:h})},className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-[10px] py-1.5 rounded flex items-center justify-center gap-1 transition-colors",children:[e.jsx(da,{size:10}),"去查证"]})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t border-gray-100 z-[9999] pointer-events-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 px-1",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:"当前估值"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-700 font-mono",children:["¥",f]}),e.jsx("span",{className:"text-xs text-red-500 font-bold ml-2 bg-red-50 px-1.5 py-0.5 rounded-full",children:"+5.5%"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("button",{onClick:()=>{m("info","提示","权益交割功能正在开发中，敬请期待")},className:"flex-1 bg-gray-500 text-white hover:bg-gray-600 transition-colors py-3.5 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg shadow-gray-500/20 active:scale-[0.98] pointer-events-auto touch-manipulation",children:[e.jsx(cr,{size:18}),"权益交割(转分红)"]}),e.jsxs("button",{onClick:()=>{a({name:"my-collection-consignment",id:String(o.id)})},className:"flex-1 bg-[#8B0000] text-amber-100 hover:bg-[#A00000] transition-colors py-3.5 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg shadow-red-900/20 active:scale-[0.98] pointer-events-auto touch-manipulation",children:[e.jsx(dr,{size:18}),"立即上架寄售"]})]})]})]})},Qs=()=>({name:"",phone:"",province:"",city:"",district:"",address:"",is_default:!1}),vl=({onBack:t})=>{const{showToast:s,showDialog:a}=he(),{errorMessage:r,hasError:l,handleError:o,clearError:c}=Ie(),{errorMessage:d,hasError:x,handleError:m,clearError:b}=Ie(),[g,f]=n.useState([]),[h,j]=n.useState(!1),[w,v]=n.useState("list"),[u,_]=n.useState(null),[N,i]=n.useState(()=>Qs()),[F,I]=n.useState(!1),[z,p]=n.useState(null),[P,y]=n.useState(!1),S=async()=>{var E;const C=localStorage.getItem(ne)||"";if(!C){o("未检测到登录信息，请重新登录后再查看地址列表",{persist:!0,showToast:!1});return}j(!0);try{const R=await fa(C);ee(R)&&((E=R.data)!=null&&E.list)?(f(R.data.list),c()):o(R,{persist:!0,showToast:!1})}catch(R){o(R,{persist:!0,showToast:!1,customMessage:"获取地址列表失败"})}finally{j(!1)}};n.useEffect(()=>{S()},[]);const k=async C=>{C==null||C===""||a({title:"删除地址",description:"确定要删除该收货地址吗？此操作无法撤销。",confirmText:"删除",cancelText:"取消",onConfirm:async()=>{try{const E=await on({id:C});s("success",(E==null?void 0:E.msg)||"删除成功"),S()}catch(E){o(E,{toastTitle:"删除失败",customMessage:"删除收货地址失败",context:{addressId:C}})}}})},T=async C=>{if(!K(C)){j(!0);try{const E=await Ls({id:C.id,name:C.name,phone:C.phone,province:C.province,city:C.city,district:C.district,address:C.address,is_default:1});ee(E)?await S():o(E,{persist:!0,customMessage:"设置默认地址失败"})}catch(E){o(E,{persist:!0,customMessage:"设置默认地址失败"})}finally{j(!1)}}},D=(C,E)=>{i(R=>({...R,[C]:E}))},Y=()=>{i(Qs()),b()},L=async C=>{C.preventDefault(),b(),p(null);const{name:E,phone:R,province:O,city:V,district:H,address:W,is_default:A}=N;if(!E.trim())return m("请输入收货人姓名",{persist:!0,showToast:!1});if(!R.trim())return m("请输入手机号",{persist:!0,showToast:!1});if(!O.trim()||!V.trim())return m("请输入完整的省市信息",{persist:!0,showToast:!1});if(!W.trim())return m("请输入详细地址",{persist:!0,showToast:!1});I(!0);try{const U=await Ls({id:w==="edit"&&u!==null&&u!==""?u:void 0,name:E.trim(),phone:R.trim(),province:O.trim(),city:V.trim(),district:H.trim(),address:W.trim(),is_default:A?1:0});ee(U)?(p(w==="edit"?"地址已更新":"新增地址成功"),Y(),v("list"),_(null),await S()):m(U,{persist:!0,showToast:!1,customMessage:"保存地址失败，请检查填写信息"})}catch($){m($,{persist:!0,showToast:!1,customMessage:"保存地址失败，请稍后重试"})}finally{I(!1)}},B=C=>[C.province,C.city,C.district,C.address].filter(Boolean).join(" "),K=C=>["1",1,!0,"true"].includes(C.is_default);return e.jsxs(xt,{title:w==="add"?"新增收货地址":w==="edit"?"编辑收货地址":"收货地址",onBack:()=>{w==="add"||w==="edit"?(Y(),v("list"),_(null)):t()},children:[e.jsxs("div",{className:"p-4 space-y-4 pb-24",children:[z&&w==="list"&&e.jsx("div",{className:"bg-green-50 text-green-600 text-xs px-3 py-2 rounded-lg",children:z}),(w==="add"||w==="edit")&&e.jsxs("form",{className:"bg-white mt-2 px-4",onSubmit:L,children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["收货人姓名 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium",type:"text",placeholder:"请输入收货人姓名",value:N.name,onChange:C=>D("name",C.target.value)})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["手机号 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium",type:"tel",placeholder:"请输入手机号",value:N.phone,onChange:C=>D("phone",C.target.value)})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",onClick:()=>y(!0),children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["所在地区 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`text-base font-medium ${N.province?"text-gray-900":"text-gray-300"}`,children:N.province&&N.city?`${N.province} ${N.city} ${N.district||""}`:"点击选择省市区"}),e.jsx(At,{size:18,className:"text-gray-400"})]})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsxs("span",{className:"block text-sm text-gray-500 mb-1",children:["详细地址 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full text-base text-gray-900 outline-none placeholder:text-gray-300 bg-transparent font-medium resize-none min-h-[80px]",placeholder:"街道、小区、楼栋、门牌号等",value:N.address,onChange:C=>D("address",C.target.value)})]}),e.jsxs("label",{className:"flex items-center justify-between py-4",children:[e.jsx("span",{className:"text-base text-gray-800",children:"设为默认地址"}),e.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:N.is_default,onChange:C=>D("is_default",C.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),x&&e.jsx("div",{className:"bg-red-50 text-red-600 text-xs px-3 py-2 rounded-md mb-4",children:d}),e.jsx("button",{type:"submit",disabled:F,className:"w-full bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white text-base font-bold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform disabled:opacity-60 disabled:cursor-not-allowed mt-4 mb-8",children:F?"提交中...":"保存地址"})]}),w==="list"&&e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"bg-red-50 text-red-600 text-xs px-3 py-2 rounded-lg",children:r}),h&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-4",children:"正在加载收货地址..."}),!h&&!g.length&&!l&&e.jsx("div",{className:"text-center text-xs text-gray-400 py-8",children:"暂无收货地址，请点击下方按钮新增"}),g.map(C=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-gray-900",children:C.name}),e.jsx("span",{className:"text-gray-500 text-sm",children:C.phone}),K(C)&&e.jsx("span",{className:"bg-red-50 text-red-500 text-[10px] px-2 py-0.5 rounded-full",children:"默认"})]}),e.jsx("button",{className:"text-gray-400 p-1",onClick:()=>{_(C.id??null),i({name:C.name||"",phone:C.phone||"",province:C.province||"",city:C.city||"",district:C.district||"",address:C.address||"",is_default:K(C)}),b(),p(null),v("edit")},children:e.jsx(xr,{size:16})})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 leading-relaxed pr-8 mb-3",children:[e.jsx(At,{size:14,className:"mt-0.5 text-gray-400"}),e.jsx("span",{children:B(C)})]}),e.jsxs("div",{className:"border-t border-gray-50 pt-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer active:opacity-60 transition-opacity",onClick:()=>T(C),children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center ${K(C)?"border-red-500 bg-red-500":"border-gray-300"}`,children:K(C)&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("span",{className:`text-xs ${K(C)?"text-red-500 font-bold":"text-gray-500"}`,children:"默认地址"})]}),e.jsxs("button",{className:"flex items-center gap-1 text-xs text-gray-500",onClick:()=>k(C.id),children:[e.jsx(Ns,{size:14}),"删除"]})]})]},C.id))]})]}),w==="list"&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 pb-safe max-w-md mx-auto",children:e.jsxs("button",{className:"w-full bg-gradient-to-r from-[#FF6B35] to-[#FF9F2E] text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform shadow-lg shadow-orange-200",onClick:()=>{Y(),p(null),v("add")},children:[e.jsx(js,{size:20}),"新增收货地址"]})}),e.jsx(li,{visible:P,onClose:()=>y(!1),onConfirm:(C,E,R)=>{D("province",C),D("city",E),D("district",R||""),y(!1)},initialProvince:N.province,initialCity:N.city,initialDistrict:N.district})]})};var Pt=(t=>(t.IDLE="idle",t.LOADING="loading",t.FORM="form",t.VERIFYING="verifying",t.PROCESSING="processing",t.SUBMITTING="submitting",t.SUCCESS="success",t.PENDING="pending",t.ERROR="error",t))(Pt||{});const wl={idle:{LOAD:"loading",VERIFY_CALLBACK:"processing"},loading:{LOAD_SUCCESS_VERIFIED:"success",LOAD_SUCCESS_PENDING:"pending",LOAD_SUCCESS_FORM:"form",LOAD_ERROR:"error"},form:{SUBMIT:"verifying"},verifying:{},processing:{VERIFY_SUCCESS:"submitting",VERIFY_ERROR:"error"},submitting:{SUBMIT_SUCCESS:"success",SUBMIT_ERROR:"error"},success:{},pending:{},error:{RETRY:"form",RETRY_LOAD:"loading"}};function _l(){const{showToast:t}=he(),{state:s,context:a,send:r,setContext:l}=Ba({initial:"idle",transitions:wl,context:{status:null,error:null,realName:"",idCard:"",authToken:null,callbackCode:null,callbackSuccess:null},debug:!1});n.useEffect(()=>{const f=new URLSearchParams(window.location.search),h=f.get("authToken");h?(window.history.replaceState({},"",window.location.pathname),r("VERIFY_CALLBACK",{authToken:h,callbackCode:f.get("code"),callbackSuccess:f.get("success")==="true"})):r("LOAD")},[r]),n.useEffect(()=>{s==="loading"&&o()},[s]),n.useEffect(()=>{s==="processing"&&c()},[s]),n.useEffect(()=>{s==="submitting"&&a.authToken&&d()},[s]);const o=async()=>{const f=localStorage.getItem(ne)||"";if(!f){r("LOAD_ERROR",{error:"未找到登录信息，请先登录"});return}try{const h=await Ut(()=>Zt(f),j=>r("LOAD_ERROR",{error:j}));if(!h)return;h.real_name_status===ys.VERIFIED?r("LOAD_SUCCESS_VERIFIED",{status:h,realName:h.real_name||"",idCard:h.id_card||""}):h.real_name_status===ys.PENDING?r("LOAD_SUCCESS_PENDING",{status:h}):r("LOAD_SUCCESS_FORM",{status:h,realName:h.real_name||"",idCard:h.id_card||""})}catch(h){const j=oe(h,"获取实名认证状态失败，请稍后重试");r("LOAD_ERROR",{error:j})}},c=async()=>{const f=localStorage.getItem(ne)||"";if(!f){r("VERIFY_ERROR",{error:"未找到登录信息，请先登录"});return}if(a.callbackCode&&a.callbackCode!=="0"){const h=Ua(a.callbackCode);t("error","核身失败",h),r("VERIFY_ERROR",{error:h});return}if(a.callbackSuccess===!1){const h="人脸核身验证失败，请重试";t("error","核身失败",h),r("VERIFY_ERROR",{error:h});return}if(!a.authToken){r("VERIFY_ERROR",{error:"authToken缺失"});return}try{const h=await Ut(()=>rn({authToken:a.authToken,token:f}),j=>{t("error","核身失败",j),r("VERIFY_ERROR",{error:j})});if(!h)return;if(h.status===1)r("VERIFY_SUCCESS");else{const j=h.reasonTypeDesc||h.statusDesc||kl(h.status,h.reasonType);t("error","核身失败",j),r("VERIFY_ERROR",{error:j})}}catch(h){const j=oe(h,"处理核身结果失败，请稍后重试");t("error","处理失败",j),r("VERIFY_ERROR",{error:j})}},d=async()=>{const f=localStorage.getItem(ne)||"";if(!f||!a.authToken){r("SUBMIT_ERROR",{error:"缺少必要参数"});return}try{await Ut(()=>sn({auth_token:a.authToken,token:f}),j=>{t("error","提交失败",j),r("SUBMIT_ERROR",{error:j})})&&(t("success","提交成功","实名认证提交成功，请等待审核"),r("SUBMIT_SUCCESS"))}catch(h){const j=oe(h,"提交实名认证失败，请稍后重试");t("error","提交失败",j),r("SUBMIT_ERROR",{error:j})}},x=async()=>{var h,j;if(!((h=a.realName)!=null&&h.trim())){l(w=>({...w,error:"请输入真实姓名"})),t("warning","请输入真实姓名");return}if(!((j=a.idCard)!=null&&j.trim())){l(w=>({...w,error:"请输入身份证号码"})),t("warning","请输入身份证号码");return}const f=localStorage.getItem(ne)||"";if(!f){l(w=>({...w,error:"未找到登录信息，请先登录"})),t("error","登录信息缺失");return}try{l(u=>({...u,error:null})),r("SUBMIT");const w=`${window.location.origin}${window.location.pathname}`,v=await Ut(()=>an({real_name:a.realName.trim(),id_card:a.idCard.trim(),redirect_url:w,token:f}),u=>{t("error","获取认证地址失败",u),l(_=>({..._,error:u}))});if(!(v!=null&&v.authUrl)){const u="获取认证地址失败，返回数据为空";l(_=>({..._,error:u})),t("error","获取认证地址失败",u);return}window.location.href=v.authUrl}catch(w){const v=oe(w,"获取认证地址失败，请稍后重试");l(u=>({...u,error:v})),t("error","网络错误",v)}},m=()=>{r("RETRY")},b=()=>{r("RETRY_LOAD")},g=f=>{l(h=>({...h,...f}))};return{state:s,context:a,canSubmit:s==="form",isLoading:["loading","processing","submitting"].includes(s),showForm:s==="form",showSuccess:s==="success",showPending:s==="pending",showError:s==="error",handleSubmit:x,handleRetry:m,handleRetryLoad:b,updateForm:g}}function Ua(t){return{2:"身份信息不匹配",3:"身份信息不匹配",4:"活体检测不通过",5:"活体检测超时，请重试",6:"身份信息不一致",7:"无身份证照片",8:"照片过大",9:"权威数据错误，请重试",10:"活体检测不通过",11:"识别到未成年人"}[t]||"人脸核身验证失败"}function kl(t,s){return t===2?s?Ua(String(s)):"人脸核身验证失败":t===0?"核身待定，请稍后重试":"人脸核身验证失败"}const Sl=({onBack:t})=>{const{state:s,context:a,canSubmit:r,isLoading:l,showForm:o,showSuccess:c,showPending:d,showError:x,handleSubmit:m,handleRetry:b,handleRetryLoad:g,updateForm:f}=_l(),{status:h,error:j,realName:w,idCard:v}=a;return e.jsxs(_e,{title:"实名认证",onBack:t,children:[l&&e.jsx(ge,{text:s===Pt.LOADING?"正在加载实名认证信息...":s===Pt.PROCESSING?"正在处理核身结果...":s===Pt.SUBMITTING?"正在提交...":"处理中..."}),x&&j&&e.jsx("div",{className:"bg-red-50 border border-red-100 text-red-500 text-xs rounded-lg px-3 py-2 mb-4",children:j}),!l&&e.jsxs(e.Fragment,{children:[c&&e.jsxs("div",{className:"flex flex-col items-center pt-8 pb-8",children:[e.jsx(Ge,{size:64,className:"text-orange-500 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"已完成实名认证"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8 text-center max-w-[240px]",children:"您的身份信息已通过审核，现在可以享受平台的全部服务"}),e.jsxs("div",{className:"w-full bg-white px-4 border-t border-b border-gray-100",children:[e.jsxs("div",{className:"py-4 border-b border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-base text-gray-500",children:"真实姓名"}),e.jsx("span",{className:"text-base font-bold text-gray-800",children:(h==null?void 0:h.real_name)||w})]}),e.jsxs("div",{className:"py-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-base text-gray-500",children:"身份证号"}),e.jsx("span",{className:"text-base font-bold text-gray-800",children:Ni((h==null?void 0:h.id_card)||v)})]})]})]}),d&&e.jsxs("div",{className:"flex flex-col items-center pt-8 pb-8",children:[e.jsx(ze,{size:64,className:"text-orange-400 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"实名认证审核中"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8 text-center max-w-[240px]",children:"您的资料已提交，工作人员正在加急审核中，请您耐心等待"}),e.jsx("div",{className:"w-full bg-white rounded-xl shadow-sm border border-orange-100 bg-orange-50/30 overflow-hidden",children:e.jsxs("div",{className:"p-4 flex items-start gap-3",children:[e.jsx(pe,{size:18,className:"text-orange-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-orange-700 leading-5",children:"审核通常在1-3个工作日内完成。审核结果将通过站内消息通知您，请留意查看。"})]})})]}),o&&e.jsxs(e.Fragment,{children:[h!=null&&h.audit_reason?e.jsxs("div",{className:"bg-red-50 border border-red-100 text-red-600 text-sm rounded-lg p-3 mb-4 flex gap-2",children:[e.jsx(pe,{size:18,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold mb-1",children:"审核未通过"}),e.jsx("div",{className:"text-xs",children:h.audit_reason})]})]}):e.jsx("div",{className:"bg-orange-50 border border-orange-100 text-orange-700 text-xs rounded-lg p-3 mb-4",children:"根据国家相关法规要求，为了保障您的账户安全，使用相关服务前请先完成实名认证。"}),e.jsxs("div",{className:"bg-white px-4 mb-6",children:[e.jsxs("div",{className:"py-4 border-b border-gray-100 flex items-center",children:[e.jsx("span",{className:"w-24 text-base text-gray-800",children:"真实姓名"}),e.jsx("input",{type:"text",value:w,onChange:u=>f({realName:u.target.value}),placeholder:"请输入身份证上的姓名",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 text-right font-medium"})]}),e.jsxs("div",{className:"py-4 border-b border-gray-100 flex items-center",children:[e.jsx("span",{className:"w-24 text-base text-gray-800",children:"身份证号"}),e.jsx("input",{type:"text",value:v,onChange:u=>f({idCard:u.target.value}),placeholder:"请输入身份证号码",className:"flex-1 text-base text-gray-900 outline-none bg-transparent placeholder:text-gray-300 text-right font-medium"})]})]}),e.jsx("div",{className:"mb-6 px-4",children:e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(It,{size:16,className:"text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-700 leading-5",children:[e.jsx("div",{className:"font-bold mb-1",children:"人脸核身说明"}),e.jsx("div",{children:"点击提交后将跳转到第三方人脸识别页面进行身份验证，请确保本人操作并准备好您的身份证。"})]})]})})}),e.jsx("button",{className:"w-full bg-orange-600 text-white text-base font-semibold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-all disabled:opacity-60 disabled:cursor-not-allowed disabled:shadow-none",onClick:m,disabled:!r,children:s===Pt.VERIFYING?"正在跳转...":"开始人脸核身认证"})]}),x&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:b,className:"w-full bg-orange-600 text-white text-base font-semibold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-all",children:"返回表单"}),e.jsx("button",{onClick:g,className:"w-full bg-white text-orange-600 text-base font-semibold py-3.5 rounded-full border-2 border-orange-600 active:scale-[0.98] transition-all",children:"刷新状态"})]})]}),e.jsxs("div",{className:"mt-auto pt-8 text-center pb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-xs text-gray-400 mb-1",children:[e.jsx(ot,{size:12}),e.jsx("span",{children:"信息安全加密存储"})]}),e.jsx("p",{className:"text-[10px] text-gray-300 px-8 leading-4",children:"由于监管要求，您的身份信息仅用于合规认证，平台承诺严格保密，不会向任何无关第三方泄露。"})]})]})},Xs=10,Cl=({onBack:t,onNavigate:s})=>{const[a,r]=n.useState([]),[l,o]=n.useState(!0),[c,d]=n.useState(!1),[x,m]=n.useState(null),[b,g]=n.useState(0),[f,h]=n.useState(1),[j,w]=n.useState(!0),v=n.useRef(null),u=n.useCallback(async(i,F=!1)=>{try{F?d(!0):o(!0),m(null);const I=await nn({page:i,page_size:Xs});if((ee(I)||I.code===0)&&I.data){const z=I.data.list||[],p=I.data.total||0;r(F?P=>[...P,...z]:z),g(p),h(i),w(i*Xs<p)}else m(oe(I,"获取好友列表失败"))}catch(I){console.error("加载好友列表失败:",I),m(I.message||"获取好友列表失败，请稍后重试")}finally{o(!1),d(!1)}},[]);n.useEffect(()=>{u(1,!1)},[u]);const _=n.useCallback(()=>{if(!v.current||c||!j)return;const{scrollTop:i,scrollHeight:F,clientHeight:I}=v.current;i+I>=F-100&&u(f+1,!0)},[c,j,f,u]),N=i=>{if(i.join_date)return i.join_date;if(i.join_time)return Pe(i.join_time,"YYYY-MM-DD");const F=i;return F.create_time?Pe(F.create_time,"YYYY-MM-DD"):F.createtime?Pe(F.createtime,"YYYY-MM-DD"):F.add_time?Pe(F.add_time,"YYYY-MM-DD"):F.reg_time?Pe(F.reg_time,"YYYY-MM-DD"):"-"};return e.jsx(_e,{title:"我的好友",onBack:t,children:e.jsxs("div",{ref:v,onScroll:_,className:"h-full overflow-y-auto",children:[e.jsx(st,{icon:e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center",children:e.jsx(mr,{size:20})}),title:"邀请好友",subtitle:"邀请好友加入，共享艺术价值",onClick:()=>s==null?void 0:s({name:"invite-friends"})}),e.jsxs("h3",{className:"text-sm font-bold text-gray-800 mb-3 pl-1 mt-4",children:["好友列表 (",b,")"]}),l&&e.jsx(ge,{text:"加载中..."}),!l&&x&&e.jsx("div",{className:"text-center py-8 text-red-500",children:x}),!l&&!x&&a.length===0&&e.jsx(Oe,{title:"暂无好友",description:"快去邀请好友吧"}),!l&&!x&&a.length>0&&e.jsxs("div",{className:"space-y-3 pb-4",children:[a.map(i=>e.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm flex items-center gap-3",children:[e.jsx("img",{src:ke(i.avatar)||"/static/images/avatar.png",alt:i.nickname||i.username,className:"w-10 h-10 rounded-full object-cover",onError:F=>{const I=F.target;I.src="/static/images/avatar.png"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:i.nickname||i.username}),e.jsxs("div",{className:"text-xs text-gray-400",children:["加入时间: ",N(i)]})]}),e.jsx("button",{onClick:()=>s==null?void 0:s({name:"friend-detail",id:String(i.id),friend:i}),className:"text-xs bg-gray-100 text-gray-600 px-3 py-1.5 rounded-full",children:"查看"})]},i.id)),c&&e.jsxs("div",{className:"py-3 flex items-center justify-center text-gray-400 text-xs",children:[e.jsx(dt,{size:16,className:"animate-spin mr-2"}),"加载中..."]}),!j&&a.length>0&&e.jsx("div",{className:"py-3 text-center text-gray-400 text-xs",children:"已加载全部"})]})]})})},El=({onBack:t})=>{const{showToast:s}=he(),{errorMessage:a,hasError:r,handleError:l,clearError:o}=Ie(),[c,d]=n.useState(!0),[x,m]=n.useState(!1),[b,g]=n.useState(!1),[f,h]=n.useState(null),[j,w]=n.useState(""),[v,u]=n.useState(""),[_,N]=n.useState(""),[i,F]=n.useState("company"),[I,z]=n.useState(""),[p,P]=n.useState("");n.useEffect(()=>{(async()=>{const T=localStorage.getItem(ne)||"";if(!T){l("未找到登录信息，请先登录",{persist:!0,showToast:!1}),d(!1);return}try{const D=await Ds(T);if(ee(D)){const Y=D.data;h(Y),Y&&(w(Y.company_name||""),u(Y.legal_person||""),N(Y.legal_id_number||""),F(Y.subject_type===2?"individual":"company"),P(Y.license_image||""),z(ke(Y.license_image||"")))}else l(D,{persist:!0,showToast:!1,customMessage:"获取代理商状态失败"})}catch(D){l(D,{persist:!0,showToast:!1,customMessage:"获取代理商状态失败，请稍后重试"})}finally{d(!1)}})()},[]);const y=async k=>{var D,Y;const T=(D=k.target.files)==null?void 0:D[0];if(k.target.value="",!!T)try{g(!0);const L=await Is(T),B=L.data||{},K=B.url||B.path||B.filepath||"",C=B.fullurl||B.fullUrl||B.url||K;if(!K&&!C)throw new Error("上传失败，返回数据为空");P(K||C);const E=ke(C||K);z(E),s("success",(L==null?void 0:L.msg)||"上传成功")}catch(L){console.error("营业执照上传失败:",L);const B=(L==null?void 0:L.msg)||((Y=L==null?void 0:L.response)==null?void 0:Y.msg)||(L==null?void 0:L.message)||"营业执照上传失败，请稍后重试";s("error","上传失败",B)}finally{g(!1)}},S=async()=>{if(!x)try{m(!0),o();const k=localStorage.getItem(ne)||"",T=await ln({company_name:j,legal_person:v,legal_id_number:_,subject_type:i==="individual"?2:1,license_image:p,token:k});T!=null&&T.msg?s(ee(T)?"success":"info","提示",T.msg):s("success","提交成功");try{const D=await Ds(k);ee(D)&&h(D.data)}catch(D){console.warn("刷新代理商状态失败:",D)}}catch(k){console.error("提交代理商申请失败:",k);const T=(k==null?void 0:k.message)||"提交代理商申请失败，请稍后重试";s("error","提交失败",T)}finally{m(!1)}};return e.jsxs(_e,{title:"代理商申请",onBack:t,children:[c&&e.jsx(ge,{text:"正在加载代理商状态..."}),!c&&r&&e.jsx("div",{className:"bg-red-50 border border-red-100 text-red-500 text-xs rounded-lg px-3 py-2 mb-4",children:a}),f&&!c&&!r&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-4",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:"当前状态:"}),e.jsx("span",{className:"font-medium text-gray-900",children:f.status_text})]}),f.audit_remark&&e.jsxs("div",{className:"px-4 py-3 text-xs text-red-500 bg-red-50 border-t border-red-100",children:["审核备注：",f.audit_remark]})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-4",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-50 flex items-center",children:[e.jsxs("span",{className:"w-24 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ur,{size:14}),"企业名称"]}),e.jsx("input",{type:"text",value:j,onChange:k=>w(k.target.value),placeholder:"请输入企业名称",className:"flex-1 text-sm text-gray-900 outline-none bg-transparent placeholder:text-gray-300"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-50 flex items-center",children:[e.jsxs("span",{className:"w-24 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(jt,{size:14}),"企业法人"]}),e.jsx("input",{type:"text",value:v,onChange:k=>u(k.target.value),placeholder:"请输入企业法人",className:"flex-1 text-sm text-gray-900 outline-none bg-transparent placeholder:text-gray-300"})]}),e.jsxs("div",{className:"px-4 py-3 flex items-center",children:[e.jsxs("span",{className:"w-24 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(gr,{size:14}),"法人证件号"]}),e.jsx("input",{type:"text",value:_,onChange:k=>N(k.target.value),placeholder:"请输入法人证件号",className:"flex-1 text-sm text-gray-900 outline-none bg-transparent placeholder:text-gray-300"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-4",children:[e.jsx("div",{className:"px-4 pt-3 pb-2 text-xs text-gray-500",children:"个体户/企业法人"}),e.jsxs("div",{className:"px-4 pb-3 flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"radio",className:"w-4 h-4 text-orange-500",checked:i==="individual",onChange:()=>F("individual")}),e.jsx("span",{children:"个体户"})]}),e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"radio",className:"w-4 h-4 text-orange-500",checked:i==="company",onChange:()=>F("company")}),e.jsx("span",{children:"企业法人"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-4",children:[e.jsx("div",{className:"px-4 pt-3 pb-2 text-xs text-gray-500",children:"请上传营业执照"}),e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("label",{className:"border border-dashed border-gray-200 rounded-lg flex flex-col items-center justify-center py-6 text-xs text-gray-400 active:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:y}),I?e.jsx("img",{src:I,alt:"营业执照预览图",className:"w-full h-32 object-cover rounded-md mb-2"}):e.jsx(Mt,{size:28,className:"mb-2 text-gray-300"}),e.jsx("span",{className:"text-gray-700 text-xs mb-0.5",children:"预览图"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:b?"上传中...":"点击上传营业执照"})]})})]}),e.jsx("button",{className:"w-full bg-orange-500 text-white text-sm font-semibold py-3 rounded-md active:opacity-80 shadow-sm disabled:opacity-50",onClick:S,disabled:x||b||c,children:x?"提交中...":"提交申请"})]})]})},Il=({onBack:t})=>{const[s,a]=n.useState([]),[r,l]=n.useState(null),[o,c]=n.useState(null),[d,x]=n.useState({}),[m,b]=n.useState(!0),[g,f]=n.useState(null);n.useEffect(()=>{(async()=>{try{b(!0);const v=await Vn(),u=re(v);if(u!=null&&u.list){const _=u.list.map(N=>({id:N.id,name:N.name,code:N.code}));a(_)}else console.warn("获取帮助中心分类失败:",v)}catch(v){console.error("获取帮助中心分类接口异常:",v)}finally{b(!1)}})()},[]);const h=async w=>{if(r===w.id){l(null);return}if(l(w.id),!d[w.id])try{f(w.id);const u=await Wn({category_id:w.id,category_code:w.code}),_=re(u);if(_!=null&&_.list){const N=_.list.map(i=>({id:i.id,categoryId:i.category_id,title:i.title,content:i.content}));x(i=>({...i,[w.id]:N}))}else x(N=>({...N,[w.id]:[]}))}catch(u){console.error("获取帮助中心问题列表接口异常:",u),x(_=>({..._,[w.id]:[]}))}finally{f(null)}},j=()=>{c(null)};return e.jsx(_e,{title:"帮助中心",onBack:o?j:t,padding:!1,children:o?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-2",children:o.title}),e.jsx("div",{className:"text-xs leading-6 text-gray-600 prose prose-sm max-w-none [&_img]:max-w-full [&_img]:h-auto",dangerouslySetInnerHTML:{__html:o.content}}),o.imageUrls&&o.imageUrls.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:o.imageUrls.map(w=>e.jsx("img",{src:w,alt:"帮助说明图片",className:"w-full rounded-md border border-gray-100 object-contain"},w))})]})}):e.jsxs("div",{className:"mt-2 space-y-2",children:[m&&s.length===0&&e.jsx("div",{className:"py-10",children:e.jsx(ge,{text:"正在加载帮助中心内容..."})}),!m&&s.length===0&&e.jsx(Oe,{title:"暂无帮助中心数据"}),s.map(w=>{const v=r===w.id,u=d[w.id]||[],_=g===w.id;return e.jsxs("div",{className:"bg-white",children:[e.jsxs("button",{className:"w-full px-4 py-3 flex items-center justify-between border-b border-gray-100 active:bg-gray-50",onClick:()=>h(w),children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 text-left",children:w.name}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:v?"收起":"展开"})]}),v&&e.jsxs("div",{children:[_&&u.length===0&&e.jsx("div",{className:"px-4 py-3 text-[11px] text-gray-400 border-t border-gray-50",children:"正在加载问题列表..."}),!_&&u.map(N=>e.jsxs("button",{className:"w-full px-4 py-3 flex items-center justify-between border-b border-gray-50 text-left active:bg-gray-50",onClick:()=>c(N),children:[e.jsx("span",{className:"text-xs text-gray-800",children:N.title}),e.jsx("span",{className:"text-[11px] text-gray-400 ml-2",children:"详情"})]},N.id)),!_&&u.length===0&&e.jsx("div",{className:"px-4 py-3 text-[11px] text-gray-400 border-t border-gray-50",children:"暂无相关问题"})]})]},w.id)})]})})},Ga=({onBack:t})=>e.jsx(Ts,{type:"user_agreement",defaultTitle:"用户协议",onBack:t}),Tl=[1,2,3,4,5],Fl=[{value:"daily",label:"几乎每天都会使用"},{value:"weekly",label:"每周使用几次"},{value:"sometimes",label:"偶尔使用"},{value:"first",label:"第一次体验"}],Pl=({onBack:t})=>{const{showToast:s}=he(),[a,r]=n.useState(null),[l,o]=n.useState(""),[c,d]=n.useState(""),[x,m]=n.useState(!1),b=La(),g=()=>{if(!a){s("warning","请评分","请先选择整体满意度");return}m(!0),b.show()};return e.jsx(_e,{title:"用户问卷",onBack:t,children:x?e.jsxs("div",{className:"mt-20 flex flex-col items-center text-center px-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-green-100 text-green-500 flex items-center justify-center mb-3",children:e.jsx("span",{className:"text-2xl",children:"✓"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"感谢您的反馈"}),e.jsx("p",{className:"text-xs text-gray-500 leading-5",children:"您的意见已成功提交，我们会认真评估并不断优化产品体验。"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"您对本应用的整体满意度？"}),e.jsx("div",{className:"flex items-center px-1 space-x-1",children:Tl.map(f=>{const h=a!==null&&a>=f;return e.jsx("button",{type:"button",className:"w-9 h-9 flex items-center justify-center active:opacity-80",onClick:()=>r(f),children:e.jsx("span",{className:`text-2xl ${h?"text-yellow-400":"text-gray-300"}`,children:"★"})},f)})}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-400 flex justify-between",children:[e.jsx("span",{children:"非常不满意"}),e.jsx("span",{children:"非常满意"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"使用频率"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Fl.map(f=>e.jsx("button",{type:"button",className:`px-3 py-1.5 rounded-full text-[11px] border text-gray-700 active:opacity-80 ${l===f.value?"bg-orange-50 text-orange-600 border-orange-400":"bg-white border-gray-200"}`,onClick:()=>o(l===f.value?"":f.value),children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"您最希望我们优化或新增的功能？"}),e.jsx("textarea",{className:"w-full min-h-[100px] resize-none text-xs border border-gray-200 rounded-md px-3 py-2 outline-none placeholder:text-gray-300 text-gray-800",placeholder:"欢迎留下您的宝贵意见，例如：界面体验、交易流程、客服响应等",value:c,onChange:f=>d(f.target.value)})]})]}),e.jsx("button",{className:"w-full bg-orange-500 text-white text-sm font-semibold py-3 rounded-md active:opacity-80 shadow-sm",onClick:g,children:"提交问卷"})]})})},zl=["账户相关问题","交易流程咨询","提现与到账时间","平台规则与协议"],Rl=[{id:1,from:"service",content:"您好，这里是在线客服中心，请简单描述您的问题，我们会尽快为您解答。",time:"刚刚"}],Al=({onBack:t})=>{const[s,a]=useState(Rl),[r,l]=useState(""),[o,c]=useState(2),d=(b,g)=>{const f={id:o,from:b,content:g,time:"刚刚"};a(h=>[...h,f]),c(h=>h+1)},x=()=>{if(!r.trim())return;const b=r.trim();l(""),d("user",b),setTimeout(()=>{d("service","已收到您的消息，当前为模拟客服示例。如需正式接入，可对接在线客服系统接口。")},500)},m=b=>{l(b)};return e.jsx(PageContainer,{title:"在线客服",onBack:t,padding:!1,children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-56px)] bg-gray-50",children:[e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-3 space-y-3",children:s.map(b=>e.jsx("div",{className:`flex ${b.from==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[75%] rounded-2xl px-3 py-2 text-xs leading-5 ${b.from==="user"?"bg-orange-500 text-white rounded-br-sm":"bg-white text-gray-800 border border-gray-100 rounded-bl-sm"}`,children:b.content})},b.id))}),e.jsxs("div",{className:"px-3 pb-2 space-y-2",children:[e.jsx("div",{className:"text-[11px] text-gray-400",children:"常见问题快捷输入"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:zl.map(b=>e.jsx("button",{className:"px-2.5 py-1 rounded-full bg-white border border-gray-200 text-[11px] text-gray-700 active:bg-gray-50",onClick:()=>m(b),children:b},b))})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 px-3 py-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"请输入您要咨询的问题...",className:"flex-1 text-xs px-3 py-2 rounded-full border border-gray-200 outline-none placeholder:text-gray-300",value:r,onChange:b=>l(b.target.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),x())}}),e.jsx("button",{className:"px-3 py-1.5 rounded-full bg-orange-500 text-white text-xs font-medium active:opacity-80 disabled:opacity-40",onClick:x,disabled:!r.trim(),children:"发送"})]})]})})},Dl=t=>{if(!t)return 0;const s=t.match(/(\d+)/);return s?Number(s[1]):0},Ha=({product:t,onBack:s,onNavigate:a})=>{var O,V,H,W,A,$,U;const{showToast:r,showDialog:l}=he(),{errorMessage:o,hasError:c,handleError:d,clearError:x}=Ie(),{handleError:m}=Ie({showToast:!0,persist:!1}),[b,g]=n.useState(null),[f,h]=n.useState(!0),[j,w]=n.useState(!1),[v,u]=n.useState(!1),_=t.productType==="shop";n.useEffect(()=>{(async()=>{try{h(!0),x();let J;if(_)J=await Cs(t.id);else try{J=await va(t.id),(J.code!==1||!J.data)&&(J=await Os(t.id))}catch{J=await Os(t.id)}const se=re(J);se?g(se):d(J,{persist:!0,showToast:!1,customMessage:"获取证书详情失败"})}catch(J){d(J,{persist:!0,showToast:!1,customMessage:"数据同步延迟，请重试",context:{productId:t.id}})}finally{h(!1)}})()},[t.id,_]);const N=async()=>{fe("productDetail.buy","发起积分商品购买",{id:t.id,title:t.title,productType:t.productType,consignmentId:t.consignmentId,reservationId:t.reservationId}),!j&&l({title:"确认购买",description:`确定要购买 ${t.title} 吗？`,confirmText:"立即支付",cancelText:"取消",onConfirm:async()=>{fe("productDetail.buy","用户确认购买");try{w(!0),fe("productDetail.buy","调用 buyShopOrder",{productId:Number(t.id)});const G=await Na({items:[{product_id:Number(t.id),quantity:1}],pay_type:"money"});fe("productDetail.buy","buyShopOrder 响应",G),tt("order.buy.shop.ui",{code:G.code,productId:t.id}),ee(G)?(r("success","购买成功","订单已创建并支付成功"),a({name:"order-list",kind:_?"points":"product",status:0,back:{name:"product-detail"}})):m(G,{toastTitle:"购买失败",customMessage:"购买失败",context:{productId:t.id}})}catch(G){m(G,{toastTitle:"购买失败",customMessage:"系统错误",context:{productId:t.id}})}finally{w(!1)}}})};if(f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#FDFBF7]",children:e.jsx(ge,{})});if(c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#FDFBF7] text-gray-500",children:o});const i=_?null:b,F=_?b:null,I=_?(F==null?void 0:F.thumbnail)||t.image:((O=i==null?void 0:i.images)==null?void 0:O[0])||(i==null?void 0:i.image)||t.image,z=_?(F==null?void 0:F.name)||t.title:(i==null?void 0:i.title)||t.title;let p,P;if(_)p=Number((F==null?void 0:F.price)??t.price),P=`¥${p.toLocaleString()}`;else{const G=Number((i==null?void 0:i.price)??t.price),J=(i==null?void 0:i.price_zone)||(i==null?void 0:i.priceZone);J?(p=Dl(J),p<=0&&(p=G),P=`¥${p.toLocaleString()}`):(p=G,P=`¥${p.toLocaleString()}`)}const y=i==null?void 0:i.tx_hash,S=i==null?void 0:i.asset_code,k=i==null?void 0:i.supplier_name,T=(i==null?void 0:i.session_name)||(i==null?void 0:i.sessionName)||(i==null?void 0:i.session_title)||(i==null?void 0:i.sessionTitle)||((V=i==null?void 0:i.session)==null?void 0:V.name),D=(i==null?void 0:i.session_start_time)||(i==null?void 0:i.sessionStartTime)||((H=i==null?void 0:i.session)==null?void 0:H.start_time),Y=(i==null?void 0:i.session_end_time)||(i==null?void 0:i.sessionEndTime)||((W=i==null?void 0:i.session)==null?void 0:W.end_time),L=D||Y?`${D||""}${D&&Y?" - ":""}${Y||""}`:"",B=(i==null?void 0:i.core_enterprise)||(i==null?void 0:i.coreEnterprise)||(i==null?void 0:i.core_company)||(i==null?void 0:i.coreCompany)||k,K=(i==null?void 0:i.farmer_info)||(i==null?void 0:i.farmerInfo)||(i==null?void 0:i.farmer_count_text)||(i==null?void 0:i.farmerCountText)||(i==null?void 0:i.farmer_text)||(i==null?void 0:i.farmerText),C=(i==null?void 0:i.asset_status)||(i==null?void 0:i.assetStatus)||(i==null?void 0:i.status_text)||(i==null?void 0:i.statusText)||(i==null?void 0:i.status),E=(i==null?void 0:i.session_id)||(i==null?void 0:i.sessionId)||((A=i==null?void 0:i.session)==null?void 0:A.id)||(($=i==null?void 0:i.session)==null?void 0:$.session_id),R=(i==null?void 0:i.zone_id)||(i==null?void 0:i.price_zone_id)||(i==null?void 0:i.zoneId)||(i==null?void 0:i.priceZoneId)||((U=i==null?void 0:i.zone)==null?void 0:U.id);return!t.sessionId&&E&&(t.sessionId=E),!t.zoneId&&R&&(t.zoneId=R),fe("productDetail.render","渲染详情",{product:t,isShopProduct:_,collectionDetail:i}),e.jsxs("div",{className:"min-h-screen bg-[#FDFBF7] text-gray-900 font-serif pb-24 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]"}),e.jsxs("header",{className:"sticky top-0 z-40 bg-[#FDFBF7]/90 backdrop-blur-sm px-4 py-4 flex justify-between items-center border-b border-amber-900/5",children:[e.jsx("button",{onClick:s,className:"p-2 hover:bg-black/5 rounded-full transition-colors text-gray-800",children:e.jsx(Ee,{size:24})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:_?"商品详情":"数字权益证书"}),e.jsx("button",{className:"p-2 hover:bg-black/5 rounded-full text-gray-800",children:e.jsx(ts,{size:20})})]}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"bg-white relative shadow-2xl shadow-gray-200/50 rounded-sm overflow-hidden border-[6px] border-double border-amber-900/10 p-6 md:p-8",children:[!_&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none",children:e.jsx(rt,{size:200})}),!_&&e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-amber-50 text-amber-900 mb-3 border border-amber-100",children:e.jsx(_t,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 tracking-wide mb-1",children:"数字产权登记证书"}),e.jsx("div",{className:"text-[10px] text-gray-400 uppercase tracking-[0.2em]",children:"Digital Property Rights Certificate"})]}),_&&e.jsx("div",{className:"mb-6 rounded-lg overflow-hidden shadow-sm aspect-square bg-gray-50",children:e.jsx(et,{src:I||"",alt:z,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-6 relative z-10 font-sans",children:[e.jsxs("div",{className:"text-center py-6 mb-2 relative",children:[!_&&e.jsx("div",{className:"absolute inset-0 opacity-[0.15] pointer-events-none rounded-lg border border-amber-900/5",style:{backgroundImage:"radial-gradient(circle, #C5A572 1px, transparent 1px), radial-gradient(circle, #C5A572 1px, transparent 1px)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"}}),!_&&S&&e.jsxs("div",{className:"text-xs text-gray-500 font-[DINAlternate-Bold,Roboto,sans-serif] tracking-widest mb-3 relative z-10",children:["确权编号：",S]}),e.jsxs("h3",{className:`${z.length>12?"text-lg":z.length>8?"text-xl":z.length>5?"text-2xl":"text-3xl"} font-extrabold text-gray-700 mb-3 font-serif tracking-tight leading-tight relative z-10 drop-shadow-sm whitespace-nowrap overflow-hidden text-ellipsis px-2`,children:["【",z,"】"]}),!_&&e.jsx("div",{className:"text-base font-bold text-[#C5A572] tracking-wide relative z-10",children:t.artist||"—"}),!_&&e.jsx("div",{className:"absolute -right-4 -bottom-6 w-32 h-32 opacity-90 -rotate-12 mix-blend-multiply z-20 pointer-events-none",children:e.jsxs("svg",{viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsx("path",{id:"textCircleTop",d:"M 25,100 A 75,75 0 1,1 175,100",fill:"none"}),e.jsxs("filter",{id:"roughPaper",children:[e.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.05",numOctaves:"2",result:"noise"}),e.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"2"})]})]}),e.jsxs("g",{filter:"url(#roughPaper)",fill:"#D60000",stroke:"none",children:[e.jsx("circle",{cx:"100",cy:"100",r:"96",fill:"none",stroke:"#D60000",strokeWidth:"3"}),e.jsx("circle",{cx:"100",cy:"100",r:"92",fill:"none",stroke:"#D60000",strokeWidth:"1"}),e.jsx("text",{fontSize:"14",fontWeight:"bold",fontFamily:"SimSun, serif",fill:"#D60000",children:e.jsx("textPath",{href:"#textCircleTop",startOffset:"50%",textAnchor:"middle",spacing:"auto",children:"树交所数字资产登记结算中心"})}),e.jsx("text",{x:"100",y:"100",fontSize:"40",textAnchor:"middle",dominantBaseline:"middle",fill:"#D60000",children:"★"}),e.jsx("text",{x:"100",y:"135",fontSize:"18",fontWeight:"bold",fontFamily:"SimHei, sans-serif",textAnchor:"middle",fill:"#D60000",children:"确权专用章"}),e.jsx("text",{x:"100",y:"155",fontSize:"10",fontFamily:"Arial, sans-serif",fontWeight:"bold",textAnchor:"middle",fill:"#D60000",letterSpacing:"1",children:"37010299821"})]})]})})]}),((i==null?void 0:i.description)||(F==null?void 0:F.description))&&e.jsxs("div",{className:"bg-amber-50/60 p-4 rounded-lg border border-amber-100",children:[e.jsx("div",{className:"text-xs font-bold text-amber-700 uppercase mb-1 tracking-wider",children:"Description / 商品描述"}),e.jsx("div",{className:"text-sm text-amber-900 leading-relaxed",dangerouslySetInnerHTML:_?{__html:(F==null?void 0:F.description)||""}:void 0,children:!_&&(i==null?void 0:i.description)})]}),!_&&(T||L.trim()||(i==null?void 0:i.price_zone))&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1 tracking-wider",children:"Session / 专场"}),e.jsx("div",{className:"text-sm font-bold text-gray-600",children:T||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1 tracking-wider",children:"Trading Window / 场次时间"}),e.jsx("div",{className:"text-sm font-bold text-gray-600",children:L||"—"})]})]}),(i==null?void 0:i.price_zone)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1 tracking-wider",children:"Price Zone / 价格分区"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-orange-50 text-orange-600 border border-orange-200",children:i.price_zone}),e.jsx("span",{className:"text-xs text-gray-400",children:"（申购价按分区统一定价）"})]})]})]}),!_&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100 space-y-2",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(rt,{size:16,className:"text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-0.5",children:"Asset Anchor / 资产锚定"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"whitespace-nowrap",children:"核心企业："}),e.jsx("span",{className:"text-gray-700 break-words",children:B||"—"})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"whitespace-nowrap",children:"关联农户："}),e.jsx("span",{className:"text-gray-700 break-words",children:K||"—"})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"whitespace-nowrap",children:"资产状态："}),e.jsx("span",{className:"text-gray-700 break-words",children:C||"—"})]})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:"数据已脱敏，持有人可申请解密查看。"})]})]})}),!_&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2 tracking-wider",children:"On-chain Proof / 上链信息"}),e.jsxs("div",{className:"bg-gray-900 text-green-500 font-mono text-[10px] p-3 rounded break-all leading-relaxed relative group hover:bg-gray-800 transition-colors",children:[e.jsx(nt,{size:12,className:"absolute right-2 top-2 text-gray-500 group-hover:text-green-400"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-gray-500 font-sans font-bold",children:[e.jsx(hr,{size:12}),e.jsx("span",{className:"uppercase",children:"Tx Hash"})]}),y?e.jsx("div",{className:"bg-black/30 p-2 rounded text-green-400 break-all",children:y}):e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 bg-amber-50 p-2 rounded border border-amber-100",children:[e.jsxs("div",{className:"relative w-4 h-4 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-transparent border-t-amber-500 rounded-full animate-[spin_1.5s_linear_infinite]"}),e.jsx("div",{className:"absolute inset-1 border-2 border-transparent border-b-amber-300 rounded-full animate-[spin_2s_linear_infinite_reverse]"})]}),e.jsx("span",{className:"text-xs font-bold animate-pulse",children:"⛓️ 链上节点正在算力撮合中..."})]})]}),k&&e.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded p-3 text-[12px] text-gray-700 flex items-center gap-2",children:[e.jsx(rt,{size:14,className:"text-amber-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Supplier"}),e.jsx("div",{className:"text-sm font-medium text-gray-600",children:k})]})]})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t border-gray-100 z-50",children:[!_&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("span",{className:"text-[10px] text-gray-900 bg-white px-1 py-0.5",children:["本次申购需冻结：¥",p.toFixed(2)," | 消耗算力：1.0 GH/s"]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-left",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 font-mono flex items-baseline leading-none",children:P}),!_&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(gs,{size:10,className:"text-red-500"}),e.jsx("span",{className:"text-[10px] font-bold text-red-500 bg-red-50 px-1 py-0.5 rounded border border-red-100/50",children:"预期增值 +4%~+6%"})]})]})}),(fe("productDetail.render","渲染按钮区",{isShopProduct:_,consignmentId:t.consignmentId,reservationId:t.reservationId,productId:t.id}),_?e.jsxs("button",{onClick:N,disabled:j,className:"flex-1 bg-[#EE4D2D] text-white hover:bg-[#D73211] transition-colors py-3.5 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg shadow-orange-900/20 active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed",children:[j?e.jsx(ge,{size:18,color:"white"}):e.jsx(Be,{size:18}),j?"处理中...":"立即购买"]}):t.reservationId?e.jsxs("button",{disabled:!0,className:"flex-1 bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed py-3.5 rounded-lg font-bold flex items-center justify-center gap-2",children:[e.jsx(As,{size:18}),"确权中"]}):e.jsxs("button",{onClick:()=>{fe("productDetail.render","点击申请确权",{id:t.id,title:t.title,consignmentId:t.consignmentId,reservationId:t.reservationId}),a({name:"reservation",back:{name:"product-detail"}})},className:"flex-1 bg-[#8B0000] text-amber-100 hover:bg-[#A00000] transition-colors py-3.5 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg shadow-red-900/20 active:scale-[0.98]",children:[e.jsx(As,{size:18}),"申请确权"]}))]})]})]})},cs="search_history",Ll=10,Ml=({onBack:t,onNavigate:s,initialCode:a})=>{const{showToast:r}=he(),[l,o]=n.useState(a||""),[c,d]=n.useState(!1),[x,m]=n.useState([]),[b,g]=n.useState(null),[f,h]=n.useState(!1);n.useEffect(()=>{j()},[]),n.useEffect(()=>{a&&u(a)},[a]);const j=()=>{try{const i=localStorage.getItem(cs);i&&m(JSON.parse(i))}catch(i){console.error("加载搜索历史失败:",i)}},w=i=>{try{const F=[...x],I=F.indexOf(i);I>-1&&F.splice(I,1),F.unshift(i);const z=F.slice(0,Ll);m(z),localStorage.setItem(cs,JSON.stringify(z))}catch(F){console.error("保存搜索历史失败:",F)}},v=()=>{try{localStorage.removeItem(cs),m([]),r("success","已清空搜索历史")}catch(i){console.error("清空搜索历史失败:",i)}},u=async i=>{const F=i||l.trim();if(!F){r("warning","提示","请输入确权编号或MD5指纹");return}d(!0);try{const I=await Ln({code:F});ee(I)&&I.data?(g(I.data),h(!0),w(F)):r("error","查询失败",oe(I,"未找到匹配的藏品"))}catch(I){console.error("搜索失败:",I),r("error","查询失败",I.message||"网络错误，请稍后重试")}finally{d(!1)}},_=i=>{o(i),u(i)},N=i=>({id:String(i.id),title:i.title,artist:i.core_enterprise||"未知",price:i.price,image:i.image,category:"collection",productType:"collection",sessionId:i.session_id,zoneId:i.zone_id});return f&&b?e.jsx(Ha,{product:N(b),onBack:()=>{h(!1),g(null)},onNavigate:s}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("div",{className:"bg-white px-4 py-3 shadow-sm sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ee,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 bg-gray-100 rounded-full px-4 py-2",children:[e.jsx(Nt,{size:18,className:"text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:i=>o(i.target.value),onKeyPress:i=>{i.key==="Enter"&&u()},placeholder:"输入确权编号或MD5指纹",className:"flex-1 bg-transparent outline-none text-sm text-gray-900 placeholder-gray-400"}),l&&e.jsx("button",{onClick:()=>o(""),className:"p-1 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(Ce,{size:16,className:"text-gray-500"})})]}),e.jsx("button",{onClick:()=>u(),disabled:c,className:"px-4 py-2 bg-orange-500 text-white rounded-full text-sm font-medium hover:bg-orange-600 transition-colors disabled:opacity-50",children:c?e.jsx(ge,{size:"sm",color:"white"}):"搜索"})]})}),e.jsxs("div",{className:"flex-1 p-4",children:[x.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{size:16,className:"text-gray-400"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"搜索历史"})]}),e.jsx("button",{onClick:v,className:"text-xs text-gray-400 hover:text-gray-600",children:"清空"})]}),e.jsx("div",{className:"space-y-2",children:x.map((i,F)=>e.jsxs("div",{onClick:()=>_(i),className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700 font-mono truncate",children:i}),e.jsx(da,{size:14,className:"text-gray-400"})]},F))})]}),x.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(Nt,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"暂无搜索历史"}),e.jsx("p",{className:"text-xs mt-2",children:"输入确权编号或MD5指纹开始查询"})]})]})]})},Bl={"news-detail":(t,s)=>{const a=t,r=s.newsList.find(l=>l.id===a.id);return r?e.jsx(Ta,{newsItem:r,onBack:()=>s.goBack()}):null},"artist-detail":(t,s)=>{const a=t;return a.id?e.jsx(Fa,{artistId:a.id,onBack:()=>s.goBack(),onProductSelect:r=>{s.setProductDetailOrigin("artist"),s.handleProductSelect(r,"artist")}}):null},"order-list":(t,s)=>e.jsx(za,{category:t.kind,initialTab:t.status,onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"order-detail":(t,s)=>e.jsx(Ei,{orderId:t.orderId,onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),cashier:(t,s)=>e.jsx(Ii,{orderId:t.orderId,onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"claim-detail":(t,s)=>e.jsx(Ti,{id:t.id,onBack:()=>s.goBack()}),settings:(t,s)=>e.jsx(Fi,{onBack:()=>s.goBack(),onLogout:s.handleLogout,onNavigate:a=>s.navigateRoute(a)}),"reset-login-password":(t,s)=>e.jsx(Mi,{onBack:()=>s.goBack(),onNavigateForgotPassword:()=>s.navigateRoute({name:"forgot-password"})}),"reset-pay-password":(t,s)=>e.jsx(Bi,{onBack:()=>s.goBack(),onNavigateForgotPassword:()=>s.navigateRoute({name:"forgot-password"})}),"forgot-password":(t,s)=>e.jsx(Da,{onBack:()=>s.goBack()}),"notification-settings":(t,s)=>e.jsx($i,{onBack:()=>s.goBack()}),"account-deletion":(t,s)=>e.jsx(Ui,{onBack:()=>s.goBack()}),"edit-profile":(t,s)=>e.jsx(Gi,{onBack:()=>s.goBack(),onLogout:s.handleLogout}),"card-management":(t,s)=>e.jsx(Hi,{onBack:()=>s.goBack()}),"trading-zone":(t,s)=>e.jsx(qs,{onBack:()=>s.goBack(),onProductSelect:a=>s.handleProductSelect(a,"trading-zone"),onNavigate:a=>s.navigateRoute(a)}),"trading-zone-items":(t,s)=>{const a=t;return e.jsx(qs,{onBack:()=>s.goBack(),onProductSelect:r=>s.handleProductSelect(r,"trading-zone"),onNavigate:r=>s.navigateRoute(r),initialSessionId:a.sessionId,initialSessionTitle:a.sessionTitle,initialSessionStartTime:a.sessionStartTime,initialSessionEndTime:a.sessionEndTime})},"artist-showcase":(t,s)=>e.jsx(Ki,{onBack:()=>s.goBack(),onArtistSelect:a=>s.navigateRoute({name:"artist-detail",id:a})}),"masterpiece-showcase":(t,s)=>e.jsx(qi,{onBack:()=>s.goBack(),onNavigateToArtist:a=>s.navigateRoute({name:"artist-detail",id:a})}),news:(t,s)=>e.jsx(jl,{newsList:s.newsList,onNavigate:a=>{const r=s.newsList.find(l=>l.id===a);if(r){const l=r.type==="announcement"?"announcement":"dynamics";Ve(je.NEWS_ACTIVE_TAB_KEY,l)}s.navigateRoute({name:"news-detail",id:a})},onMarkAllRead:()=>s.markAllNewsRead(),onBack:()=>s.goBack()}),"invite-friends":(t,s)=>e.jsx(Nl,{onBack:()=>s.goBack()}),"my-collection":(t,s)=>e.jsx(Zs,{onBack:()=>s.goBack(),onItemSelect:a=>{s.setSelectedCollectionItem(a),s.navigateRoute({name:"my-collection-detail",id:String(a.id)})}}),"my-collection-detail":(t,s)=>{const a=t;return!s.selectedCollectionItem||String(s.selectedCollectionItem.id)!==a.id?null:e.jsx(Oa,{item:s.selectedCollectionItem,onBack:()=>s.goBack(),onNavigate:r=>s.navigateRoute(r)})},"my-collection-consignment":(t,s)=>{const a=t;return e.jsx(Zs,{onBack:()=>s.goBack(),onItemSelect:r=>{s.setSelectedCollectionItem(r),s.navigateRoute({name:"my-collection-detail",id:String(r.id)})},initialConsignItemId:a.id})},"address-list":(t,s)=>e.jsx(vl,{onBack:()=>s.goBack()}),"real-name-auth":(t,s)=>e.jsx(Sl,{onBack:()=>s.goBack()}),"my-friends":(t,s)=>e.jsx(Cl,{onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"agent-auth":(t,s)=>e.jsx(El,{onBack:()=>s.goBack()}),"help-center":(t,s)=>e.jsx(Il,{onBack:()=>s.goBack()}),"user-agreement":(t,s)=>e.jsx(Ga,{onBack:()=>s.goBack()}),"user-survey":(t,s)=>e.jsx(Pl,{onBack:()=>s.goBack()}),"online-service":(t,s)=>e.jsx(Al,{onBack:()=>s.goBack()}),search:(t,s)=>{const a=t;return e.jsx(Ml,{onBack:()=>s.goBack(),onNavigate:r=>s.navigateRoute(r),initialCode:a.code})},"about-us":(t,s)=>e.jsx(Wi,{onBack:()=>s.goBack()}),"privacy-policy":(t,s)=>e.jsx(Ma,{onBack:()=>s.goBack()}),"asset-view":(t,s)=>e.jsx(il,{initialTab:t.tab??0,onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a),onProductSelect:a=>s.handleProductSelect(a,"market")}),"asset-history":(t,s)=>e.jsx(ll,{onBack:()=>s.goBack()}),"balance-recharge":(t,s)=>{const a=t;return a.source==="reservation"||a.source,e.jsx(cl,{onBack:()=>s.goBack(),initialAmount:a.amount})},"balance-withdraw":(t,s)=>(t.source,e.jsx(dl,{onBack:()=>s.goBack(),onNavigate:r=>s.navigateRoute(r)})),"service-recharge":(t,s)=>(t.source,e.jsx(xl,{onBack:()=>s.goBack()})),"extension-withdraw":(t,s)=>e.jsx(ml,{onBack:()=>s.goBack()}),"hashrate-exchange":(t,s)=>{const a=t;return a.source==="reservation"||a.source,e.jsx(ul,{onBack:()=>s.goBack(),onNavigate:r=>s.navigateRoute(r)})},"consignment-voucher":(t,s)=>e.jsx(gl,{onBack:()=>s.goBack()}),"cumulative-rights":(t,s)=>e.jsx(hl,{onBack:()=>s.goBack()}),"claim-history":(t,s)=>e.jsx(fl,{onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"sign-in":(t,s)=>e.jsx(pl,{onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"recharge-order-detail":(t,s)=>e.jsx($a,{orderId:t.orderId,onBack:()=>s.goBack()}),"withdraw-order-list":(t,s)=>e.jsx(bl,{onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)}),"message-center":(t,s)=>e.jsx(yl,{onBack:()=>s.goBack(),onNavigate:a=>s.navigateRoute(a)})},$l=(t,s)=>{const a=Bl[t.name];return a?a(t,s):null};function Ol(t=[]){const[s,a]=n.useState(t),r=()=>ss(je.READ_NEWS_IDS_KEY,[])||[],l=x=>Jt(je.READ_NEWS_IDS_KEY,x),o=n.useCallback(()=>{const x=s.map(g=>g.id),m=r(),b=Array.from(new Set([...m,...x]));l(b),a(g=>g.map(f=>({...f,isUnread:!1})))},[s]),c=n.useCallback(x=>{a(b=>b.map(g=>g.id===x?{...g,isUnread:!1}:g));const m=r();m.includes(x)||l([...m,x])},[]),d=n.useCallback(x=>{const m=r(),b=x.map(g=>({...g,isUnread:g.isUnread??!m.includes(g.id)}));a(b)},[]);return{newsList:s,setNewsList:a,initWith:d,markAllRead:o,markReadById:c}}function Ul(){const[t,s]=n.useState(null),a=n.useCallback(l=>{s(l)},[]),r=n.useCallback(()=>{const l=t;return s(null),l},[t]);return{pending:t,setPendingNav:a,consumePending:r}}const Qt=t=>t?/^1[3-9]\d{9}$/.test(t)?{valid:!0}:{valid:!1,message:"请输入正确的手机号"}:{valid:!1,message:"请输入手机号"},ds="login_remembered_phone",xs="login_remembered_password",ms="login_remember_me",Gl=({onLogin:t,onNavigateRegister:s,onNavigateUserAgreement:a,onNavigatePrivacyPolicy:r,onNavigateForgotPassword:l})=>{const{showToast:o}=he(),{handleError:c}=Ie({showToast:!0,persist:!1}),[d,x]=n.useState(""),[m,b]=n.useState(""),[g,f]=n.useState(!1),[h,j]=n.useState(!1),[w,v]=n.useState(!1),[u,_]=n.useState(""),[N,i]=n.useState("password"),[F,I]=n.useState(0),[z,p]=n.useState(!1);n.useEffect(()=>{try{if(localStorage.getItem(ms)==="true"){const D=localStorage.getItem(ds)||"",Y=localStorage.getItem(xs)||"";x(D),b(Y),p(!0)}}catch(T){console.error("读取记住密码信息失败:",T)}},[]);const P=()=>{try{localStorage.setItem(ds,d),localStorage.setItem(xs,m),localStorage.setItem(ms,"true")}catch(T){console.error("保存记住密码信息失败:",T)}},y=()=>{try{localStorage.removeItem(ds),localStorage.removeItem(xs),localStorage.removeItem(ms)}catch(T){console.error("清除记住密码信息失败:",T)}},S=()=>{if(!d){o("warning","请输入手机号");return}const T=Qt(d);if(!T.valid){o("warning","手机号错误",T.message);return}I(60);const D=setInterval(()=>{I(Y=>Y<=1?(clearInterval(D),0):Y-1)},1e3);o("success","验证码已发送","请查收（模拟）")},k=async()=>{var D,Y,L;if(!d){o("warning","请输入手机号");return}if(N==="password"&&!m){o("warning","请输入密码");return}if(N==="code"&&!u){o("warning","请输入验证码");return}if(!g){o("warning","请阅读并同意用户协议");return}const T=Qt(d);if(!T.valid){o("warning","手机号错误",T.message);return}v(!0);try{const B={mobile:d,password:N==="password"?m:""};if(N==="code"){o("info","暂未支持","验证码登录暂未对接后端API"),v(!1);return}const K=await Wr(B);if(fe("auth.login.page","登录接口响应",K),tt("auth.login.page",{code:K.code}),ee(K)){const C=(Y=(D=K.data)==null?void 0:D.userInfo)==null?void 0:Y.token;if(!C){o("error","登录异常","登录成功，但未获取到 token，无法继续");return}z?P():y(),o("success","登录成功",K.msg),t({token:C,userInfo:((L=K.data)==null?void 0:L.userInfo)||null})}else c(K,{toastTitle:"登录失败",customMessage:"登录失败，请稍后重试",context:{phone:d,loginType:N}})}catch(B){c(B,{toastTitle:B.isCorsError?"网络错误":"登录失败",customMessage:B.isCorsError?B.message:"请检查网络连接后重试",context:{phone:d,loginType:N}})}finally{N!=="code"&&v(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col px-8 pt-20 pb-safe bg-gradient-to-br from-[#FFD6A5] via-[#FFC3A0] to-[#FFDEE9]",children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-2",children:"Hello!"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-700",children:"欢迎登录树交所"})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-8",children:[e.jsx("button",{onClick:()=>i("password"),className:`text-lg font-medium transition-colors relative pb-2 ${N==="password"?'text-gray-800 font-bold after:content-[""] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-6 after:h-1 after:bg-orange-500 after:rounded-full':"text-gray-500"}`,children:"密码登录"}),e.jsx("button",{onClick:()=>i("code"),className:`text-lg font-medium transition-colors relative pb-2 ${N==="code"?'text-gray-800 font-bold after:content-[""] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-6 after:h-1 after:bg-orange-500 after:rounded-full':"text-gray-500"}`,children:"验证码登录"})]}),e.jsxs("div",{className:"space-y-6 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(jt,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:"tel",placeholder:"请输入手机号",value:d,onChange:T=>x(T.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),d&&e.jsx("button",{onClick:()=>x(""),className:"text-gray-300 ml-2",children:e.jsx("div",{className:"bg-gray-200 rounded-full p-0.5",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})]}),N==="password"?e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(ks,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:h?"text":"password",placeholder:"请输入您的密码",value:m,onChange:T=>b(T.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),e.jsx("button",{onClick:()=>j(!h),className:"text-gray-500 ml-2",children:h?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]}):e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})})}),e.jsx("input",{type:"text",placeholder:"请输入验证码",value:u,onChange:T=>_(T.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),e.jsx("button",{onClick:S,disabled:F>0,className:`ml-2 text-sm font-medium ${F>0?"text-gray-400":"text-orange-500"}`,children:F>0?`${F}s后重发`:"获取验证码"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-10 text-sm",children:[e.jsxs("label",{className:"flex items-center text-gray-700 gap-2 cursor-pointer select-none",children:[e.jsx("div",{className:`w-4 h-4 border rounded flex items-center justify-center transition-colors cursor-pointer ${z?"bg-orange-400 border-orange-400":"border-orange-400 bg-transparent"}`,onClick:()=>p(!z),children:z&&e.jsx(Ze,{size:12,className:"text-white"})}),e.jsx("span",{onClick:()=>p(!z),children:"记住密码"})]}),e.jsx("button",{type:"button",className:"text-gray-600",onClick:l,children:"忘记密码"})]}),e.jsx("button",{onClick:k,disabled:w,className:"w-full bg-gradient-to-r from-[#FF9966] to-[#FF5E62] text-white font-bold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-all mb-8 text-lg tracking-wide disabled:opacity-70 disabled:cursor-not-allowed",children:w?"登录中...":"登 录"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-600 mb-12",children:[e.jsx("div",{className:`w-4 h-4 rounded border flex-shrink-0 flex items-center justify-center cursor-pointer transition-colors ${g?"bg-orange-500 border-orange-500":"border-gray-400 bg-transparent"}`,onClick:()=>f(!g),children:g&&e.jsx(Ze,{size:12,className:"text-white"})}),e.jsxs("div",{className:"leading-none flex items-center flex-wrap",children:[e.jsx("span",{children:"登录即代表你已同意"}),e.jsx("button",{type:"button",className:"text-orange-500 mx-0.5",onClick:a,children:"用户协议"}),e.jsx("span",{children:"和"}),e.jsx("button",{type:"button",className:"text-orange-500 mx-0.5",onClick:r,children:"隐私政策"})]})]}),e.jsxs("div",{className:"mt-auto text-center pb-8 flex items-center justify-center gap-1 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"没有账户？"}),e.jsx("button",{onClick:s,className:"text-blue-600 font-medium hover:text-blue-700",children:"点击注册"})]})]})},Hl=({onBack:t,onRegisterSuccess:s,onNavigateUserAgreement:a,onNavigatePrivacyPolicy:r})=>{const{showToast:l}=he(),o=()=>typeof window>"u"?"":new URLSearchParams(window.location.search).get("invite_code")||"",[c,d]=n.useState("DDD9A5"),[x,m]=n.useState(""),[b,g]=n.useState(""),[f,h]=n.useState(""),[j,w]=n.useState(""),[v,u]=n.useState(!1),[_,N]=n.useState(!1),[i,F]=n.useState(0),[I,z]=n.useState(!1),[p,P]=n.useState(!1);n.useEffect(()=>{const k=o();k&&d(k)},[]);const y=async()=>{const k=Qt(x);if(!k.valid){l("warning","手机号错误",k.message);return}try{await Sa({mobile:x,event:"register"}),l("success","验证码已发送"),F(60);const T=setInterval(()=>{F(D=>D<=1?(clearInterval(T),0):D-1)},1e3)}catch(T){const D=T.msg||T.message||"发送验证码失败";l("error","验证码发送失败",D)}},S=async()=>{var T;if(!x||!b||!f||!j){l("warning","请填写完整信息");return}if(!v){l("warning","请阅读并同意用户协议");return}if(!/^\d{6}$/.test(f)){l("warning","支付密码格式错误","支付密码必须为6位数字");return}const k=Qt(x);if(!k.valid){l("warning","手机号错误",k.message);return}N(!0);try{const Y=await Vr({mobile:x,password:b,pay_password:f,invite_code:c,captcha:j});if(console.log("注册接口响应:",Y),console.log("response.data:",Y.data),ee(Y)){const L=((T=Y.data)==null?void 0:T.userInfo)||null,B=(L==null?void 0:L.token)||"";if(console.log("提取的userInfo:",L),console.log("提取的token:",B),!B){l("warning","注册成功","但未获取到登录凭证，请手动登录"),s();return}l("success","注册成功","正在自动登录...");const K={token:B,userInfo:L};console.log("准备自动登录，loginPayload:",K),s(K)}else{const L=oe(Y,"注册失败，请稍后重试");l("error","注册失败",L)}}catch(D){console.error("注册失败:",D),D.isCorsError?l("error","网络错误",D.message):D.message?l("error","注册失败",D.message):l("error","注册失败","请检查网络连接后重试")}finally{N(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col px-6 pt-8 pb-safe bg-gradient-to-br from-[#FFD6A5] via-[#FFC3A0] to-[#FFDEE9]",children:[e.jsxs("div",{className:"flex items-center mb-8 relative",children:[e.jsx("button",{onClick:t,className:"absolute left-0 -ml-2 p-2",children:e.jsx(Ee,{size:24,className:"text-gray-800"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900 w-full text-center",children:"注册"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Hello!"}),e.jsx("h3",{className:"text-xl font-bold text-gray-700",children:"欢迎注册树交所"})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(jt,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:"text",value:c,placeholder:"请输入邀请码",onChange:k=>d(k.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),c&&e.jsx("button",{onClick:()=>d(""),className:"text-gray-300 ml-2",children:e.jsx(Xt,{size:18,fill:"#9ca3af",className:"text-white"})})]}),e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(fr,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:"tel",placeholder:"请输入手机号",value:x,onChange:k=>m(k.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"})]}),e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(ks,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:I?"text":"password",placeholder:"设置登录密码",value:b,onChange:k=>g(k.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),e.jsx("button",{type:"button",onClick:()=>z(!I),className:"ml-2 text-gray-400 focus:outline-none",children:I?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]}),e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(Be,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:p?"text":"password",placeholder:"设置支付密码 (6位数字)",value:f,onChange:k=>h(k.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),e.jsx("button",{type:"button",onClick:()=>P(!p),className:"ml-2 text-gray-400 focus:outline-none",children:p?e.jsx(ft,{size:20}):e.jsx(bt,{size:20})})]}),e.jsxs("div",{className:"bg-white rounded-lg flex items-center px-4 py-3 shadow-sm",children:[e.jsx(ot,{className:"text-gray-500 mr-3",size:20}),e.jsx("input",{type:"text",placeholder:"请输入验证码",value:j,onChange:k=>w(k.target.value),className:"flex-1 text-base outline-none placeholder-gray-400 bg-transparent text-gray-800"}),e.jsx("button",{onClick:y,disabled:i>0,className:`text-sm font-medium whitespace-nowrap pl-3 border-l border-gray-200 ${i>0?"text-gray-400":"text-orange-500"}`,children:i>0?`${i}s 后重试`:"获取验证码"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:S,disabled:_,className:"w-full bg-gradient-to-r from-[#FF9966] to-[#FF5E62] text-white font-bold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-all text-lg tracking-wide disabled:opacity-70 disabled:cursor-not-allowed",children:_?"注册中...":"完成并登录"})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-600 mb-8",children:[e.jsx("div",{className:`w-4 h-4 rounded border flex-shrink-0 flex items-center justify-center cursor-pointer transition-colors ${v?"bg-orange-500 border-orange-500":"border-gray-400 bg-transparent"}`,onClick:()=>u(!v),children:v&&e.jsx(Ze,{size:12,className:"text-white"})}),e.jsxs("div",{className:"leading-none flex items-center flex-wrap",children:[e.jsx("span",{children:"阅读并同意"}),e.jsx("button",{type:"button",className:"text-orange-500 mx-0.5",onClick:a,children:"《用户协议》"}),e.jsx("span",{children:"及"}),e.jsx("button",{type:"button",className:"text-orange-500 mx-0.5",onClick:r,children:"《隐私政策》"})]})]}),e.jsx("div",{className:"text-center pb-4 mt-auto",children:e.jsx("button",{className:"text-orange-600 text-sm font-medium",children:"点击下载APP"})})]})},Yl=({friend:t,id:s,onBack:a})=>{if(!t)return e.jsx(_e,{title:"好友详情",onBack:a,children:e.jsxs("div",{className:"flex flex-col items-center justify-center pt-20 text-gray-400",children:[e.jsx("p",{children:"未找到好友信息"}),e.jsxs("p",{className:"text-xs mt-2",children:["ID: ",s]})]})});const r=t.join_date||(t.join_time?Pe(t.join_time,"YYYY-MM-DD"):"-"),l=t.join_time?Pe(t.join_time):"-";return e.jsx(_e,{title:"好友详情",onBack:a,children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm flex flex-col items-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-orange-50 to-white -z-10"}),e.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-md mb-3 overflow-hidden",children:e.jsx("img",{src:ke(t.avatar)||"/static/images/avatar.png",alt:t.nickname,className:"w-full h-full object-cover",onError:o=>{const c=o.target;c.src="/static/images/avatar.png"}})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:t.nickname||"未命名用户"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",t.username]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"用户 ID"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.id})]}),e.jsxs("div",{className:"px-5 py-4 border-b border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"手机号"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.mobile||"-"})]}),e.jsxs("div",{className:"px-5 py-4 border-b border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"加入日期"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r})]}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"注册时间"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l})]})]})]})})},Vl=({product:t,onBack:s,onNavigate:a})=>{const{showToast:r}=he(),[l,o]=n.useState(0),[c,d]=n.useState(!1),[x,m]=n.useState(!1),[b,g]=n.useState(t.sessionId),[f,h]=n.useState(t.zoneId),[j,w]=n.useState(t.price),v=Math.ceil(t.price/100),u=v+l,[_,N]=n.useState(10),i=j,[F,I]=n.useState(1e3),z=_>=u,p=F>=i,P=Math.max(0,_-v),y=l<P,[S,k]=n.useState(!1),T=async()=>{var B,K,C;if(S)return{sessionId:b??t.sessionId,zoneId:f??t.zoneId};if(k(!0),!(t!=null&&t.id))return{sessionId:b,zoneId:f};try{const E=await va(Number(t.id)),R=re(E);if(R){const O=R.session_id??R.sessionId??((B=R.session)==null?void 0:B.id)??((K=R.session)==null?void 0:K.session_id),V=R.zone_id??R.price_zone_id??R.zoneId??R.priceZoneId??((C=R.zone)==null?void 0:C.id),H=R.zone_max_price??R.zoneMaxPrice??R.max_price??R.maxPrice??R.price;return O&&g(O),V&&h(V),H&&w(Number(H)),{sessionId:O??b??t.sessionId,zoneId:V??f??t.zoneId}}}catch(E){console.warn("补全场次/分区失败",E)}return{sessionId:b??t.sessionId,zoneId:f??t.zoneId}};n.useEffect(()=>{b&&f||t!=null&&t.id&&T()},[t==null?void 0:t.id,b,f]),n.useEffect(()=>{(async()=>{const K=ce();if(!K){console.log("用户未登录，使用默认算力和余额");return}try{const C=await $e(K);ee(C)&&(N(Number(C.data.userInfo.green_power)||0),I(Number(C.data.userInfo.balance_available)||0))}catch(C){if(console.error("获取用户信息失败:",C),(C==null?void 0:C.name)==="NeedLoginError")return}})()},[]);const D=()=>{!z||!p||d(!0)},Y=()=>{z?p||a({name:"balance-recharge",source:"reservation",back:{name:"reservation"}}):a({name:"hashrate-exchange",source:"reservation",back:{name:"reservation"}})},L=async()=>{try{m(!0);const B=b??t.sessionId,K=f??t.zoneId;let C=B,E=K;if(!C||Number(C)<=0||!E||Number(E)<=0){const O=await T();C=O.sessionId,E=O.zoneId}const R=await Dn({session_id:C,zone_id:E,extra_hashrate:l});Number(R.code)===1?(d(!1),r("success","预约成功",R.msg||"预约成功"),a({name:"reservation-record"},{replace:!0})):r("error","预约失败",R.msg||"预约失败")}catch(B){if(console.error("操作失败:",B),(B==null?void 0:B.name)==="NeedLoginError")return;r("error","操作失败",(B==null?void 0:B.msg)||(B==null?void 0:B.message)||"网络错误，请稍后重试")}finally{m(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(Ee,{size:24,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"预约确权"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden shrink-0",children:e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 line-clamp-2",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["艺术家: ",t.artist]}),e.jsxs("div",{className:"text-xs text-gray-400 font-mono mt-2",children:["确权编号: 37-DATA-2025-",String(t.id).padStart(4,"0")]}),e.jsxs("div",{className:"flex items-baseline gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"起购价"}),e.jsxs("span",{className:"text-xl font-bold text-red-600 font-mono",children:["¥",t.price.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ct,{size:18,className:"text-orange-500 fill-orange-500"}),"算力配置"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"基础算力需求"}),e.jsx("span",{className:"font-mono font-bold",children:v})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-4",children:[e.jsx("span",{children:"额外加注算力 (提升中签率)"}),e.jsxs("span",{className:"font-mono font-bold text-orange-600",children:["+",l]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 p-3 rounded-lg",children:[e.jsx("button",{onClick:()=>o(Math.max(0,l-.5)),disabled:l<=0,className:`w-8 h-8 flex items-center justify-center bg-white rounded-full shadow font-bold transition-all ${l<=0?"text-gray-300 cursor-not-allowed":"text-gray-600 active:scale-95"}`,children:"-"}),e.jsx("div",{className:"flex-1 text-center font-mono font-bold text-lg text-gray-900",children:l.toFixed(1)}),e.jsx("button",{onClick:()=>y&&o(l+.5),disabled:!y,className:`w-8 h-8 flex items-center justify-center bg-white rounded-full shadow font-bold transition-all ${y?"text-orange-600 active:scale-95":"text-gray-300 cursor-not-allowed"}`,children:"+"})]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"当前持有绿色算力"}),e.jsx("span",{className:`font-mono font-bold ${z?"text-gray-900":"text-red-500"}`,children:_.toFixed(1)})]}),!z&&e.jsxs("div",{className:"text-xs text-red-500 flex items-center justify-end gap-1",children:[e.jsx(pe,{size:12}),"算力不足，请前往【我的-算力兑换】获取"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Le,{size:18,className:"text-blue-500 fill-blue-500"}),"资金冻结"]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"需冻结专项金（该场次最高价）"}),e.jsxs("span",{className:"font-mono font-bold",children:["¥",i.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"当前专项金余额"}),e.jsxs("span",{className:`font-mono font-bold ${p?"text-gray-900":"text-red-500"}`,children:["¥",F.toLocaleString()]})]}),e.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(zt,{size:14,className:"text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-blue-700 leading-relaxed",children:"预约时将冻结该场次的最高金额，撮合成功后若实际藏品金额低于冻结金额，将自动退还差价"})]})}),!p&&e.jsxs("div",{className:"text-xs text-red-500 flex items-center gap-1 mt-2",children:[e.jsx(pe,{size:12}),"余额不足，请充值"]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 pb-safe",children:e.jsx("button",{onClick:!z||!p?Y:D,className:`w-full py-3.5 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-all active:scale-[0.98] ${z&&p?"bg-[#8B0000] text-amber-50 shadow-red-900/20 hover:bg-[#A00000]":"bg-[#8B0000] text-white opacity-90"}`,children:z?p?"确认预约":"前往充值专项金":"前往获取算力"})}),c&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl p-6 relative z-10 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-xl font-bold text-center mb-6",children:"确认提交预约"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"消耗算力"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-gray-900 font-mono",children:u.toFixed(1)}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["基础 ",v," + 加注 ",l]})]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"冻结金额"}),e.jsxs("div",{className:"font-bold text-gray-900 font-mono",children:["¥",i.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-3 rounded-lg border border-gray-200 text-gray-600 font-bold hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:L,disabled:x,className:"flex-1 py-3 rounded-lg bg-[#8B0000] text-white font-bold hover:bg-[#A00000] flex justify-center items-center",children:x?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):"确认提交"})]})]})]})]})},ea=10,Wl=({onBack:t,onNavigate:s,onProductSelect:a})=>{const[r,l]=n.useState(-1),[o,c]=n.useState([]),[d,x]=n.useState(!0),[m,b]=n.useState(!1),[g,f]=n.useState(null),[h,j]=n.useState(!1),[w,v]=n.useState(1),[u,_]=n.useState(!0),N=n.useRef(null);n.useEffect(()=>{const z=ce();j(!!z)},[]),n.useEffect(()=>{h?(v(1),c([]),i(1,!1)):x(!1)},[r,h]);const i=async(z,p=!1)=>{try{p?b(!0):x(!0),f(null);const P=await wa({status:r,page:z,limit:ea});if(Number(P.code)===1&&P.data){const y=P.data.list||[],S=P.data.total||0;c(p?k=>[...k,...y]:y),v(z),_(z*ea<S)}else f(P.msg||"加载失败")}catch(P){if(console.error("加载申购记录失败:",P),(P==null?void 0:P.name)==="NeedLoginError")return;f((P==null?void 0:P.msg)||"网络连接异常")}finally{x(!1),b(!1)}},F=n.useCallback(()=>{if(!N.current||m||!u)return;const{scrollTop:z,scrollHeight:p,clientHeight:P}=N.current;z+P>=p-100&&i(w+1,!0)},[m,u,w,r]),I=z=>{switch(z.status){case Me.PENDING:return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded border flex items-center gap-1 bg-orange-50 text-orange-600 border-orange-200",children:[e.jsx(ze,{size:10,className:"text-orange-500"})," 待撮合"]});case Me.APPROVED:return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded border flex items-center gap-1 bg-green-50 text-green-600 border-green-200",children:[e.jsx(wt,{size:10,className:"text-green-500"})," 已撮合"]});case Me.REJECTED:return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded border flex items-center gap-1 bg-gray-100 text-gray-500 border-gray-200",children:[e.jsx(pe,{size:10,className:"text-gray-400"})," 已退款"]});default:return e.jsxs("span",{className:"text-xs font-bold px-2 py-0.5 rounded border flex items-center gap-1 bg-gray-50 text-gray-500 border-gray-200",children:[e.jsx(ze,{size:10})," ",z.status_text||"未知"]})}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm border-b border-gray-100",children:[e.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(Ee,{size:24,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"申购记录"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"sticky top-[53px] z-10 bg-white border-b border-gray-100 shadow-sm",children:e.jsx("div",{className:"flex px-4",children:[{key:-1,label:"全部"},{key:Me.PENDING,label:"待撮合"},{key:Me.APPROVED,label:"已撮合"},{key:Me.REJECTED,label:"已退款"}].map(z=>e.jsx("button",{onClick:()=>l(z.key),className:`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${r===z.key?"border-[#8B0000] text-[#8B0000]":"border-transparent text-gray-400 hover:text-gray-600"}`,children:z.label},z.key))})}),e.jsxs("div",{ref:N,onScroll:F,className:"p-4 space-y-4 h-[calc(100vh-110px)] overflow-y-auto",children:[h?d?e.jsxs("div",{className:"py-20 text-center text-gray-400",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-orange-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-sm",children:"加载中..."})]}):g?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:g}),e.jsx("button",{onClick:()=>i(1,!1),className:"text-sm font-bold text-orange-500 bg-orange-50 px-4 py-2 rounded-lg",children:"重试"})]}):o.length===0?e.jsxs("div",{className:"py-20 text-center text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ze,{size:24})}),e.jsx("p",{className:"text-sm",children:"暂无申购记录"})]}):o.map(z=>e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-lg border border-gray-100 mb-4 hover:shadow-xl transition-shadow duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 pb-3 border-b border-gray-50",children:[e.jsx("div",{className:"text-xs text-gray-400",children:z.create_time||""}),I(z)]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-gray-900 font-bold text-base",children:z.session_title||"盲盒预约"}),e.jsx("span",{className:"text-xs bg-orange-50 text-orange-600 px-2 py-0.5 rounded-full border border-orange-100 font-bold",children:z.zone_name||`分区${z.zone_id}`})]}),(z.session_start_time||z.session_end_time)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Lt,{size:12}),e.jsxs("span",{children:["场次时间: ",z.session_start_time||"--:--"," - ",z.session_end_time||"--:--"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 grid grid-cols-2 gap-y-2 gap-x-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(Le,{size:10})," 冻结金额"]}),e.jsxs("span",{className:"text-xs font-bold text-red-600 font-mono",children:["¥",Number(z.freeze_amount||0).toLocaleString()]})]}),z.status===Me.APPROVED&&z.item_price&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:"实际金额"}),e.jsxs("span",{className:"text-xs font-bold text-green-600 font-mono",children:["¥",Number(z.item_price||0).toLocaleString()]})]}),z.status!==Me.APPROVED&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(ct,{size:10})," 权重"]}),e.jsx("span",{className:"text-xs font-bold text-gray-900 font-mono",children:z.weight||0})]}),z.power_used>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[e.jsx(ct,{size:10})," 消耗算力"]}),e.jsx("span",{className:"text-xs font-bold text-gray-900 font-mono",children:z.power_used})]})]}),z.status===Me.APPROVED&&z.item_price&&Number(z.freeze_amount)>Number(z.item_price)&&e.jsx("div",{className:"mb-3 p-2 bg-green-50 rounded-lg border border-green-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-700",children:[e.jsx(wt,{size:12,className:"flex-shrink-0"}),e.jsxs("span",{children:["已退还差价：¥",(Number(z.freeze_amount)-Number(z.item_price)).toLocaleString()]})]})}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("div",{className:"text-gray-400",children:[z.status===Me.PENDING&&z.session_end_time&&`预计 ${z.session_end_time} 结束撮合`,z.status===Me.APPROVED&&z.match_time&&`撮合时间: ${z.match_time}`,z.status===Me.REJECTED&&"未中签，冻结金额已退回"]}),z.status===Me.APPROVED&&e.jsxs("button",{onClick:p=>{p.stopPropagation(),s({name:"my-collection",back:{name:"reservation-record"}})},className:"text-xs font-bold text-[#8B0000] flex items-center gap-1 bg-red-50 pl-3 pr-2 py-1.5 rounded-full",children:["去持仓查看 ",e.jsx(St,{size:12})]})]})]},z.id)):e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{size:32,className:"text-orange-500"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"请先登录"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"登录后即可查看您的申购记录"}),e.jsx("button",{onClick:()=>s({name:"login"}),className:"px-6 py-3 bg-[#8B0000] text-white rounded-lg font-bold shadow-md shadow-red-900/10 hover:bg-[#A00000] transition-colors",children:"去登录"})]}),m&&e.jsxs("div",{className:"py-3 flex items-center justify-center text-gray-400 text-xs",children:[e.jsx(dt,{size:16,className:"animate-spin mr-2"}),"加载中..."]}),!d&&!u&&o.length>0&&e.jsx("div",{className:"py-3 text-center text-gray-400 text-xs",children:"已加载全部"})]})]})},Kl=({product:t,onBack:s,onNavigate:a})=>{const{showToast:r,showDialog:l}=he(),[o,c]=n.useState(null),[d,x]=n.useState(!0),[m,b]=n.useState(null),[g,f]=n.useState(!1),[h,j]=n.useState(null),[w,v]=n.useState(!1),[u,_]=n.useState(!1),[N,i]=n.useState(!1),[F,I]=n.useState(!1),[z,p]=n.useState([]),[P,y]=n.useState(null),[S,k]=n.useState(!1),[T,D]=n.useState(1),[Y,L]=n.useState("");n.useEffect(()=>{B(),K()},[t.id]);const B=async()=>{try{x(!0),b(null);const G=await Cs(t.id);ee(G)&&G.data?c(G.data):b(oe(G,"获取商品详情失败"))}catch{b("网络请求失败，请稍后重试")}finally{x(!1)}},K=async()=>{var G;try{const J=localStorage.getItem(ne)||"";if(!J)return;const se=await fa(J);if(ee(se)&&((G=se.data)!=null&&G.list)){p(se.data.list);const de=se.data.list.find(Re=>Number(Re.is_default)===1)||se.data.list[0];de&&y(de)}}catch(J){console.error("Load addresses failed",J)}},C=async()=>{try{v(!0);const G=await Tn(t.id);ee(G)&&G.data?(j(G.data),f(!0)):r("error",oe(G,"获取分享信息失败"))}catch{r("error","网络请求失败")}finally{v(!1)}},E=()=>{h!=null&&h.share_url&&navigator.clipboard.writeText(h.share_url).then(()=>{r("success","链接已复制")}).catch(()=>{r("error","复制失败")})},R=!!(o!=null&&o.score_price),O=(o==null?void 0:o.stock)||0,V=()=>{D(1),i(!0)},H=()=>{if(T>O){r("error","库存不足");return}if(i(!1),z.length===0){l({title:"温馨提示",description:"您还没有设置收货地址，请先添加地址",confirmText:"去添加",cancelText:"取消",onConfirm:()=>a({name:"address-list",back:{name:"points-product-detail"}})});return}I(!0)},W=async()=>{if(!u){if(!P){r("error","请选择收货地址");return}try{_(!0);const G=await Na({items:[{product_id:Number(t.id),quantity:T}],pay_type:R?"score":"money",address_id:P.id});ee(G)?(I(!1),r("success","购买成功"),setTimeout(()=>{a({name:"order-list",kind:"points",status:0,back:{name:"points-product-detail"}})},1500)):r("error","购买失败",oe(G,"操作失败"))}catch(G){console.error("Create order failed",G),r("error","下单失败",G.message||"系统错误")}finally{_(!1)}}};if(d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(ge,{})});if(m)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 text-gray-500",children:m});const A=(o==null?void 0:o.score_price)||(o==null?void 0:o.price)||0,$=(Number(A)*T).toFixed(2),U=Number(A)*T;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24 relative",children:[e.jsxs("header",{className:"sticky top-0 z-40 bg-white/90 backdrop-blur-sm px-4 py-3 flex justify-between items-center border-b border-gray-100",children:[e.jsx("button",{onClick:s,className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors text-gray-800",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"消费金商品详情"}),e.jsx("button",{onClick:C,disabled:w,className:"p-2 -mr-2 hover:bg-gray-100 rounded-full text-gray-800 transition-colors",children:w?e.jsx(ge,{size:20,color:"gray"}):e.jsx(ts,{size:20})})]}),e.jsx("div",{className:"aspect-square w-full bg-white relative",children:e.jsx(et,{src:(o==null?void 0:o.thumbnail)||t.image||"",alt:(o==null?void 0:o.name)||t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("div",{className:"flex items-baseline gap-1 mb-2",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600 font-mono",children:[R?"":"¥",A]}),e.jsx("span",{className:"text-sm text-orange-500 font-medium",children:R?"消费金":"元"}),(o==null?void 0:o.price)&&R&&e.jsxs("span",{className:"text-xs text-gray-400 line-through ml-2",children:["¥",o.price]})]}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 leading-snug mb-2",children:(o==null?void 0:o.name)||t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["库存: ",(o==null?void 0:o.stock)??"-"]}),e.jsxs("span",{children:["销量: ",(o==null?void 0:o.sales)??"-"]})]})]}),e.jsxs("div",{className:"bg-white p-4 mb-2 flex items-center justify-between active:bg-gray-50 transition-colors",onClick:()=>i(!0),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:"选择规格"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["已选: ",T," 件"]})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})]}),e.jsxs("div",{className:"bg-white p-4 mb-20",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3 border-l-4 border-orange-500 pl-2",children:"商品详情"}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed rich-text space-y-2",dangerouslySetInnerHTML:{__html:(o==null?void 0:o.description)||"<p>暂无详情</p>"}})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 z-50 flex items-center gap-3 safe-area-bottom",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500 px-2 min-w-[50px]",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"}),e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"})]}),e.jsx("span",{className:"text-[10px] mt-0.5",children:"店铺"})]}),e.jsxs("button",{className:"flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3 px-6 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] transition-transform flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",onClick:V,disabled:u,children:[R?e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"8"}),e.jsx("path",{d:"M9.3 12.5a3.5 3.5 0 0 0 5.4 0"}),e.jsx("line",{x1:"12",x2:"12",y1:"16",y2:"16"})]}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),e.jsx("line",{x1:"2",x2:"22",y1:"10",y2:"10"})]}),R?"立即兑换":"立即购买"]})]}),g&&h&&e.jsx("div",{className:"fixed inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center animate-in fade-in",onClick:()=>f(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-[32px] p-6 pb-safe animate-in slide-in-from-bottom duration-300 relative",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"分享商品"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 p-2 -mr-2",children:e.jsx(Ce,{size:24})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 mb-6 flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-lg overflow-hidden shrink-0 border border-gray-100",children:e.jsx("img",{src:h.share_image||h.product.thumbnail,className:"w-full h-full object-cover",alt:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 mb-1 line-clamp-2",children:h.share_title}),e.jsx("div",{className:"text-xs text-gray-500 mb-2 line-clamp-2",children:h.share_desc})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("button",{onClick:E,className:"flex flex-col items-center justify-center gap-2 p-4 bg-orange-50 rounded-2xl active:scale-[0.98] transition-transform",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center",children:e.jsx(nt,{size:24})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"复制链接"})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"text-xs text-center text-gray-400",children:["分享码: ",h.share_code]})})]})}),N&&e.jsx("div",{className:"fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm flex items-end justify-center animate-in fade-in",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-[32px] p-6 pb-safe animate-in slide-in-from-bottom duration-300 relative",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-xl overflow-hidden shrink-0 border border-gray-100 -mt-10 shadow-lg relative bg-white",children:e.jsx("img",{src:(o==null?void 0:o.thumbnail)||t.image,className:"w-full h-full object-cover",alt:""})}),e.jsxs("div",{className:"flex-1 pt-1",children:[e.jsxs("div",{className:"text-xl font-bold text-orange-600 mb-1 font-mono",children:[R?"":"¥",A,e.jsx("span",{className:"text-xs font-normal ml-1",children:R?"消费金":"元"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["库存: ",O," 件"]}),e.jsxs("div",{className:"text-sm text-gray-900 mt-1 font-medium",children:["已选: ",T," 件"]})]}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 p-2 -mr-2 -mt-2",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-3",children:"购买数量"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>D(G=>Math.max(1,G-1)),className:"w-10 h-8 flex items-center justify-center bg-gray-50 active:bg-gray-100 text-gray-600 disabled:opacity-50",disabled:T<=1,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M5 12h14"})})}),e.jsx("div",{className:"w-12 h-8 flex items-center justify-center text-sm font-bold border-x border-gray-200 bg-white",children:T}),e.jsx("button",{onClick:()=>D(G=>Math.min(O,G+1)),className:"w-10 h-8 flex items-center justify-center bg-gray-50 active:bg-gray-100 text-gray-600 disabled:opacity-50",disabled:T>=O,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})})]}),e.jsx("span",{className:"text-xs text-gray-400",children:T>=O?"(已达最大库存)":""})]})]}),e.jsx("button",{onClick:H,className:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3.5 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] flex items-center justify-center gap-2",children:"下一步"})]})}),F&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-gray-50 flex flex-col animate-in slide-in-from-right duration-300",children:[e.jsxs("header",{className:"bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-10 border-b border-gray-100",children:[e.jsx("button",{onClick:()=>I(!1),className:"p-2 -ml-2 text-gray-800",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"确认订单"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 mb-4 flex items-center justify-between active:bg-gray-50 transition-colors border border-gray-100 shadow-sm",onClick:()=>k(!0),children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900 truncate",children:P==null?void 0:P.name}),e.jsx("span",{className:"text-gray-500 text-xs",children:P==null?void 0:P.phone})]}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[P==null?void 0:P.province," ",P==null?void 0:P.city," ",P==null?void 0:P.district," ",P==null?void 0:P.address]})]})]}),e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400 rotate-180",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-gray-50",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-500",children:[e.jsx("path",{d:"m6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"}),e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"})]}),e.jsx("span",{className:"text-xs font-bold text-gray-700",children:"店铺自营"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden shrink-0",children:e.jsx("img",{src:(o==null?void 0:o.thumbnail)||t.image,className:"w-full h-full object-cover",alt:""})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 line-clamp-2",children:(o==null?void 0:o.name)||t.title}),e.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 self-start px-2 py-0.5 rounded mt-1",children:"默认规格"}),e.jsx("div",{className:"flex justify-between items-end mt-2",children:e.jsxs("div",{className:"font-mono font-bold text-orange-600 text-lg",children:[R?"":"¥",A,e.jsxs("span",{className:"text-xs text-gray-500 font-normal ml-1",children:["x ",T]})]})})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-50 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"配送方式"}),e.jsx("span",{className:"text-sm text-gray-900",children:"快递 免邮"})]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 shrink-0 mr-3",children:"订单备注"}),e.jsx("input",{type:"text",value:Y,onChange:G=>L(G.target.value),placeholder:"选填，请输入备注信息",className:"flex-1 text-sm text-right text-gray-900 bg-transparent outline-none placeholder:text-gray-400",maxLength:100})]}),e.jsxs("div",{className:"mt-3 flex justify-end items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["共 ",T," 件，小计："]}),e.jsx("span",{className:"text-lg font-bold text-orange-600 font-mono",children:R?`${U} 消费金`:`¥${$}`})]})]})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 p-4 safe-area-bottom flex items-center justify-between shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"合计:"}),e.jsx("span",{className:"text-xl font-bold text-orange-600 font-mono",children:R?`${U} 消费金`:`¥${$}`})]}),e.jsx("button",{onClick:W,disabled:u,className:"bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-orange-200 active:scale-[0.98] flex items-center justify-center gap-2 min-w-[140px]",children:u?e.jsx(ge,{size:20,color:"white"}):"提交订单"})]})]}),S&&e.jsx("div",{className:"fixed inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center animate-in fade-in",onClick:()=>k(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-[32px] p-6 pb-safe animate-in slide-in-from-bottom duration-300 max-h-[70vh] flex flex-col",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"选择收货地址"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-500",children:"关闭"})]}),e.jsxs("div",{className:"overflow-y-auto space-y-4 flex-1",children:[z.map(G=>e.jsxs("div",{onClick:()=>{y(G),k(!1)},className:`p-4 rounded-xl border flex items-center gap-3 ${(P==null?void 0:P.id)===G.id?"border-orange-500 bg-orange-50":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-900 mb-1",children:[G.name,e.jsx("span",{className:"text-gray-500 font-normal text-xs",children:G.phone}),Number(G.is_default)===1&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-500 px-1 rounded",children:"默认"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[G.province," ",G.city," ",G.district," ",G.address]})]}),(P==null?void 0:P.id)===G.id&&e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"})]},G.id)),e.jsxs("button",{onClick:()=>{a("address-list"),k(!1)},className:"w-full py-3 border border-dashed border-gray-300 rounded-xl text-gray-500 text-sm flex items-center justify-center gap-2",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"管理/添加地址"]})]})]})})]})},Jl=({toast:t,onClose:s,index:a})=>{const r=()=>{switch(t.type){case"success":return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--gns-success-green)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m9 12 2 2 4-4"})]});case"info":return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--gns-info-bluegray)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]});case"warning":return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"var(--gns-warning-amber)",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]});case"error":return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--gns-error-coral)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m15 9-6 6"}),e.jsx("path",{d:"m9 9 6 6"})]})}};return e.jsxs("div",{className:"gns-toast",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"gns-toast-icon",children:r()}),e.jsxs("div",{className:"gns-toast-content",children:[e.jsx("div",{className:"gns-toast-title",children:t.title}),t.description&&e.jsx("div",{className:"gns-toast-desc",children:t.description})]}),e.jsx("div",{className:"gns-toast-close",onClick:s,children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"m6 6 12 12"})]})})]})},ql=({item:t,onClose:s})=>e.jsxs("div",{className:"gns-snackbar",onClick:a=>a.stopPropagation(),children:[e.jsx("span",{className:"gns-snackbar-text",children:t.text}),t.action&&e.jsx("button",{className:"gns-snackbar-action",onClick:()=>{var a;(a=t.action)==null||a.onClick(),s()},children:t.action.text})]}),Zl=({item:t,onClose:s})=>e.jsx("div",{className:"gns-dialog-overlay",onClick:s,children:e.jsxs("div",{className:"gns-dialog",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{className:"gns-dialog-title",children:t.title}),e.jsx("p",{className:"gns-dialog-desc",children:t.description}),e.jsxs("div",{className:"gns-dialog-actions",children:[e.jsx("button",{className:"gns-dialog-btn secondary",onClick:()=>{var a;(a=t.onCancel)==null||a.call(t),s()},children:t.cancelText||"取消"}),e.jsx("button",{className:"gns-dialog-btn primary",onClick:()=>{t.onConfirm(),s()},children:t.confirmText||"确认"})]})]})}),Ql=()=>{const{toasts:t,snackBar:s,dialog:a,removeToast:r,closeSnackBar:l,hideDialog:o}=he();return e.jsxs("div",{className:"gns-container",children:[e.jsx("div",{className:"gns-toast-stack",children:t.map((c,d)=>e.jsx(Jl,{toast:c,index:d,onClose:()=>r(c.id)},c.id))}),s&&e.jsx("div",{className:"gns-snackbar-container",children:e.jsx(ql,{item:s,onClose:l})}),a&&e.jsx(Zl,{item:a,onClose:o})]})},Xl=({onNavigate:t,onSwitchTab:s,announcements:a=[]})=>{const[r,l]=n.useState(0),[o,c]=n.useState(0),[d,x]=n.useState([]),[m,b]=n.useState([]),[g,f]=n.useState([]),[h,j]=n.useState(!0),w=n.useRef(0),v=n.useRef(0),u=n.useRef(null),_=n.useRef(null),N=()=>{d.length&&(u.current&&clearInterval(u.current),u.current=setInterval(()=>{l(p=>(p+1)%d.length)},4e3))};n.useEffect(()=>{if(a.length)return _.current=setInterval(()=>{c(p=>(p+1)%a.length)},3e3),()=>{_.current&&clearInterval(_.current)}},[a.length]),n.useEffect(()=>{if(!a.length){c(0);return}c(p=>p%a.length)},[a.length]),n.useEffect(()=>{if(!d.length){u.current&&(clearInterval(u.current),u.current=null),l(0);return}return N(),()=>{u.current&&clearInterval(u.current)}},[d.length]),n.useEffect(()=>{(async()=>{var P,y,S;try{const[k,T]=await Promise.all([Kn({page:1,limit:10}),Es({page:1,limit:4})]);if(ee(k)&&((y=(P=k.data)==null?void 0:P.list)!=null&&y.length)){const L=k.data.list.map(B=>({id:String(B.id),image:ke(B.image),tag:B.description||"",title:B.title||""}));x(L),l(0)}else x([]),l(0);const Y=(((S=T.data)==null?void 0:S.list)??[]).slice(0,4).map(L=>({id:String(L.id),name:L.name,image:ke(L.image),title:L.title,bio:L.bio}));b(Y)}catch(k){console.error("加载首页数据失败:",k),x([]),l(0),b([])}})()},[]),n.useEffect(()=>{(async()=>{var P;try{j(!0);const y=await wa({page:1,limit:3});ee(y)&&((P=y.data)!=null&&P.list)?f(y.data.list):f([])}catch(y){console.error("加载申购记录失败:",y),f([])}finally{j(!1)}})()},[]);const i=p=>{w.current=p.targetTouches[0].clientX,u.current&&clearInterval(u.current)},F=p=>{v.current=p.targetTouches[0].clientX},I=()=>{if(!d.length){N();return}if(!w.current||!v.current){N();return}const p=w.current-v.current,P=p>50,y=p<-50;P?l(S=>(S+1)%d.length):y&&l(S=>(S-1+d.length)%d.length),w.current=0,v.current=0,N()},z=[{label:"专项金申购",icon:Le,color:"text-orange-500",bgColor:"bg-orange-50",action:()=>t({name:"balance-recharge",source:"asset-view"})},{label:"收益提现",icon:br,color:"text-orange-500",bgColor:"bg-orange-50",action:()=>t({name:"balance-withdraw",source:"asset-view"})},{label:"算力补充",icon:ct,color:"text-orange-500",bgColor:"bg-orange-50",action:()=>t({name:"hashrate-exchange",source:"asset-view"})},{label:"确权申报",icon:pr,color:"text-orange-500",bgColor:"bg-orange-50",action:()=>t({name:"cumulative-rights"})}];return e.jsxs("div",{className:"pb-24 bg-gray-50 min-h-screen",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-[#FFD6A5] to-gray-50 z-0"}),e.jsx("header",{className:"px-4 py-3 fixed top-0 left-0 right-0 z-20 bg-gradient-to-r from-[#FFD6A5] to-[#FFC3A0] shadow-sm max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-center bg-white rounded-full p-1 pl-4 shadow-sm cursor-pointer active:scale-[0.99] transition-transform",onClick:()=>t({name:"search"}),children:[e.jsx(Nt,{size:16,className:"text-gray-400 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-400 flex-1 truncate",children:"数据资产溯源查询..."}),e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs font-medium px-4 py-1.5 rounded-full flex-shrink-0 ml-2",children:"搜索"})]})}),e.jsxs("div",{className:"p-4 pb-0 pt-[72px] relative z-0",children:[e.jsxs("div",{className:"w-full h-40 rounded-xl overflow-hidden relative shadow-lg touch-pan-y",onTouchStart:i,onTouchMove:F,onTouchEnd:I,children:[e.jsx("div",{className:"flex h-full transition-transform duration-500 ease-out",style:{transform:`translateX(-${r*100}%)`},children:d.map(p=>e.jsxs("div",{className:"w-full flex-shrink-0 relative h-full",children:[e.jsx("img",{src:p.image,alt:p.title||"Banner",className:"w-full h-full object-cover",draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/40 to-transparent flex items-center p-4",children:e.jsxs("div",{className:"text-white",children:[p.tag&&e.jsx("div",{className:"bg-orange-500 text-xs inline-block px-2 py-0.5 rounded mb-2 backdrop-blur-sm bg-opacity-90",children:p.tag}),p.title&&e.jsx("h2",{className:"font-bold text-xl shadow-black drop-shadow-md",children:p.title})]})})]},p.id))}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10",children:d.map((p,P)=>e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${r===P?"w-4 bg-white":"w-1.5 bg-white/60"}`},P))})]}),e.jsxs("div",{className:`flex items-center mt-3 text-xs text-gray-600 bg-white/80 backdrop-blur-sm p-2 rounded-lg transition-colors shadow-sm ${a.length?"cursor-pointer active:bg-white":"opacity-60"}`,onClick:()=>{var p;if(a.length){const P=(p=a[o])==null?void 0:p.id;P&&t({name:"news-detail",id:P,from:{name:"news"}})}},children:[e.jsx("span",{className:"bg-orange-500 text-white px-1 rounded text-[10px] mr-2 flex-shrink-0 font-medium",children:"平台资讯"}),e.jsx("div",{className:"flex-1 h-5 overflow-hidden relative",children:e.jsx("div",{className:"absolute w-full transition-transform duration-500 ease-in-out",style:{transform:`translateY(-${o*1.25}rem)`},children:(a.length?a:[{id:"placeholder",title:"暂无公告"}]).map(p=>e.jsx("div",{className:"h-5 flex items-center w-full",children:e.jsx("span",{className:"truncate text-gray-700",children:p.title})},p.id))})}),e.jsx(qe,{size:14,className:"text-gray-400 flex-shrink-0 ml-1"})]})]}),e.jsx("div",{className:"pb-4 pt-4 relative z-0",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 px-2",children:z.map((p,P)=>e.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-70 transition-opacity",onClick:p.action,children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${p.bgColor} flex items-center justify-center mb-1 ${p.color} shadow-sm`,children:e.jsx(p.icon,{size:20})}),e.jsx("span",{className:"text-[10px] text-gray-700 font-medium whitespace-nowrap",children:p.label})]},P))})}),e.jsx("div",{className:"px-4 py-2 mb-2 relative z-0",children:e.jsx("div",{className:"w-full h-24 rounded-xl overflow-hidden relative shadow-md cursor-pointer transform transition active:scale-95 duration-200 group bg-gradient-to-r from-[#FFD6A5] to-[#FFC3A0]",onClick:()=>t({name:"trading-zone"}),children:e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white tracking-widest drop-shadow-md",children:"交易专区"}),e.jsx("div",{className:"w-8 h-1 bg-white/80 mt-2 rounded-full shadow-sm"})]})})}),e.jsxs("div",{className:"mt-2 bg-white p-4 rounded-t-2xl shadow-sm relative z-0 pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"font-bold text-gray-800 text-lg border-l-4 border-orange-500 pl-2 flex items-center gap-2",children:"申购记录"}),e.jsxs("button",{onClick:()=>t({name:"reservation-record"}),className:"text-gray-400 flex items-center text-xs bg-gray-50 px-2 py-1 rounded-full",children:["全部记录 ",e.jsx(qe,{size:14})]})]}),e.jsx("div",{className:"space-y-3",children:h?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(ze,{size:24,className:"mx-auto mb-2 animate-pulse"}),e.jsx("p",{className:"text-sm",children:"加载中..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(vs,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"暂无申购记录"})]}):g.map(p=>{const P=y=>{switch(y.status){case 0:return e.jsxs("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded border flex items-center gap-1 whitespace-nowrap text-orange-600 bg-orange-100 border-orange-200",children:[e.jsx(ze,{size:10,className:"text-orange-500"})," 待撮合"]});case 1:return e.jsxs("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded border flex items-center gap-1 whitespace-nowrap text-green-600 bg-green-100 border-green-200",children:[e.jsx(wt,{size:10,className:"text-green-500"})," 已中签"]});case 2:return e.jsxs("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded border flex items-center gap-1 whitespace-nowrap text-gray-400 bg-gray-100 border-gray-200",children:[e.jsx(pe,{size:10,className:"text-gray-400"})," 未中签"]});default:return e.jsxs("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded border flex items-center gap-1 whitespace-nowrap text-gray-400 bg-gray-100 border-gray-200",children:[e.jsx(ze,{size:10})," ",y.status_text||"未知"]})}};return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 flex flex-col gap-2 active:scale-[0.99] transition-transform cursor-pointer",onClick:()=>t({name:"reservation-record"}),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:p.status_text||"待撮合"}),e.jsx("span",{className:"text-xs text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded border border-orange-100",children:p.session_id?`场次${p.session_id}`:"盲盒预约"})]}),P(p)]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["冻结金额 ",e.jsxs("span",{className:"text-red-600 font-bold",children:["¥",Number(p.freeze_amount||0).toLocaleString()]})]}),e.jsxs("span",{className:"text-gray-400",children:["权重: ",p.weight||0]})]})]},p.id)})})]})]})},ta=({announcements:t,onNavigate:s,onSwitchTab:a})=>e.jsx(Xl,{onNavigate:s,onSwitchTab:a,announcements:t}),Ht=10,eo=({onProductSelect:t})=>{const[s,a]=n.useState("comprehensive"),[r,l]=n.useState(""),[o,c]=n.useState("all"),[d,x]=n.useState([]),[m,b]=n.useState(!1),[g,f]=n.useState(!1),[h,j]=n.useState(null),[w,v]=n.useState([]),[u,_]=n.useState(1),[N,i]=n.useState(!0),F=n.useRef(null),I=n.useMemo(()=>[{id:"all",label:"全部商品",icon:Ot},...w.map(k=>({id:k,label:k,icon:k==="数码产品"||k==="数码配件"?yr:k==="优惠券"?jr:Ot}))],[w]),z=k=>({id:String(k.id),title:k.name,artist:k.category||"消费金商品",price:k.score_price||k.price||0,image:ke(k.thumbnail),category:k.category||"其他",productType:"shop"});n.useEffect(()=>{let k=!0;return(async()=>{var D;try{const Y=await Cn();k&&v(((D=Y.data)==null?void 0:D.list)??[])}catch(Y){console.error("加载商品分类失败:",Y)}})(),()=>{k=!1}},[]);const p=n.useCallback(async(k,T=!1)=>{var D,Y,L;try{T?f(!0):b(!0),j(null);let B;s==="sales"?B=await En({page:k,limit:Ht}):s==="new"?B=await In({page:k,limit:Ht}):B=await Sn({page:k,limit:Ht});const K=((D=B.data)==null?void 0:D.list)??[],C=((Y=B.data)==null?void 0:Y.total)||0,E=K.map(z);x(T?R=>[...R,...E]:E),_(k),i(k*Ht<C)}catch(B){console.error("加载商品列表失败:",B),j((B==null?void 0:B.msg)||((L=B==null?void 0:B.response)==null?void 0:L.msg)||(B==null?void 0:B.message)||"加载商品失败，请稍后重试")}finally{b(!1),f(!1)}},[s]);n.useEffect(()=>{_(1),x([]),p(1,!1)},[s,p]);const P=n.useCallback(()=>{if(!F.current||g||!N)return;const{scrollTop:k,scrollHeight:T,clientHeight:D}=F.current;k+D>=T-100&&p(u+1,!0)},[g,N,u,p]),y=n.useMemo(()=>d.filter(k=>{const T=k.title.includes(r)||k.artist.includes(r),D=o==="all"||k.category===o;return T&&D}).sort((k,T)=>s==="price_asc"?k.price-T.price:s==="price_desc"?T.price-k.price:0),[d,r,o,s]),S=k=>{a(k==="price"?T=>T==="price_asc"?"price_desc":"price_asc":k==="sales"?"sales":k==="new"?"new":"comprehensive")};return e.jsxs("div",{ref:F,onScroll:P,className:"h-[calc(100vh-60px)] overflow-y-auto bg-gray-50",children:[e.jsxs("div",{className:"bg-white p-3 sticky top-0 z-20 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h1",{className:"font-bold text-lg text-gray-800 whitespace-nowrap",children:"消费金兑换"}),e.jsxs("div",{className:"flex-1 bg-gray-100 rounded-full flex items-center px-3 py-1.5 border border-gray-100 focus-within:border-orange-200 transition-colors",children:[e.jsx(Nt,{size:16,className:"text-gray-400 mr-2"}),e.jsx("input",{type:"text",value:r,onChange:k=>l(k.target.value),placeholder:"请输入您要搜索的商品名称",className:"bg-transparent border-none outline-none text-xs flex-1 text-gray-700 placeholder-gray-400"})]}),e.jsx("button",{className:"bg-orange-600 text-white text-xs px-4 py-1.5 rounded-full shadow-sm shadow-orange-200 active:bg-orange-700",children:"搜索"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:I.map(k=>e.jsxs("div",{className:"flex flex-col items-center py-2 cursor-pointer active:opacity-60",onClick:()=>c(k.id),children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center mb-1 border transition-colors ${o===k.id?"border-orange-500 text-orange-500 bg-orange-50":"border-gray-200 text-gray-400"}`,children:e.jsx(k.icon,{size:20})}),e.jsx("span",{className:`text-[10px] ${o===k.id?"text-orange-600 font-bold":"text-gray-500"}`,children:k.label})]},k.id))}),e.jsx("div",{className:"flex justify-between text-sm border-t border-gray-100 pt-3",children:[{id:"comprehensive",label:"综合"},{id:"price",label:"价格"},{id:"sales",label:"销量"},{id:"new",label:"最新"}].map(k=>e.jsxs("button",{onClick:()=>S(k.id),className:`flex items-center justify-center flex-1 py-1 ${s===k.id||k.id==="price"&&s.startsWith("price")?"text-orange-600 font-bold":"text-gray-500"}`,children:[k.label,k.id==="price"&&e.jsxs("div",{className:"flex flex-col ml-1 -space-y-1",children:[e.jsx("span",{className:`w-0 h-0 border-l-[3px] border-l-transparent border-r-[3px] border-r-transparent border-b-[4px] ${s==="price_asc"?"border-b-orange-600":"border-b-gray-300"}`}),e.jsx("span",{className:`w-0 h-0 border-l-[3px] border-l-transparent border-r-[3px] border-r-transparent border-t-[4px] ${s==="price_desc"?"border-t-orange-600":"border-t-gray-300"}`})]})]},k.id))})]}),e.jsxs("div",{className:"p-3",children:[m?e.jsx(ge,{text:"商品加载中..."}):h?e.jsx(Oe,{icon:e.jsx(Ot,{size:48,className:"text-gray-300"}),title:"加载失败",description:h}):y.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:y.map(k=>e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-sm active:scale-[0.98] transition-transform flex flex-col",onClick:()=>t&&t(k),children:[e.jsx("div",{className:"aspect-square bg-gray-100 relative",children:e.jsx(et,{src:k.image,alt:k.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-2.5 flex flex-col flex-1 justify-between",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm text-gray-800 font-medium line-clamp-2 h-10 mb-1 leading-5",children:k.title}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{className:"bg-gray-100 text-gray-400 px-1 rounded text-[10px] mr-1 flex-shrink-0",children:"艺术家"}),e.jsx("span",{className:"truncate",children:k.artist})]})]}),e.jsxs("div",{className:"text-red-500 font-bold text-base leading-none pt-1",children:[e.jsx("span",{className:"text-xs mr-0.5",children:"¥"}),k.price.toFixed(2),e.jsx("span",{className:"text-[10px] font-normal text-gray-400 ml-1",children:"消费金"})]})]})]},k.id))}):e.jsx(Oe,{icon:e.jsx(Ot,{size:48,className:"text-gray-300"}),title:"暂无相关商品",description:"换个关键词试试吧"}),g&&e.jsxs("div",{className:"py-4 flex items-center justify-center text-gray-400 text-xs",children:[e.jsx(dt,{size:16,className:"animate-spin mr-2"}),"加载中..."]}),!m&&!N&&y.length>0&&e.jsx("div",{className:"py-4 text-center text-gray-400 text-xs pb-20",children:"已加载全部"})]})]})},to=({onProductSelect:t})=>e.jsx(eo,{onProductSelect:t}),so=({size:t,className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("circle",{cx:"8",cy:"8",r:"6"}),e.jsx("path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18"}),e.jsx("path",{d:"M7 6h1v4"}),e.jsx("path",{d:"m16.71 13.88.7.71-2.82 2.82"})]}),ao=({onNavigate:t,unreadCount:s=0})=>{const{errorMessage:a,hasError:r,handleError:l,clearError:o}=Ie(),[c,d]=n.useState(()=>{try{const v=localStorage.getItem(Ae);return v?JSON.parse(v):null}catch(v){return console.warn("解析本地用户信息失败:",v),null}}),[x,m]=n.useState(!1);n.useEffect(()=>{const v=localStorage.getItem(ne);if(!v){l("未检测到登录信息，请重新登录",{persist:!0,showToast:!1});return}let u=!0;return(async()=>{var N;m(!0);try{const i=await $e(v);if(!u)return;ee(i)&&((N=i.data)!=null&&N.userInfo)?(d(i.data.userInfo),localStorage.setItem(Ae,JSON.stringify(i.data.userInfo)),o()):l(i,{persist:!0,showToast:!1,customMessage:"获取用户信息失败"})}catch(i){if(!u)return;l(i,{persist:!0,showToast:!1,customMessage:"获取个人信息失败"})}finally{u&&m(!1)}})(),()=>{u=!1}},[]);const{realName:b}=Ea(),g=b||(c==null?void 0:c.nickname)||(c==null?void 0:c.username)||"用户",f=g.slice(0,1).toUpperCase(),h=ke(c==null?void 0:c.avatar),w=(v=>{if(v==null)return"--";switch(v){case 0:return"新用户";case 1:return"普通用户";case 2:return"交易用户";default:return"--"}})(c==null?void 0:c.user_type);return n.useMemo(()=>[{label:"供应链专项金",val:we(c==null?void 0:c.money)},{label:"可调度收益",val:we(c==null?void 0:c.withdrawable_money)},{label:"确权金",val:we(c==null?void 0:c.service_fee_balance)}],[c]),e.jsxs("div",{className:"pb-24 min-h-screen bg-gray-50",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-72 bg-gradient-to-b from-[#FFD6A5] to-gray-50 z-0"}),e.jsxs("div",{className:"pt-12 pb-6 px-4 relative z-10 text-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-orange-100 border-2 border-white flex items-center justify-center text-xl font-bold text-orange-600 overflow-hidden shadow-sm",children:h?e.jsx("img",{src:h,alt:"用户头像",className:"w-full h-full object-cover"}):f||"用"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:g}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("div",{className:"flex items-center bg-white/60 backdrop-blur-md border border-gray-200/50 rounded-full px-2 py-0.5",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mr-1 shadow-inner",children:(()=>{const v={0:{icon:Nr,color:"text-green-600"},1:{icon:It,color:"text-blue-600"},2:{icon:ra,color:"text-yellow-600"}}[(c==null?void 0:c.user_type)??-1]||{icon:It,color:"text-gray-500"},u=v.icon;return e.jsx(u,{size:10,className:`${v.color} fill-current`})})()}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:w})]}),(()=>{const v=c==null?void 0:c.agent_review_status;return v===1?e.jsxs("div",{className:"flex items-center bg-white/60 backdrop-blur-md border border-red-200 rounded-full px-2 py-0.5 ml-1",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 flex items-center justify-center mr-1",children:e.jsx(_t,{size:10,className:"text-red-500 fill-red-500"})}),e.jsx("span",{className:"text-xs font-medium text-red-600",children:"代理"})]}):v===0?e.jsxs("div",{className:"flex items-center bg-white/60 backdrop-blur-md border border-yellow-200 rounded-full px-2 py-0.5 ml-1",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-100 flex items-center justify-center mr-1",children:e.jsx(_t,{size:10,className:"text-yellow-600 fill-yellow-600"})}),e.jsx("span",{className:"text-xs font-medium text-yellow-700",children:"待审核"})]}):null})()]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>t("service-center:message"),className:"text-gray-600 hover:text-gray-900 transition-colors relative",children:[e.jsx(hs,{size:22}),s>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white box-content"})]}),e.jsx("button",{onClick:()=>t("service-center:settings"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(vr,{size:22})})]})]}),e.jsx("div",{className:"bg-white mx-2 rounded-3xl px-8 py-6 shadow-sm relative overflow-hidden mb-3",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:"供应链专项金"}),e.jsx("span",{className:"bg-orange-50 text-orange-600 text-[10px] px-2 py-0.5 rounded-full font-bold",children:"采购本金"})]}),e.jsxs("button",{onClick:()=>t("asset:balance-recharge:profile"),className:"text-orange-600 text-sm font-medium flex items-center gap-1 active:opacity-70",children:["去充值 ",e.jsx(qe,{size:14})]})]}),e.jsxs("div",{className:"text-3xl font-[DINAlternate-Bold,Roboto,sans-serif] font-bold text-gray-900 tracking-tight mb-6 cursor-pointer active:opacity-70 transition-opacity",onClick:()=>t("asset-view:0"),children:[e.jsx("span",{className:"text-xl mr-1",children:"¥"}),String((c==null?void 0:c.balance_available)||"0.00")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-2 gap-x-2 mt-2",children:[e.jsxs("div",{className:"flex flex-col cursor-pointer active:opacity-70 transition-opacity",onClick:()=>t("asset-view:1"),children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"可调度收益"}),e.jsx("div",{className:"text-[15px] font-bold text-gray-800 font-[DINAlternate-Bold,Roboto,sans-serif] leading-tight",children:we(c==null?void 0:c.withdrawable_money)})]}),e.jsxs("div",{className:"flex flex-col items-end cursor-pointer active:opacity-70 transition-opacity",onClick:()=>t("switch-to-market"),children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"消费金"}),e.jsx("div",{className:"text-[15px] font-bold text-gray-800 font-[DINAlternate-Bold,Roboto,sans-serif] leading-tight",children:(c==null?void 0:c.score)||0})]}),e.jsxs("div",{className:"flex flex-col cursor-pointer active:opacity-70 transition-opacity",onClick:()=>t("wallet:hashrate_exchange:profile"),children:[e.jsxs("div",{className:"text-xs text-gray-400 mb-1 flex items-center gap-1",children:["绿色算力 ",e.jsx(ia,{size:10,className:"text-green-500"})]}),e.jsx("div",{className:"text-[15px] font-bold text-gray-800 font-[DINAlternate-Bold,Roboto,sans-serif] leading-tight",children:(c==null?void 0:c.green_power)||0})]}),e.jsxs("div",{className:"flex flex-col items-end cursor-pointer active:opacity-70 transition-opacity",onClick:()=>t("asset-view:3"),children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"确权金"}),e.jsx("div",{className:"text-[15px] font-bold text-gray-800 font-[DINAlternate-Bold,Roboto,sans-serif] leading-tight",children:we(c==null?void 0:c.service_fee_balance)})]})]})]})})]}),r&&!c&&!a.includes("登录态过期")&&e.jsx("div",{className:"mx-4 mt-4 bg-red-50 text-red-600 text-sm px-4 py-2 rounded-lg shadow-sm",children:a}),e.jsxs("div",{className:"px-4 mt-2 relative z-10 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-gray-800 text-sm mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"便捷服务"]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{label:"专项金充值",icon:Le,color:"text-orange-600",bg:"bg-orange-50",action:()=>t({name:"balance-recharge",source:"asset-view"})},{label:"每日签到",icon:ca,color:"text-red-500",bg:"bg-red-50",action:()=>t({name:"sign-in"})},{label:"收益提现",icon:at,color:"text-orange-500",bg:"bg-orange-50",action:()=>t({name:"balance-withdraw",source:"asset-view"})},{label:"商品寄售",icon:at,color:"text-blue-500",bg:"bg-blue-50",action:()=>t({name:"order-list",orderType:"transaction",tabIndex:0})},{label:"消费金兑换",icon:so,color:"text-yellow-600",bg:"bg-yellow-50",action:()=>t({name:"switch-to-market"})},{label:"消费金订单",icon:vs,color:"text-emerald-500",bg:"bg-emerald-50",action:()=>t({name:"order-list",orderType:"points",tabIndex:0})}].map((v,u)=>e.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-60 group",onClick:v.action,children:[e.jsx("div",{className:`w-11 h-11 rounded-2xl ${v.bg} flex items-center justify-center mb-2 transition-transform group-active:scale-95`,children:e.jsx(v.icon,{size:20,className:v.color,strokeWidth:2})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:v.label})]},u))})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-gray-800 text-sm mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"权益管理"]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{label:"资产明细",icon:Te,color:"text-purple-600",bg:"bg-purple-50",action:()=>t({name:"asset-view"})},{label:"累计权益",icon:ot,color:"text-green-600",bg:"bg-green-50",action:()=>t({name:"cumulative-rights"})},{label:"寄售券",icon:at,color:"text-pink-600",bg:"bg-pink-50",action:()=>t({name:"consignment-voucher"})},{label:"我的藏品",icon:wr,color:"text-indigo-600",bg:"bg-indigo-50",action:()=>t({name:"my-collection"})}].map((v,u)=>e.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-60 group",onClick:v.action,children:[e.jsx("div",{className:`w-11 h-11 rounded-2xl ${v.bg} flex items-center justify-center mb-2 transition-transform group-active:scale-95`,children:e.jsx(v.icon,{size:20,className:v.color,strokeWidth:2})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:v.label})]},u))})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"font-bold text-gray-800 text-sm mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-orange-500 rounded-full"}),"服务管理"]}),e.jsx("div",{className:"grid grid-cols-4 gap-y-6 gap-x-4",children:[{label:"实名认证",icon:It,action:()=>t({name:"real-name-auth"})},{label:"卡号管理",icon:Be,action:()=>t({name:"card-management"})},{label:"收货地址",icon:At,action:()=>t({name:"address-list"})},{label:"我的好友",icon:_s,action:()=>t({name:"my-friends"})},{label:"代理认证",icon:It,action:()=>t({name:"agent-auth"})},{label:"帮助中心",icon:na,action:()=>t({name:"help-center"})},{label:"规则协议",icon:Te,action:()=>t({name:"user-agreement"})},{label:"用户问卷",icon:Te,action:()=>t({name:"user-survey"})},{label:"在线客服",icon:_r,action:()=>t({name:"online-service"})},{label:"平台资讯",icon:kr,action:()=>t({name:"news"})}].map((v,u)=>e.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-60 group",onClick:v.action,children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gray-50 flex items-center justify-center mb-2 transition-transform group-active:scale-95",children:e.jsx(v.icon,{size:20,className:"text-gray-600",strokeWidth:1.5})}),e.jsx("span",{className:"text-xs text-gray-500",children:v.label})]},u))})]})]})]})},ro=({onNavigate:t,unreadCount:s})=>e.jsx(ao,{onNavigate:t,unreadCount:s});function no(t){const[s,a]=n.useState(null),[r,l]=n.useState([]),[o,c]=n.useState(!1),[d,x]=n.useState({pending_count:0,approved_count:0,isLoading:!0}),m=n.useCallback(()=>{const h=ce();return h||(t("error","登录过期","请重新登录"),null)},[t]),b=n.useCallback(async()=>{const h=m();if(!h)return null;try{const j=await $e(h),w=re(j);w!=null&&w.userInfo&&a(w.userInfo)}catch(j){console.error("获取用户信息失败:",j)}return await g(h),await f(h),h},[m]),g=n.useCallback(async h=>{const j=h||m();if(j){c(!0);try{const w=await Ca({limit:10},j),v=re(w);v!=null&&v.list&&l(v.list)}catch(w){console.error("获取申报历史失败:",w),t("error","加载失败","获取申报历史失败")}finally{c(!1)}}},[m,t]),f=n.useCallback(async h=>{const j=h||m();if(j)try{const w=await Zn({},j),v=re(w);v&&x({pending_count:v.pending_count,approved_count:v.approved_count,isLoading:!1})}catch(w){console.error("获取审核统计失败:",w),x(v=>({...v,isLoading:!1}))}},[m]);return{userInfo:s,setUserInfo:a,history:r,historyLoading:o,reviewStats:d,loadInitialData:b,loadHistory:g,loadReviewStats:f}}const io=({reviewStats:t})=>{const s=[{label:"实名认证",status:"done"},{label:"上传凭证",status:"active"},{label:"等待审核",status:t.pending_count>0?"active":"wait"},{label:"确权成功",status:t.approved_count>0?"done":"wait"}];return e.jsx("div",{className:"bg-[#FFF8F0] py-4 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between relative px-4",children:[e.jsx("div",{className:"absolute top-3 left-8 right-8 h-[3px] bg-[#FFE4C4] -z-10 rounded-full"}),s.map((a,r)=>e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:`w-7 h-7 rounded-full border-[3px] flex items-center justify-center z-10 bg-[#FFF8F0] shadow-sm transition-colors duration-300
                ${a.status==="done"?"border-[#FF6B00] bg-[#FF6B00]":a.status==="active"?"border-[#FF6B00] ring-2 ring-[#FF6B00]/20":"border-[#E0E0E0]"}
             `,children:[a.status==="done"&&e.jsx(Ze,{size:14,className:"text-white",strokeWidth:3}),a.status==="active"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#FF6B00]"})]}),e.jsx("span",{className:`text-xs font-medium scale-90 ${a.status==="active"?"text-[#FF4500]":a.status==="done"?"text-[#8B4513]":"text-[#BBBBBB]"}`,children:a.label})]},r))]})})},lo=t=>{switch(t){case"pending":return e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-[#FFE4C4] text-[#8B4513] font-medium border border-[#DEB887]",children:"待审核"});case"approved":return e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-[#DEF7EC] text-[#03543F] font-medium border border-[#84E1BC]",children:"确权成功"});case"rejected":return e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-[#FDE8E8] text-[#9B1C1C] font-medium border border-[#F8B4B4]",children:"审核失败"});case"cancelled":return e.jsx("span",{className:"text-xs px-3 py-1 rounded bg-[#F3F4F6] text-[#6B7280] font-medium border border-[#D1D5DB]",children:"已撤销"});default:return null}},oo=({history:t,loading:s,onNavigateHistory:a})=>e.jsxs("div",{className:"space-y-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsxs("h3",{className:"font-bold text-[#333333] text-lg flex items-center gap-2",children:[e.jsx(oa,{size:18}),"历史记录区"]}),e.jsx("button",{className:"text-[#FF4500] text-sm font-medium hover:text-[#E63E00]",onClick:a,children:"查看更多"})]}),s?e.jsxs("div",{className:"text-center py-8 text-gray-400 text-sm bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#FF4500] mx-auto mb-2"}),"加载中..."]}):t.length>0?t.map(r=>e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[#666666] text-base font-medium",children:r.voucher_type_text}),e.jsxs("div",{className:"text-[#999999] text-sm",children:["¥",Number(r.amount).toFixed(2)]})]}),lo(r.status)]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[#999999] text-sm",children:r.create_time_text}),r.review_remark&&e.jsx("div",{className:"text-[#FF4D4F] text-xs mt-1",children:r.review_remark})]})]},r.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm bg-white rounded-xl border border-gray-100",children:"暂无提交记录"})]}),co=({userInfo:t,unlockStatus:s,unlockLoading:a,onUnlock:r})=>{var l,o,c,d;return e.jsxs("div",{className:"space-y-6 pt-4 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#FF9966] to-[#FF5E62] rounded-2xl p-6 text-white shadow-lg shadow-orange-200 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(ks,{size:100})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"text-white/80 text-sm font-medium mb-1",children:"待激活确权金余额"}),e.jsxs("div",{className:"text-3xl font-bold font-mono tracking-wider",children:["¥",s.currentGold?Number(s.currentGold).toFixed(2):"0.00"]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-white/90 text-xs bg-white/20 px-3 py-1.5 rounded-full w-fit backdrop-blur-sm",children:[e.jsx(pe,{size:12}),e.jsx("span",{children:"完成任务即可解锁旧资产"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-[#FFE4C4]/60",children:[e.jsxs("div",{className:"flex items-center mb-4 border-b border-gray-100 pb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"解锁条件检测"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.hasSelfTrade?"bg-[#DEF7EC] text-[#03543F]":"bg-[#FDE8E8] text-[#9B1C1C]"}`,children:e.jsx(yt,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[#333] font-medium text-sm",children:"自身完成交易"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["已完成 ",((l=s.unlockConditions)==null?void 0:l.transaction_count)||0," 笔交易",((o=s.unlockConditions)==null?void 0:o.transaction_count)===0&&"，需至少完成一笔买入或卖出"]})]})]}),e.jsx("div",{children:s.isLoading?e.jsx("span",{className:"text-gray-400 text-xs",children:"检测中..."}):s.hasSelfTrade?e.jsx(Ze,{size:20,className:"text-[#03543F]"}):e.jsx(Ce,{size:20,className:"text-[#9B1C1C]"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.activeReferrals>=s.referralTarget?"bg-[#DEF7EC] text-[#03543F]":"bg-[#FFF8F0] text-[#8B4513]"}`,children:e.jsx(_s,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[#333] font-medium text-sm",children:"直推有效用户"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["直推用户总数: ",((c=s.unlockConditions)==null?void 0:c.direct_referrals_count)||0,"， 有交易记录: ",((d=s.unlockConditions)==null?void 0:d.qualified_referrals)||0,s.unlockConditions&&s.unlockConditions.qualified_referrals<s.referralTarget&&`，需 ${s.referralTarget} 个`]})]})]}),e.jsx("div",{className:"flex flex-col items-end",children:s.isLoading?e.jsx("span",{className:"text-gray-400 text-xs",children:"检测中..."}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`text-sm font-bold ${s.activeReferrals>=s.referralTarget?"text-[#03543F]":"text-[#FF4500]"}`,children:[s.activeReferrals,"/",s.referralTarget]}),s.activeReferrals>=s.referralTarget&&e.jsx(Ze,{size:14,className:"text-[#03543F] mt-1"})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-[#FFE4C4]/60",children:[e.jsxs("div",{className:"flex items-center mb-4 border-b border-gray-100 pb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"解锁权益"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 bg-[#FFF8F0] p-3 rounded-xl border border-[#FFE4C4] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"text-[#FF4500] font-bold text-lg mb-1",children:"权益资产包"}),e.jsx("div",{className:"text-xs text-[#8B4513]",children:"价值 ¥1000"})]}),e.jsx("div",{className:"text-[#D48E58]",children:"+"}),e.jsxs("div",{className:"flex-1 bg-[#FFF8F0] p-3 rounded-xl border border-[#FFE4C4] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"text-[#FF4500] font-bold text-lg mb-1",children:"寄售券 x1"}),e.jsx("div",{className:"text-xs text-[#8B4513]",children:"解锁赠送"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"解锁消耗"}),e.jsxs("span",{className:"font-bold text-[#FF4500]",children:[s.requiredGold||1e3," 确权金"]})]}),s.unlockedCount!==void 0&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"已解锁次数"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.unlockedCount," 次"]})]}),s.availableQuota!==void 0&&s.availableQuota>0&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-orange-500 mb-1",children:[e.jsx("span",{children:"可解锁名额"}),e.jsxs("span",{className:"font-bold",children:[s.availableQuota," 次"]})]}),e.jsx("div",{className:"text-[10px] text-center text-gray-400 mt-2",children:"点击解锁后系统将自动扣除余额并发放权益"})]}),!s.canUnlock&&(s.availableQuota===0||s.availableQuota===void 0)&&s.alreadyUnlocked?e.jsx("div",{className:"w-full py-3.5 rounded-full text-lg font-bold text-white bg-green-500 shadow-lg text-center",children:"已解锁 ✓"}):e.jsx("button",{onClick:r,disabled:a||s.isLoading||!s.canUnlock,className:`w-full py-3.5 rounded-full text-lg font-bold text-white shadow-lg transition-all active:scale-[0.98]
              ${a||s.isLoading||!s.canUnlock?"bg-gray-300 shadow-none cursor-not-allowed":"bg-gradient-to-r from-[#FF6B00] to-[#FF4500] shadow-orange-200"}`,children:a?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["解锁中 ",e.jsx("span",{className:"animate-spin",children:"◌"})]}):s.unlockedCount&&s.unlockedCount>0?"再次解锁资产":"立即解锁"})]})]})},xo=({showToast:t,userInfo:s,setUserInfo:a})=>{const[r,l]=n.useState({hasSelfTrade:!1,activeReferrals:0,referralTarget:3,canUnlock:!1,isLoading:!0}),[o,c]=n.useState(!1),d=n.useCallback(async m=>{const b=m??ce();if(!b){t("error","登录过期","请重新登录");return}l(g=>({...g,isLoading:!0}));try{const g=await un(b),f=re(g);if(f){const h=f.unlock_conditions;l({hasSelfTrade:h.has_transaction,activeReferrals:h.qualified_referrals,referralTarget:3,canUnlock:h.is_qualified,isLoading:!1,unlockConditions:h,requiredGold:f.required_gold,currentGold:f.current_gold,canUnlockDirect:f.can_unlock,alreadyUnlocked:f.unlock_status===1,unlockedCount:f.unlocked_count||0,availableQuota:f.available_quota||0})}else l(h=>({...h,isLoading:!1}))}catch(g){console.error("获取解锁状态失败:",g),l(f=>({...f,isLoading:!1}))}},[t]),x=n.useCallback(async()=>{var f;const m=r.currentGold??Number((s==null?void 0:s.confirm_rights_gold)||0),b=r.requiredGold||1e3;if(m<b){t("warning","余额不足",`待激活确权金不足 ${b}`);return}if(!r.canUnlock){t("warning","条件未满足","请先满足解锁条件");return}const g=ce();if(!g){t("error","登录过期","请重新登录");return}c(!0);try{const h=await gn(g),j=re(h);if(j)if(j.unlock_status===1)t("success","解锁成功",`权益资产包 ¥${j.reward_equity_package} 与 ${j.reward_consignment_coupon} 张寄售券已发放`),s&&j.consumed_gold&&a({...s,confirm_rights_gold:Number(s.confirm_rights_gold)-j.consumed_gold}),await d(g);else{const w=((f=j.unlock_conditions)==null?void 0:f.messages)||[];w.length>0?t("warning","解锁失败",w.join("; ")):t("warning","解锁失败","条件未满足")}else t("error","解锁失败",oe(h,"解锁失败，请重试"))}catch(h){console.error("解锁旧资产失败:",h),t("error","解锁失败",h.message||"网络错误，请重试")}finally{c(!1)}},[d,a,t,r.canUnlock,s]);return{unlockStatus:r,unlockLoading:o,loadUnlockStatus:d,handleUnlockLegacy:x}},mo=({imageUploadStates:t,onAddClick:s,onRemove:a,onFileChange:r,fileInputRef:l,maxCount:o=8})=>{const c=t.filter(d=>d.uploaded).length;return e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[t.map((d,x)=>e.jsxs("div",{className:"aspect-square rounded-xl bg-[#FFF8F0] border border-[#FFE4C4] overflow-hidden relative group",children:[e.jsx("img",{src:d.url||d.preview,alt:"preview",className:`w-full h-full object-cover ${d.uploading?"opacity-50":""}`}),d.uploading&&e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})}),d.error&&e.jsx("div",{className:"absolute inset-0 bg-red-500/80 flex items-center justify-center",children:e.jsx(pe,{size:24,className:"text-white"})}),e.jsx("button",{onClick:()=>a(x),className:"absolute top-0.5 right-0.5 bg-black/40 text-white rounded-full p-1 hover:bg-red-500 transition-colors",children:e.jsx(Ce,{size:10})}),d.uploaded&&!d.uploading&&e.jsx("div",{className:"absolute bottom-0.5 right-0.5 bg-green-500 text-white rounded-full p-1",children:e.jsx(Ze,{size:10})})]},x)),c<o&&e.jsx("button",{onClick:s,className:"aspect-square rounded-xl bg-[#FFE4C4] border border-[#FFDAB9] flex items-center justify-center text-[#FF6B00] hover:bg-[#FFDAB9] transition-colors",children:e.jsx(js,{size:28})}),t.length===0&&e.jsx("div",{className:"aspect-square rounded-xl bg-[#F9F9F9] border border-[#EEEEEE] flex items-center justify-center",children:e.jsx(Mt,{size:24,className:"text-[#DDDDDD]"})}),e.jsx("input",{type:"file",ref:l,className:"hidden",accept:"image/*",multiple:!0,onChange:r})]})},uo=({form:t,onVoucherChange:s,onAmountChange:a,onRemarkChange:r,userBalance:l,uploadStates:o,fileInputRef:c,onFileChange:d,onRemoveImage:x,onAddClick:m,onSubmit:b,loading:g,showAmountError:f})=>e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm shadow-orange-100/50 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"凭证类型"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"w-full appearance-none bg-[#F9F9F9] border border-[#EEEEEE] text-[#333333] text-sm rounded-xl px-4 py-3.5 focus:outline-none focus:ring-1 focus:ring-[#FF4500] focus:border-[#FF4500] transition-all",value:t.voucher_type,onChange:h=>s(h.target.value),children:[e.jsx("option",{value:"screenshot",children:"余额截图"}),e.jsx("option",{value:"transfer_record",children:"转账记录"}),e.jsx("option",{value:"other",children:"其他凭证"})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-[#999999]",children:e.jsx(Ee,{size:20,className:"-rotate-90"})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"确权金额"})]}),e.jsxs("span",{className:"text-xs text-[#666666]",children:["当前余额: ",e.jsxs("span",{className:"font-bold text-[#333333]",children:["¥",l||"0.00"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",className:"w-full bg-[#F9F9F9] border border-[#EEEEEE] text-[#333333] text-sm rounded-xl px-4 py-3.5 focus:outline-none focus:ring-1 focus:ring-[#FF4500] focus:border-[#FF4500] transition-all placeholder-[#CCCCCC]",placeholder:"确权金额",value:t.amount,onChange:h=>a(h.target.value)})}),e.jsx("p",{className:"mt-2 text-xs text-[#FF4D4F]",children:"提示：请严格按照截图金额填写，虚假申报将导致封号"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"备注说明"})]}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{className:"w-full bg-[#F9F9F9] border border-[#EEEEEE] text-[#333333] text-sm rounded-xl px-4 py-3.5 focus:outline-none focus:ring-1 focus:ring-[#FF4500] focus:border-[#FF4500] transition-all placeholder-[#CCCCCC] resize-none",placeholder:"可选：添加备注说明（最多200字符）",rows:3,maxLength:200,value:t.remark,onChange:h=>r(h.target.value)})}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("p",{className:"text-xs text-[#999999]",children:"可不填"}),e.jsxs("p",{className:"text-xs text-[#999999]",children:[t.remark.length,"/200"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-[#FF4500] rounded-full mr-2"}),e.jsx("h3",{className:"text-[#333333] font-bold text-base",children:"凭证上传"})]}),e.jsx(mo,{imageUploadStates:o,onAddClick:m,onRemove:x,onFileChange:d,fileInputRef:c})]}),e.jsx("button",{onClick:b,disabled:g,className:`w-full py-3.5 rounded-full text-lg font-bold text-white shadow-lg transition-all active:scale-[0.98] mt-2
          ${g?"bg-gray-300 shadow-none cursor-not-allowed":"bg-gradient-to-r from-[#FF6B00] to-[#FF4500] shadow-orange-200"}`,children:g?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["提交中 ",e.jsx("span",{className:"animate-spin",children:"◌"})]}):"提 交"}),f&&e.jsx("div",{className:"text-xs text-[#FF4D4F] -mt-3",children:"请输入有效的确权金额"})]}),sa=()=>({voucher_type:"screenshot",amount:"",images:[],remark:""}),go=()=>{const t=n.useMemo(sa,[]),[s,a]=n.useState(t),[r,l]=n.useState(!1),o=n.useCallback((b,g)=>{a(f=>({...f,[b]:g}))},[]),c=n.useCallback(b=>{a(g=>({...g,images:typeof b=="function"?b(g.images):b}))},[]),d=n.useCallback(()=>{a(sa())},[]),x=n.useCallback(()=>l(!1),[]),m=n.useCallback(()=>{const b=s.amount.trim()!==""&&parseFloat(s.amount)>0,g=s.images.length>0;return b||(l(!0),setTimeout(()=>l(!1),3e3)),{valid:b&&g,validAmount:b,hasImages:g}},[s.amount,s.images.length]);return{form:s,updateField:o,replaceImages:c,resetForm:d,validateForm:m,amountErrorVisible:r,hideAmountError:x}},ho=({showToast:t,onImagesChange:s,currentUrls:a=[],maxCount:r=8})=>{const[l,o]=n.useState([]),c=n.useRef(null),d=n.useCallback(h=>{h!=null&&h.preview&&!h.url&&URL.revokeObjectURL(h.preview)},[]);n.useEffect(()=>()=>{l.forEach(d)},[l,d]);const x=n.useCallback(async(h,j)=>{const w=h.map(async v=>{try{const u=await Is(v.file,j),_=re(u);if(_!=null&&_.url)o(N=>N.map(i=>i.file===v.file?{...i,uploading:!1,uploaded:!0,url:_.url}:i)),s(N=>[...N,_.url]);else throw new Error(oe(u,"上传失败"))}catch(u){console.error("图片上传失败:",u),o(_=>_.map(N=>N.file===v.file?{...N,uploading:!1,error:(u==null?void 0:u.message)||"上传失败"}:N)),t("error","上传失败",v.file.name||"图片上传失败")}});await Promise.all(w)},[s,t]),m=n.useCallback(async h=>{if(!h||h.length===0)return;const j=ce();if(!j){t("error","登录过期","请重新登录");return}const w=a.length,v=r-w;if(v<=0){t("warning","数量限制",`最多只能上传${r}张凭证`);return}const u=Array.from(h).slice(0,v);h.length>v&&t("warning","数量限制",`最多只能上传${r}张凭证`);const _=u.map(N=>({file:N,preview:URL.createObjectURL(N),uploading:!0,uploaded:!1}));o(N=>[...N,..._]),await x(_,j)},[a.length,x,r,t]),b=n.useCallback(h=>{o(j=>{const w=j[h];d(w);const v=j.filter((u,_)=>_!==h);return w!=null&&w.url&&s(u=>u.filter(_=>_!==w.url)),v})},[s,d]),g=n.useCallback(()=>{l.forEach(d),o([]),s([])},[l,s,d]),f=n.useCallback(()=>{var h;return(h=c.current)==null?void 0:h.click()},[]);return{fileInputRef:c,imageUploadStates:l,selectFiles:m,removeImage:b,resetUploads:g,triggerSelect:f}},fo=({form:t,validateForm:s,reviewStats:a,resetForm:r,resetUploads:l,loadHistory:o,loadReviewStats:c,onNavigateHistory:d,showToast:x})=>{const[m,b]=n.useState(!1),g=n.useCallback(async()=>{const f=s();if(!f.validAmount)return;if(!f.hasImages){x("warning","缺少凭证","请上传凭证截图");return}if(!a.isLoading&&a.pending_count>0){x("info","已有审核中记录","请等待审核完成后再提交新的申请"),d==null||d();return}if(a.isLoading){x("info","数据加载中","正在检查审核状态，请稍后再试");return}const h=ce();if(!h){x("error","登录过期","请重新登录");return}b(!0);try{const j=await Jn({voucher_type:t.voucher_type,amount:parseFloat(t.amount),images:t.images,remark:t.remark},h);ee(j)?(x("success","提交成功","确权申报提交成功，请等待管理员审核"),r(),l(),await Promise.all([o(h),c(h)])):x("error","提交失败",oe(j,"提交失败，请重试"))}catch(j){console.error("提交申报失败:",j);const w=(j==null?void 0:j.message)||(j==null?void 0:j.msg)||"网络错误，请重试";x("error","提交失败",w)}finally{b(!1)}},[t.amount,t.images,t.remark,t.voucher_type,o,c,d,r,l,a.isLoading,a.pending_count,x,s]);return{submitting:m,submit:g}},bo=({userBalance:t,reviewStats:s,loadHistory:a,loadReviewStats:r,onNavigateHistory:l})=>{const{showToast:o}=he(),{form:c,updateField:d,replaceImages:x,resetForm:m,validateForm:b,amountErrorVisible:g}=go(),{fileInputRef:f,imageUploadStates:h,selectFiles:j,removeImage:w,resetUploads:v,triggerSelect:u}=ho({showToast:o,onImagesChange:x,currentUrls:c.images}),{submitting:_,submit:N}=fo({form:c,validateForm:b,reviewStats:s,resetForm:m,resetUploads:v,loadHistory:a,loadReviewStats:r,onNavigateHistory:l,showToast:o});return e.jsx(uo,{form:c,onVoucherChange:i=>d("voucher_type",i),onAmountChange:i=>d("amount",i),onRemarkChange:i=>d("remark",i),userBalance:t,uploadStates:h,fileInputRef:f,onFileChange:i=>j(i.target.files),onRemoveImage:w,onAddClick:u,onSubmit:N,loading:_,showAmountError:g})},po=({reviewStats:t,onNavigateHistory:s})=>{const{pending_count:a,approved_count:r,isLoading:l}=t;return e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-[#FFE4C4]/60 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#333333] font-bold",children:[e.jsx(Sr,{size:18,className:"text-[#FF6B00]"}),"审核概览"]}),e.jsx("button",{className:"text-sm text-[#FF4500] font-medium hover:text-[#E63E00]",onClick:s,children:"查看历史"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-xl bg-[#FFF8F0] border border-[#FFE4C4] p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[#8B4513]/70",children:"审核中"}),e.jsx("div",{className:"text-2xl font-bold text-[#FF6B00]",children:l?"--":a})]}),e.jsx(ze,{size:22,className:"text-[#FF6B00]"})]}),e.jsxs("div",{className:"rounded-xl bg-[#F2FFFA] border border-[#B8EEDC] p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[#0F5132]/70",children:"已通过"}),e.jsx("div",{className:"text-2xl font-bold text-[#0F5132]",children:l?"--":r})]}),e.jsx(wt,{size:22,className:"text-[#0F5132]"})]})]})]})},yo=({onNavigate:t})=>{const{showToast:s}=he(),[a,r]=n.useState("apply"),{userInfo:l,setUserInfo:o,history:c,historyLoading:d,reviewStats:x,loadInitialData:m,loadHistory:b,loadReviewStats:g}=no(s),{unlockStatus:f,unlockLoading:h,loadUnlockStatus:j,handleUnlockLegacy:w}=xo({showToast:s,userInfo:l,setUserInfo:u=>o(u)});n.useEffect(()=>{m(),j()},[m,j]),n.useEffect(()=>{a==="unlock"&&j()},[a,j]);const v=n.useCallback(()=>t==null?void 0:t({name:"claim-history"}),[t]);return e.jsxs("div",{className:"min-h-screen bg-[#FFF8F0] pb-24 font-sans relative",children:[e.jsx("div",{className:"bg-[#FFDAB9] pt-safe pb-2 px-4 sticky top-0 z-20",children:e.jsxs("div",{className:"bg-[#FFE4C4]/50 p-1 rounded-2xl flex relative",children:[e.jsx("button",{onClick:()=>r("apply"),className:`flex-1 py-2.5 text-center rounded-xl text-base font-bold transition-all duration-300 relative z-10 ${a==="apply"?"bg-white text-[#FF4500] shadow-sm":"text-[#8B4513]/70 hover:bg-white/30"}`,children:"确权申请"}),e.jsx("button",{onClick:()=>r("unlock"),className:`flex-1 py-2.5 text-center rounded-xl text-base font-bold transition-all duration-300 relative z-10 ${a==="unlock"?"bg-white text-[#FF4500] shadow-sm":"text-[#8B4513]/70 hover:bg-white/30"}`,children:"旧资产解锁"})]})}),e.jsx("div",{className:"px-4 -mt-2 relative z-10",children:a==="apply"?e.jsxs(e.Fragment,{children:[e.jsx(io,{reviewStats:x}),e.jsx(po,{reviewStats:x,onNavigateHistory:v}),e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx(bo,{userBalance:f.currentGold||0,reviewStats:x,loadHistory:b,loadReviewStats:g,onNavigateHistory:v}),e.jsx(oo,{history:c,loading:d,onNavigateHistory:v})]})]}):e.jsx(co,{userInfo:l,unlockStatus:f,unlockLoading:h,onUnlock:w})})]})},jo=({onNavigate:t})=>e.jsx(yo,{onNavigate:t}),No=[{id:"1",title:"开启全民数商新生活",streamer:"树拍集团董事长",viewers:12500,image:"https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?auto=format&fit=crop&q=80&w=1000",avatar:"https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&q=80&w=100",isLive:!0},{id:"2",title:"新时代，新气象",streamer:"树拍易购官方直播间",viewers:8900,image:"https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&q=80&w=1000",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&q=80&w=100",isLive:!0},{id:"3",title:"如何开通数字店",streamer:"众欢商贸商行",viewers:3400,image:"https://images.unsplash.com/photo-1551836022-d5d88e9218df?auto=format&fit=crop&q=80&w=1000",avatar:"https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?auto=format&fit=crop&q=80&w=100",isLive:!0},{id:"4",title:"数字确权最新政策解读",streamer:"政策解读中心",viewers:5600,image:"https://images.unsplash.com/photo-1556155092-490a1ba16284?auto=format&fit=crop&q=80&w=1000",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&q=80&w=100",isLive:!0}],vo=()=>{var r,l;const[t,s]=n.useState("live"),a=[{id:"live",label:"直播",icon:Cr},{id:"replay",label:"回放",icon:Er}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx("div",{className:"bg-orange-600 sticky top-0 z-20 text-white shadow-lg",children:e.jsx("div",{className:"flex items-center justify-center px-4 pt-4 pb-2",children:e.jsx("div",{className:"flex justify-center space-x-12 text-base font-medium",children:a.map(o=>e.jsxs("button",{onClick:()=>s(o.id),className:`relative px-2 py-2 transition-colors duration-200 whitespace-nowrap ${t===o.id?"text-white text-lg font-bold":"text-orange-100/90"}`,children:[o.label,t===o.id&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-0.5 bg-white rounded-full p-1"})]},o.id))})})}),e.jsx("div",{className:"p-3",children:t==="live"&&e.jsx("div",{className:"grid grid-cols-2 gap-3",children:No.map(o=>e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-sm aspect-[3/4] relative group",children:[e.jsx("img",{src:o.image,alt:o.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90"}),o.isLive&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-1 bg-orange-600/90 backdrop-blur-sm px-2 py-0.5 rounded text-[10px] text-white font-medium",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-white"})]}),"正在直播"]}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/30 backdrop-blur-md px-2 py-0.5 rounded text-[10px] text-white/90",children:[o.viewers>1e4?(o.viewers/1e4).toFixed(1)+"w":o.viewers,"观看"]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-white",children:[e.jsx("h3",{className:"text-sm font-bold line-clamp-2 mb-2 leading-tight text-shadow-sm",children:o.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-white/50 overflow-hidden shrink-0",children:e.jsx("img",{src:o.avatar,alt:o.streamer,className:"w-full h-full object-cover"})}),e.jsx("span",{className:"text-xs text-white/90 truncate",children:o.streamer})]})]})]},o.id))})}),t!=="live"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(r=a.find(o=>o.id===t))==null?void 0:r.icon({size:32,className:"text-gray-300"})}),e.jsxs("p",{children:["暂无",(l=a.find(o=>o.id===t))==null?void 0:l.label,"内容"]})]})]})},wo=()=>ss(je.READ_NEWS_IDS_KEY,[])||[],_o=()=>{const{isLoggedIn:t,isRealNameVerified:s,login:a,logout:r,refreshRealNameStatus:l}=Ea(),[o,c]=n.useState(!1),[d,x]=n.useState(null),[m,b]=n.useState(null),[g,f]=n.useState("market"),[h,j]=n.useState("home"),[w,v]=n.useState(!1),{current:u,navigate:_,reset:N,goBack:i}=ti(null),F=n.useMemo(()=>u?ei(u):null,[u]),I=n.useMemo(()=>{const A=u===null;return console.log("[BottomNav] currentRoute:",(u==null?void 0:u.name)??"null","| shouldShow:",A),A},[u]),[z,p]=n.useState(0),{newsList:P,initWith:y,markAllRead:S,markReadById:k}=Ol([]),[T,D]=n.useState([]),[Y,L]=n.useState(!1),{pending:B,consumePending:K}=Ul(),C=n.useRef(null),E=n.useCallback((A,$)=>{_(A,{replace:$==null?void 0:$.replace,back:$==null?void 0:$.back,clearHistory:$==null?void 0:$.clearHistory})},[_]);es.useCallback(A=>{const $=A?Ia(A):null;E($)},[E]),n.useEffect(()=>(Lr(()=>{r(),N(),E(null,{clearHistory:!0}),j("home")}),()=>Mr()),[r,E,N]),n.useEffect(()=>{const A=C.current,$=u==null?void 0:u.name;A==="real-name-auth"&&$!=="real-name-auth"&&t&&(console.log("[实名状态] 从实名认证页面返回，刷新状态"),l()),C.current=$},[u==null?void 0:u.name,t,l]);const R=(A,$,U)=>{const G=String(A.id),J=$.includes(G);let se=A.content||"";return se=se.replace(/<\/p>/gi,`

`).replace(/<br\s*\/?>/gi,`
`).replace(/<\/li>/gi,`
`).replace(/<\/h[1-6]>/gi,`

`),se=se.replace(/<\/?[^>]+(>|$)/g,""),{id:G,date:A.createtime||"",title:A.title||"",isUnread:!J,type:U,content:se}};n.useEffect(()=>{(async()=>{var G;const $=Xe(je.AUTH_TOKEN_KEY),U=Xe(je.AUTH_KEY);if(U==="true"&&$)try{const J=await $e($);ee(J)&&((G=J.data)!=null&&G.userInfo)?(Jt(je.USER_INFO_KEY,J.data.userInfo),a({token:$,userInfo:J.data.userInfo}),fe("auth.verify","登录状态验证成功")):(Ke("auth.verify","Token无效，清除登录状态"),V())}catch(J){Fe("auth.verify","验证登录状态失败",J),J.name==="NeedLoginError"||J.code===303?(Ke("auth.verify","Token已失效（303错误），清除登录状态并跳转到登录页"),V()):J.isCorsError||J.name==="TypeError"?Ke("auth.verify","网络错误，保留登录状态，用户可以重试"):(Ke("auth.verify","未知错误，清除登录状态以确保安全"),V())}else U==="true"&&!$&&(Ke("auth.verify","登录标记存在但缺少token，清除登录状态"),V())})()},[]),n.useEffect(()=>{if(!t||h!=="home")return;(async()=>{var $,U;try{console.log("[公告] 开始加载公告数据...");const G=wo(),[J,se]=await Promise.all([Dt({page:1,limit:10,type:"normal",is_popup:1}),Dt({page:1,limit:10,type:"important",is_popup:1})]);console.log("[公告] API响应:",{announcementRes:J,dynamicRes:se});const de=(($=J.data)==null?void 0:$.list)??[],Re=((U=se.data)==null?void 0:U.list)??[];console.log("[公告] 获取到的数据:",{announcementCount:de.length,dynamicCount:Re.length,announcementList:de,dynamicList:Re});const ie=[...de.map(le=>R(le,G,"announcement")),...Re.map(le=>R(le,G,"dynamic"))];y(ie);const xe=[...de,...Re];console.log("[公告] 检查弹窗公告，总数:",xe.length),xe.forEach((le,me)=>{console.log(`[公告] 公告 #${me+1}:`,{id:le.id,title:le.title,is_popup:le.is_popup,is_popup_type:typeof le.is_popup,is_popup_number:Number(le.is_popup),matches:Number(le.is_popup)===1})});const ae=xe.filter(le=>Number(le.is_popup)===1);if(console.log("[公告] 找到的弹窗公告:",ae),ae.length>0){const le=new Date().toDateString(),me=ae.filter(ye=>{const M=`popup_dismissed_${ye.id}`;let X=null;try{X=localStorage.getItem(M)}catch{}const te=X!==le;return console.log(`[公告] 公告 #${ye.id} "${ye.title}" 检查:`,{dismissedDate:X,today:le,shouldShow:te}),te});if(console.log("[公告] 过滤后待显示的弹窗数量:",me.length),me.length>0){const ye=Number(me[0].popup_delay)||0;console.log(`[公告] 将在 ${ye}ms 后开始显示 ${me.length} 个弹窗`),setTimeout(()=>{console.log("[公告] 显示弹窗队列，共",me.length,"个"),D(me),L(!0)},ye)}else console.log("[公告] 所有弹窗今日都已关闭")}else console.log("[公告] 没有找到需要弹窗的公告")}catch(G){console.error("[公告] 加载资讯失败:",G)}})()},[t,h]);const O=A=>{fe("auth.login","开始执行登录",A),a(A),tt("auth.login.success",{hasPayload:!!A,pendingRedirect:!!B});const $=K();$?(fe("auth.login","跳转到待处理页面",$),$.tab&&j($.tab),$.route?E($.route):E(null,{clearHistory:!0})):(E(null,{clearHistory:!0}),j("home")),x(null)},V=()=>{r(),N(),E(null,{clearHistory:!0}),j("home"),x(null)},H=(A,$="market")=>{x(A),f($),A.productType==="shop"?E({name:"points-product-detail"}):E({name:"product-detail"})};if(n.useEffect(()=>{(u==null?void 0:u.name)==="news-detail"&&u.id&&k(u.id)},[u,k]),n.useEffect(()=>{(u==null?void 0:u.name)==="switch-to-market"&&(j("market"),E(null,{clearHistory:!0}))},[u,E]),n.useEffect(()=>{typeof window<"u"&&window.location.pathname==="/register"&&E("register")},[]),!t)return(u==null?void 0:u.name)==="register"?e.jsx(Hl,{onBack:()=>E(null),onRegisterSuccess:A=>{console.log("[App] 收到注册成功回调，loginPayload:",A),A&&A.token?(console.log("[App] 开始自动登录，token:",A.token),O(A)):(console.warn("[App] 没有收到登录信息，只关闭注册页面"),E(null))},onNavigateUserAgreement:()=>E({name:"user-agreement"}),onNavigatePrivacyPolicy:()=>E({name:"privacy-policy"})}):(u==null?void 0:u.name)==="privacy-policy"?e.jsx(Ma,{onBack:()=>i()}):(u==null?void 0:u.name)==="user-agreement"?e.jsx(Ga,{onBack:()=>i()}):(u==null?void 0:u.name)==="forgot-password"?e.jsx(Da,{onBack:()=>E(null)}):e.jsx(Gl,{onLogin:O,onNavigateRegister:()=>E({name:"register"}),onNavigateUserAgreement:()=>E({name:"user-agreement"}),onNavigatePrivacyPolicy:()=>E({name:"privacy-policy"}),onNavigateForgotPassword:()=>E({name:"forgot-password"})});const W=()=>{if(!s){const A=[null,"real-name-auth"],$=h!=="home"&&!F,U=u&&!A.includes(u.name);if($||U)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(Hs,{open:!0,isRealNameVerified:s,onNavigateToAuth:()=>{j("home"),E({name:"real-name-auth"})},onBackToHome:()=>{j("home"),E(null)},onNavigateToProfile:()=>{j("profile"),E(null)}})})}if((u==null?void 0:u.name)==="points-product-detail"&&d)return e.jsx(Kl,{product:d,onBack:()=>{i(),x(null)},onNavigate:A=>E(A)});if(u){const A=$l(u,{newsList:P,navigateRoute:E,handleProductSelect:H,setProductDetailOrigin:f,productDetailOrigin:g,handleLogout:V,selectedCollectionItem:m,setSelectedCollectionItem:b,markAllNewsRead:S,goBack:i});if(A)return A}if((u==null?void 0:u.name)==="product-detail"&&d)return e.jsx(Ha,{product:d,onBack:()=>{i(),x(null),f("market")},onNavigate:A=>E(A)});if((u==null?void 0:u.name)==="reservation"&&d)return e.jsx(Vl,{product:d,onBack:()=>i(),onNavigate:(A,$)=>E(A,$)});if((u==null?void 0:u.name)==="reservation-record")return e.jsx(Wl,{onBack:()=>i(),onNavigate:A=>E(A),onProductSelect:A=>H(A,"reservation-record")});if((u==null?void 0:u.name)==="my-collection-detail"&&m)return e.jsx(Oa,{item:m,onBack:()=>{E({name:"my-collection"}),b(null)},onNavigate:A=>E(A)});if((u==null?void 0:u.name)==="news-detail"){const A=u.id,$=P.find(U=>U.id===A);if($){k(A);const U=$.type==="announcement"?"announcement":"dynamics";try{Ve(je.NEWS_ACTIVE_TAB_KEY,U)}catch{}return e.jsx(Ta,{newsItem:$,onBack:()=>i()})}}if((u==null?void 0:u.name)==="friend-detail")return e.jsx(Yl,{id:u.id,friend:u.friend,onBack:()=>i()});if((u==null?void 0:u.name)==="artist-detail"&&u.id){const A=u.id;return e.jsx(Fa,{artistId:A,onBack:()=>i(),onProductSelect:$=>H($,"artist")})}if((u==null?void 0:u.name)==="order-list")return e.jsx(za,{category:u.kind,initialTab:u.status,onBack:()=>i(),onNavigate:A=>E(A)});switch(h){case"home":return e.jsx(ta,{onNavigate:A=>E(A),onSwitchTab:A=>j(A),announcements:P});case"market":return e.jsx(to,{onProductSelect:A=>H(A,"market")});case"rights":return e.jsx(jo,{onNavigate:A=>E(A)});case"live":return e.jsx(vo,{});case"profile":return e.jsx(ro,{onNavigate:A=>E(A),unreadCount:P.filter(A=>A.isUnread).length});default:return e.jsx(ta,{onNavigate:A=>E(A),onSwitchTab:A=>j(A),announcements:P})}};return e.jsxs("div",{className:"bg-gray-100 min-h-screen font-sans antialiased text-gray-900 max-w-md mx-auto relative shadow-2xl",children:[e.jsx("div",{className:"min-h-screen bg-gray-50 pb-safe",children:W()}),e.jsx(Hs,{open:o,isRealNameVerified:s,onNavigateToAuth:()=>{c(!1),j("home"),E("real-name-auth")},onBackToHome:()=>{c(!1),j("home"),E(null)},onNavigateToProfile:()=>{c(!1),j("profile"),E(null)}}),e.jsx(Qn,{visible:Y&&T.length>0,announcement:T[0]||null,onClose:()=>{D(A=>A.slice(1)),T.length<=1&&L(!1)},onDontShowToday:()=>{const A=T[0];if(A){const $=`popup_dismissed_${A.id}`;try{localStorage.setItem($,new Date().toDateString())}catch{}}}}),I&&e.jsx(Fr,{activeTab:h,onTabChange:A=>{j(A)}})]})},ko=()=>e.jsxs(hi,{children:[e.jsx(Ql,{}),e.jsx(_o,{})]}),Ya=document.getElementById("root");if(!Ya)throw new Error("Could not find root element to mount to");const So=Ir.createRoot(Ya);So.render(e.jsx(es.StrictMode,{children:e.jsx(ko,{})}));
